<!DOCTYPE html><html lang="ja"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=2"><meta name="theme-color" content="#FFF"><link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png"><link rel="icon" type="image/ico" sizes="32x32" href="/images/favicon.ico"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link rel="alternate" type="application/rss+xml" title="チンモクのブログ" href="https://www.chinmoku.cc/rss.xml"><link rel="alternate" type="application/atom+xml" title="チンモクのブログ" href="https://www.chinmoku.cc/atom.xml"><link rel="alternate" type="application/json" title="チンモクのブログ" href="https://www.chinmoku.cc/feed.json"><link rel="stylesheet" href="//fonts.googleapis.com/css?family=Mulish:300,300italic,400,400italic,700,700italic%7CFredericka%20the%20Great:300,300italic,400,400italic,700,700italic%7CNoto%20Serif%20JP:300,300italic,400,400italic,700,700italic%7CNoto%20Serif%20SC:300,300italic,400,400italic,700,700italic%7CInconsolata:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext"><link rel="stylesheet" href="/css/app.css?v=0.2.5"><meta name="keywords" content="python"><link rel="canonical" href="https://www.chinmoku.cc/computer-science/python/python-all-base/"><title>Python 基础知识全通关 - Python 入门教程 - 计算机科学 | Chinmoku = チンモクのブログ = 露の世は　露の世ながら　さりながら</title><meta name="generator" content="Hexo 5.4.0"></head><body itemscope itemtype="http://schema.org/WebPage"><div id="loading"><div class="cat"><div class="body"></div><div class="head"><div class="face"></div></div><div class="foot"><div class="tummy-end"></div><div class="bottom"></div><div class="legs left"></div><div class="legs right"></div></div><div class="paw"><div class="hands left"></div><div class="hands right"></div></div></div></div><div id="container"><header id="header" itemscope itemtype="http://schema.org/WPHeader"><div class="inner"><div id="brand"><div class="pjax"><h1 itemprop="name headline">Python 基础知识全通关</h1><div class="meta"><span class="item" title="作成日：2021-10-01 17:22:15"><span class="icon"><i class="ic i-calendar"></i> </span><span class="text">投稿日</span> <time itemprop="dateCreated datePublished" datetime="2021-10-01T17:22:15+08:00">2021-10-01</time> </span><span class="item" title="単語数"><span class="icon"><i class="ic i-pen"></i> </span><span class="text">単語数</span> <span>91k</span> <span class="text">単語</span> </span><span class="item" title="読書の時間"><span class="icon"><i class="ic i-clock"></i> </span><span class="text">読書の時間</span> <span>1:23</span></span></div></div></div><nav id="nav"><div class="inner"><div class="toggle"><div class="lines" aria-label="ナビゲーションバーの切り替え"><span class="line"></span> <span class="line"></span> <span class="line"></span></div></div><ul class="menu"><li class="item title"><a href="/" rel="start">Chinmoku</a></li></ul><ul class="right"><li class="item theme"><i class="ic i-sun"></i></li><li class="item search"><i class="ic i-search"></i></li></ul></div></nav></div><div id="imgs" class="pjax"><ul><li class="item" data-background-image="https://reference-1301046789.cos.ap-nanjing.myqcloud.com/blog-img/c03b148512e34fb39203704daf2cbe3b.jpg"></li><li class="item" data-background-image="https://reference-1301046789.cos.ap-nanjing.myqcloud.com/blog-img/590308ef821a48168723438e7052d196.jpg"></li><li class="item" data-background-image="https://reference-1301046789.cos.ap-nanjing.myqcloud.com/blog-img/23052aa8882d11ebb6edd017c2d2eca2.jpg"></li><li class="item" data-background-image="https://reference-1301046789.cos.ap-nanjing.myqcloud.com/blog-img/bc5c721d370341c8895d1a13b2dbb708.jpg"></li><li class="item" data-background-image="https://reference-1301046789.cos.ap-nanjing.myqcloud.com/blog-img/942fa2711d9b436299a229a3eb9b3924.jpg"></li><li class="item" data-background-image="https://reference-1301046789.cos.ap-nanjing.myqcloud.com/blog-img/f7c577369671490f9f2ca20b0695ddcd.jpg"></li></ul></div></header><div id="waves"><svg class="waves" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto"><defs><path id="gentle-wave" d="M-160 44c30 0 58-18 88-18s 58 18 88 18 58-18 88-18 58 18 88 18 v44h-352z"/></defs><g class="parallax"><use xlink:href="#gentle-wave" x="48" y="0"/><use xlink:href="#gentle-wave" x="48" y="3"/><use xlink:href="#gentle-wave" x="48" y="5"/><use xlink:href="#gentle-wave" x="48" y="7"/></g></svg></div><main><div class="inner"><div id="main" class="pjax"><div class="article wrap"><div class="breadcrumb" itemscope itemtype="https://schema.org/BreadcrumbList"><i class="ic i-home"></i> <span><a href="/">ホーム</a></span><i class="ic i-angle-right"></i> <span itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem"><a href="/categories/computer-science/" itemprop="item" rel="index" title="カテゴリ 计算机科学"><span itemprop="name">计算机科学</span></a><meta itemprop="position" content="1"></span><i class="ic i-angle-right"></i> <span class="current" itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem"><a href="/categories/computer-science/Python%E5%85%A5%E9%97%A8%E6%95%99%E7%A8%8B/" itemprop="item" rel="index" title="カテゴリ Python 入门教程"><span itemprop="name">Python 入门教程</span></a><meta itemprop="position" content="2"></span></div><article itemscope itemtype="http://schema.org/Article" class="post block" lang="ja"><link itemprop="mainEntityOfPage" href="https://www.chinmoku.cc/computer-science/python/python-all-base/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/images/avatar.jpg"><meta itemprop="name" content="チンモク"><meta itemprop="description" content="露の世は　露の世ながら　さりながら, 本站主要以 Java 开发总结文章为主，也会向技术周边进行适当的扩展。此外，偶尔会更新部分其他学习或感兴趣的内容，如语言学习、文本翻译、文艺创作等。"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="チンモクのブログ"></span><div class="body md" itemprop="articleBody"><div class="note info"><p>最近在工作的项目中，有一个模块的服务是使用 Python 脚本编写的，刚巧最近通过用户的反馈发现这个脚本有些 bug ，而我周围同事又都是 Java 体系的，对 Python 不太了解。基于这个原因，加上我之前也模糊了解过，大概知道 Python 的入门是很简单的。所以就干脆花点时间好好地学一下 Python ，预期能够入门并适用到一些简单的工作场景中。</p><p>关于开发语言的热度：<span class="exturl" data-url="aHR0cHM6Ly93d3cudGlvYmUuY29tL3Rpb2JlLWluZGV4">https://www.tiobe.com/tiobe-index</span></p><p>当然，不同开发语言各有优劣，脱离实际需要进行对比也无意义，能适应需要的语言，就是好的语言。</p><p>另外，本文作为 Python 基础学习的笔记，限于篇幅，对于部分较为深广的知识不做扩展，但响应部分都会尽量留出扩展链接，供有兴趣的读者进行深化了解。</p></div><h3 id="简介"><a class="anchor" href="#简介">#</a> 简介</h3><p>Python 的优点很多，简单的可以总结为以下几点。</p><ol><li>简单和明确，做一件事只有一种方法。</li><li>学习曲线低，跟其他很多语言相比，Python 更容易上手。</li><li>开放源代码，拥有强大的社区和生态圈。</li><li>解释型语言，天生具有平台可移植性。</li><li>支持两种主流的编程范式（面向对象编程和函数式编程）都提供了支持。</li><li>可扩展性和可嵌入性，可以调用 <code>C/C++</code> 代码，也可以在 <code>C/C++</code> 中调用 Python。</li><li>代码规范程度高，可读性强，适合有代码洁癖和强迫症的人群。</li></ol><p>Python 的缺点主要集中在以下几点。</p><ol><li>运行速度慢，和 C 程序相比非常慢，因为 Python 是解释型语言，你的代码在执行时会一行一行地翻译成 CPU 能理解的机器码，这个翻译过程非常耗时，所以很慢。</li><li>代码无法加密，发布出去的 Python 代码都是源代码，这是所有解释型语言的共性。</li><li>在开发时可以选择的框架太多（如 Web 框架就有 100 多个），有选择的地方就有错误。</li></ol><p>目前 Python 在 Web 应用开发、云基础设施、DevOps、网络爬虫开发、数据分析挖掘、机器学习等领域都有着广泛的应用，因此也产生了 Web 后端开发、数据接口开发、自动化运维、自动化测试、科学计算和可视化、数据分析、量化交易、机器人开发、图像识别和处理等一系列的职位。</p><h3 id="安装"><a class="anchor" href="#安装">#</a> 安装</h3><blockquote><p>本文作为学习示例，以 windows 作为学习环境，Python 当前文档版本号： <code>3.9.6</code></p></blockquote><h4 id="windows-环境"><a class="anchor" href="#windows-环境">#</a> Windows 环境</h4><p>官网下载：<span class="exturl" data-url="aHR0cHM6Ly93d3cucHl0aG9uLm9yZw==">https://www.python.org</span></p><p><img data-src="https://img.xfc-exclave.com/2021/08/1d551f6f77ba7c6dfd11272639e424981629963175.png" alt="Python官网首页"></p><p>从官网下载安装文件 <code>python-3.9.6-amd64.exe</code> 并双击执行安装：</p><p><img data-src="https://img.xfc-exclave.com/2021/08/dfa4fe1ca0aa52c76328e36fa6d4a78d1629963181.png" alt="Python安装引导"></p><blockquote><p>注意：安装时请勾选 <code>Add Python *.* to PATH</code> ，它将会为您自动配置环境变量。</p></blockquote><p>检验是否安装成功：</p><p><img data-src="https://img.xfc-exclave.com/2021/08/e21b309abd82d2f79572f8ad2f308cbb1629963192.png" alt="校验Python安装"></p><p>如图所示，则表示 Python 安装成功！</p><h4 id="linux-环境"><a class="anchor" href="#linux-环境">#</a> Linux 环境</h4><p>部分主机或虚拟机版本会内置安装 Python，如内置 Python 以足够，即可跳过此小节。</p><ol><li><p>选择 Python 版本（可选）。</p><p>如需指定版本号，<span class="exturl" data-url="aHR0cHM6Ly93d3cucHl0aG9uLm9yZy9mdHAvcHl0aG9uLw==">点击此处</span>前往官网进行选择，本文将以 <code>3.9.6</code> 作为示例。</p></li><li><p>安装并更新。</p><p>在合适的位置下载安装包：</p><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token function">wget</span> https://www.python.org/ftp/python/3.9.6/Python-3.9.6.tgz <span class="token comment"># 下载</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token function">tar</span> -zxvf Python-3.9.6.tgz -C /opt/module/ <span class="token comment"># 解压</span></pre></td></tr><tr><td data-num="3"></td><td><pre>yum -y <span class="token function">install</span> gcc zlib* libffi-devel <span class="token comment"># 安装编译 Python 所需要的开发包</span></pre></td></tr></table></figure><p>进入解压目录，进行编译和安装：</p><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token builtin class-name">cd</span> /opt/module/Python-3.9.6</pre></td></tr><tr><td data-num="2"></td><td><pre>./configure --prefix<span class="token operator">=</span>/usr/local/bin/python3</pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token function">make</span><span class="token operator">&amp;&amp;</span><span class="token function">make</span> <span class="token function">install</span></pre></td></tr></table></figure><blockquote><p>如在编译过程中提示 make 命令不存在，会给出相应的提示，可根据提示进行安装。</p></blockquote><p>删除原先的命令，并建立新的软连接：</p><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre>python3 -V <span class="token comment"># 此时仍是旧版本</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token function">rm</span> -rf /usr/bin/python3</pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token function">ln</span> -s /usr/local/bin/python3/bin/python3 /usr/bin/python3</pre></td></tr><tr><td data-num="4"></td><td><pre>python3 -V <span class="token comment"># 此时被替换为新安装的版本</span></pre></td></tr></table></figure><blockquote><p>注意：</p><ol><li>如果安装过程中出现网络问题，可尝试临时关闭防火墙。</li><li>如果出现权限问题，可尝试使用 root 或 sudo 用户身份。</li></ol></blockquote></li></ol><h3 id="hello-world"><a class="anchor" href="#hello-world">#</a> Hello World</h3><p>安装成功后，我们将开始学习如何编写第一个 Python 程序。</p><h4 id="命令行模式与-python-交互模式"><a class="anchor" href="#命令行模式与-python-交互模式">#</a> 命令行模式与 Python 交互模式</h4><p>正式编写 Python 程序之前，需要先了解一下什么是命令行模式，什么是 Python 模式。</p><ol><li><p>命令行模式</p><p>命令行模式，即命令提示符，也就是我们常说的 <code>CMD</code> 、小黑框等，它用于执行一些 Windows 命令。</p></li><li><p>Python 交互模式</p><p>在命令行模式下，输入 <code>python</code> ，即可进入 Python 交互模式，它以 <code>&gt;&gt;&gt;</code> 作为提示符。</p><p>在 Python 交互模式下，输入 <code>exit()</code> 或使用快捷键 <code>Ctrl + Z</code> 并回车，即可退出，回到命令行模式。</p><blockquote><p>Python 只是为调试代码提供方便，并非正式运行 Python 代码的环境。</p></blockquote></li></ol><p>尝试在 Python 交互模式下，执行一些简单的指令：</p><figure class="highlight shell"><figcaption data-lang="Bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token operator">>></span><span class="token operator">></span> <span class="token number">100</span> + <span class="token number">20</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token number">120</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token operator">>></span><span class="token operator">></span> print<span class="token punctuation">(</span><span class="token string">'Hello World~'</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="4"></td><td><pre>Hello World~</pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token operator">>></span><span class="token operator">></span> <span class="token number">2</span> ** <span class="token number">10</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token number">1024</span></pre></td></tr></table></figure><p>在命令行模式下，也可以执行 <code>python hello.py</code> 运行一个 <code>.py</code> 文件。</p><p><code>hello.py</code> 内容示例：</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token number">100</span> <span class="token operator">+</span> <span class="token number">20</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Hello World~'</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token number">2</span> <span class="token operator">**</span> <span class="token number">10</span><span class="token punctuation">)</span></pre></td></tr></table></figure><p>在命令行模式下执行：</p><figure class="highlight shell"><figcaption data-lang="Bash"></figcaption><table><tr><td data-num="1"></td><td><pre>C:<span class="token punctuation">\</span><span class="token operator">></span>python hello.py</pre></td></tr><tr><td data-num="2"></td><td><pre>Hello World~</pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token number">1024</span></pre></td></tr></table></figure><h4 id="选择开发工具"><a class="anchor" href="#选择开发工具">#</a> 选择开发工具</h4><p>在上文中，我们已经能够通过命令行执行一些简单的 Python 指令，但…… 总有点重上幼儿园的感觉。好吧，这不怪我们，怪只怪没有用上趁手的工具。这里提出几款可供选择的 Python 开发工具：</p><ul><li><p>PyCharm（推荐 1）</p><p>下载地址：<span class="exturl" data-url="aHR0cHM6Ly93d3cuamV0YnJhaW5zLmNvbS9weWNoYXJt">https://www.jetbrains.com/pycharm</span></p></li><li><p>Visual Studio Code（推荐 2）</p></li><li><p>Eclipse（不推荐）</p></li></ul><blockquote><p>PyCharm 社区版是免费的，商业版是收费的。我对用过的所有 JetBrains 的产品都欲罢不能，在选择开发工具方面，我个人的首选当然是 PyCharm 啦。</p></blockquote><p>使用 PyCharm 创建一个 Python 项目并运行，如下图所示：</p><p><img data-src="https://img.xfc-exclave.com/2021/08/0868aaf999e563773eb14044b3b6e4be1630046231.png" alt="PyCharm第一个程序"></p><h4 id="输入打印"><a class="anchor" href="#输入打印">#</a> 输入打印</h4><p>在上述示例中，我们反复用到了 <code>print()</code> 这个函数，它的作用就是将内容打印（输出）到控制台。而如果需要从控制台获取用户自定义输入的内容，则需要使用到 <code>input()</code> 函数，使用方式如下：</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre>name <span class="token operator">=</span> <span class="token builtin">input</span><span class="token punctuation">(</span><span class="token string">'Please input your name: '</span><span class="token punctuation">)</span><span class="token comment"># 开启输入，并提示</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Hello, '</span> <span class="token operator">+</span> name<span class="token punctuation">)</span><span class="token comment"># 打印用户输入的内容</span></pre></td></tr></table></figure><blockquote><p>注意，与 Java 不同，Python 每一行代码的结尾部分不需要添加 <code>;</code> 。</p></blockquote><h3 id="python-基础"><a class="anchor" href="#python-基础">#</a> Python 基础</h3><p>Python 的语法比较简单，采用缩进方式，示例代码如下：</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment"># print absolute value of an integer:</span></pre></td></tr><tr><td data-num="2"></td><td><pre>a <span class="token operator">=</span> <span class="token number">100</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">if</span> a <span class="token operator">>=</span> <span class="token number">0</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token keyword">print</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token keyword">else</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token operator">-</span>a<span class="token punctuation">)</span></pre></td></tr></table></figure><p>Python 语法特点：</p><ol><li><p>关于注释</p><p>Python 以 <code>#</code> 来表示注释，与其他语言一样，注释的作用只是为开发人员提供方便，对程序没有实际意义，解释器（或编译器）会忽略掉注释内容。</p></li><li><p>代码块</p><p>当缩进的语句以冒号 <code>:</code> 结尾时，缩进的语句被视为代码块。</p></li><li><p>缩进</p><p>Python 采用缩进方式组织代码，它对缩进是十分敏感的，但同时，它又并未规定具体的缩进方式，理论上两个或四个空格的缩进方式与一个制表符的缩进方式都是可以的，甚至在很多情况下混合使用也能够正常执行。但缩进作为 Python 语法的一部分，它是需要严谨对待的，编码人员一定要强制要求自己，在书写 Python 代码时，使用 4 个空格作为缩进方式。</p><blockquote><p>注意区分 4 个空格与 1 个 tab 的区别。</p><p>另外，Python 的缩进与 Java 不同，Java 缩进的作用仅仅是为了代码的美观和可读性。</p></blockquote></li><li><p>字母大小写</p><p>和 Java 一样，Python 程序也是大小写敏感的。</p></li></ol><h4 id="数据类型和变量"><a class="anchor" href="#数据类型和变量">#</a> 数据类型和变量</h4><ol><li><p>整数</p><p>Python 可以处理任意大小的整数（包括负整数），如需使用十六进制，则需要以 <code>0x</code> 作为前缀，例如 <code>0xff00</code> 。</p><p>对于较大的数值，为了提高可读性，Python 支持使用下划线来分割位数，例如 <code>10_000_000_000</code> 。</p></li><li><p>浮点数</p><p>浮点数也就是小数，之所以称为浮点数，是因为按照科学记数法表示时，一个浮点数的小数点位置是可变的。浮点数可以用数学写法，例如 <code>3.14</code> 。但是对于很大或很小的浮点数，就必须用科学计数法表示。</p><p>整数和浮点数在计算机内部存储的方式是不同的，整数运算永远是精确的，而浮点数运算则可能会有四舍五入的误差。</p></li><li><p>字符串</p><p>字符串是以英文单引号或双引号括起来的任意文本，引号本身只是一种表示方式，不是字符串的一部分。如果字符串内容本身带有引号，则要进行区分，关于引号的各种情况，可以参照以下代码清单：</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'It\'s a nice day!'</span><span class="token punctuation">)</span>  <span class="token comment"># 输出结果：It's a nice day!</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"It's a nice day!"</span><span class="token punctuation">)</span>  <span class="token comment"># 输出结果：It's a nice day!</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"He said: \"It's a nice day!\""</span><span class="token punctuation">)</span>  <span class="token comment"># He said: "It's a nice day!"</span></pre></td></tr></table></figure><p>这里使用到的 <code>\</code> 被称为转义字符，它除了可以对引号进行转义之外，还可以表示换行（ <code>\n</code> ）、制表符（ <code>\t</code> ）以及该字符本身（ <code>\\</code> ）。但是，当字符串中存在较多需要进行转义处理的字符时，Python 还允许使用 <code>r''</code> 来表示引号内部的字符串内容不转义，例如：</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">r'\n表示换行'</span> <span class="token operator">+</span> <span class="token string">"\nr''表示引用原字符"</span><span class="token punctuation">)</span></pre></td></tr></table></figure><p>但如果字符串内存在多个换行，使用 <code>\n</code> 换行时候，会对阅读造成不便，因此 Python 允许使用 <code>'''...'''</code> 的格式表示多行内容，例如：</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token triple-quoted-string string">'''My learning tasks:</span></pre></td></tr><tr><td data-num="2"></td><td><pre>Java</pre></td></tr><tr><td data-num="3"></td><td><pre>Python</pre></td></tr><tr><td data-num="4"></td><td><pre>Golang</pre></td></tr><tr><td data-num="5"></td><td><pre>'''<span class="token punctuation">)</span></pre></td></tr></table></figure><p>同样，多行字符 <code>'''...'''</code> 前也可以加上 <code>r</code> 字符结合使用。</p></li><li><p>布尔值</p><p>布尔值和布尔代数的表示完全一致，一个布尔值只有 <code>True</code> 、 <code>False</code> 两种值，要么是 <code>True</code> ，要么是 <code>False</code> ，在 Python 中，可以直接用 <code>True</code> 、 <code>False</code> 表示布尔值（注意大小写），也可以通过布尔运算计算出来：</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token builtin">bool</span> <span class="token operator">=</span> <span class="token number">1</span> <span class="token operator">&lt;</span> <span class="token number">2</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">></span> <span class="token number">2</span><span class="token punctuation">)</span>  <span class="token comment"># False</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">bool</span><span class="token punctuation">)</span>  <span class="token comment"># True</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token boolean">True</span><span class="token punctuation">)</span>  <span class="token comment"># True</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">bool</span> <span class="token operator">==</span> <span class="token boolean">False</span><span class="token punctuation">)</span>  <span class="token comment"># False</span></pre></td></tr></table></figure><p>布尔值可以使用 <code>and</code> 、 <code>or</code> 和 <code>not</code> 进行运算。</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre>t1 <span class="token operator">=</span> <span class="token number">1</span> <span class="token operator">&lt;</span> <span class="token number">2</span>  <span class="token comment"># True</span></pre></td></tr><tr><td data-num="2"></td><td><pre>f1 <span class="token operator">=</span> <span class="token number">1</span> <span class="token operator">></span> <span class="token number">2</span>  <span class="token comment"># False</span></pre></td></tr><tr><td data-num="3"></td><td><pre>t2 <span class="token operator">=</span> <span class="token number">2</span> <span class="token operator">></span> <span class="token number">1</span>  <span class="token comment"># True</span></pre></td></tr><tr><td data-num="4"></td><td><pre>f2 <span class="token operator">=</span> <span class="token number">2</span> <span class="token operator">&lt;</span> <span class="token number">1</span>  <span class="token comment"># False</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'and ------->'</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span>t1 <span class="token keyword">and</span> f1<span class="token punctuation">)</span>  <span class="token comment"># True and False => False</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span>t1 <span class="token keyword">and</span> t2<span class="token punctuation">)</span>  <span class="token comment"># True and True => True</span></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span>f1 <span class="token keyword">and</span> f2<span class="token punctuation">)</span>  <span class="token comment"># False and False => False</span></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'or ------->'</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span>t1 <span class="token keyword">or</span> f1<span class="token punctuation">)</span>  <span class="token comment"># True or False => True</span></pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span>t1 <span class="token keyword">or</span> t2<span class="token punctuation">)</span>  <span class="token comment"># True or True => True</span></pre></td></tr><tr><td data-num="12"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span>f1 <span class="token keyword">or</span> f2<span class="token punctuation">)</span>  <span class="token comment"># False or False => False</span></pre></td></tr><tr><td data-num="13"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'not ------->'</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="14"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token keyword">not</span> t1<span class="token punctuation">)</span>  <span class="token comment"># not True => False</span></pre></td></tr><tr><td data-num="15"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token keyword">not</span> f1<span class="token punctuation">)</span>  <span class="token comment"># not False => True</span></pre></td></tr></table></figure></li><li><p>空值</p><p>空值是 Python 里一个特殊的值，用 <code>None</code> 表示。</p></li><li><p>变量</p><p>变量名必须是大小写英文、数字和 <code>_</code> 的组合，且不能用数字开头，例如：</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre>age <span class="token operator">=</span> <span class="token number">20</span>  <span class="token comment"># age 是一个数值型的变量，它的值为 20</span></pre></td></tr><tr><td data-num="2"></td><td><pre>birth_98 <span class="token operator">=</span> <span class="token string">'1998年'</span>  <span class="token comment"># birth_98 是一个字符串类型的变量，它的值为【1998 年】</span></pre></td></tr><tr><td data-num="3"></td><td><pre>MyAnswer <span class="token operator">=</span> <span class="token boolean">True</span>  <span class="token comment"># 布尔型变量...</span></pre></td></tr></table></figure><p>在 Python 中，等号 <code>=</code> 是赋值语句，可以把任意数据类型赋值给变量，同一个变量可以反复赋值，而且可以是不同类型的变量，例如：</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre>totalPrice <span class="token operator">=</span> <span class="token number">0</span></pre></td></tr><tr><td data-num="2"></td><td><pre>bookPrice <span class="token operator">=</span> <span class="token number">299</span></pre></td></tr><tr><td data-num="3"></td><td><pre>pencilPrice <span class="token operator">=</span> <span class="token number">84</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'この本は　いくらですか？'</span><span class="token punctuation">)</span>  <span class="token comment"># 询问价格</span></pre></td></tr><tr><td data-num="5"></td><td><pre>priceAStr <span class="token operator">=</span> bookPrice<span class="token punctuation">.</span>__str__<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">'円です'</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span>priceAStr<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="7"></td><td><pre>totalPrice <span class="token operator">=</span> totalPrice <span class="token operator">+</span> bookPrice</pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'その鉛筆は？'</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span>pencilPrice<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="10"></td><td><pre>totalPrice <span class="token operator">+=</span> pencilPrice  <span class="token comment"># A += B ==> A = A + B</span></pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'全部でいくらですか？'</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="12"></td><td><pre>totalPrice <span class="token operator">=</span> totalPrice<span class="token punctuation">.</span>__str__<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">'円です'</span></pre></td></tr><tr><td data-num="13"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span>totalPrice<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="14"></td><td><pre></pre></td></tr><tr><td data-num="15"></td><td><pre><span class="token comment"># 哈哈，最近在日语入门，有点疯魔，不要介意</span></pre></td></tr></table></figure><p>示例中，变量 totalPrice 被进行了多次赋值，而且可以看到，对于同一变量，可以为其赋予不同类型的值。</p><p>这种变量本身类型不固定的语言称之为动态语言，与之对应的是静态语言。静态语言在定义变量时必须指定变量类型，如果赋值的时候类型不匹配，就会报错。也可以理解为强类型与弱类型，Python 是弱类型的语言。</p><p>和静态语言相比，动态语言更灵活。</p><blockquote><p>注意理解赋值语句与数学上的等号的区别。</p></blockquote></li><li><p>常量</p><p>所谓常量就是不能变的变量，比如常用的数学常数 <code>π</code> 就是一个常量。在 Python 中，通常用全部大写的变量名表示常量：</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre>PI <span class="token operator">=</span> <span class="token number">3.14159265359</span></pre></td></tr></table></figure><blockquote><p>但其实 Python 中并不存在常量，因为即便是通过大写的方式生命变量名，但它并没有与其他语言的 <code>const</code> 类似的修饰符，它不能保证它所谓的常量不被修改。而使用大写标识常量也只是人为的规定而已，实际上是可以被修改的。简单来说，<ins>Python 中没有常量</ins>。</p></blockquote></li></ol><p><strong>Python 中的除法：</strong></p><p>Python 的除法有两种方式：</p><ol><li><p><code>/</code> 获取浮点数结果。</p><p>这种除法方式的结果始终都是浮点数，不论是否能够被整除。</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token number">10</span> <span class="token operator">/</span> <span class="token number">3</span><span class="token punctuation">)</span>  <span class="token comment"># 3.3333333333333335</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token number">9</span> <span class="token operator">/</span> <span class="token number">3</span><span class="token punctuation">)</span>  <span class="token comment"># 3.0</span></pre></td></tr></table></figure></li><li><p><code>//</code> 被称为地板除。</p><p>这种除法会舍去运算结果的小数部分，如果是整数相除，则结果为整数类型，否则，结果为浮点类型，例如：</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token number">10</span> <span class="token operator">//</span> <span class="token number">3</span><span class="token punctuation">)</span>  <span class="token comment"># 3</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token number">9</span> <span class="token operator">//</span> <span class="token number">3</span><span class="token punctuation">)</span>  <span class="token comment"># 3</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token number">9.6</span> <span class="token operator">//</span> <span class="token number">3</span><span class="token punctuation">)</span>  <span class="token comment"># 3.0</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token number">9.6</span> <span class="token operator">//</span> <span class="token number">3.2</span><span class="token punctuation">)</span>  <span class="token comment"># 2.0</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token number">0.0006</span> <span class="token operator">//</span> <span class="token number">3</span><span class="token punctuation">)</span>  <span class="token comment"># 0.0</span></pre></td></tr></table></figure></li></ol><blockquote><p>注意：和 Java 不同，Python 的整数没有大小限。Python 的浮点数也没有大小限制，但是超出一定范围就直接表示为 <code>inf</code> （无限大）。</p></blockquote><h4 id="字符串和编码"><a class="anchor" href="#字符串和编码">#</a> 字符串和编码</h4><p>在最新的 Python 3 版本中，字符串是以 Unicode 编码的，也就是说，Python 的字符串支持多语言。</p><p>对于单个字符的编码，Python 提供了 <code>ord()</code> 函数获取字符的整数表示， <code>chr()</code> 函数把编码转换为对应的字符，例如：</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">ord</span><span class="token punctuation">(</span><span class="token string">'A'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># 65</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">ord</span><span class="token punctuation">(</span><span class="token string">'甲'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># 30002</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">ord</span><span class="token punctuation">(</span><span class="token string">'あ'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># 12354</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">chr</span><span class="token punctuation">(</span><span class="token number">65</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># A</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">chr</span><span class="token punctuation">(</span><span class="token number">30002</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># 甲</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">chr</span><span class="token punctuation">(</span><span class="token number">12354</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># あ</span></pre></td></tr></table></figure><p>另外，你也可以直接使用字符的整数编码，例如：</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'\u7532\u4e59\u4e19\u4e01'</span><span class="token punctuation">)</span>  <span class="token comment"># 甲乙丙丁</span></pre></td></tr></table></figure><p>关于中文转码，可以使用在线转码工具：<span class="exturl" data-url="aHR0cHM6Ly93d3cuYmVqc29uLmNvbS9jb252ZXJ0L3VuaWNvZGVfY2hpbmVzZQ==">https://www.bejson.com/convert/unicode_chinese</span></p><p>由于 Python 的字符串类型是 <code>str</code> ，在内存中以 Unicode 表示，一个字符对应若干个字节。如果要在网络上传输，或者保存到磁盘上，就需要把 <code>str</code> 变为以字节为单位的 <code>bytes</code> 。</p><p>Python 对 <code>bytes</code> 类型的数据用带 <code>b</code> 前缀的单引号或双引号表示：</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre>x <span class="token operator">=</span> <span class="token string">b'ABC'</span></pre></td></tr></table></figure><p>以 Unicode 表示的 <code>str</code> 通过 <code>encode()</code> 方法可以编码为指定的 <code>bytes</code> ，例如：</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'ABC'</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token string">'ascii'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># b'ABC'</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'中文'</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># b'\xe4\xb8\xad\xe6\x96\x87'</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'中文'</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token string">'ascii'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># 报错，因为 ASCII 无法表示中文</span></pre></td></tr></table></figure><p>反过来，如果需要从磁盘上读取字节流，就需要将 <code>bytes</code> 转换为字符串，这时就需要使用 <code>decode()</code> 方法：</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">b'ABC'</span><span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token string">'ascii'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># ABC</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">b'\xe4\xb8\xad\xe6\x96\x87'</span><span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># 中文</span></pre></td></tr></table></figure><p>Python 还提供了一个 <code>len()</code> 函数，用于计算字符长度或字节数：</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span><span class="token string">'中文'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># 2</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span><span class="token string">b'\xe4\xb8\xad\xe6\x96\x87'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># 6</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token builtin">len</span><span class="token punctuation">(</span><span class="token string">'中文'</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># 6</span></pre></td></tr></table></figure><blockquote><p>在 Unicode 编码中，一个中文字符占用 3 个字节，在字符串操作过程中，如果经常需要对将字符串与字节流进行转换，则需要尽量保持编码的一致性。</p></blockquote><p>我们在保存 Python 源代码时，为了让 Python 解释器在读取源码时按照 UTF-8 的编码读取，我们可以在文件开头位置指定读取的编码方式：</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">#!/usr/bin/env python3</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token comment"># -*- coding: utf-8 -*-</span></pre></td></tr></table></figure><p>字符串的格式化方式：</p><ol><li><p><code>%</code> 占位符格式化</p><p>在 Python 中，也可以对字符串进行格式化，它采用的格式化方式和 C 语言是一致的，用 <code>%</code> 实现，例如：</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Hello, %s!'</span> <span class="token operator">%</span> <span class="token string">'World'</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'I\'m learning %s! It had took me %d hours yet.'</span> <span class="token operator">%</span> <span class="token punctuation">(</span><span class="token string">'Python'</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr></table></figure><p><code>%</code> 用于占位和替换，其对应的占位符有四种类型：</p><ol><li><code>%s</code> 表示字符串占位。</li><li><code>%d</code> 表示整数占位。</li><li><code>%f</code> 表示浮点数占位。</li><li><code>%x</code> 表示十六进制整数占位。</li></ol><p>其中，格式化整数和浮点数还可以指定是否补 0 和整数与小数的位数：</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'%.2f'</span> <span class="token operator">%</span> <span class="token number">3.1415926</span><span class="token punctuation">)</span>  <span class="token comment"># 保留 2 位小数</span></pre></td></tr></table></figure></li><li><p><code>format()</code> 格式化</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Hello, &#123;0&#125;, 成绩提升了 &#123;1:.1f&#125;%'</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span><span class="token string">'小明'</span><span class="token punctuation">,</span> <span class="token number">17.125</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr></table></figure><p>这种方式相比占位符更加麻烦。</p></li><li><p><code>f-string</code> 格式化</p><p>这种格式化字符串的方法是使用以 <code>f</code> 开头的字符串，称之为 <code>f-string</code> ，它和普通字符串不同之处在于，字符串如果包含 <code>&#123;xxx&#125;</code> ，就会以对应的变量替换：</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre>r <span class="token operator">=</span> <span class="token number">2.5</span></pre></td></tr><tr><td data-num="2"></td><td><pre>s <span class="token operator">=</span> <span class="token number">3.14</span> <span class="token operator">*</span> r <span class="token operator">**</span> <span class="token number">2</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f'The area of a circle with radius </span><span class="token interpolation"><span class="token punctuation">&#123;</span>r<span class="token punctuation">&#125;</span></span><span class="token string"> is </span><span class="token interpolation"><span class="token punctuation">&#123;</span>s<span class="token punctuation">:</span><span class="token format-spec">.2f</span><span class="token punctuation">&#125;</span></span><span class="token string">'</span></span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token comment"># The area of a circle with radius 2.5 is 19.62</span></pre></td></tr></table></figure></li></ol><h4 id="list-和-tuple"><a class="anchor" href="#list-和-tuple">#</a> list 和 tuple</h4><h5 id="list"><a class="anchor" href="#list">#</a> list</h5><p>list（列表）是 Python 内置的一种数据类型，它是一种有序的集合，可以随时添加和删除其中的元素。</p><p>使用 <code>len()</code> 函数则可以获取到集合的大小。</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre>language <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'Zh-CN'</span><span class="token punctuation">,</span> <span class="token string">'En'</span><span class="token punctuation">,</span> <span class="token string">'Ja'</span><span class="token punctuation">]</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>language<span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># 3</span></pre></td></tr></table></figure><p>Python 中的列表概念 Java 基本一样，都是一个有序的列表，都是以 0 作为起始索引，所以超出范围会报越界错误。</p><p>我们可以向列表中插入追加数据，数据会默认追加到最后位置。</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre>language <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'Zh-CN'</span><span class="token punctuation">,</span> <span class="token string">'En'</span><span class="token punctuation">,</span> <span class="token string">'Ja'</span><span class="token punctuation">]</span></pre></td></tr><tr><td data-num="2"></td><td><pre>language<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token string">'Zh-TW'</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span>language<span class="token punctuation">)</span>  <span class="token comment"># ['Zh-CN', 'En', 'Ja', 'Zh-TW']</span></pre></td></tr></table></figure><p>当然，也可以将新的数据插入到指定的下标位置，例如：</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre>language <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'Zh-CN'</span><span class="token punctuation">,</span> <span class="token string">'En'</span><span class="token punctuation">,</span> <span class="token string">'Ja'</span><span class="token punctuation">]</span></pre></td></tr><tr><td data-num="2"></td><td><pre>language<span class="token punctuation">.</span>insert<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">'Zh-TW'</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span>language<span class="token punctuation">)</span>  <span class="token comment"># ['Zh-CN', 'Zh-TW', 'En', 'Ja']</span></pre></td></tr></table></figure><p>删除列表中的元素，需要使用 <code>pop()</code> ，如下：</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre>language <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'Zh-CN'</span><span class="token punctuation">,</span> <span class="token string">'Zh-TW'</span><span class="token punctuation">,</span> <span class="token string">'Ko'</span><span class="token punctuation">,</span> <span class="token string">'En'</span><span class="token punctuation">,</span> <span class="token string">'Ja'</span><span class="token punctuation">,</span> <span class="token string">'Fran'</span><span class="token punctuation">]</span></pre></td></tr><tr><td data-num="2"></td><td><pre>language<span class="token punctuation">.</span>pop<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment"># 不指定 pop () 函数的参数，则删除最后一个元素</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span>language<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="4"></td><td><pre>language<span class="token punctuation">.</span>pop<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>  <span class="token comment"># 删除指定下标位置的元素</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span>language<span class="token punctuation">)</span>  <span class="token comment"># ['Zh-CN', 'Zh-TW', 'En', 'Ja']</span></pre></td></tr></table></figure><p>替换元素：</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre>language <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'Zh-CN'</span><span class="token punctuation">,</span> <span class="token string">'En'</span><span class="token punctuation">,</span> <span class="token string">'Ja'</span><span class="token punctuation">]</span></pre></td></tr><tr><td data-num="2"></td><td><pre>language<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">'Zh-TW'</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span>language<span class="token punctuation">)</span>  <span class="token comment"># ['Zh-TW', 'En', 'Ja']</span></pre></td></tr></table></figure><p>列表中元素的数据类型并不一定要保持一致，如果数组列表中包含有列表类型的元素，则被称为多维数组。</p><h5 id="tuple"><a class="anchor" href="#tuple">#</a> tuple</h5><p>tuple（元组）是另一种有序列表，它和 list 非常相似，但 tuple 一旦初始化就不能修改。</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre>language <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token string">'Zh-CN'</span><span class="token punctuation">,</span> <span class="token string">'En'</span><span class="token punctuation">,</span> <span class="token string">'Ja'</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="2"></td><td><pre>language<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">'Zh-TW'</span>  <span class="token comment"># 报错：'tuple' object does not support item assignment</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span>language<span class="token punctuation">)</span></pre></td></tr></table></figure><p>元组列表没有提供 <code>append()</code> 和 <code>insert()</code> 类似的方法。</p><p>因为 tuple 初始化后是不可改变的，因而更具有安全性。</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre>tupleA <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment"># 定义一个空的 tuple</span></pre></td></tr><tr><td data-num="2"></td><td><pre>tupleB <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token punctuation">)</span>  <span class="token comment"># 当 tuple 内只有一个元素时，也需要添加逗号，以避免和数学公式符号混淆</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>tupleB<span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># 1</span></pre></td></tr></table></figure><p>可变的 tuple ？</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre>t <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token string">'a'</span><span class="token punctuation">,</span> <span class="token string">'b'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">'A'</span><span class="token punctuation">,</span> <span class="token string">'B'</span><span class="token punctuation">]</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="2"></td><td><pre>t<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">'X'</span></pre></td></tr><tr><td data-num="3"></td><td><pre>t<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">'Y'</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span>t<span class="token punctuation">)</span>  <span class="token comment"># ('a', 'b', ['X', 'Y'])</span></pre></td></tr></table></figure><p>这里的可变并不是真正的可变，这里变化的只是 tuple 内部的 list 元素，而 tuple 本身的指针指向并没有变。</p><h4 id="条件判断"><a class="anchor" href="#条件判断">#</a> 条件判断</h4><p>Python 使用 <code>if-elif-else</code> 作为条件判断的语法结构，其中 <code>elif</code> 其实是 <code>else if</code> 的缩写，该语法的完整形式的使用如下：</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre>condition <span class="token operator">=</span> <span class="token string">'A'</span></pre></td></tr><tr><td data-num="2"></td><td><pre></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">if</span> condition<span class="token punctuation">.</span>__eq__<span class="token punctuation">(</span><span class="token string">'A'</span><span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'do A'</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token keyword">elif</span> condition<span class="token punctuation">.</span>__eq__<span class="token punctuation">(</span><span class="token string">'B'</span><span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'do B'</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token keyword">elif</span> condition<span class="token punctuation">.</span>__eq__<span class="token punctuation">(</span><span class="token string">'C'</span><span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="8"></td><td><pre>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'do C'</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token keyword">else</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="10"></td><td><pre>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'do D'</span><span class="token punctuation">)</span></pre></td></tr></table></figure><p><code>if</code> 判断条件不一定要求是布尔类型或布尔类型的表达式，也可以是一些其他的数据类型，如果这些数据类型是非零数值、非空字符串、非空数组等，条件判断则为 <code>True</code> ，否则为 <code>False</code> ，例如：</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token builtin">str</span> <span class="token operator">=</span> <span class="token builtin">input</span><span class="token punctuation">(</span><span class="token string">'Please input and enter to judge true or false: '</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">if</span> <span class="token builtin">str</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Your input is: '</span> <span class="token operator">+</span> <span class="token builtin">str</span> <span class="token operator">+</span> <span class="token string">', it\'s true'</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token keyword">else</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Your input is: '</span> <span class="token operator">+</span> <span class="token builtin">str</span> <span class="token operator">+</span> <span class="token string">', it\'s false'</span><span class="token punctuation">)</span></pre></td></tr></table></figure><blockquote><p>通过输入不同内容，即可判断该输入内容是否为 True ，可以在您的开发工具中尝试一下，并观察返回结果。但同时，请注意，通过 <code>input()</code> 获取到的用户输入的所有内容都是字符串类型。</p></blockquote><p>如需要将字符串内容转换为数值型，可以使用 <code>int()</code> 函数。</p><h4 id="循环"><a class="anchor" href="#循环">#</a> 循环</h4><p>Python 中有两种循环方式：</p><ol><li><p><code>for...in</code></p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre>total <span class="token operator">=</span> <span class="token number">0</span></pre></td></tr><tr><td data-num="2"></td><td><pre>arr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">]</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">for</span> num <span class="token keyword">in</span> arr<span class="token punctuation">:</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    total <span class="token operator">+=</span> num</pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span>total<span class="token punctuation">)</span></pre></td></tr></table></figure><p>Python 也提供了一个 <code>range()</code> 方法用于生成整数序列，而通过 <code>list()</code> 方法可以将整数序列转换为数组，例如：</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token builtin">str</span> <span class="token operator">=</span> <span class="token string">'| '</span></pre></td></tr><tr><td data-num="2"></td><td><pre>arr <span class="token operator">=</span> <span class="token builtin">list</span><span class="token punctuation">(</span><span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">for</span> num <span class="token keyword">in</span> arr<span class="token punctuation">:</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token builtin">str</span> <span class="token operator">+=</span> num<span class="token punctuation">.</span>__str__<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">' | '</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">)</span>  <span class="token comment"># | 0 | 1 | 2 | 3 | 4 |</span></pre></td></tr></table></figure><blockquote><p><code>range()</code> 函数有两个参数，一个是起始值，一个是终止值，当起始为 0 时，可以省略不写。</p></blockquote></li><li><p><code>while</code></p><p>对于 while 循环，只要条件满足，就不断循环，条件不满足时退出循环。</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment"># 计算 100 以内所有奇数之和</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token builtin">sum</span> <span class="token operator">=</span> <span class="token number">0</span></pre></td></tr><tr><td data-num="3"></td><td><pre>n <span class="token operator">=</span> <span class="token number">99</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token keyword">while</span> n <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token builtin">sum</span> <span class="token operator">+=</span> n</pre></td></tr><tr><td data-num="6"></td><td><pre>    n <span class="token operator">=</span> n <span class="token operator">-</span> <span class="token number">2</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">sum</span><span class="token punctuation">)</span></pre></td></tr></table></figure></li></ol><p><code>break</code> 和 <code>continue</code> ：</p><ol><li><p><code>break</code></p><p>在循环中， <code>break</code> 语句可以提前退出循环。</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment"># 获取大于 100 的最小立方数</span></pre></td></tr><tr><td data-num="2"></td><td><pre>result <span class="token operator">=</span> <span class="token number">0</span></pre></td></tr><tr><td data-num="3"></td><td><pre>n <span class="token operator">=</span> <span class="token number">0</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    n <span class="token operator">+=</span> <span class="token number">1</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    result <span class="token operator">=</span> n <span class="token operator">*</span> n <span class="token operator">*</span> n</pre></td></tr><tr><td data-num="7"></td><td><pre>    <span class="token keyword">if</span> result <span class="token operator">></span> <span class="token number">100</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="8"></td><td><pre>        <span class="token keyword">break</span></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span>  <span class="token comment"># 125</span></pre></td></tr></table></figure></li><li><p><code>continue</code></p><p>在循环过程中，也可以通过 <code>continue</code> 语句，跳过当前的这次循环，直接开始下一次循环。</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment"># 获取 100 以内所有奇数的总和</span></pre></td></tr><tr><td data-num="2"></td><td><pre>total <span class="token operator">=</span> <span class="token number">0</span></pre></td></tr><tr><td data-num="3"></td><td><pre>n <span class="token operator">=</span> <span class="token number">0</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token keyword">while</span> n <span class="token operator">&lt;</span> <span class="token number">100</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    n <span class="token operator">+=</span> <span class="token number">1</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    <span class="token keyword">if</span> <span class="token punctuation">(</span>n <span class="token operator">%</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="7"></td><td><pre>        <span class="token keyword">continue</span>  <span class="token comment"># 当条件满足时，进入下一次循环</span></pre></td></tr><tr><td data-num="8"></td><td><pre>    total <span class="token operator">+=</span> n</pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span>total<span class="token punctuation">)</span>  <span class="token comment"># 2500</span></pre></td></tr></table></figure></li></ol><blockquote><p><code>break</code> 和 <code>continue</code> 的区别在于，前者是直接跳出整个循环结构，而后者当前正在循环的某一轮，可以理解为跳过当前循环，继续下一次。另外， <code>break</code> 往往适用于从众多数据中找到某一个符合特定条件的数据，而 <code>continue</code> 则适用于从众多数据中找到某一系列符合条件的数据。</p><p>注意：由于逻辑不够完善，或循环和跳出语句使用不当，可能会出现死循环的情况，就需要终止当前程序并检查代码逻辑。（在终端可使用 <code>Ctrl + C</code> 终止程序）</p></blockquote><h4 id="dict-和-set"><a class="anchor" href="#dict-和-set">#</a> dict 和 set</h4><h5 id="dict"><a class="anchor" href="#dict">#</a> dict</h5><p>Python 内置了字典（在其他语言中也称为 <code>map</code> ），它使用 <code>key-value</code> （键值对）的方式存储，具有极快的查找速度。</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre>data <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token string">'dataA'</span><span class="token punctuation">:</span> <span class="token number">30</span><span class="token punctuation">,</span> <span class="token string">'dataB'</span><span class="token punctuation">:</span> <span class="token number">73</span><span class="token punctuation">,</span> <span class="token string">'dataC'</span><span class="token punctuation">:</span> <span class="token operator">-</span><span class="token number">7</span><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span>data<span class="token punctuation">[</span><span class="token string">'dataB'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>  <span class="token comment"># 73</span></pre></td></tr></table></figure><p>也可以对 dict 中的值进行添加、修改或移除等操作：</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre>data <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token string">'dataA'</span><span class="token punctuation">:</span> <span class="token number">30</span><span class="token punctuation">,</span> <span class="token string">'dataB'</span><span class="token punctuation">:</span> <span class="token number">73</span><span class="token punctuation">,</span> <span class="token string">'dataC'</span><span class="token punctuation">:</span> <span class="token operator">-</span><span class="token number">7</span><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># 计算 dict 元素个数</span></pre></td></tr><tr><td data-num="3"></td><td><pre>data<span class="token punctuation">[</span><span class="token string">'dataB'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">54</span>  <span class="token comment"># 根据 key 值修改 dict 中的元素</span></pre></td></tr><tr><td data-num="4"></td><td><pre>data<span class="token punctuation">[</span><span class="token string">'dataD'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">108</span>  <span class="token comment"># 向 dict 中添加元素</span></pre></td></tr><tr><td data-num="5"></td><td><pre>data<span class="token punctuation">.</span>pop<span class="token punctuation">(</span><span class="token string">'dataA'</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>  <span class="token comment"># &#123;'dataB': 54, 'dataC': -7, 'dataD': 108&#125;</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token comment"># dict 的遍历</span></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token keyword">for</span> key <span class="token keyword">in</span> data<span class="token punctuation">:</span></pre></td></tr><tr><td data-num="9"></td><td><pre>    <span class="token keyword">print</span><span class="token punctuation">(</span>data<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="10"></td><td><pre>data<span class="token punctuation">.</span>clear<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment"># 清空 dict</span></pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>  <span class="token comment"># &#123;&#125;</span></pre></td></tr></table></figure><p>但是，在根据 key 从 dict 中获取值时，可能会出现 key 不存在的情况，这时就会引起程序报错，我们可以通过如下方式避免：</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre>data <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token string">'dataA'</span><span class="token punctuation">:</span> <span class="token number">30</span><span class="token punctuation">,</span> <span class="token string">'dataB'</span><span class="token punctuation">:</span> <span class="token number">73</span><span class="token punctuation">,</span> <span class="token string">'dataC'</span><span class="token punctuation">:</span> <span class="token operator">-</span><span class="token number">7</span><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token comment"># 方式一：判断要查询的 key 是否存在</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">if</span> <span class="token string">'dataD'</span> <span class="token keyword">in</span> data<span class="token punctuation">:</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token keyword">print</span><span class="token punctuation">(</span>data<span class="token punctuation">[</span><span class="token string">'dataD'</span><span class="token punctuation">]</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token comment"># 方式二：推荐</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'dataD'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># 未查询到时，返回 None</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'dataD'</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># 未查询到时，指定返回内容（这里是 - 1）</span></pre></td></tr></table></figure><blockquote><p>注意：在 Python 交互环境中，返回值为 None 是不会输出到控制台的，另外， dict 内部元素的存放顺序和 key 放入的顺序无关。</p></blockquote><p>dict 和 list 比较：</p><ol><li>对于查找和插入，dict 处理极快，不会随着 key 的增加而变慢，而 list 则会因为元素的不断增加变慢。</li><li>对于内存占用而言，dict 由于要存储键值对，占用内存较多，而 list 则占用很少。</li></ol><p>所以，list 的优势在于空间占用少，而 dict 的优势在于时间消耗少。</p><p>此外，由于 dict 是通过 key 来计算 value 的存储位置，所以程序需要保证 key 的对象的不可变性，这种不可变性，需要通过<ins>哈希算法</ins>进行保证。在 Python 中，字符串和整数都是不可变的，可以作为 dict 的 key 使用，但 list 却是可变的，不应当作为 key 使用。</p><h5 id="set"><a class="anchor" href="#set">#</a> set</h5><p>set 和 dict 类似，也是一组 key 的集合，但是 set 中不存储 value，由于 key 是不可重复的，所以 set 中不存在重复的数据。</p><p>要创建一个 set，需要先提供一个 list 作为输入集合：</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre>s1 <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">&#125;</span>  <span class="token comment"># 直接声明 set，重复值时无效的</span></pre></td></tr><tr><td data-num="2"></td><td><pre>s1<span class="token punctuation">.</span>add<span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span>  <span class="token comment"># 向 set 中添加元素</span></pre></td></tr><tr><td data-num="3"></td><td><pre>s1<span class="token punctuation">.</span>add<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>  <span class="token comment"># 如果添加元素已存在，不会引起报错，但也不会重复添加</span></pre></td></tr><tr><td data-num="4"></td><td><pre>s1<span class="token punctuation">.</span>remove<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>  <span class="token comment"># 移除 set 中某个元素</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span>s1<span class="token punctuation">)</span>  <span class="token comment"># &#123;1, 3, 4&#125;</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>s1<span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># 计算元素个数</span></pre></td></tr><tr><td data-num="7"></td><td><pre>list1 <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span></pre></td></tr><tr><td data-num="8"></td><td><pre>s2 <span class="token operator">=</span> <span class="token builtin">set</span><span class="token punctuation">(</span>list1<span class="token punctuation">)</span>  <span class="token comment"># 将 list 转为 set</span></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span>s2<span class="token punctuation">)</span>  <span class="token comment"># &#123;1, 2, 3&#125;</span></pre></td></tr><tr><td data-num="10"></td><td><pre>s1<span class="token punctuation">.</span>clear<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment"># 清空 set</span></pre></td></tr></table></figure><p>set 无序不重复的元素集合，它可以做数学意义上的交集、并集处理：</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre>s1 <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>s2 <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token comment"># 交集</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span>s1 <span class="token operator">&amp;</span> s2<span class="token punctuation">)</span>  <span class="token comment"># &#123;2, 4&#125;</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token comment"># 并集</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span>s1 <span class="token operator">|</span> s2<span class="token punctuation">)</span>  <span class="token comment"># &#123;1, 2, 3, 4, 6, 8&#125;</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token comment"># set 中存放 list 会导致报错</span></pre></td></tr><tr><td data-num="8"></td><td><pre>s3 <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span>s3<span class="token punctuation">)</span>  <span class="token comment"># 报错：TypeError: unhashable type: 'list'</span></pre></td></tr></table></figure><blockquote><p>set 中存放 list 作为元素会引起报错，其原理和 dict 是一样的。</p></blockquote><h3 id="函数"><a class="anchor" href="#函数">#</a> 函数</h3><p>Python 内置了很多有用的函数，我们可以直接调用，例如在上文中频繁使用到的 <code>len()</code> 。</p><h4 id="调用函数"><a class="anchor" href="#调用函数">#</a> 调用函数</h4><p>要调用一个函数，需要知道函数的名称和参数，而且需要保证参数的类型及顺序的一致，否则就会引起程序错误。</p><p>也有一些函数可以接收任意多个参数。</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">abs</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">13.2</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># 13.2</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">max</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">18</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">33</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># 33</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token comment"># 类型转换函数</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">(</span><span class="token string">'15'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># 15</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">float</span><span class="token punctuation">(</span><span class="token string">'2.18'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># 2.18</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">(</span><span class="token number">1.62</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># 1.62</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">bool</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># True</span></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">bool</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># False</span></pre></td></tr></table></figure><p>函数名其实就是指向一个函数对象的引用，完全可以把函数名赋给一个变量，相当于给这个函数起了一个别名：</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre>a <span class="token operator">=</span> <span class="token builtin">abs</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span>a<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># 6</span></pre></td></tr></table></figure><h4 id="定义函数"><a class="anchor" href="#定义函数">#</a> 定义函数</h4><p>在 Python 中，定义一个函数要使用 <code>def</code> 语句，依次写出函数名、括号、括号中的参数和冒号 <code>:</code> ，然后，在缩进块中编写函数体，函数的返回值用 <code>return</code> 语句返回（无返回值不写即可）。</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">def</span> <span class="token function">division</span><span class="token punctuation">(</span>m<span class="token punctuation">,</span> n<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token keyword">if</span> n <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="3"></td><td><pre>        <span class="token keyword">return</span>  <span class="token comment"># return None 可以直接简写为 return</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token keyword">else</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="5"></td><td><pre>        <span class="token keyword">return</span> m <span class="token operator">/</span> n</pre></td></tr><tr><td data-num="6"></td><td><pre></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span>division<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># 2.5</span></pre></td></tr></table></figure><p>当暂未想好如何定义函数的实现时，可以定义一个空函数，它的目的是进行占位，当想好函数的实现内容时在填充即可。</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre>i <span class="token operator">=</span> <span class="token number">1001</span></pre></td></tr><tr><td data-num="2"></td><td><pre>u <span class="token operator">=</span> <span class="token number">1005</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">def</span> <span class="token function">say</span><span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token keyword">pass</span></pre></td></tr><tr><td data-num="6"></td><td><pre></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token keyword">if</span> i <span class="token operator">==</span> u<span class="token punctuation">:</span>  <span class="token comment"># if I were You</span></pre></td></tr><tr><td data-num="8"></td><td><pre>    <span class="token keyword">pass</span>  <span class="token comment"># I would ...  # if 内容暂未确定，但留空又会报错</span></pre></td></tr><tr><td data-num="9"></td><td><pre>say<span class="token punctuation">(</span><span class="token string">'Anyway!!!'</span><span class="token punctuation">)</span>  <span class="token comment"># but I'm not, so, >>></span></pre></td></tr></table></figure><p>调用函数时，如果参数个数不对，Python 解释器会自动检查出来，并抛出 <code>TypeError</code> 错误，但是如果参数类型不对，Python 解释器就无法帮我们检查。</p><blockquote><p>但是现在的 IDE 工具很智能了，PyCharm 在代码编写时就可以帮助我们规避很多错误，例如参数检查。</p></blockquote><p>因此，我们定义函数的时候，可以进行参数类型检查：</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">def</span> <span class="token function">division</span><span class="token punctuation">(</span>m<span class="token punctuation">,</span> n<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token keyword">if</span> <span class="token keyword">not</span> <span class="token builtin">isinstance</span><span class="token punctuation">(</span>m<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">,</span> <span class="token builtin">float</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="3"></td><td><pre>        <span class="token keyword">raise</span> TypeError<span class="token punctuation">(</span><span class="token string">'您传入的除数必须是数值型'</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token keyword">if</span> <span class="token keyword">not</span> <span class="token builtin">isinstance</span><span class="token punctuation">(</span>n<span class="token punctuation">,</span> <span class="token builtin">int</span><span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="5"></td><td><pre>        <span class="token keyword">raise</span> TypeError<span class="token punctuation">(</span><span class="token string">'您传入的被除数必须是整数'</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    <span class="token keyword">if</span> n <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="7"></td><td><pre>        <span class="token keyword">return</span></pre></td></tr><tr><td data-num="8"></td><td><pre>    <span class="token keyword">else</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="9"></td><td><pre>        <span class="token keyword">return</span> m <span class="token operator">/</span> n</pre></td></tr><tr><td data-num="10"></td><td><pre></pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span>division<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">4.5</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># 抛出【您传入的被除数必须是整数】错误</span></pre></td></tr></table></figure><p>Python 函数也可以返回多个值：</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">def</span> <span class="token function">maxAndMin</span><span class="token punctuation">(</span>arr<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token builtin">max</span> <span class="token operator">=</span> arr<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token builtin">min</span> <span class="token operator">=</span> arr<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token keyword">for</span> item <span class="token keyword">in</span> arr<span class="token punctuation">:</span></pre></td></tr><tr><td data-num="5"></td><td><pre>        <span class="token keyword">if</span> item <span class="token operator">></span> <span class="token builtin">max</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="6"></td><td><pre>            <span class="token builtin">max</span> <span class="token operator">=</span> item</pre></td></tr><tr><td data-num="7"></td><td><pre>        <span class="token keyword">if</span> item <span class="token operator">&lt;</span> <span class="token builtin">min</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="8"></td><td><pre>            <span class="token builtin">min</span> <span class="token operator">=</span> item</pre></td></tr><tr><td data-num="9"></td><td><pre>    <span class="token keyword">return</span> <span class="token builtin">max</span><span class="token punctuation">,</span> <span class="token builtin">min</span></pre></td></tr><tr><td data-num="10"></td><td><pre></pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token builtin">max</span><span class="token punctuation">,</span> <span class="token builtin">min</span> <span class="token operator">=</span> maxAndMin<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">53</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">28</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">]</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="12"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'max = '</span><span class="token punctuation">,</span> <span class="token builtin">max</span><span class="token punctuation">)</span>  <span class="token comment"># max =  53</span></pre></td></tr><tr><td data-num="13"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'min = '</span><span class="token punctuation">,</span> <span class="token builtin">min</span><span class="token punctuation">)</span>  <span class="token comment"># min =  -1</span></pre></td></tr><tr><td data-num="14"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span>maxAndMin<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">53</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">28</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># (53, -1)</span></pre></td></tr></table></figure><blockquote><p>从示例中可以看到，Python 函数返回多个值其实是一种假象，它返回多个值，其实本质上是返回一个 tuple 。</p></blockquote><p>尝试定义一个函数 <code>quadratic(a, b, c)</code> 来求出一元二次方程的解，公式定义：<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>a</mi><msup><mi>x</mi><mn>2</mn></msup><mo>+</mo><mi>b</mi><mi>x</mi><mo>+</mo><mi>c</mi><mo>=</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">ax^2 + bx + c = 0</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.897438em;vertical-align:-.08333em"></span><span class="mord mathnormal">a</span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:.8141079999999999em"><span style="top:-3.063em;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:.2222222222222222em"></span><span class="mbin">+</span><span class="mspace" style="margin-right:.2222222222222222em"></span></span><span class="base"><span class="strut" style="height:.77777em;vertical-align:-.08333em"></span><span class="mord mathnormal">b</span><span class="mord mathnormal">x</span><span class="mspace" style="margin-right:.2222222222222222em"></span><span class="mbin">+</span><span class="mspace" style="margin-right:.2222222222222222em"></span></span><span class="base"><span class="strut" style="height:.43056em;vertical-align:0"></span><span class="mord mathnormal">c</span><span class="mspace" style="margin-right:.2777777777777778em"></span><span class="mrel">=</span><span class="mspace" style="margin-right:.2777777777777778em"></span></span><span class="base"><span class="strut" style="height:.64444em;vertical-align:0"></span><span class="mord">0</span></span></span></span></p><blockquote><p>提示：</p><ol><li><p>一元二次方程的求根公式为：</p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mtable rowspacing="0.15999999999999992em" columnalign="center" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mi>x</mi><mo>=</mo><mfrac><mrow><mo>−</mo><mi>b</mi><mo>±</mo><msqrt><mrow><msup><mi>b</mi><mn>2</mn></msup><mo>−</mo><mn>4</mn><mi>a</mi><mi>c</mi></mrow></msqrt></mrow><mrow><mn>2</mn><mi>a</mi></mrow></mfrac></mrow></mstyle></mtd></mtr></mtable><annotation encoding="application/x-tex">\begin {array}{c} x = \frac{-b±\sqrt {b^2-4ac}}{2a} \end {array}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.3994820000000001em;vertical-align:-.449741em"></span><span class="mord"><span class="mtable"><span class="arraycolsep" style="width:.5em"></span><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.9497410000000002em"><span style="top:-2.949741em"><span class="pstrut" style="height:3.039482em"></span><span class="mord"><span class="mord mathnormal">x</span><span class="mspace" style="margin-right:.2777777777777778em"></span><span class="mrel">=</span><span class="mspace" style="margin-right:.2777777777777778em"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.039482em"><span style="top:-2.6550000000000002em"><span class="pstrut" style="height:3em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span><span class="mord mathnormal mtight">a</span></span></span></span><span style="top:-3.23em"><span class="pstrut" style="height:3em"></span><span class="frac-line" style="border-bottom-width:.04em"></span></span><span style="top:-3.3939999999999997em"><span class="pstrut" style="height:3em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">−</span><span class="mord mathnormal mtight">b</span><span class="mbin mtight">±</span><span class="mord sqrt mtight"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.9221171428571429em"><span class="svg-align" style="top:-3em"><span class="pstrut" style="height:3em"></span><span class="mord mtight" style="padding-left:.833em"><span class="mord mtight"><span class="mord mathnormal mtight">b</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:.7463142857142857em"><span style="top:-2.786em;margin-right:.07142857142857144em"><span class="pstrut" style="height:2.5em"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mbin mtight">−</span><span class="mord mtight">4</span><span class="mord mathnormal mtight">a</span><span class="mord mathnormal mtight">c</span></span></span><span style="top:-2.882117142857143em"><span class="pstrut" style="height:3em"></span><span class="hide-tail mtight" style="min-width:.853em;height:1.08em"><svg width="400em" height="1.08em" viewBox="0 0 400000 1080" preserveAspectRatio="xMinYMin slice"><path d="M95,702
c-2.7,0,-7.17,-2.7,-13.5,-8c-5.8,-5.3,-9.5,-10,-9.5,-14
c0,-2,0.3,-3.3,1,-4c1.3,-2.7,23.83,-20.7,67.5,-54
c44.2,-33.3,65.8,-50.3,66.5,-51c1.3,-1.3,3,-2,5,-2c4.7,0,8.7,3.3,12,10
s173,378,173,378c0.7,0,35.3,-71,104,-213c68.7,-142,137.5,-285,206.5,-429
c69,-144,104.5,-217.7,106.5,-221
l0 -0
c5.3,-9.3,12,-14,20,-14
H400000v40H845.2724
s-225.272,467,-225.272,467s-235,486,-235,486c-2.7,4.7,-9,7,-19,7
c-6,0,-10,-1,-12,-3s-194,-422,-194,-422s-65,47,-65,47z
M834 80h400000v40h-400000z"/></svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.11788285714285718em"><span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.345em"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.449741em"><span></span></span></span></span></span><span class="arraycolsep" style="width:.5em"></span></span></span></span></span></span></span></p></li><li><p>计算平方根可以调用 <code>math.sqrt()</code> 函数。</p></li></ol></blockquote><p>使用下面的代码来尝试一下吧：</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">import</span> math</pre></td></tr><tr><td data-num="2"></td><td><pre></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">def</span> <span class="token function">quadratic</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">,</span> c<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token keyword">pass</span>  <span class="token comment"># 在这里写入你的代码逻辑</span></pre></td></tr><tr><td data-num="5"></td><td><pre></pre></td></tr><tr><td data-num="6"></td><td><pre>a <span class="token operator">=</span> <span class="token builtin">input</span><span class="token punctuation">(</span><span class="token string">'Input parameter a: '</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="7"></td><td><pre>b <span class="token operator">=</span> <span class="token builtin">input</span><span class="token punctuation">(</span><span class="token string">'Input parameter b: '</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="8"></td><td><pre>c <span class="token operator">=</span> <span class="token builtin">input</span><span class="token punctuation">(</span><span class="token string">'Input parameter c: '</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token keyword">try</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="10"></td><td><pre>    a <span class="token operator">=</span> <span class="token builtin">float</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="11"></td><td><pre>    b <span class="token operator">=</span> <span class="token builtin">float</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="12"></td><td><pre>    c <span class="token operator">=</span> <span class="token builtin">float</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="13"></td><td><pre><span class="token keyword">except</span> ValueError<span class="token punctuation">:</span></pre></td></tr><tr><td data-num="14"></td><td><pre>    <span class="token keyword">raise</span> ValueError<span class="token punctuation">(</span><span class="token string">'参数错误：请传入数值类型的参数'</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="15"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Get result = '</span> <span class="token operator">+</span> quadratic<span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">,</span> c<span class="token punctuation">)</span><span class="token punctuation">.</span>__str__<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr></table></figure><details><summary>点击这里查看参考答案。</summary><div><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">import</span> math</pre></td></tr><tr><td data-num="2"></td><td><pre></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">def</span> <span class="token function">quadratic</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">,</span> c<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    x1 <span class="token operator">=</span> <span class="token boolean">None</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    x2 <span class="token operator">=</span> <span class="token boolean">None</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    <span class="token comment"># 1. 参数校验</span></pre></td></tr><tr><td data-num="7"></td><td><pre>    <span class="token keyword">if</span> a <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="8"></td><td><pre>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'参数错误：一元二次方程的a值不能为0'</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="9"></td><td><pre>        <span class="token keyword">return</span></pre></td></tr><tr><td data-num="10"></td><td><pre>    <span class="token comment"># 2. 判断有多少个解</span></pre></td></tr><tr><td data-num="11"></td><td><pre>    d <span class="token operator">=</span> b <span class="token operator">**</span> <span class="token number">2</span> <span class="token operator">-</span> <span class="token number">4</span> <span class="token operator">*</span> a <span class="token operator">*</span> c</pre></td></tr><tr><td data-num="12"></td><td><pre>    <span class="token keyword">if</span> d <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">:</span>  <span class="token comment"># 该方程只有一个解，或两个解相同</span></pre></td></tr><tr><td data-num="13"></td><td><pre>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'该一元二次方程没有【无解】'</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="14"></td><td><pre>    <span class="token keyword">elif</span> d <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="15"></td><td><pre>        x1 <span class="token operator">=</span> b <span class="token operator">/</span> <span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">2</span> <span class="token operator">*</span> a<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="16"></td><td><pre>        x2 <span class="token operator">=</span> x1</pre></td></tr><tr><td data-num="17"></td><td><pre>    <span class="token keyword">else</span><span class="token punctuation">:</span>  <span class="token comment"># 该方程有两个解</span></pre></td></tr><tr><td data-num="18"></td><td><pre>        x1 <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token operator">-</span>b <span class="token operator">+</span> math<span class="token punctuation">.</span>sqrt<span class="token punctuation">(</span>d<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token punctuation">(</span><span class="token number">2</span> <span class="token operator">*</span> a<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="19"></td><td><pre>        x2 <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token operator">-</span>b <span class="token operator">-</span> math<span class="token punctuation">.</span>sqrt<span class="token punctuation">(</span>d<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token punctuation">(</span><span class="token number">2</span> <span class="token operator">*</span> a<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="20"></td><td><pre>    <span class="token keyword">return</span> x1<span class="token punctuation">,</span> x2</pre></td></tr><tr><td data-num="21"></td><td><pre></pre></td></tr><tr><td data-num="22"></td><td><pre>a <span class="token operator">=</span> <span class="token builtin">input</span><span class="token punctuation">(</span><span class="token string">'Input parameter a: '</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="23"></td><td><pre>b <span class="token operator">=</span> <span class="token builtin">input</span><span class="token punctuation">(</span><span class="token string">'Input parameter b: '</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="24"></td><td><pre>c <span class="token operator">=</span> <span class="token builtin">input</span><span class="token punctuation">(</span><span class="token string">'Input parameter c: '</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="25"></td><td><pre><span class="token keyword">try</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="26"></td><td><pre>    a <span class="token operator">=</span> <span class="token builtin">float</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="27"></td><td><pre>    b <span class="token operator">=</span> <span class="token builtin">float</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="28"></td><td><pre>    c <span class="token operator">=</span> <span class="token builtin">float</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="29"></td><td><pre><span class="token keyword">except</span> ValueError<span class="token punctuation">:</span></pre></td></tr><tr><td data-num="30"></td><td><pre>    <span class="token keyword">raise</span> ValueError<span class="token punctuation">(</span><span class="token string">'参数错误：请传入数值类型的参数'</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="31"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Get result = '</span> <span class="token operator">+</span> quadratic<span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">,</span> c<span class="token punctuation">)</span><span class="token punctuation">.</span>__str__<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr></table></figure><blockquote><p>可以尝试输入一些下面这几组参数进行验证：</p><p>1, 2, -3 -&gt; (1.0, -3.0)</p><p>4, 6, 0 -&gt; (0.0, -1.5)</p><p>1, 4, 4 -&gt; (-2.0, -2.0)</p></blockquote></div></details><h4 id="函数的参数"><a class="anchor" href="#函数的参数">#</a> 函数的参数</h4><ol><li><p>位置参数</p><p>在前文中，我们已经多次使用到位置参数，所谓位置参数，就是在调用函数时，指定的实际参数的数量，必须和形式参数的数量保持一致，否则就会抛出 <code>TypeError</code> 异常。</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">def</span> <span class="token function">power</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> n<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    s <span class="token operator">=</span> <span class="token number">1</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token keyword">while</span> n <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="4"></td><td><pre>        s <span class="token operator">*=</span> x</pre></td></tr><tr><td data-num="5"></td><td><pre>        n <span class="token operator">-=</span> <span class="token number">1</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    <span class="token keyword">return</span> s</pre></td></tr><tr><td data-num="7"></td><td><pre></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span>power<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr></table></figure></li><li><p>默认参数</p><p>默认参数是指当函数调用方不传递时，函数指定参数具有一个默认的值。</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">def</span> <span class="token function">power</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> n<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">:</span>  <span class="token comment"># 次方数默认为 2</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    s <span class="token operator">=</span> <span class="token number">1</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token keyword">while</span> n <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="4"></td><td><pre>        s <span class="token operator">*=</span> x</pre></td></tr><tr><td data-num="5"></td><td><pre>        n <span class="token operator">-=</span> <span class="token number">1</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    <span class="token keyword">return</span> s</pre></td></tr><tr><td data-num="7"></td><td><pre></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span>power<span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr></table></figure><p>使用默认参数需要记住以下原则：</p><ul><li><p>位置参数放前，默认参数放后。</p></li><li><p>确定性大的参数放前，确定性小的参数放后。</p></li><li><p>调用的函数需要传递默认参数，但参数位置不匹配时，需要指定参数名。</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">def</span> <span class="token function">test</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> age<span class="token punctuation">,</span> school<span class="token operator">=</span><span class="token string">''</span><span class="token punctuation">,</span> gender<span class="token operator">=</span><span class="token string">'Male'</span><span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token keyword">pass</span></pre></td></tr><tr><td data-num="3"></td><td><pre></pre></td></tr><tr><td data-num="4"></td><td><pre>a <span class="token operator">=</span> <span class="token number">1</span></pre></td></tr><tr><td data-num="5"></td><td><pre>test<span class="token punctuation">(</span><span class="token string">'Susan'</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">,</span> gender<span class="token operator">=</span><span class="token string">'Female'</span><span class="token punctuation">)</span></pre></td></tr></table></figure></li><li><p>默认参数必须指向不变对象【坑点】。</p><p>例如，当默认参数定义为数组时，将出现如下情况：</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">def</span> <span class="token function">add_end</span><span class="token punctuation">(</span>l<span class="token operator">=</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    l<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token string">'END'</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token keyword">return</span> l</pre></td></tr><tr><td data-num="4"></td><td><pre></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span>add_end<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># [1, 2, 3, 'END']</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span>add_end<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># ['END']</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span>add_end<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># ['END', 'END']</span></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span>add_end<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># ['END', 'END', 'END']</span></pre></td></tr></table></figure><p>这是因为默认参数指定为 list 时，指定的其实只是一个指针，当我们每次使用默认参数，使用的都是指针对应的值，多次调用就会反复修改 list 指针对应的值，导致多重拼接。</p><blockquote><p>要理解这一点，请务必理解可变对象和不可变对象。（在 Java 语言中，被称为值类型和引用类型）</p></blockquote></li></ul></li><li><p>可变参数</p><p>可变参数，即参数的个数是可以变化的，可以传入任意多个参数（包括 0 个）。定义函数可变参数的方式如下：</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">def</span> <span class="token function">sum</span><span class="token punctuation">(</span><span class="token operator">*</span>nums<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token builtin">sum</span> <span class="token operator">=</span> <span class="token number">0</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token keyword">for</span> num <span class="token keyword">in</span> nums<span class="token punctuation">:</span></pre></td></tr><tr><td data-num="4"></td><td><pre>        <span class="token builtin">sum</span> <span class="token operator">+=</span> num</pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token keyword">return</span> <span class="token builtin">sum</span></pre></td></tr><tr><td data-num="6"></td><td><pre></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">sum</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">29</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># 42</span></pre></td></tr></table></figure><p>可变参数接收到的是一个 tuple 类型。</p><p>如果调用函数时，某一个参数本身即是 tuple 类型的参数，为了区分可变参数与参数的 tuple 类型参数，可以使用如下方式调用函数：</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">def</span> <span class="token function">sum</span><span class="token punctuation">(</span><span class="token operator">*</span>nums<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token builtin">sum</span> <span class="token operator">=</span> <span class="token number">0</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token keyword">for</span> num <span class="token keyword">in</span> nums<span class="token punctuation">:</span></pre></td></tr><tr><td data-num="4"></td><td><pre>        <span class="token builtin">sum</span> <span class="token operator">+=</span> num</pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token keyword">return</span> <span class="token builtin">sum</span></pre></td></tr><tr><td data-num="6"></td><td><pre></pre></td></tr><tr><td data-num="7"></td><td><pre>nums <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">29</span><span class="token punctuation">]</span></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">sum</span><span class="token punctuation">(</span><span class="token operator">*</span>nums<span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># 50</span></pre></td></tr></table></figure><blockquote><p>这里是将 tuple 转换为可变参数，再传入到函数中。</p></blockquote></li><li><p>关键字参数</p><p>关键字参数允许传入任意多个参数，这些关键字参数在函数内部会自动组装成一个 dict 。</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">def</span> <span class="token function">person</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> age<span class="token punctuation">,</span> <span class="token operator">**</span>kw<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'name:'</span><span class="token punctuation">,</span> name<span class="token punctuation">,</span> <span class="token string">'age:'</span><span class="token punctuation">,</span> age<span class="token punctuation">,</span> <span class="token string">'extra:'</span><span class="token punctuation">,</span> kw<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="3"></td><td><pre></pre></td></tr><tr><td data-num="4"></td><td><pre>person<span class="token punctuation">(</span><span class="token string">'Lily'</span><span class="token punctuation">,</span> <span class="token number">24</span><span class="token punctuation">,</span> city<span class="token operator">=</span><span class="token string">'Shanghai'</span><span class="token punctuation">,</span> job<span class="token operator">=</span><span class="token string">'teacher'</span><span class="token punctuation">)</span>  <span class="token comment"># name: Lily age: 24 extra: &#123;'city': 'Shanghai', 'job': 'teacher'&#125;</span></pre></td></tr></table></figure><p>关键字参数可以扩展函数的功能，函数调用方可以根据情况自由选择是否传递某些参数字段，上面的函数也可以做如下简化：</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">def</span> <span class="token function">person</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> age<span class="token punctuation">,</span> <span class="token operator">**</span>kw<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'name:'</span><span class="token punctuation">,</span> name<span class="token punctuation">,</span> <span class="token string">'age:'</span><span class="token punctuation">,</span> age<span class="token punctuation">,</span> <span class="token string">'extra:'</span><span class="token punctuation">,</span> kw<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="3"></td><td><pre></pre></td></tr><tr><td data-num="4"></td><td><pre>extra <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token string">'city'</span><span class="token punctuation">:</span> <span class="token string">'Shanghai'</span><span class="token punctuation">,</span> <span class="token string">'job'</span><span class="token punctuation">:</span> <span class="token string">'teacher'</span><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>person<span class="token punctuation">(</span><span class="token string">'Lily'</span><span class="token punctuation">,</span> <span class="token number">24</span><span class="token punctuation">,</span> <span class="token operator">**</span>extra<span class="token punctuation">)</span></pre></td></tr></table></figure><blockquote><p>注意：函数内的关键字参数只是传入实际参数的一份拷贝，对它进行改动并不会影响到函数调用方的变量。</p></blockquote></li><li><p>命名关键字参数</p><p>对于关键字参数，调用方对参数名称可以任意指定，但如需进行参数名称限制，我们可以进行如下声明：</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">def</span> <span class="token function">person</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> age<span class="token punctuation">,</span> <span class="token operator">*</span><span class="token punctuation">,</span> city<span class="token punctuation">,</span> job<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'name:'</span><span class="token punctuation">,</span> name<span class="token punctuation">,</span> <span class="token string">'age:'</span><span class="token punctuation">,</span> age<span class="token punctuation">,</span> <span class="token string">'city:'</span><span class="token punctuation">,</span> city<span class="token punctuation">,</span> <span class="token string">'job:'</span><span class="token punctuation">,</span> job<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="3"></td><td><pre></pre></td></tr><tr><td data-num="4"></td><td><pre>extra <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token string">'city'</span><span class="token punctuation">:</span> <span class="token string">'Shanghai'</span><span class="token punctuation">,</span> <span class="token string">'job'</span><span class="token punctuation">:</span> <span class="token string">'teacher'</span><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>person<span class="token punctuation">(</span><span class="token string">'Lily'</span><span class="token punctuation">,</span> <span class="token number">24</span><span class="token punctuation">,</span> <span class="token operator">**</span>extra<span class="token punctuation">)</span></pre></td></tr></table></figure><p>这种通过 <code>*</code> 分隔被命名的关键字参数，可以实现对参数命名的限制，但通过这种方式传递参数时，调用方必须传递所有关键字参数（除非关键字参数中使用了默认参数），否则会引起报错。</p><p>另外，当函数中已经定义了一个可变参数，那么，这个函数中的可变参数前就不再需要使用 <code>*</code> 分隔符了，例如：</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">def</span> <span class="token function">person</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> age<span class="token punctuation">,</span> <span class="token operator">*</span>args<span class="token punctuation">,</span> city<span class="token operator">=</span><span class="token string">'Taiyuan'</span><span class="token punctuation">,</span> job<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token keyword">pass</span></pre></td></tr></table></figure></li><li><p>参数组合</p><p>在 Python 中定义函数，可以用必选参数、默认参数、可变参数、关键字参数和命名关键字参数，这 5 种参数都可以组合使用。但是请注意，参数定义的顺序必须是：必选参数、默认参数、可变参数、命名关键字参数和关键字参数，例如：</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">def</span> <span class="token function">f1</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">,</span> c<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">*</span>args<span class="token punctuation">,</span> school<span class="token punctuation">,</span> <span class="token operator">**</span>kw<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'a ='</span><span class="token punctuation">,</span> a<span class="token punctuation">,</span> <span class="token string">'b ='</span><span class="token punctuation">,</span> b<span class="token punctuation">,</span> <span class="token string">'c ='</span><span class="token punctuation">,</span> c<span class="token punctuation">,</span> <span class="token string">'args ='</span><span class="token punctuation">,</span> args<span class="token punctuation">,</span> school<span class="token punctuation">,</span> <span class="token string">'kw ='</span><span class="token punctuation">,</span> kw<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="3"></td><td><pre></pre></td></tr><tr><td data-num="4"></td><td><pre>f1<span class="token punctuation">(</span><span class="token string">'zhangsan'</span><span class="token punctuation">,</span> <span class="token string">'nanjing'</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">,</span> <span class="token number">33</span><span class="token punctuation">,</span> school<span class="token operator">=</span><span class="token string">'NanJin University'</span><span class="token punctuation">,</span> email<span class="token operator">=</span><span class="token string">'abc@q.com'</span><span class="token punctuation">,</span> phone<span class="token operator">=</span><span class="token string">'15625376'</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token comment"># a = zhangsan b = nanjing c = 5 args = (12, 33) NanJin University kw = &#123;'email': 'abc@q.com', 'phone': '15625376'&#125;</span></pre></td></tr></table></figure><blockquote><p>但是，由于多种类型的组合参数可读性并不太高，不推荐同时使用较多种类型的参数进行组合。</p></blockquote></li></ol><h4 id="递归函数"><a class="anchor" href="#递归函数">#</a> 递归函数</h4><p>在函数内部，可以调用其他函数。如果一个函数在内部调用自身本身，这个函数就是递归函数，例如：</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment"># 阶乘</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">def</span> <span class="token function">fact</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token keyword">if</span> n <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="4"></td><td><pre>        <span class="token keyword">return</span> <span class="token number">1</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token keyword">return</span> n <span class="token operator">*</span> fact<span class="token punctuation">(</span>n <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="6"></td><td><pre></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span>fact<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># 120</span></pre></td></tr></table></figure><p>递归函数的优点是定义简单，逻辑清晰。理论上，所有的递归函数都可以写成循环的方式，但循环的逻辑不如递归清晰。</p><p>使用递归函数需要注意防止栈溢出。在计算机中，函数调用是通过栈（stack）这种数据结构实现的，每当进入一个函数调用，栈就会加一层栈帧，每当函数返回，栈就会减一层栈帧。由于栈的大小不是无限的，所以，递归调用的次数过多，会导致栈溢出。（例如在示例中调用 <code>fact(1000)</code> ）</p><p>解决递归调用栈溢出的方法是通过<strong>尾递归</strong>优化，事实上尾递归和循环的效果是一样的，所以，把循环看成是一种特殊的尾递归函数也是可以的。</p><blockquote><p>对于 Python 而言，因为其解释器并未对尾递归做优化，所以，Python 使用尾递归方式也不能解决栈溢出的问题。</p></blockquote><p>尾递归是指，在函数返回的时候，调用自身本身，并且，return 语句不能包含表达式。这样，编译器或者解释器就可以把尾递归做优化，使递归本身无论调用多少次，都只占用一个栈帧，不会出现栈溢出的情况。</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment"># 尾递归阶乘</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">def</span> <span class="token function">fact</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token keyword">return</span> fact_iter<span class="token punctuation">(</span>n<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="4"></td><td><pre></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token keyword">def</span> <span class="token function">fact_iter</span><span class="token punctuation">(</span>num<span class="token punctuation">,</span> product<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    <span class="token keyword">if</span> num <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="7"></td><td><pre>        <span class="token keyword">return</span> product</pre></td></tr><tr><td data-num="8"></td><td><pre>    <span class="token keyword">return</span> fact_iter<span class="token punctuation">(</span>num <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">,</span> num <span class="token operator">*</span> product<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="9"></td><td><pre></pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span>fact<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># 120</span></pre></td></tr></table></figure><p>两者的区别在于：</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment"># 递归方式：</span></pre></td></tr><tr><td data-num="2"></td><td><pre>fact<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token number">3</span> <span class="token operator">*</span> fact<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token number">3</span> <span class="token operator">*</span> <span class="token punctuation">(</span><span class="token number">2</span> <span class="token operator">*</span> fact<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token number">3</span> <span class="token operator">*</span> <span class="token punctuation">(</span><span class="token number">2</span> <span class="token operator">*</span> <span class="token number">1</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token number">3</span> <span class="token operator">*</span> <span class="token number">2</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token number">6</span></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token comment"># 尾递归方式：</span></pre></td></tr><tr><td data-num="9"></td><td><pre>fact_iter<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="10"></td><td><pre>fact_iter<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="11"></td><td><pre>fact_iter<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="12"></td><td><pre><span class="token number">6</span></pre></td></tr></table></figure><h3 id="高级特性"><a class="anchor" href="#高级特性">#</a> 高级特性</h3><h4 id="切片"><a class="anchor" href="#切片">#</a> 切片</h4><p>在 Python 中，可以通过切片截取数组中任意任意位置的元素。</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre>arr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    arr<span class="token punctuation">.</span>append<span class="token punctuation">(</span>i<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="4"></td><td><pre></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span>arr<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">:</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span>  <span class="token comment"># [0, 1, 2]</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span>arr<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span>  <span class="token comment"># [0, 1, 2]</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span>arr<span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">:</span><span class="token number">14</span><span class="token punctuation">]</span><span class="token punctuation">)</span>  <span class="token comment"># [10, 11, 12, 13]</span></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span>arr<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>  <span class="token comment"># [99] # 倒数第一个元素</span></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span>arr<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">4</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>  <span class="token comment"># [96, 97, 98]</span></pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span>arr<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">4</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">)</span>  <span class="token comment"># [96, 97, 98, 99] # 倒数四个参数</span></pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span>arr<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">4</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>  <span class="token comment"># []</span></pre></td></tr><tr><td data-num="12"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span>arr<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token number">10</span><span class="token punctuation">:</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span>  <span class="token comment"># [0, 2, 4, 6, 8] # 前 10 个数中，每 3 个数取一个</span></pre></td></tr><tr><td data-num="13"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span>arr<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">)</span>  <span class="token comment"># 拷贝原数组</span></pre></td></tr></table></figure><blockquote><p>倒数第一个元素的索引是 -1。</p></blockquote><p>字符串和 tuple 也是看做是一种 list ，因此它们同样支持切片操作：</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span>  <span class="token comment"># (0, 1, 2)</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'PYTHON'</span><span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span>  <span class="token comment"># PYT</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'PYTHON'</span><span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token number">5</span><span class="token punctuation">:</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span>  <span class="token comment"># PTO</span></pre></td></tr></table></figure><p>在很多编程语言中，针对字符串提供了很多各种截取函数（例如，substring），其实目的就是对字符串切片。Python 没有针对字符串的截取函数，但可以直接使用切片方式实现。</p><h4 id="迭代"><a class="anchor" href="#迭代">#</a> 迭代</h4><p>对于一个 list 或 tuple ，我们可以通过循环来进行遍历，这种遍历被称为迭代。</p><p>在 Python 中，迭代是通过 <code>for ... in</code> 来完成的，它既可以迭代一个 list 和 tuple ，也可以迭代字符串。</p><p>而且在 Python 中，程序只需要关注对象是否可迭代，而不需要关注迭代对象的类型，判断对象是否可迭代：</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">from</span> collections<span class="token punctuation">.</span>abc <span class="token keyword">import</span> Iterable</pre></td></tr><tr><td data-num="2"></td><td><pre></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">isinstance</span><span class="token punctuation">(</span><span class="token string">'abc'</span><span class="token punctuation">,</span> Iterable<span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># True</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">isinstance</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span> Iterable<span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># True</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">isinstance</span><span class="token punctuation">(</span><span class="token number">123</span><span class="token punctuation">,</span> Iterable<span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># False # 整数不可迭代</span></pre></td></tr></table></figure><p>另外，Python 也内置了一个 <code>enumerate</code> 函数，可以将 list 变为一个 <code>索引-元素</code> 对，这样就可以在 <code>for</code> 循环中同时迭代索引和元素本身：</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">for</span> i<span class="token punctuation">,</span> v <span class="token keyword">in</span> <span class="token builtin">enumerate</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'A'</span><span class="token punctuation">,</span> <span class="token string">'B'</span><span class="token punctuation">,</span> <span class="token string">'C'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token keyword">print</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> v<span class="token punctuation">)</span></pre></td></tr></table></figure><p>Python 也可以同时遍历多个内部元素，但需要注意个数需要完全匹配，否则会报错：</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">for</span> x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> z <span class="token keyword">in</span> <span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token keyword">print</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> z<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="3"></td><td><pre></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token keyword">for</span> x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> z <span class="token keyword">in</span> <span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">:</span>  <span class="token comment"># ValueError: not enough values to unpack</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token keyword">print</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> z<span class="token punctuation">)</span></pre></td></tr></table></figure><h4 id="列表生成式"><a class="anchor" href="#列表生成式">#</a> 列表生成式</h4><p>列表生成式即 <code>List Comprehensions</code> ，是 Python 内置的非常简单却强大的可以用来创建 list 的生成式。</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token punctuation">[</span>x <span class="token operator">*</span> x <span class="token keyword">for</span> x <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span>  <span class="token comment"># [1, 4, 9, 16, 25, 36, 49, 64, 81, 100]</span></pre></td></tr></table></figure><p>for 循环后面还可以加上条件判断：</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token punctuation">[</span>x <span class="token operator">*</span> x <span class="token keyword">for</span> x <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">)</span> <span class="token keyword">if</span> x <span class="token operator">%</span> <span class="token number">2</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>  <span class="token comment"># [4, 16, 36, 64, 100]</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token punctuation">[</span>x <span class="token operator">*</span> <span class="token number">2</span> <span class="token keyword">if</span> x <span class="token operator">></span> <span class="token number">5</span> <span class="token keyword">else</span> x <span class="token operator">*</span> x <span class="token keyword">for</span> x <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">)</span> <span class="token keyword">if</span> x <span class="token operator">%</span> <span class="token number">2</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>  <span class="token comment"># [4, 16, 12, 16, 20]</span></pre></td></tr></table></figure><blockquote><p>注意：在列表生成式中， for 后面的条件判断的作用是进行筛选，所以不能带有 <code>elif</code> 或 <code>else</code> 判断。而 for 前面也可以使用 <code>if</code> 语句，但如果是在 for 前面添加条件判断，它的作用则是作为一个表达式，这时它必须有 <code>else</code> 语句，以便能够保证所有的情况都得到处理。</p><p>在一个列表生成式中， <code>for</code> 前面的 <code>if ... else</code> 是表达式，而 <code>for</code> 后面的 <code>if</code> 是过滤条件，不能带 <code>else</code> 。</p></blockquote><p>还可以使用多个 for 循环生成全排列：</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token punctuation">[</span>a <span class="token operator">+</span> b <span class="token operator">+</span> c <span class="token keyword">for</span> a <span class="token keyword">in</span> <span class="token string">'BC'</span> <span class="token keyword">for</span> b <span class="token keyword">in</span> <span class="token string">'12'</span> <span class="token keyword">for</span> c <span class="token keyword">in</span> <span class="token string">'あう'</span><span class="token punctuation">]</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token comment"># ['B1 あ ', 'B1 う ', 'B2 あ ', 'B2 う ', 'C1 あ ', 'C1 う ', 'C2 あ ', 'C2 う ']</span></pre></td></tr></table></figure><p>运用列表生成式，可以写出非常简洁的代码。例如，列出当前目录下的所有文件和目录名：</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">import</span> os</pre></td></tr><tr><td data-num="2"></td><td><pre></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token punctuation">[</span>d <span class="token keyword">for</span> d <span class="token keyword">in</span> os<span class="token punctuation">.</span>listdir<span class="token punctuation">(</span><span class="token string">'.'</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span>  <span class="token comment"># ['.idea', 'main.py', 'venv']</span></pre></td></tr></table></figure><p>for 循环其实可以同时使用两个甚至多个变量，比如 dict 的 items () 可以同时迭代 key 和 value：</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre>d <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token string">'x'</span><span class="token punctuation">:</span> <span class="token string">'A'</span><span class="token punctuation">,</span> <span class="token string">'y'</span><span class="token punctuation">:</span> <span class="token string">'B'</span><span class="token punctuation">,</span> <span class="token string">'z'</span><span class="token punctuation">:</span> <span class="token string">'C'</span><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">for</span> k<span class="token punctuation">,</span> v <span class="token keyword">in</span> d<span class="token punctuation">.</span>items<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token keyword">print</span><span class="token punctuation">(</span>k<span class="token punctuation">,</span> <span class="token string">'='</span><span class="token punctuation">,</span> v<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="4"></td><td><pre></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token punctuation">[</span>k <span class="token operator">+</span> <span class="token string">'='</span> <span class="token operator">+</span> v <span class="token keyword">for</span> k<span class="token punctuation">,</span> v <span class="token keyword">in</span> d<span class="token punctuation">.</span>items<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span>  <span class="token comment"># ['x=A', 'y=B', 'z=C']</span></pre></td></tr></table></figure><p>另外，还可以对字符串进行处理，例如：</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre>L <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'Hello'</span><span class="token punctuation">,</span> <span class="token string">'World'</span><span class="token punctuation">,</span> <span class="token string">'IBM'</span><span class="token punctuation">,</span> <span class="token string">'Apple'</span><span class="token punctuation">]</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token punctuation">[</span>s<span class="token punctuation">.</span>lower<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">for</span> s <span class="token keyword">in</span> L<span class="token punctuation">]</span><span class="token punctuation">)</span>  <span class="token comment"># ['hello', 'world', 'ibm', 'apple']</span></pre></td></tr></table></figure><h4 id="生成器"><a class="anchor" href="#生成器">#</a> 生成器</h4><p>通过列表生成式，我们可以直接创建一个列表。但是，受到内存限制，列表容量肯定是有限的。而且，创建一个包含 100 万个元素的列表，不仅占用很大的存储空间，如果我们仅仅需要访问前面几个元素，那后面绝大多数元素占用的空间都白白浪费了。</p><p>但如果列表元素可以按照某种算法推算出来，那我们就可以在循环的过程中不断推算出后续的元素，这样就不必创建完整的 list，从而节省大量的空间。在 Python 中，这种一边循环一边计算的机制，称为生成器： <code>generator</code> 。</p><p>要创建一个 generator，有很多种方法。第一种方法很简单，只要把一个列表生成式的 <code>[]</code> 改成 <code>()</code> ，就创建了一个 generator：</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre>d <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token string">'x'</span><span class="token punctuation">:</span> <span class="token string">'A'</span><span class="token punctuation">,</span> <span class="token string">'y'</span><span class="token punctuation">:</span> <span class="token string">'B'</span><span class="token punctuation">,</span> <span class="token string">'z'</span><span class="token punctuation">:</span> <span class="token string">'C'</span><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>g <span class="token operator">=</span> <span class="token punctuation">(</span>k <span class="token operator">+</span> <span class="token string">'='</span> <span class="token operator">+</span> v <span class="token keyword">for</span> k<span class="token punctuation">,</span> v <span class="token keyword">in</span> d<span class="token punctuation">.</span>items<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span>g<span class="token punctuation">)</span>  <span class="token comment"># &lt;generator object &lt;genexpr> at 0x00000210690ADBA0></span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">next</span><span class="token punctuation">(</span>g<span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># x=A</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span>g<span class="token punctuation">.</span>__next__<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># y=B</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">next</span><span class="token punctuation">(</span>g<span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># z=C</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">next</span><span class="token punctuation">(</span>g<span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># 抛出异常 StopIteration</span></pre></td></tr></table></figure><p>generator 可以通过实例中 <code>next()</code> 的方式依次取出相应的值，但这种做法较为笨拙，而且越界时会抛出异常，由于 generator 也是可遍历对象，因此更加常见的是结合循环进行使用：</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre>d <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token string">'x'</span><span class="token punctuation">:</span> <span class="token string">'A'</span><span class="token punctuation">,</span> <span class="token string">'y'</span><span class="token punctuation">:</span> <span class="token string">'B'</span><span class="token punctuation">,</span> <span class="token string">'z'</span><span class="token punctuation">:</span> <span class="token string">'C'</span><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>g <span class="token operator">=</span> <span class="token punctuation">(</span>k <span class="token operator">+</span> <span class="token string">'='</span> <span class="token operator">+</span> v <span class="token keyword">for</span> k<span class="token punctuation">,</span> v <span class="token keyword">in</span> d<span class="token punctuation">.</span>items<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">for</span> n <span class="token keyword">in</span> g<span class="token punctuation">:</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token keyword">print</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span></pre></td></tr></table></figure><p>另一种创建 generator 的方法：</p><p>著名的斐波拉契数列（Fibonacci），除第一个和第二个数外，任意一个数都可由前两个数相加得到：</p><p>1, 1, 2, 3, 5, 8, 13, 21, 34, ...</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment"># 函数实现斐波拉契数列</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">def</span> <span class="token function">fib</span><span class="token punctuation">(</span><span class="token builtin">max</span><span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    n<span class="token punctuation">,</span> a<span class="token punctuation">,</span> b <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token keyword">while</span> n <span class="token operator">&lt;</span> <span class="token builtin">max</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="5"></td><td><pre>        <span class="token keyword">print</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="6"></td><td><pre>        a<span class="token punctuation">,</span> b <span class="token operator">=</span> b<span class="token punctuation">,</span> a <span class="token operator">+</span> b</pre></td></tr><tr><td data-num="7"></td><td><pre>        n <span class="token operator">=</span> n <span class="token operator">+</span> <span class="token number">1</span></pre></td></tr><tr><td data-num="8"></td><td><pre>    <span class="token keyword">return</span> <span class="token string">'done'</span></pre></td></tr><tr><td data-num="9"></td><td><pre></pre></td></tr><tr><td data-num="10"></td><td><pre>fib<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span></pre></td></tr></table></figure><p>将上述算法修改为一个生成器：</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment"># 斐波拉契数列生成器</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">def</span> <span class="token function">fib</span><span class="token punctuation">(</span><span class="token builtin">max</span><span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    n<span class="token punctuation">,</span> a<span class="token punctuation">,</span> b <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token keyword">while</span> n <span class="token operator">&lt;</span> <span class="token builtin">max</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="5"></td><td><pre>        <span class="token keyword">yield</span> b  <span class="token comment"># yield 中断执行并返回每轮执行的结果</span></pre></td></tr><tr><td data-num="6"></td><td><pre>        a<span class="token punctuation">,</span> b <span class="token operator">=</span> b<span class="token punctuation">,</span> a <span class="token operator">+</span> b</pre></td></tr><tr><td data-num="7"></td><td><pre>        n <span class="token operator">=</span> n <span class="token operator">+</span> <span class="token number">1</span></pre></td></tr><tr><td data-num="8"></td><td><pre>    <span class="token keyword">return</span> <span class="token string">'done'</span></pre></td></tr><tr><td data-num="9"></td><td><pre></pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token comment"># 这里得到的 fib (10) 是一个 generator 对象</span></pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token keyword">for</span> n <span class="token keyword">in</span> fib<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="12"></td><td><pre>    <span class="token keyword">print</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span></pre></td></tr></table></figure><p>这就是第二种创建 generator 的方法，如果一个函数中定义了 <code>yield</code> 字段，这个函数就不再是一个普通函数，而是一个生成器。</p><p>函数和生成器有一个较为突出的区别：函数是按照顺序执行，如果遇到 return 语句或执行到最后一行语句就返回；而生成器却是在每次调用 <code>next()</code> 方法时才执行，遇到 <code>yield</code> 语句时就返回，而当再次执行 <code>next()</code> 时，就从上一次 <code>yield</code> 返回语句处继续执行。</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment"># 在这里，注释中的 [ ] 表示执行顺序，其后表示输出内容</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">def</span> <span class="token function">odd</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'step 1'</span><span class="token punctuation">)</span>  <span class="token comment"># [1] step 1</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token keyword">yield</span> <span class="token number">1</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'step 2'</span><span class="token punctuation">)</span>  <span class="token comment"># [3] step 2</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    <span class="token keyword">yield</span> <span class="token number">3</span></pre></td></tr><tr><td data-num="7"></td><td><pre>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'step 3'</span><span class="token punctuation">)</span>  <span class="token comment"># [5] step 3</span></pre></td></tr><tr><td data-num="8"></td><td><pre>    <span class="token keyword">yield</span> <span class="token number">5</span></pre></td></tr><tr><td data-num="9"></td><td><pre></pre></td></tr><tr><td data-num="10"></td><td><pre>odd <span class="token operator">=</span> odd<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">next</span><span class="token punctuation">(</span>odd<span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># [2] 1</span></pre></td></tr><tr><td data-num="12"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">next</span><span class="token punctuation">(</span>odd<span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># [4] 3</span></pre></td></tr><tr><td data-num="13"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">next</span><span class="token punctuation">(</span>odd<span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># [6] 5</span></pre></td></tr><tr><td data-num="14"></td><td><pre></pre></td></tr><tr><td data-num="15"></td><td><pre><span class="token comment"># 也可以使用循环进行遍历</span></pre></td></tr><tr><td data-num="16"></td><td><pre><span class="token comment"># for n in odd():</span></pre></td></tr><tr><td data-num="17"></td><td><pre><span class="token comment">#     print(n)</span></pre></td></tr></table></figure><p>如果在取出生成器中的所有值之后，希望获得生成器中返回语句定义的内容，可以通过异常捕获的方式：</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">def</span> <span class="token function">fib</span><span class="token punctuation">(</span><span class="token builtin">max</span><span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    n<span class="token punctuation">,</span> a<span class="token punctuation">,</span> b <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token keyword">while</span> n <span class="token operator">&lt;</span> <span class="token builtin">max</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="4"></td><td><pre>        <span class="token keyword">yield</span> b  <span class="token comment"># yield 中断执行并返回每轮执行的结果</span></pre></td></tr><tr><td data-num="5"></td><td><pre>        a<span class="token punctuation">,</span> b <span class="token operator">=</span> b<span class="token punctuation">,</span> a <span class="token operator">+</span> b</pre></td></tr><tr><td data-num="6"></td><td><pre>        n <span class="token operator">=</span> n <span class="token operator">+</span> <span class="token number">1</span></pre></td></tr><tr><td data-num="7"></td><td><pre>    <span class="token keyword">return</span> <span class="token string">'done'</span></pre></td></tr><tr><td data-num="8"></td><td><pre></pre></td></tr><tr><td data-num="9"></td><td><pre>fib <span class="token operator">=</span> fib<span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="11"></td><td><pre>    <span class="token keyword">try</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="12"></td><td><pre>        x <span class="token operator">=</span> <span class="token builtin">next</span><span class="token punctuation">(</span>fib<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="13"></td><td><pre>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'g:'</span><span class="token punctuation">,</span> x<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="14"></td><td><pre>    <span class="token keyword">except</span> StopIteration <span class="token keyword">as</span> e<span class="token punctuation">:</span></pre></td></tr><tr><td data-num="15"></td><td><pre>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Generator return value:'</span><span class="token punctuation">,</span> e<span class="token punctuation">.</span>value<span class="token punctuation">)</span>  <span class="token comment"># 获取到生成器中 return 语句的返回值。</span></pre></td></tr><tr><td data-num="16"></td><td><pre>        <span class="token keyword">break</span></pre></td></tr></table></figure><h4 id="迭代器"><a class="anchor" href="#迭代器">#</a> 迭代器</h4><p>在前文的<strong>迭代</strong>部分，我们已经提到过迭代器，可以直接作用于 for 循环的对象，都被称为可迭代对象，并且可以使用 <code>isinstance()</code> 函数来判断一个对象是否可迭代。而其实，可以被 <code>next()</code> 函数调用并不断返回下一个值的对象，即为迭代器（Iterator）。</p><p>生成器都是迭代器对象，而数组、字典、字符串等虽然具有可迭代属性，却并不是迭代器对象，这是因为迭代器对象可以被 <code>next()</code> 函数不断获取下一个值，但其本身却并不知晓当前序列的长度，只能通过 <code>next()</code> 函数实现按需计算下一个元素。因此，迭代器的计算是惰性的，只有在需要返回下一个数据的时候，才会进行计算。</p><blockquote><p>迭代器甚至可以表示一个无限大的数据流，而列表等类型则是有限的。判断是否是迭代器对象很简单，只需要知道它是否是可作用于 <code>next()</code> 函数的对象即可。</p></blockquote><h3 id="函数式编程"><a class="anchor" href="#函数式编程">#</a> 函数式编程</h3><p>函数是 Python 内建支持的一种封装，我们通过把大段代码拆成函数，通过一层一层的函数调用，就可以把复杂任务分解成简单的任务，这种分解可以称之为面向过程的程序设计。函数就是面向过程的程序设计的基本单元。</p><p>而函数式编程（Functional Programming）虽然也可以归结到面向过程的程序设计，但其思想更接近数学计算。</p><p>函数式编程的一个特点就是，允许把函数本身作为参数传入另一个函数，还允许返回一个函数！</p><p>Python 对函数式编程提供部分支持。由于 Python 允许使用变量，因此，Python 不是纯函数式编程语言。</p><h4 id="高阶函数"><a class="anchor" href="#高阶函数">#</a> 高阶函数</h4><p>函数本身可以赋值给一个变量，即变量可以指向函数。</p><p>当一个变量指向了某个函数，那么就可以通过这个变量来调用该函数：</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre>f <span class="token operator">=</span> <span class="token builtin">abs</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span>f<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">12</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># 12</span></pre></td></tr></table></figure><p>其实，函数名本身就是一个指向函数的变量，那么，这个变量自然也可以被重新赋值：</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">from</span> collections<span class="token punctuation">.</span>abc <span class="token keyword">import</span> Iterable</pre></td></tr><tr><td data-num="2"></td><td><pre></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token builtin">abs</span> <span class="token operator">=</span> <span class="token builtin">isinstance</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">abs</span><span class="token punctuation">(</span><span class="token string">'abc'</span><span class="token punctuation">,</span> Iterable<span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># True</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">abs</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># 报错：TypeError</span></pre></td></tr></table></figure><p>由此可知，函数本身也是一个变量，反过来说，我们可以定义一个函数类型的变量，而函数本身是可以接收变量作为参数的，那么，同样函数就也可以接收一个函数类型的参数。这种接收函数作为参数的函数，就被称为高阶函数，例如：</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">def</span> <span class="token function">add</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> f<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token keyword">return</span> f<span class="token punctuation">(</span>x<span class="token punctuation">)</span> <span class="token operator">+</span> f<span class="token punctuation">(</span>y<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="3"></td><td><pre></pre></td></tr><tr><td data-num="4"></td><td><pre>result <span class="token operator">=</span> add<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token builtin">abs</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span>  <span class="token comment"># 6</span></pre></td></tr></table></figure><p>总而言之，<mark>把函数作为参数传入，这样的函数称为高阶函数，函数式编程就是指这种高度抽象的编程范式。</mark></p><h5 id="map-reduce"><a class="anchor" href="#map-reduce">#</a> map / reduce</h5><p>Python 内建了 <code>map()</code> 和 <code>reduce()</code> 函数。</p><ol><li><p>map</p><p><code>map()</code> 函数接收两个参数，一个是函数，一个是 <code>Iterable</code> ， <code>map</code> 将传入的函数依次作用到序列的每个元素，并把结果作为新的 <code>Iterator</code> 返回，例如：</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">def</span> <span class="token function">f</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token keyword">return</span> x <span class="token operator">*</span> x</pre></td></tr><tr><td data-num="3"></td><td><pre></pre></td></tr><tr><td data-num="4"></td><td><pre>r <span class="token operator">=</span> <span class="token builtin">map</span><span class="token punctuation">(</span>f<span class="token punctuation">,</span> <span class="token builtin">list</span><span class="token punctuation">(</span><span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># 返回值是一个 Iterator 对象</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">list</span><span class="token punctuation">(</span>r<span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># [1, 4, 9, 16, 25, 36, 49, 64, 81]</span></pre></td></tr></table></figure><p>通过 map 传递不同的函数参数，可以实现对数组的不同处理。</p></li><li><p>reduce</p><p><code>reduce</code> 把一个函数作用在一个序列上，这个函数必须接收两个参数， <code>reduce</code> 会把结果继续和序列的下一个元素做累积计算，其效果就是：</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token builtin">reduce</span><span class="token punctuation">(</span>f<span class="token punctuation">,</span> <span class="token punctuation">[</span>x1<span class="token punctuation">,</span> x2<span class="token punctuation">,</span> x3<span class="token punctuation">,</span> x4<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">=</span> f<span class="token punctuation">(</span>f<span class="token punctuation">(</span>f<span class="token punctuation">(</span>x1<span class="token punctuation">,</span> x2<span class="token punctuation">)</span><span class="token punctuation">,</span> x3<span class="token punctuation">)</span><span class="token punctuation">,</span> x4<span class="token punctuation">)</span></pre></td></tr></table></figure><p>例如：</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">from</span> functools <span class="token keyword">import</span> <span class="token builtin">reduce</span></pre></td></tr><tr><td data-num="2"></td><td><pre></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">def</span> <span class="token function">f</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token keyword">return</span> <span class="token punctuation">(</span>y <span class="token operator">-</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">**</span> x</pre></td></tr><tr><td data-num="5"></td><td><pre></pre></td></tr><tr><td data-num="6"></td><td><pre>result <span class="token operator">=</span> <span class="token builtin">reduce</span><span class="token punctuation">(</span>f<span class="token punctuation">,</span> <span class="token builtin">list</span><span class="token punctuation">(</span>x <span class="token keyword">for</span> x <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">)</span> <span class="token keyword">if</span> x <span class="token operator">%</span> <span class="token number">2</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span>f<span class="token punctuation">(</span>f<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># 256</span></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token comment"># f(f(2, 4), 6) ==> (6 - 2) ** ((4 - 2) ** 2) ==> 4 ** (2 ** 2) ==> 4 ** 4 ==> 256</span></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span>  <span class="token comment"># 256</span></pre></td></tr></table></figure><p>当然，map 和 reduce 也可以进行组合使用。</p></li></ol><h5 id="filter"><a class="anchor" href="#filter">#</a> filter</h5><p>Python 内建的 <code>filter()</code> 函数用于过滤序列，它和 <code>map()</code> 类似，也接收一个函数和一个序列。但不同的是， <code>filter()</code> 把传入的函数依次作用于每个元素，然后根据返回值是 <code>True</code> 还是 <code>False</code> 决定保留还是丢弃该元素，例如：</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment"># 过滤掉奇数，保留偶数</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">def</span> <span class="token function">is_odd</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token keyword">return</span> x <span class="token operator">%</span> <span class="token number">2</span> <span class="token operator">==</span> <span class="token number">1</span></pre></td></tr><tr><td data-num="4"></td><td><pre></pre></td></tr><tr><td data-num="5"></td><td><pre>f <span class="token operator">=</span> <span class="token builtin">filter</span><span class="token punctuation">(</span>is_odd<span class="token punctuation">,</span> <span class="token builtin">list</span><span class="token punctuation">(</span><span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">list</span><span class="token punctuation">(</span>f<span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># [1, 3, 5, 7, 9]</span></pre></td></tr></table></figure><p>除了上述示例的用法，还可以有很多用途，例如：去除字符串中的特殊字符、移除数组中的空元素、保留数组中具有某种特征的元素等，总之，filter 的主要作用在于对序列进行过滤和赛选。</p><blockquote><p>map 和 filter 返回的都是 Iterator 。由于迭代器是惰性序列，因此，要强迫其完成计算结果，需要使用 <code>list()</code> 函数获取所有结果并返回数组。</p></blockquote><p>可以尝试用已有知识求出 100 以内所有素数。</p><h5 id="sorted"><a class="anchor" href="#sorted">#</a> sorted</h5><p>排序也是在程序中经常用到的算法。无论使用冒泡排序还是快速排序，排序的核心是比较两个元素的大小。如果是数字，我们可以直接比较，但如果是字符串或者两个 dict 比较的过程就必须通过函数抽象出来。</p><p>Python 内置的 <code>sorted()</code> 函数就可以对 list 进行排序：</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">sorted</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">36</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">12</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">21</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># [-21, -12, 5, 9, 36]</span></pre></td></tr></table></figure><p>但 <code>sort()</code> 作为一个高阶函数，除了默认的排序之外，它还可以接收一个 <code>key</code> 指定的函数来实现自定义的排序，例如：</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">def</span> <span class="token function">f</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token keyword">return</span> x <span class="token operator">**</span> x <span class="token operator">-</span> x</pre></td></tr><tr><td data-num="3"></td><td><pre></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token comment"># 按绝对值大小排序</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">sorted</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">36</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">12</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">21</span><span class="token punctuation">]</span><span class="token punctuation">,</span> key<span class="token operator">=</span><span class="token builtin">abs</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># [5, 9, -12, -21, 36]</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token comment"># 按自定义函数方式进行排序</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">sorted</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">36</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">12</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">21</span><span class="token punctuation">]</span><span class="token punctuation">,</span> key<span class="token operator">=</span>f<span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># [-12, -21, 5, 9, 36]</span></pre></td></tr></table></figure><p>而如果要对字符串进行排序，sort 默认会对字符串的 ASCII 码进行比较。</p><p>而要进行反向排序，只需要指定一个 <code>reverse=True</code> 参数即可：</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">sorted</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">36</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">12</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">21</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># [-21, -12, 5, 9, 36]</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">sorted</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">36</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">12</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">21</span><span class="token punctuation">]</span><span class="token punctuation">,</span> reverse<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># [36, 9, 5, -12, -21]</span></pre></td></tr></table></figure><h4 id="返回函数"><a class="anchor" href="#返回函数">#</a> 返回函数</h4><p>高阶函数除了可以接受函数作为参数外，还可以把函数作为结果值返回，例如：</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment"># 可变参数求和的懒执行方式</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">def</span> <span class="token function">lazy_sum</span><span class="token punctuation">(</span><span class="token operator">*</span>args<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token keyword">def</span> <span class="token function">sum</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="4"></td><td><pre>        ax <span class="token operator">=</span> <span class="token number">0</span></pre></td></tr><tr><td data-num="5"></td><td><pre>        <span class="token keyword">for</span> n <span class="token keyword">in</span> args<span class="token punctuation">:</span></pre></td></tr><tr><td data-num="6"></td><td><pre>            ax <span class="token operator">=</span> ax <span class="token operator">+</span> n</pre></td></tr><tr><td data-num="7"></td><td><pre>        <span class="token keyword">return</span> ax</pre></td></tr><tr><td data-num="8"></td><td><pre>    <span class="token keyword">return</span> <span class="token builtin">sum</span></pre></td></tr><tr><td data-num="9"></td><td><pre></pre></td></tr><tr><td data-num="10"></td><td><pre>f <span class="token operator">=</span> lazy_sum<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token comment"># 返回的函数并不是立即执行</span></pre></td></tr><tr><td data-num="12"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span>f<span class="token punctuation">)</span>  <span class="token comment"># &lt;function lazy_sum.&lt;locals>.sum at 0x000001875C48EB80></span></pre></td></tr><tr><td data-num="13"></td><td><pre><span class="token comment"># 而是 f () 函数调用时才执行</span></pre></td></tr><tr><td data-num="14"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span>f<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># 25</span></pre></td></tr></table></figure><p>这种在函数中定义的函数，称为内部函数，内部函数可以引用外部函数的参数和局部变量，当外部函数被调用并返回内部函数时，相关的参数和变量都会保存在返回的函数中，这种被称为<strong>闭包</strong>的结构在许多程序中都有广泛的应用。</p><p>另外，每次调用外部函数时，返回的内部函数都是一个新的实例：</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">def</span> <span class="token function">fn</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token keyword">def</span> <span class="token function">f</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="3"></td><td><pre>        <span class="token keyword">return</span> <span class="token builtin">abs</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token keyword">return</span> f</pre></td></tr><tr><td data-num="5"></td><td><pre></pre></td></tr><tr><td data-num="6"></td><td><pre>f1 <span class="token operator">=</span> fn<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">5</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="7"></td><td><pre>f2 <span class="token operator">=</span> fn<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">5</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span>f1 <span class="token operator">==</span> f2<span class="token punctuation">)</span>  <span class="token comment"># False</span></pre></td></tr></table></figure><p>另外，需要注意的是，返回函数不要引用任何循环变量，或者后续会发生变化的变量，反例如下：</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">def</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    fs <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="4"></td><td><pre>        <span class="token keyword">def</span> <span class="token function">f</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="5"></td><td><pre>             <span class="token keyword">return</span> i <span class="token operator">*</span> i</pre></td></tr><tr><td data-num="6"></td><td><pre>        fs<span class="token punctuation">.</span>append<span class="token punctuation">(</span>f<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="7"></td><td><pre>    <span class="token keyword">return</span> fs</pre></td></tr><tr><td data-num="8"></td><td><pre></pre></td></tr><tr><td data-num="9"></td><td><pre>f1<span class="token punctuation">,</span> f2<span class="token punctuation">,</span> f3 <span class="token operator">=</span> count<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span>f1<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># 9 （预期是 1）</span></pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span>f2<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># 9 （预期是 4）</span></pre></td></tr><tr><td data-num="12"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span>f3<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># 9</span></pre></td></tr></table></figure><p>这就会出现函数的返回值和预期不一致，这是因为在返回的函数中引用了循环变量，但这种返回函数并非立即执行，而当多个循环函数都被返回时，循环变量已经变为循环周期的最大值，所以最终调用函数进行计算时，就不会得到预期的循环效果产生的值。</p><p>而如果一定要引用循环变量，可以通过如下方式，将循环变量作为参数传入到另一内部函数中，这样就可以保证被绑定的循环变量参数不变：</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">def</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token keyword">def</span> <span class="token function">f</span><span class="token punctuation">(</span>j<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="3"></td><td><pre>        <span class="token keyword">def</span> <span class="token function">g</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="4"></td><td><pre>            <span class="token keyword">return</span> j <span class="token operator">*</span> j</pre></td></tr><tr><td data-num="5"></td><td><pre>        <span class="token keyword">return</span> g</pre></td></tr><tr><td data-num="6"></td><td><pre>    fs <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span></pre></td></tr><tr><td data-num="7"></td><td><pre>    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="8"></td><td><pre>        fs<span class="token punctuation">.</span>append<span class="token punctuation">(</span>f<span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># f (i) 立刻被执行，因此 i 的当前值被传入 f ()</span></pre></td></tr><tr><td data-num="9"></td><td><pre>    <span class="token keyword">return</span> fs</pre></td></tr><tr><td data-num="10"></td><td><pre></pre></td></tr><tr><td data-num="11"></td><td><pre>f1<span class="token punctuation">,</span> f2<span class="token punctuation">,</span> f3 <span class="token operator">=</span> count<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="12"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span>f1<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># 1</span></pre></td></tr><tr><td data-num="13"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span>f2<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># 4</span></pre></td></tr><tr><td data-num="14"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span>f3<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># 9</span></pre></td></tr></table></figure><h4 id="匿名函数"><a class="anchor" href="#匿名函数">#</a> 匿名函数</h4><p>当我们在传入函数时，有些时候，不需要显式地定义函数，直接传入匿名函数更方便。</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre>n <span class="token operator">=</span> <span class="token builtin">list</span><span class="token punctuation">(</span><span class="token builtin">map</span><span class="token punctuation">(</span><span class="token keyword">lambda</span> x<span class="token punctuation">:</span> x <span class="token operator">*</span> x<span class="token punctuation">,</span> <span class="token builtin">list</span><span class="token punctuation">(</span><span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span>  <span class="token comment"># [1, 4, 9, 16, 25, 36, 49, 64, 81]</span></pre></td></tr></table></figure><p>关键字 <code>lambda</code> 表示匿名函数，冒号前面的变量表示函数参数。</p><p>匿名函数有个限制，就是只能有一个表达式，不用写 <code>return</code> ，返回值就是该表达式的结果。</p><p>匿名函数也是一个函数对象，也可以把匿名函数赋值给一个变量，再利用变量来调用该函数；同样地，也可以把匿名函数作为返回值返回。</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre>f <span class="token operator">=</span> <span class="token keyword">lambda</span> x<span class="token punctuation">:</span> x <span class="token operator">*</span> x</pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span>f<span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># 16</span></pre></td></tr><tr><td data-num="3"></td><td><pre></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token keyword">def</span> <span class="token function">fn</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token keyword">return</span> <span class="token keyword">lambda</span><span class="token punctuation">:</span> x <span class="token operator">**</span> x</pre></td></tr><tr><td data-num="6"></td><td><pre></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span>fn<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># 27</span></pre></td></tr></table></figure><h4 id="装饰器"><a class="anchor" href="#装饰器">#</a> 装饰器</h4><p>装饰器（Decorator）可以在代码运行期间，动态地增加功能，而其实本质上，装饰器就是一个返回函数的高阶函数。</p><p>由于函数也是一个对象，而且函数对象可以被赋值给变量，所以，通过变量也能调用该函数。而函数对象有一个 <code>__name__</code> 属性，可以获取到函数的名字，据此，我们可以尝试实现一个简单的打印日志的功能：</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">def</span> <span class="token function">log</span><span class="token punctuation">(</span>func<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token keyword">def</span> <span class="token function">wrapper</span><span class="token punctuation">(</span><span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kw<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="3"></td><td><pre>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'call %s()'</span> <span class="token operator">%</span> func<span class="token punctuation">.</span>__name__<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="4"></td><td><pre>        <span class="token keyword">return</span> func<span class="token punctuation">(</span><span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kw<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token keyword">return</span> wrapper</pre></td></tr><tr><td data-num="6"></td><td><pre></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token decorator annotation punctuation">@log</span>  <span class="token comment"># 通过 Python 的 @语法，将装饰器置于函数的定义处，相当于执行了：say_hi = log (say_hi)</span></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token keyword">def</span> <span class="token function">say_hi</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="9"></td><td><pre>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Hi,'</span><span class="token punctuation">,</span> name<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="10"></td><td><pre></pre></td></tr><tr><td data-num="11"></td><td><pre>say_hi<span class="token punctuation">(</span><span class="token string">'Zhang San'</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="12"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span>say_hi<span class="token punctuation">.</span>__name__<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="13"></td><td><pre></pre></td></tr><tr><td data-num="14"></td><td><pre><span class="token comment"># call say_hi()</span></pre></td></tr><tr><td data-num="15"></td><td><pre><span class="token comment"># Hi, Zhang San</span></pre></td></tr><tr><td data-num="16"></td><td><pre><span class="token comment"># wrapper  # 函数名错误</span></pre></td></tr></table></figure><p>当然，你也可以为以上程序添加断点，并观察其执行流程。</p><p>但是，如果装饰器本身需要传入参数，那就需要编写一个返回装饰器的高阶函数，相对而言会更加复杂：</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">def</span> <span class="token function">log</span><span class="token punctuation">(</span>text<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token keyword">def</span> <span class="token function">decorator</span><span class="token punctuation">(</span>func<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="3"></td><td><pre>        <span class="token keyword">def</span> <span class="token function">wrapper</span><span class="token punctuation">(</span><span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kw<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="4"></td><td><pre>            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'%s %s()'</span> <span class="token operator">%</span> <span class="token punctuation">(</span>text<span class="token punctuation">,</span> func<span class="token punctuation">.</span>__name__<span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="5"></td><td><pre>            <span class="token keyword">return</span> func<span class="token punctuation">(</span><span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kw<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="6"></td><td><pre>        <span class="token keyword">return</span> wrapper</pre></td></tr><tr><td data-num="7"></td><td><pre>    <span class="token keyword">return</span> decorator</pre></td></tr><tr><td data-num="8"></td><td><pre></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token decorator annotation punctuation">@log</span><span class="token punctuation">(</span><span class="token string">"Python"</span><span class="token punctuation">)</span>  <span class="token comment"># 相当于执行了：now = log ('Python')(say_hi)</span></pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token keyword">def</span> <span class="token function">say_hi</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="11"></td><td><pre>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Hi,'</span><span class="token punctuation">,</span> name<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="12"></td><td><pre></pre></td></tr><tr><td data-num="13"></td><td><pre>say_hi<span class="token punctuation">(</span><span class="token string">'Zhang San'</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="14"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span>say_hi<span class="token punctuation">.</span>__name__<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="15"></td><td><pre></pre></td></tr><tr><td data-num="16"></td><td><pre><span class="token comment"># Python say_hi()</span></pre></td></tr><tr><td data-num="17"></td><td><pre><span class="token comment"># Hi, Zhang San</span></pre></td></tr><tr><td data-num="18"></td><td><pre><span class="token comment"># wrapper  # 函数名错误</span></pre></td></tr></table></figure><p>但如代码所示，通过现在的方式调用，被装饰器修饰的函数（say_hi）在执行结束后，其函数名称被替换了，这是因为装饰器是将被修饰的函数（say_hi）作为参数传递到了装饰器的内部，并且最终将其赋值为装饰器内部定义的一个内部函数（wrapper），因此，装饰器修饰的函数所对应的名称（say_hi），其实际上指向的不再是原本定义的函数，而是指向其作为参数传递，并且被赋值到的装饰器的一个内部参数（wrapper），所以最终通过 <code>say_hi.__name__</code> 获取到的函数名称变为了 <code>wrapper</code> 。</p><p>而要解决这样的问题，我们就需要在装饰器中实现类似 <code>wrapper.__name__ = func.__name__</code> 的功能，但我们其实并不需要手动编写这样的代码，因为 Python 内置了一个 <code>functools.wraps</code> 函数可以实现这样的功能：</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">import</span> functools  <span class="token comment"># 导入 functools 模块</span></pre></td></tr><tr><td data-num="2"></td><td><pre></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">def</span> <span class="token function">log</span><span class="token punctuation">(</span>text<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token keyword">def</span> <span class="token function">decorator</span><span class="token punctuation">(</span>func<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="5"></td><td><pre>        <span class="token decorator annotation punctuation">@functools<span class="token punctuation">.</span>wraps</span><span class="token punctuation">(</span>func<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="6"></td><td><pre>        <span class="token keyword">def</span> <span class="token function">wrapper</span><span class="token punctuation">(</span><span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kw<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="7"></td><td><pre>            <span class="token comment"># wrapper.__name__ = func.__name__  # 当然，通过这种方式也是可以的，但不推荐</span></pre></td></tr><tr><td data-num="8"></td><td><pre>            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'%s %s()'</span> <span class="token operator">%</span> <span class="token punctuation">(</span>text<span class="token punctuation">,</span> func<span class="token punctuation">.</span>__name__<span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="9"></td><td><pre>            <span class="token keyword">return</span> func<span class="token punctuation">(</span><span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kw<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="10"></td><td><pre>        <span class="token keyword">return</span> wrapper</pre></td></tr><tr><td data-num="11"></td><td><pre>    <span class="token keyword">return</span> decorator</pre></td></tr><tr><td data-num="12"></td><td><pre></pre></td></tr><tr><td data-num="13"></td><td><pre><span class="token decorator annotation punctuation">@log</span><span class="token punctuation">(</span><span class="token string">"Python"</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="14"></td><td><pre><span class="token keyword">def</span> <span class="token function">say_hi</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="15"></td><td><pre>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Hi,'</span><span class="token punctuation">,</span> name<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="16"></td><td><pre></pre></td></tr><tr><td data-num="17"></td><td><pre>say_hi<span class="token punctuation">(</span><span class="token string">'Zhang San'</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="18"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span>say_hi<span class="token punctuation">.</span>__name__<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="19"></td><td><pre></pre></td></tr><tr><td data-num="20"></td><td><pre><span class="token comment"># Python say_hi()</span></pre></td></tr><tr><td data-num="21"></td><td><pre><span class="token comment"># Hi, Zhang San</span></pre></td></tr><tr><td data-num="22"></td><td><pre><span class="token comment"># say_hi  # 函数名正确</span></pre></td></tr></table></figure><h4 id="偏函数"><a class="anchor" href="#偏函数">#</a> 偏函数</h4><p>Python 的 <code>functools</code> 模块提供了很多有用的功能，其中一个就是偏函数（Partial function）。</p><p>通过函数 <code>functools.partial</code> ，我们可以创建一个偏函数：</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment"># hex 字符串转 10 进制</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">import</span> functools</pre></td></tr><tr><td data-num="3"></td><td><pre></pre></td></tr><tr><td data-num="4"></td><td><pre>int2 <span class="token operator">=</span> functools<span class="token punctuation">.</span>partial<span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">,</span> base<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span>int2<span class="token punctuation">(</span><span class="token string">'101000'</span><span class="token punctuation">,</span> base<span class="token operator">=</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># 101000</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span>int2<span class="token punctuation">(</span><span class="token string">'101000'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># 40</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token comment"># 相当于</span></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">(</span><span class="token string">'101000'</span><span class="token punctuation">,</span> <span class="token operator">**</span><span class="token punctuation">&#123;</span><span class="token string">'base'</span><span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># 40</span></pre></td></tr></table></figure><p><code>functools.partial</code> 的作用就是，把一个函数的某些参数给固定住（也就是设置默认值），返回一个新的函数，这样调用这个新函数会更简单。而且，调用方可以根据自己的需要，选择是否传递新的值覆盖默认值。</p><p>创建偏函数时，实际上可以接收函数对象、 <code>*args</code> 和 <code>**kw</code> 这 3 个参数，在上面的二进制示例中，实际上是固定了 <code>int()</code> 函数的关键字参数 <code>base</code> 。而其他偏函数也是类似地，是将向偏函数中传入的值作为远函数的一部分，自动添加到所有参数左侧，例如：</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">import</span> functools</pre></td></tr><tr><td data-num="2"></td><td><pre></pre></td></tr><tr><td data-num="3"></td><td><pre>args1 <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="4"></td><td><pre>max1 <span class="token operator">=</span> functools<span class="token punctuation">.</span>partial<span class="token punctuation">(</span><span class="token builtin">max</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span>max1<span class="token punctuation">(</span><span class="token operator">*</span>args1<span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token comment"># 相当于</span></pre></td></tr><tr><td data-num="7"></td><td><pre>args2 <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="8"></td><td><pre>max2 <span class="token operator">=</span> <span class="token builtin">max</span><span class="token punctuation">(</span><span class="token operator">*</span>args2<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span>max2<span class="token punctuation">)</span></pre></td></tr></table></figure><blockquote><p>当函数的参数个数太多，需要简化时，使用 <code>functools.partial</code> 可以创建一个新的函数，这个新函数可以固定住原函数的部分参数，从而在调用时更简单。</p></blockquote><p>课间休息，听听音乐吧！</p><p></p><div class="media-container"><div class="player" data-type="audio" data-src='[{"title":"音乐推荐","list":["https://music.163.com/#/song?id=1501450521","https://music.163.com/#/song?id=28461702","https://music.163.com/#/song?id=857606","http://music.163.com/#/song?id=31545838","https://music.163.com/#/song?id=1815109509","https://music.163.com/#/song?id=1485319473"]}]'></div></div><p></p><h3 id="模块"><a class="anchor" href="#模块">#</a> 模块</h3><p>在计算机程序的开发过程中，随着业务逐渐完善，代码会越来越多，也越来越不容易维护。所以，为了便于更好地维护代码，提高开发效率，所有开发语言都有意识地将代码模块进行分化，这也是也是必然的。</p><p>为了编写可维护的代码，我们把很多函数分组，分别放到不同的文件里，这样，每个文件包含的代码就相对较少，很多编程语言都采用这种组织代码的方式。在 Python 中，一个 <code>.py</code> 文件就称之为一个模块（Module）。</p><p>在不同的模块中，函数的命名是可以重复的，但是我们所编写的函数，应当尽量与 Python 的内置函数区别开来，避免引起不必要的误会和冲突。</p><p>可以在<span class="exturl" data-url="aHR0cHM6Ly9kb2NzLnB5dGhvbi5vcmcvMy9saWJyYXJ5L2Z1bmN0aW9ucy5odG1s">官方文档</span>中查看 Python 的所有的内置函数。</p><p>另外，对于模块的命名， Python 按照目录来组织模块结构，并且称之为包（Package），而这种目录结构，通常推荐使用公司或企业的组织结构进行命名。</p><p>Python 的每个包目录下，都应当存在一个 <code>__init__.py</code> 文件，这个文件是必须的，否则，这个目录就不会被识别为包，而这个 <code>__init__.py</code> 文件本身可以是空文件，也可以有代码内容。</p><blockquote><p>在开发时创建模块，命名时需要注意避开 Python 自带的模块名称，例如系统自带了 <code>sys</code> 模块，就不可再命名为 <code>sys.py</code> ，否则将导致系统的 <code>sys</code> 模块无法导入。</p></blockquote><h4 id="使用模块"><a class="anchor" href="#使用模块">#</a> 使用模块</h4><p>Python 本身内置了很多非常有用的模块，只要安装完毕，这些模块就可以立刻使用，一个标准的 Python 文件模板如下：</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">#!/usr/bin/env python3</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token comment"># -*- coding: utf-8 -*-</span></pre></td></tr><tr><td data-num="3"></td><td><pre></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token triple-quoted-string string">""" a test module """</span></pre></td></tr><tr><td data-num="5"></td><td><pre></pre></td></tr><tr><td data-num="6"></td><td><pre>__author__ <span class="token operator">=</span> <span class="token string">'Chinmoku'</span></pre></td></tr><tr><td data-num="7"></td><td><pre></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token keyword">import</span> sys</pre></td></tr><tr><td data-num="9"></td><td><pre></pre></td></tr><tr><td data-num="10"></td><td><pre></pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token keyword">def</span> <span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="12"></td><td><pre>    args <span class="token operator">=</span> sys<span class="token punctuation">.</span>argv</pre></td></tr><tr><td data-num="13"></td><td><pre>    <span class="token keyword">print</span><span class="token punctuation">(</span>args<span class="token punctuation">)</span>  <span class="token comment"># ['A:/pycharm-workspace/py-test/main.py']</span></pre></td></tr><tr><td data-num="14"></td><td><pre>    <span class="token keyword">if</span> <span class="token builtin">len</span><span class="token punctuation">(</span>args<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="15"></td><td><pre>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Hello, world!'</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="16"></td><td><pre>    <span class="token keyword">elif</span> <span class="token builtin">len</span><span class="token punctuation">(</span>args<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">2</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="17"></td><td><pre>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Hello, %s!'</span> <span class="token operator">%</span> args<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="18"></td><td><pre>    <span class="token keyword">else</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="19"></td><td><pre>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Too many arguments!'</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="20"></td><td><pre></pre></td></tr><tr><td data-num="21"></td><td><pre></pre></td></tr><tr><td data-num="22"></td><td><pre><span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="23"></td><td><pre>    test<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr></table></figure><blockquote><p>前两行是标准注释，第一行注释指定了 Python 的环境，可以让这个文件直接在 Unix/Linux/Mac 环境上运行；而第二行注释则表明了这个文件使用的编码格式，避免解释器读取代码时产生乱码。第四行的字符串是用来指定当前模块的文档注释内容，任何模块的第一个字符串都将被视为该模块的文档注释。而第六行的 <code>__author__</code> 则指定了当前文件的开发者姓名，方便合作开发和维护。</p></blockquote><p>要使用一个模块，第一步是导入该模块，与其他开发语言大同小异，Python 导入模块的语法如下：</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">import</span> sys</pre></td></tr></table></figure><p><code>sys</code> 模块被导入后，就可以通过 <code>sys</code> 这个变量来访问该模块的所有功能。</p><p><code>sys.argv</code> 变量使用 list 存储了命令行的所有参数，它最少有一个参数，即是当前 <code>.py</code> 文件的全名称。</p><p>另外，在一个模块中，我们可能会定义很多函数或变量，但是我们希望一些函数或变量仅仅在模块内部进行使用，这时就要通过 <code>_</code> 前缀来实现。</p><p>正常的函数和变量名是公开的（public），可以被直接引用，，比如： <code>abc</code> ， <code>x123</code> ， <code>PI</code> 等；而特殊变量使用 <code>__xxx__</code> 方式命名，可以被直接引用，但是有特殊用途，例如 <code>__author__</code> 、 <code>__name__</code> 就分别代表作者和当前模块名，而且模块定义的文档注释其实也可以使用变量 <code>__doc__</code> 来访问（非常规）。</p><p>类似 <code>_xxx</code> 和 <code>__xxx</code> 这样的函数或变量就是非公开的（private），不应该被直接引用，比如 <code>_abc</code> ， <code>__abc</code> 等；</p><blockquote><p>但是，Python 其实并没有一种方法可以完全限制访问 private 函数或变量，但是，从编程习惯上不应该引用 private 函数或变量。</p></blockquote><p>外部不需要引用的函数尽量全部定义成 private，只有外部需要引用的函数才定义为 public。</p><h4 id="安装第三方模块"><a class="anchor" href="#安装第三方模块">#</a> 安装第三方模块</h4><p>在 Python 中，安装第三方模块，是通过包管理工具 pip 完成的。</p><p>一般来说，第三方库都会在 Python 官方的 <span class="exturl" data-url="aHR0cDovL3B5cGkucHl0aG9uLm9yZw==">pypi.python.org</span> 网站注册，要安装一个第三方库，必须先知道该库的名称，可以在官网或者 pypi 上搜索，比如 Pillow 的名称叫 Pillow，因此，安装 Pillow 的命令就是：</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre>pip install Pillow</pre></td></tr></table></figure><p>在使用 Python 时，我们经常需要用到很多第三方库，例如，上面提到的 Pillow，以及 MySQL 驱动程序，Web 框架 Flask，科学计算 Numpy 等。用 pip 一个一个安装费时费力，还需要考虑兼容性。因此，更加推荐地是使用 <span class="exturl" data-url="aHR0cHM6Ly93d3cuYW5hY29uZGEuY29tLw==">Anaconda</span> ，这是一个基于 Python 的数据处理和科学计算平台，它已经内置了许多非常有用的第三方库，可以从<span class="exturl" data-url="aHR0cHM6Ly93d3cuYW5hY29uZGEuY29tL2Rvd25sb2FkLw=="> Anaconda 官网</span>下载安装包。</p><p>下载完成后进行安装，推荐不要在安装时勾选自动配置环境变量的选项，而是手动进行配置，配置示例：</p><blockquote><p>在 <code>path</code> 环境变量中，添加如下配置：</p><p>A:\anaconda3<br>A:\anaconda3\Scripts<br>A:\anaconda3\Library\bin</p></blockquote><p>在命令行中输入 <code>python</code> ，在回车输出的结果中，如果有 <code>Anaconda</code> 字符，就表示安装成功。</p><p>当我们试图加载一个模块时，Python 会在指定的路径下搜索对应的 <code>.py</code> 文件，如果找不到，就会抛出 <code>ModuleNotFoundError</code> 异常。</p><p>默认情况下，Python 解释器会搜索当前目录、所有已安装的内置模块和第三方模块，搜索路径存放在 <code>sys</code> 模块的 <code>path</code> 变量中：</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">import</span> sys</pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span>sys<span class="token punctuation">.</span>path<span class="token punctuation">)</span></pre></td></tr></table></figure><p>如果要添加自定义的搜索目录，有以下两种方式：</p><ol><li><p>直接修改 <code>sys.path</code> ，添加自定义的搜索目录：</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">import</span> sys</pre></td></tr><tr><td data-num="2"></td><td><pre>sys<span class="token punctuation">.</span>path<span class="token punctuation">.</span>append<span class="token punctuation">(</span>'<span class="token operator">/</span>Users<span class="token operator">/</span>chinmoku<span class="token operator">/</span>py_test<span class="token punctuation">)</span></pre></td></tr></table></figure><p>这种方法是在运行时进行修改，程序运行结束后即失效。</p></li><li><p>设置环境变量 <code>PYTHONPATH</code> ，该环境变量的内容会被自动添加到模块搜索路径中。</p></li></ol><h3 id="面向对象编程"><a class="anchor" href="#面向对象编程">#</a> 面向对象编程</h3><blockquote><p>由于本人的第一开发语言 Java 本身就是一种面向对象的语言，因此，部分与 Java 共通的思想或基础概念，这里会有所省略。</p></blockquote><h4 id="类和实例"><a class="anchor" href="#类和实例">#</a> 类和实例</h4><p>Python 通过如下方式定义一个类：</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">class</span> <span class="token class-name">Student</span><span class="token punctuation">(</span><span class="token builtin">object</span><span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token keyword">pass</span></pre></td></tr></table></figure><p>其中， <code>class</code> 是定义类的关键字， <code>Student</code> 是类名，而紧接着的 <code>(object)</code> 表示当前类所继承的父类，所有的类最终都会继承自 <code>object</code> 类。</p><p>根据已有的类创建类的实例：</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment"># 定义一个类</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">class</span> <span class="token class-name">Student</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> name<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="4"></td><td><pre>        self<span class="token punctuation">.</span>name <span class="token operator">=</span> name</pre></td></tr><tr><td data-num="5"></td><td><pre></pre></td></tr><tr><td data-num="6"></td><td><pre>    <span class="token keyword">def</span> <span class="token function">get_name</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>  <span class="token comment"># 方法</span></pre></td></tr><tr><td data-num="7"></td><td><pre>        <span class="token keyword">return</span> self<span class="token punctuation">.</span>name</pre></td></tr><tr><td data-num="8"></td><td><pre></pre></td></tr><tr><td data-num="9"></td><td><pre></pre></td></tr><tr><td data-num="10"></td><td><pre>zhang <span class="token operator">=</span> Student<span class="token punctuation">(</span><span class="token string">'zhang'</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span>zhang<span class="token punctuation">)</span>  <span class="token comment"># &lt;__main__.Student object at 0x000002153559BA60></span></pre></td></tr><tr><td data-num="12"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span>zhang<span class="token punctuation">.</span>get_name<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># zhang</span></pre></td></tr></table></figure><p><code>__init__()</code> 是一个特殊的函数，这个方法在获取类的实例时被调用，可以进行对实例进行一些初始化定义，它可以有多个参数，但第一个参数必须是 <code>self</code> ，表示创建的实例本身。在创建实例时，要根据 <code>__init__()</code> 函数所需要的参数匹配传值，但 <code>self</code> 参数在传值时可以忽略，因为 Python 解释器会自动将实例变量传入到这个函数中。</p><p>在类中声明的函数与普通函数基本一样，但在类中声明的函数默认会有一个 <code>self</code> 参数，和 <code>__init__()</code> 函数一样，调用函数时忽略 <code>self</code> 参数即可。</p><p><mark>数据封装</mark>是面向对象编程的一个重要特点。</p><p>我们定义一个类，并且通过 <code>__init__()</code> 函数可以创建出该类的实例，但对于创建的实例，是可以调用类内部定义的方法的，这些在类内部的函数与类本身是关联起来的，我们称这些函数为类的方法，如上述代码片段中的 <code>get_name()</code> 函数。而要调用类的方法也很简单，通过实例直接调用即可。这样，对于实例而言，它并不需要关心调用的方法内部的实现细节，这是封装的好处之一。封装的另一好处是可以给类增加新的方法，而类的实例只需要直接调用方法即可。</p><p>总而言之：</p><ul><li><p>类是创建实例的模板，而实例则是一个一个具体的对象，各个实例拥有的数据都互相独立，互不影响；</p></li><li><p>方法就是与实例绑定的函数，和普通函数不同，方法可以直接访问实例的数据；</p></li><li><p>通过在实例上调用方法，我们就直接操作了对象内部的数据，但无需知道方法内部的实现细节；</p></li></ul><blockquote><p>Python 允许对实例变量绑定任何数据，也就是说，对于两个实例变量，虽然它们都是同一个类的不同实例，但拥有的变量名称都可能不同。</p></blockquote><h4 id="访问限制"><a class="anchor" href="#访问限制">#</a> 访问限制</h4><p>在 Class 内部，可以有属性和方法，而外部代码可以通过直接调用实例变量的方法来操作数据，这样，就隐藏了内部的复杂逻辑。但是，外部仍旧可以自由访问和修改一个实例内部的属性，如果不希望内部属性被外部访问，可以使用 <code>__name</code> 这种方式对属性进行命名。该变量就会变为一个私有变量，这样，这个变量就只有内部可以访问，而外部是无法访问的。</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">class</span> <span class="token class-name">Student</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> name<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="3"></td><td><pre>        self<span class="token punctuation">.</span>__name <span class="token operator">=</span> name</pre></td></tr><tr><td data-num="4"></td><td><pre></pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token keyword">def</span> <span class="token function">get_name</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="6"></td><td><pre>        <span class="token keyword">return</span> self<span class="token punctuation">.</span>__name</pre></td></tr><tr><td data-num="7"></td><td><pre></pre></td></tr><tr><td data-num="8"></td><td><pre>    <span class="token keyword">def</span> <span class="token function">set_name</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> name<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="9"></td><td><pre>        self<span class="token punctuation">.</span>__name <span class="token operator">=</span> name</pre></td></tr><tr><td data-num="10"></td><td><pre></pre></td></tr><tr><td data-num="11"></td><td><pre>zhang <span class="token operator">=</span> Student<span class="token punctuation">(</span><span class="token string">'zhang'</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="12"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span>zhang<span class="token punctuation">.</span>_Student__name<span class="token punctuation">)</span>  <span class="token comment"># zhang</span></pre></td></tr><tr><td data-num="13"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span>zhang<span class="token punctuation">.</span>__name<span class="token punctuation">)</span>  <span class="token comment"># AttributeError: 'Student' object has no attribute '__name'</span></pre></td></tr><tr><td data-num="14"></td><td><pre>zhang<span class="token punctuation">.</span>set_name<span class="token punctuation">(</span><span class="token string">'zhou'</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="15"></td><td><pre></pre></td></tr><tr><td data-num="16"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span>zhang<span class="token punctuation">.</span>get_name<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># zhou</span></pre></td></tr></table></figure><p>其实在上文已经多次提到，以 <code>__xxx</code> 方式命名变量，并不能保证变量不被外部直接访问，例如在上面的代码清单中，其实通过 <code>.Student__name</code> 依然能够得到私有变量的值，而之所以说通过 <code>__xxx</code> 方式可以声明为私有变量，其实仅仅是出于约定俗成的规定，而非出于程序的强制要求，往往更多的是需要开发者拥有主动意识，自觉遵守这些约定或规范。</p><blockquote><p>注意： <code>__xxx__</code> 命名方式，表示这个变量是一个特殊变量，它不是私有变量，可以被直接访问，所以在属性命名时，不应当以这种方式命名。另外，以 <code>_xxx</code> 这种方式命名的变量，是可以被外部访问的，但作为一种约定俗成的规定，我们应当尽量将它当做私有变量看待。</p></blockquote><h4 id="继承和多态"><a class="anchor" href="#继承和多态">#</a> 继承和多态</h4><p>前面提到封装是面向对象编程的一个重要特点，而继承和多态则是面向对象编程的另外两大特点。</p><p>当我们定义一个类的时候，我们定义的这个类可以从某个类继承，因此新创建的类相对被继承的类而言就是子类，而被继承的类就是基类、父类或超类。</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">class</span> <span class="token class-name">Animal</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token keyword">def</span> <span class="token function">run</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> ani<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="3"></td><td><pre>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'%s can run'</span> <span class="token operator">%</span> ani<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="4"></td><td><pre></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token keyword">class</span> <span class="token class-name">Dog</span><span class="token punctuation">(</span>Animal<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> type_name<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="7"></td><td><pre>        self<span class="token punctuation">.</span>type_name <span class="token operator">=</span> type_name</pre></td></tr><tr><td data-num="8"></td><td><pre></pre></td></tr><tr><td data-num="9"></td><td><pre>    <span class="token keyword">def</span> <span class="token function">get_type_name</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="10"></td><td><pre>        <span class="token keyword">return</span> self<span class="token punctuation">.</span>type_name</pre></td></tr><tr><td data-num="11"></td><td><pre></pre></td></tr><tr><td data-num="12"></td><td><pre>    <span class="token comment"># 子类可以重写父类的方法</span></pre></td></tr><tr><td data-num="13"></td><td><pre>    <span class="token keyword">def</span> <span class="token function">run</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> <span class="token builtin">type</span><span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="14"></td><td><pre>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'%s can run every!'</span> <span class="token operator">%</span> <span class="token builtin">type</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="15"></td><td><pre></pre></td></tr><tr><td data-num="16"></td><td><pre><span class="token keyword">class</span> <span class="token class-name">Cat</span><span class="token punctuation">(</span>Animal<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="17"></td><td><pre>    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="18"></td><td><pre>        <span class="token keyword">pass</span></pre></td></tr><tr><td data-num="19"></td><td><pre></pre></td></tr><tr><td data-num="20"></td><td><pre>catA <span class="token operator">=</span> Cat<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="21"></td><td><pre>catA<span class="token punctuation">.</span>run<span class="token punctuation">(</span><span class="token string">'Cat'</span><span class="token punctuation">)</span>  <span class="token comment"># 子类可以调用父类的方法</span></pre></td></tr><tr><td data-num="22"></td><td><pre><span class="token comment"># Cat can run</span></pre></td></tr><tr><td data-num="23"></td><td><pre></pre></td></tr><tr><td data-num="24"></td><td><pre>dogA <span class="token operator">=</span> Dog<span class="token punctuation">(</span><span class="token string">'Dog'</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="25"></td><td><pre></pre></td></tr><tr><td data-num="26"></td><td><pre>dogA<span class="token punctuation">.</span>run<span class="token punctuation">(</span>dogA<span class="token punctuation">.</span>get_type_name<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="27"></td><td><pre><span class="token comment"># Dog can run every!</span></pre></td></tr></table></figure><p>继承的好处在于不用进行任何声明就可以获得父类的全部功能，而且子类仍然可以对自身进行扩展和增强而不受父类限制，例如新增属性和方法。</p><p>当子类和父类存在相同的方法时，我们便说子类覆盖了父类的方法。当实例调用该同名方法时，就只会调用子类的方法，而不会调用父类，这种特性在面向对象的思想里被称为多态。</p><p>在 Python 基础中我们提到过，可以使用 <code>isinstance()</code> 函数来判断某个变量是否是某种类型。而在这里的实例中，我们同样可以通过这种方法来对拥有继承关系的子类对象和父类进行判断：</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">isinstance</span><span class="token punctuation">(</span>catA<span class="token punctuation">,</span> Cat<span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># True</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">isinstance</span><span class="token punctuation">(</span>dogA<span class="token punctuation">,</span> Dog<span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># True</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">isinstance</span><span class="token punctuation">(</span>catA<span class="token punctuation">,</span> Animal<span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># True</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">isinstance</span><span class="token punctuation">(</span>dogA<span class="token punctuation">,</span> Animal<span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># True</span></pre></td></tr><tr><td data-num="5"></td><td><pre>animal <span class="token operator">=</span> Animal<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">isinstance</span><span class="token punctuation">(</span>animal<span class="token punctuation">,</span> Dog<span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># False</span></pre></td></tr></table></figure><p><strong>静态语言与动态语言：</strong></p><p>对于静态语言来说（例如 Java），如果需要传入 Animal 类型，那么就必须传入 Animal 类型或它的子类，否则无法调用其 <code>run()</code> 方法。</p><p>而对于 Python 这样的动态语言来说，则不一定非要传入 Animal 类型或其子类，我们只需要保证传入的对象有一个 <code>run()</code> 方法即可。</p><p>Python 具有这种 <code>file-like-object</code> 的特点，它并不严格要求继承体系，这就是所谓的 “鸭子类型”。</p><blockquote><p>鸭子类型：一个对象只要 “看起来像鸭子，走起路来像鸭子”，那它就可以被看做是鸭子。</p></blockquote><h4 id="获取对象信息"><a class="anchor" href="#获取对象信息">#</a> 获取对象信息</h4><p>当我们获得一个对象的引用时，我们可以通过 <code>type()</code> 函数来判断该对象的类型，当然，如果一个变量指向函数或类，也可以使用 <code>type()</code> 函数进行判断：</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token punctuation">(</span>dogA<span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># &lt;class '__main__.Dog'></span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token punctuation">(</span>dogA<span class="token punctuation">)</span> <span class="token operator">==</span> Dog<span class="token punctuation">)</span>  <span class="token comment"># True</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token punctuation">(</span>dogA<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token builtin">type</span><span class="token punctuation">(</span>catA<span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># False</span></pre></td></tr></table></figure><p><code>type()</code> 函数返回的是一个 Class 类型，除了自定义的类型之外，也可以判断内置的类型：</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">import</span> types</pre></td></tr><tr><td data-num="2"></td><td><pre></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">def</span> <span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token keyword">pass</span></pre></td></tr><tr><td data-num="5"></td><td><pre></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token punctuation">(</span>fn<span class="token punctuation">)</span> <span class="token operator">==</span> types<span class="token punctuation">.</span>FunctionType<span class="token punctuation">)</span>  <span class="token comment"># True</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token punctuation">(</span><span class="token keyword">lambda</span> x<span class="token punctuation">:</span> x<span class="token punctuation">)</span> <span class="token operator">==</span> types<span class="token punctuation">.</span>LambdaType<span class="token punctuation">)</span>  <span class="token comment"># True</span></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token punctuation">(</span><span class="token punctuation">(</span>x <span class="token keyword">for</span> x <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">==</span>types<span class="token punctuation">.</span>GeneratorType<span class="token punctuation">)</span>  <span class="token comment"># True</span></pre></td></tr></table></figure><p>type 函数可以判断一个对象的类型，但对于拥有继承关系的对象而言，就无法判断它的父级类型，对于这种情况，我们仍旧可以使用 <code>isinstance()</code> 函数进行判断，它可以判断对象是否处于某一继承链上。</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">isinstance</span><span class="token punctuation">(</span>catA<span class="token punctuation">,</span> Animal<span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># True</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">isinstance</span><span class="token punctuation">(</span>dogA<span class="token punctuation">,</span> Animal<span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># True</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">isinstance</span><span class="token punctuation">(</span>dogA<span class="token punctuation">,</span> Cat<span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># False</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">isinstance</span><span class="token punctuation">(</span>dogA<span class="token punctuation">,</span> <span class="token punctuation">(</span>Cat<span class="token punctuation">,</span> Dog<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># True # 判断是否是多个对象中的一种</span></pre></td></tr></table></figure><p>如果要获得一个对象的所有属性和方法，可以使用 <code>dir()</code> 函数，它返回一个包含字符串的 list ；如果想要获取对象长度，可以使用 <code>__len__()</code> 方法或 <code>len()</code> 函数，他们是等价的，并且，我们可以重写类中的 <code>__len__()</code> 方法。</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">class</span> <span class="token class-name">Cat</span><span class="token punctuation">(</span>Animal<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="3"></td><td><pre>        <span class="token keyword">pass</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    </pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token keyword">def</span> <span class="token function">__len__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="6"></td><td><pre>        <span class="token keyword">return</span> <span class="token number">20</span></pre></td></tr><tr><td data-num="7"></td><td><pre></pre></td></tr><tr><td data-num="8"></td><td><pre>catA <span class="token operator">=</span> Cat<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">dir</span><span class="token punctuation">(</span>catA<span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># ['__class__', '__delattr__', '__dict__', '__dir__' ...</span></pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>catA<span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># 20</span></pre></td></tr></table></figure><p>另外，对象还提供了 <code>getattr()</code> 、 <code>setattr()</code> 、 <code>hasattr()</code> 函数，可用于操作类中的属性。</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment"># print(getattr(dogA, 'color'))  # AttributeError: 'Dog' object has no attribute 'color'</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">getattr</span><span class="token punctuation">(</span>dogA<span class="token punctuation">,</span> <span class="token string">'color'</span><span class="token punctuation">,</span> <span class="token boolean">None</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># None # 获取属性时，可以传入一个默认值，当属性不存在时生效</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">hasattr</span><span class="token punctuation">(</span>dogA<span class="token punctuation">,</span> <span class="token string">'color'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># False</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token builtin">setattr</span><span class="token punctuation">(</span>dogA<span class="token punctuation">,</span> <span class="token string">'color'</span><span class="token punctuation">,</span> <span class="token string">'brown'</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">hasattr</span><span class="token punctuation">(</span>dogA<span class="token punctuation">,</span> <span class="token string">'color'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># True</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">getattr</span><span class="token punctuation">(</span>dogA<span class="token punctuation">,</span> <span class="token string">'color'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># brown</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">getattr</span><span class="token punctuation">(</span>dogA<span class="token punctuation">,</span> <span class="token string">'run'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># &lt;bound method Dog.run of &lt;__main__.Dog object at 0x000001BB085C2FA0>> # 判断是否有某方法</span></pre></td></tr></table></figure><blockquote><p>这些用于获取属性的方法或函数，通常是在不知道某一个类是否具有该方法时才使用的。</p></blockquote><h4 id="实例属性和类属性"><a class="anchor" href="#实例属性和类属性">#</a> 实例属性和类属性</h4><p>对于一个类的实例，我们可以通过实例变量直接声明或使用 self 参数的方式声明以为其绑定属性。但对一个类本身，我们也可以通过如下方式为这个类声明属性：</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">class</span> <span class="token class-name">Student</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    name <span class="token operator">=</span> <span class="token string">'Student'</span></pre></td></tr><tr><td data-num="3"></td><td><pre></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="5"></td><td><pre>        <span class="token keyword">pass</span></pre></td></tr><tr><td data-num="6"></td><td><pre></pre></td></tr><tr><td data-num="7"></td><td><pre>student <span class="token operator">=</span> Student<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span>student<span class="token punctuation">.</span>name<span class="token punctuation">)</span>  <span class="token comment"># Student</span></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span>Student<span class="token punctuation">.</span>name<span class="token punctuation">)</span>  <span class="token comment"># Student</span></pre></td></tr><tr><td data-num="10"></td><td><pre>student<span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">'Teacher'</span></pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span>student<span class="token punctuation">.</span>name<span class="token punctuation">)</span>  <span class="token comment"># Teacher</span></pre></td></tr><tr><td data-num="12"></td><td><pre><span class="token keyword">del</span> student<span class="token punctuation">.</span>name</pre></td></tr><tr><td data-num="13"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span>student<span class="token punctuation">.</span>name<span class="token punctuation">)</span>  <span class="token comment"># Student</span></pre></td></tr></table></figure><p>这个为类声明的属性虽然为类所有，但这个类的所有实例均可以访问该属性。如果类属性与实例属性同名，调用属性时默认从实例属性中获取，如实例属性未获取到，则从类属性中获取。因此，在编程时，我们应当尽量避免出现实例属性与类属性同名的情况。</p><h3 id="面向对象高级编程"><a class="anchor" href="#面向对象高级编程">#</a> 面向对象高级编程</h3><h4 id="_slots_"><a class="anchor" href="#_slots_">#</a> _<em>slots</em>_</h4><p>对于一个已声明的对象的实例，我们可以为其绑定任何属性和方法，但是为某一实例绑定的属性或方法，仅对当前实例有效，如果需要为所有实例都绑定属性或方法，则可以直接将属性或方法绑定到类上。给类绑定实例或方法后，这个类的所有实例均可调用。</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">class</span> <span class="token class-name">Student</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="3"></td><td><pre>        <span class="token keyword">pass</span></pre></td></tr><tr><td data-num="4"></td><td><pre></pre></td></tr><tr><td data-num="5"></td><td><pre>student1 <span class="token operator">=</span> Student<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="6"></td><td><pre>student1<span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">'Zhang'</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span>student1<span class="token punctuation">.</span>name<span class="token punctuation">)</span>  <span class="token comment"># Zhang</span></pre></td></tr><tr><td data-num="8"></td><td><pre>student2 <span class="token operator">=</span> Student<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token comment"># print(student2.name)  # AttributeError: 'Student' object has no attribute 'name'</span></pre></td></tr><tr><td data-num="10"></td><td><pre>Student<span class="token punctuation">.</span>age <span class="token operator">=</span> <span class="token number">17</span></pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span>student1<span class="token punctuation">.</span>age<span class="token punctuation">)</span>  <span class="token comment"># 17</span></pre></td></tr><tr><td data-num="12"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span>student2<span class="token punctuation">.</span>age<span class="token punctuation">)</span>  <span class="token comment"># 17</span></pre></td></tr></table></figure><p>但是，为示例绑定属性或方法并不受任何限制，如果需要限定实例需要绑定的属性或方法，可以通过 <code>__slots__</code> 来指定：</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">class</span> <span class="token class-name">Student</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    __slots__ <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token string">'name'</span><span class="token punctuation">,</span> <span class="token string">'study'</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="3"></td><td><pre></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="5"></td><td><pre>        <span class="token keyword">pass</span></pre></td></tr><tr><td data-num="6"></td><td><pre></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token keyword">def</span> <span class="token function">study</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="8"></td><td><pre>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'%s is studying!'</span> <span class="token operator">%</span> name<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="9"></td><td><pre></pre></td></tr><tr><td data-num="10"></td><td><pre>student1 <span class="token operator">=</span> Student<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="11"></td><td><pre>student1<span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">'Zhang'</span></pre></td></tr><tr><td data-num="12"></td><td><pre>student1<span class="token punctuation">.</span>study <span class="token operator">=</span> study</pre></td></tr><tr><td data-num="13"></td><td><pre>student1<span class="token punctuation">.</span>study<span class="token punctuation">(</span>student1<span class="token punctuation">.</span>name<span class="token punctuation">)</span>  <span class="token comment"># Zhang is studying!</span></pre></td></tr><tr><td data-num="14"></td><td><pre>student1<span class="token punctuation">.</span>age <span class="token operator">=</span> <span class="token number">17</span>  <span class="token comment"># AttributeError: 'Student' object has no attribute 'age'</span></pre></td></tr></table></figure><p><code>__slots__</code> 使用 tuple 来指定多个属性名，实例在绑定属性或方法时，所绑定的属性或方法的名称必须在 <code>__slot__</code> 属性中存在，否则就会抛出异常。</p><p>注意： <code>__slots__</code> 中定义的属性仅仅对当前类的实例起作用，对继承的子类是不起作用的，除非在子类中也进行声明，这样，子类和父类的 <code>__slots__</code> 限制会进行叠加。</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">class</span> <span class="token class-name">Person</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    __slots__ <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token string">'name'</span><span class="token punctuation">,</span> <span class="token string">'age'</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="3"></td><td><pre></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token keyword">class</span> <span class="token class-name">Student</span><span class="token punctuation">(</span>Person<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    __slots__ <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token string">'grade'</span><span class="token punctuation">,</span> <span class="token string">'score'</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="6"></td><td><pre></pre></td></tr><tr><td data-num="7"></td><td><pre>student1 <span class="token operator">=</span> Student<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="8"></td><td><pre>student1<span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">'Zhang'</span></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span>student1<span class="token punctuation">.</span>name<span class="token punctuation">)</span>  <span class="token comment"># Zhang</span></pre></td></tr><tr><td data-num="10"></td><td><pre>student1<span class="token punctuation">.</span>character <span class="token operator">=</span> <span class="token string">'forthright'</span>  <span class="token comment"># AttributeError: 'Student' object has no attribute 'character'</span></pre></td></tr></table></figure><h4 id="property"><a class="anchor" href="#property">#</a> @property</h4><p>对于一个类的属性，声明的实例直接调用属性是不安全而且无法进行任何限制的，如果需要对属性进行限制，我们可以使用 Python 内置的 <code>@property</code> 装饰器来将一个方法变为属性调用。</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">class</span> <span class="token class-name">Student</span><span class="token punctuation">(</span><span class="token builtin">object</span><span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="2"></td><td><pre></pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token decorator annotation punctuation">@property</span>  <span class="token comment"># getter</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token keyword">def</span> <span class="token function">score</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="5"></td><td><pre>        <span class="token keyword">return</span> self<span class="token punctuation">.</span>_score</pre></td></tr><tr><td data-num="6"></td><td><pre></pre></td></tr><tr><td data-num="7"></td><td><pre>    <span class="token decorator annotation punctuation">@score<span class="token punctuation">.</span>setter</span>  <span class="token comment"># setter</span></pre></td></tr><tr><td data-num="8"></td><td><pre>    <span class="token keyword">def</span> <span class="token function">score</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="9"></td><td><pre>        <span class="token keyword">if</span> <span class="token keyword">not</span> <span class="token builtin">isinstance</span><span class="token punctuation">(</span>value<span class="token punctuation">,</span> <span class="token builtin">int</span><span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="10"></td><td><pre>            <span class="token keyword">raise</span> ValueError<span class="token punctuation">(</span><span class="token string">'score must be an integer!'</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="11"></td><td><pre>        <span class="token keyword">if</span> value <span class="token operator">&lt;</span> <span class="token number">0</span> <span class="token keyword">or</span> value <span class="token operator">></span> <span class="token number">100</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="12"></td><td><pre>            <span class="token keyword">raise</span> ValueError<span class="token punctuation">(</span><span class="token string">'score must between 0 ~ 100!'</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="13"></td><td><pre>        self<span class="token punctuation">.</span>_score <span class="token operator">=</span> value</pre></td></tr><tr><td data-num="14"></td><td><pre></pre></td></tr><tr><td data-num="15"></td><td><pre>student1 <span class="token operator">=</span> Student<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="16"></td><td><pre><span class="token comment"># student1.score = 'C'  # ValueError: score must be an integer!</span></pre></td></tr><tr><td data-num="17"></td><td><pre><span class="token comment"># student1.score = 120  # ValueError: score must between 0 ~ 100!</span></pre></td></tr><tr><td data-num="18"></td><td><pre>student1<span class="token punctuation">.</span>score <span class="token operator">=</span> <span class="token number">60</span></pre></td></tr><tr><td data-num="19"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span>student1<span class="token punctuation">.</span>score<span class="token punctuation">)</span>  <span class="token comment"># 60</span></pre></td></tr></table></figure><p>如果需要定义一个只读属性，那么，我们只需要不对 <code>setter</code> 进行定义即可。</p><p>但需要注意一点，属性的方法名不应当与实例变量重名，这样会导致无线递归，最终赵成栈溢出，错误示例：</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">class</span> <span class="token class-name">Student</span><span class="token punctuation">(</span><span class="token builtin">object</span><span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="2"></td><td><pre></pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token decorator annotation punctuation">@property</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token keyword">def</span> <span class="token function">score</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>  <span class="token comment"># 属性方法名为 score</span></pre></td></tr><tr><td data-num="5"></td><td><pre>        <span class="token keyword">return</span> self<span class="token punctuation">.</span>score  <span class="token comment"># 实例变量名也为 score</span></pre></td></tr></table></figure><h4 id="多重继承"><a class="anchor" href="#多重继承">#</a> 多重继承</h4><p>在面向对象的思想中，一个类是可以同时继承多个类的，但在设计类的继承关系时，通常，主线都是单一继承下来的，如果需要 “混入” 额外的功能，通过多重继承就可以实现，这种设计通常称之为 <code>MixIn</code> 。</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">class</span> <span class="token class-name">Dog</span><span class="token punctuation">(</span>Mammal<span class="token punctuation">,</span> RunnableMixIn<span class="token punctuation">,</span> CarnivorousMixIn<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token keyword">pass</span></pre></td></tr></table></figure><p>MixIn 的目的就是给一个类增加多个功能，这样，在设计类的时候，我们优先考虑通过多重继承来组合多个 MixIn 的功能，而不是设计多层次的复杂的继承关系。</p><p>Python 自带的很多库也使用了 MixIn。例如 Python 自带了 <code>TCPServer</code> 和 <code>UDPServer</code> 这两类网络服务，而要同时服务多个用户就必须使用多进程或多线程模型，这两种模型由 <code>ForkingMixIn</code> 和 <code>ThreadingMixIn</code> 提供，于是，我们可以通过不同的组合来创建合适的服务。</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment"># 多进程模式的 TCP 服务</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">class</span> <span class="token class-name">MyTCPServer</span><span class="token punctuation">(</span>TCPServer<span class="token punctuation">,</span> ForkingMixIn<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token keyword">pass</span></pre></td></tr><tr><td data-num="4"></td><td><pre></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token comment"># 多线程模式的 UDP 服务</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token keyword">class</span> <span class="token class-name">MyUDPServer</span><span class="token punctuation">(</span>UDPServer<span class="token punctuation">,</span> ThreadingMixIn<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="7"></td><td><pre>    <span class="token keyword">pass</span></pre></td></tr></table></figure><p>通过这种 MixIn 方式，我们不需要复杂而庞大的继承链，只要选择组合不同的类的功能，就可以快速构造出所需的子类。</p><blockquote><p>只允许单一继承的语言（如 Java）不能使用 MixIn 的设计。</p></blockquote><h4 id="定制类"><a class="anchor" href="#定制类">#</a> 定制类</h4><h5 id="_str_"><a class="anchor" href="#_str_">#</a> _<em>str</em>_</h5><p>当我们在打印一个类的实例时，通常打印的都是都是这个实例的内存地址信息，如需要有意义的自定义实例信息，可以使用 <code>__str__()</code> 方法：</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">class</span> <span class="token class-name">Student</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> name<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="3"></td><td><pre>        self<span class="token punctuation">.</span>name <span class="token operator">=</span> name</pre></td></tr><tr><td data-num="4"></td><td><pre></pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token keyword">def</span> <span class="token function">__str__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="6"></td><td><pre>        <span class="token keyword">return</span> <span class="token string">'class Student(name: %s)'</span> <span class="token operator">%</span> self<span class="token punctuation">.</span>name</pre></td></tr><tr><td data-num="7"></td><td><pre></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token keyword">class</span> <span class="token class-name">Teacher</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="9"></td><td><pre>    <span class="token keyword">pass</span></pre></td></tr><tr><td data-num="10"></td><td><pre></pre></td></tr><tr><td data-num="11"></td><td><pre>teacher1 <span class="token operator">=</span> Teacher<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="12"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span>teacher1<span class="token punctuation">)</span>  <span class="token comment"># &lt;__main__.Teacher object at 0x000001D2DAC21FD0></span></pre></td></tr><tr><td data-num="13"></td><td><pre>student1 <span class="token operator">=</span> Student<span class="token punctuation">(</span><span class="token string">'Zhang'</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="14"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span>student1<span class="token punctuation">)</span>  <span class="token comment"># class Student(name: Zhang)</span></pre></td></tr></table></figure><h5 id="_iter_"><a class="anchor" href="#_iter_">#</a> _<em>iter</em>_</h5><p>如果一个类想被用于 <code>for ... in</code> 循环，就必须实现一个 <code>__iter__()</code> 方法，该方法返回一个迭代对象，然后，Python 的 for 循环就会不断调用该迭代对象的 <code>__next__()</code> 方法拿到循环的下一个值，直到遇到 <code>StopIteration</code> 错误时退出循环，例如：</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment"># 斐波那契数列</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">class</span> <span class="token class-name">Fib</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="4"></td><td><pre>        self<span class="token punctuation">.</span>a<span class="token punctuation">,</span> self<span class="token punctuation">.</span>b <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span>  <span class="token comment"># 初始化两个计数器 a，b</span></pre></td></tr><tr><td data-num="5"></td><td><pre></pre></td></tr><tr><td data-num="6"></td><td><pre>    <span class="token keyword">def</span> <span class="token function">__iter__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="7"></td><td><pre>        <span class="token keyword">return</span> self  <span class="token comment"># 实例本身就是迭代对象，故返回自己</span></pre></td></tr><tr><td data-num="8"></td><td><pre></pre></td></tr><tr><td data-num="9"></td><td><pre>    <span class="token keyword">def</span> <span class="token function">__next__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="10"></td><td><pre>        self<span class="token punctuation">.</span>a<span class="token punctuation">,</span> self<span class="token punctuation">.</span>b <span class="token operator">=</span> self<span class="token punctuation">.</span>b<span class="token punctuation">,</span> self<span class="token punctuation">.</span>a <span class="token operator">+</span> self<span class="token punctuation">.</span>b  <span class="token comment"># 计算下一个值</span></pre></td></tr><tr><td data-num="11"></td><td><pre>        <span class="token keyword">if</span> self<span class="token punctuation">.</span>a <span class="token operator">></span> <span class="token number">1000</span><span class="token punctuation">:</span>  <span class="token comment"># 退出循环的条件</span></pre></td></tr><tr><td data-num="12"></td><td><pre>            <span class="token keyword">raise</span> StopIteration<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="13"></td><td><pre>        <span class="token keyword">return</span> self<span class="token punctuation">.</span>a  <span class="token comment"># 返回下一个值</span></pre></td></tr><tr><td data-num="14"></td><td><pre></pre></td></tr><tr><td data-num="15"></td><td><pre>fib <span class="token operator">=</span> Fib<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="16"></td><td><pre>tu <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span></pre></td></tr><tr><td data-num="17"></td><td><pre><span class="token keyword">for</span> x <span class="token keyword">in</span> fib<span class="token punctuation">:</span></pre></td></tr><tr><td data-num="18"></td><td><pre>    tu<span class="token punctuation">.</span>append<span class="token punctuation">(</span>x<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="19"></td><td><pre></pre></td></tr><tr><td data-num="20"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span>tu<span class="token punctuation">)</span>  <span class="token comment"># [1, 1, 2, 3, 5, 8, 13, 21, 34, 55, 89, 144, 233, 377, 610, 987]</span></pre></td></tr></table></figure><h5 id="_getitem_"><a class="anchor" href="#_getitem_">#</a> _<em>getitem</em>_</h5><p>在上面的斐波那契数列代码清单中，声明的实例对象虽然和 list 很像，但它还不能通过下标获取对应的元素，要实现这一点，可以通过加入 <code>__getitem__()</code> 方法来实现：</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">def</span> <span class="token function">__getitem__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> n<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    a<span class="token punctuation">,</span> b <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token keyword">for</span> x <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="4"></td><td><pre>        a<span class="token punctuation">,</span> b <span class="token operator">=</span> b<span class="token punctuation">,</span> a <span class="token operator">+</span> b</pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token keyword">return</span> a</pre></td></tr><tr><td data-num="6"></td><td><pre></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span>Fib<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">)</span>  <span class="token comment"># 5</span></pre></td></tr></table></figure><p>而如果要支持切片方式，则需要更加完善的逻辑：</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">def</span> <span class="token function">__getitem__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> n<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token keyword">if</span> <span class="token builtin">isinstance</span><span class="token punctuation">(</span>n<span class="token punctuation">,</span> <span class="token builtin">int</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token comment"># n 是索引</span></pre></td></tr><tr><td data-num="3"></td><td><pre>        a<span class="token punctuation">,</span> b <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span></pre></td></tr><tr><td data-num="4"></td><td><pre>        <span class="token keyword">for</span> x <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="5"></td><td><pre>            a<span class="token punctuation">,</span> b <span class="token operator">=</span> b<span class="token punctuation">,</span> a <span class="token operator">+</span> b</pre></td></tr><tr><td data-num="6"></td><td><pre>        <span class="token keyword">return</span> a</pre></td></tr><tr><td data-num="7"></td><td><pre>    <span class="token keyword">if</span> <span class="token builtin">isinstance</span><span class="token punctuation">(</span>n<span class="token punctuation">,</span> <span class="token builtin">slice</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token comment"># n 是切片</span></pre></td></tr><tr><td data-num="8"></td><td><pre>        start <span class="token operator">=</span> n<span class="token punctuation">.</span>start</pre></td></tr><tr><td data-num="9"></td><td><pre>        stop <span class="token operator">=</span> n<span class="token punctuation">.</span>stop</pre></td></tr><tr><td data-num="10"></td><td><pre>        <span class="token keyword">if</span> start <span class="token keyword">is</span> <span class="token boolean">None</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="11"></td><td><pre>            start <span class="token operator">=</span> <span class="token number">0</span></pre></td></tr><tr><td data-num="12"></td><td><pre>        a<span class="token punctuation">,</span> b <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span></pre></td></tr><tr><td data-num="13"></td><td><pre>        L <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span></pre></td></tr><tr><td data-num="14"></td><td><pre>        <span class="token keyword">for</span> x <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>stop<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="15"></td><td><pre>            <span class="token keyword">if</span> x <span class="token operator">>=</span> start<span class="token punctuation">:</span></pre></td></tr><tr><td data-num="16"></td><td><pre>                L<span class="token punctuation">.</span>append<span class="token punctuation">(</span>a<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="17"></td><td><pre>            a<span class="token punctuation">,</span> b <span class="token operator">=</span> b<span class="token punctuation">,</span> a <span class="token operator">+</span> b</pre></td></tr><tr><td data-num="18"></td><td><pre>        <span class="token keyword">return</span> L</pre></td></tr><tr><td data-num="19"></td><td><pre></pre></td></tr><tr><td data-num="20"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span>fib<span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">:</span><span class="token number">10</span><span class="token punctuation">]</span><span class="token punctuation">)</span>  <span class="token comment"># [8, 13, 21, 34, 55]</span></pre></td></tr></table></figure><h5 id="_getattr_"><a class="anchor" href="#_getattr_">#</a> _<em>getattr</em>_</h5><p>当一个实例调用不存在的属性或方法时，就会抛出异常，我们可以定义一个 <code>__getattr__()</code> 方法来动态地返回属性或函数。</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">class</span> <span class="token class-name">Student</span><span class="token punctuation">(</span><span class="token builtin">object</span><span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="2"></td><td><pre></pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="4"></td><td><pre>        self<span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">'Michael'</span></pre></td></tr><tr><td data-num="5"></td><td><pre></pre></td></tr><tr><td data-num="6"></td><td><pre>    <span class="token keyword">def</span> <span class="token function">__getattr__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> attr<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="7"></td><td><pre>        <span class="token keyword">if</span> attr <span class="token operator">==</span> <span class="token string">'score'</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="8"></td><td><pre>            <span class="token keyword">return</span> <span class="token number">60</span></pre></td></tr><tr><td data-num="9"></td><td><pre>        <span class="token keyword">if</span> attr <span class="token operator">==</span> <span class="token string">'age'</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="10"></td><td><pre>            <span class="token keyword">return</span> <span class="token keyword">lambda</span><span class="token punctuation">:</span> <span class="token number">18</span></pre></td></tr><tr><td data-num="11"></td><td><pre>        <span class="token keyword">raise</span> AttributeError<span class="token punctuation">(</span><span class="token string">'\'Student\' object has no attribute \'%s\''</span> <span class="token operator">%</span> attr<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="12"></td><td><pre></pre></td></tr><tr><td data-num="13"></td><td><pre>student1 <span class="token operator">=</span> Student<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="14"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span>student1<span class="token punctuation">.</span>score<span class="token punctuation">)</span>  <span class="token comment"># 60</span></pre></td></tr><tr><td data-num="15"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span>student1<span class="token punctuation">.</span>age<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># 18</span></pre></td></tr><tr><td data-num="16"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span>student1<span class="token punctuation">.</span>test<span class="token punctuation">)</span>  <span class="token comment"># None</span></pre></td></tr></table></figure><blockquote><p>注意：只有在没有找到属性的情况下，才会调用 <code>__getattr__()</code> ，并且，当调用一个不存在的方法或属性时， <code>__getattr__()</code> 方法会默认返回为 None ，我们也可以做自定义处理，例如抛出自定义异常。</p></blockquote><p>实现一个动态路由链：</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">class</span> <span class="token class-name">Chain</span><span class="token punctuation">(</span><span class="token builtin">object</span><span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="2"></td><td><pre></pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> path<span class="token operator">=</span><span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="4"></td><td><pre>        self<span class="token punctuation">.</span>_path <span class="token operator">=</span> path</pre></td></tr><tr><td data-num="5"></td><td><pre></pre></td></tr><tr><td data-num="6"></td><td><pre>    <span class="token keyword">def</span> <span class="token function">__getattr__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> path<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="7"></td><td><pre>        <span class="token keyword">return</span> Chain<span class="token punctuation">(</span><span class="token string">'%s/%s'</span> <span class="token operator">%</span> <span class="token punctuation">(</span>self<span class="token punctuation">.</span>_path<span class="token punctuation">,</span> path<span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="8"></td><td><pre></pre></td></tr><tr><td data-num="9"></td><td><pre>    <span class="token keyword">def</span> <span class="token function">__call__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> path<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="10"></td><td><pre>       <span class="token keyword">return</span> Chain<span class="token punctuation">(</span><span class="token string">'%s/%s'</span> <span class="token operator">%</span> <span class="token punctuation">(</span>self<span class="token punctuation">.</span>_path<span class="token punctuation">,</span> path<span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="11"></td><td><pre></pre></td></tr><tr><td data-num="12"></td><td><pre>    <span class="token keyword">def</span> <span class="token function">__str__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="13"></td><td><pre>        <span class="token keyword">return</span> self<span class="token punctuation">.</span>_path</pre></td></tr><tr><td data-num="14"></td><td><pre></pre></td></tr><tr><td data-num="15"></td><td><pre>url <span class="token operator">=</span> Chain<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>user<span class="token punctuation">(</span><span class="token string">'zhang'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>status<span class="token punctuation">.</span>timeline<span class="token punctuation">.</span><span class="token builtin">list</span></pre></td></tr><tr><td data-num="16"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span>  <span class="token comment"># /user/zhang/status/timeline/list</span></pre></td></tr></table></figure><h5 id="_call_"><a class="anchor" href="#_call_">#</a> _<em>call</em>_</h5><p>在动态路由链的代码清单中，我们使用到了一个 <code>__call__()</code> 方法，这个方法可以直接在实例本身的基础上调用方法。</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">class</span> <span class="token class-name">Person</span><span class="token punctuation">(</span><span class="token builtin">object</span><span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> name<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="3"></td><td><pre>        self<span class="token punctuation">.</span>name <span class="token operator">=</span> name</pre></td></tr><tr><td data-num="4"></td><td><pre></pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token keyword">def</span> <span class="token function">__call__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> <span class="token builtin">str</span><span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="6"></td><td><pre>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Mr. %s is %s'</span> <span class="token operator">%</span> <span class="token punctuation">(</span>self<span class="token punctuation">.</span>name<span class="token punctuation">,</span> <span class="token builtin">str</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="7"></td><td><pre></pre></td></tr><tr><td data-num="8"></td><td><pre>Person<span class="token punctuation">(</span><span class="token string">'Zhang'</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token string">'working!'</span><span class="token punctuation">)</span>  <span class="token comment"># Mr. Zhang is working!</span></pre></td></tr><tr><td data-num="9"></td><td><pre>person1 <span class="token operator">=</span> Person<span class="token punctuation">(</span><span class="token string">'Wang'</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">callable</span><span class="token punctuation">(</span>person1<span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># True # 可以使用 callable () 函数判断是否是可调用对象</span></pre></td></tr><tr><td data-num="11"></td><td><pre>person1<span class="token punctuation">(</span><span class="token string">'studying!'</span><span class="token punctuation">)</span>  <span class="token comment"># Mr. Wang is studying!</span></pre></td></tr></table></figure><p>Python 的 class 允许定义许多定制方法，可以让我们非常方便地生成特定的类，还有很多可定制的方法，详情可参考<span class="exturl" data-url="aHR0cHM6Ly9kb2NzLnB5dGhvbi5vcmcvMy9yZWZlcmVuY2UvZGF0YW1vZGVsLmh0bWwjc3BlY2lhbC1tZXRob2QtbmFtZXM=">官方文档</span>。</p><h4 id="枚举类"><a class="anchor" href="#枚举类">#</a> 枚举类</h4><p>Python 枚举类的声明及使用方式如下：</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">from</span> enum <span class="token keyword">import</span> Enum</pre></td></tr><tr><td data-num="2"></td><td><pre></pre></td></tr><tr><td data-num="3"></td><td><pre>Month <span class="token operator">=</span> Enum<span class="token punctuation">(</span><span class="token string">'Month'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token string">'Jan'</span><span class="token punctuation">,</span> <span class="token string">'Feb'</span><span class="token punctuation">,</span> <span class="token string">'Mar'</span><span class="token punctuation">,</span> <span class="token string">'Apr'</span><span class="token punctuation">,</span> <span class="token string">'May'</span><span class="token punctuation">,</span> <span class="token string">'Jun'</span><span class="token punctuation">,</span> <span class="token string">'Jul'</span><span class="token punctuation">,</span> <span class="token string">'Aug'</span><span class="token punctuation">,</span> <span class="token string">'Sep'</span><span class="token punctuation">,</span> <span class="token string">'Oct'</span><span class="token punctuation">,</span> <span class="token string">'Nov'</span><span class="token punctuation">,</span> <span class="token string">'Dec'</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="4"></td><td><pre></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span>Month<span class="token punctuation">.</span>May<span class="token punctuation">)</span>  <span class="token comment"># Month.May</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span>Month<span class="token punctuation">.</span>May<span class="token punctuation">.</span>name<span class="token punctuation">)</span>  <span class="token comment"># May</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span>Month<span class="token punctuation">.</span>May<span class="token punctuation">.</span>value<span class="token punctuation">)</span>  <span class="token comment"># 5 # 默认从 1 开始计数</span></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token keyword">for</span> name<span class="token punctuation">,</span> member <span class="token keyword">in</span> Month<span class="token punctuation">.</span>__members__<span class="token punctuation">.</span>items<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="9"></td><td><pre>    <span class="token keyword">print</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> <span class="token string">'=>'</span><span class="token punctuation">,</span> member<span class="token punctuation">,</span> <span class="token string">','</span><span class="token punctuation">,</span> member<span class="token punctuation">.</span>value<span class="token punctuation">)</span></pre></td></tr></table></figure><p>如果需要更精确地控制枚举类型，可以从 <code>Enum</code> 派生出自定义类：</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">from</span> enum <span class="token keyword">import</span> Enum<span class="token punctuation">,</span> unique</pre></td></tr><tr><td data-num="2"></td><td><pre></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token decorator annotation punctuation">@unique</span>  <span class="token comment"># 用于检查重复</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token keyword">class</span> <span class="token class-name">Weekday</span><span class="token punctuation">(</span>Enum<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    Sun <span class="token operator">=</span> <span class="token number">0</span>  <span class="token comment"># 自定义值</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    Mon <span class="token operator">=</span> <span class="token number">1</span></pre></td></tr><tr><td data-num="7"></td><td><pre>    Tue <span class="token operator">=</span> <span class="token number">2</span></pre></td></tr><tr><td data-num="8"></td><td><pre>    Wed <span class="token operator">=</span> <span class="token number">3</span></pre></td></tr><tr><td data-num="9"></td><td><pre>    Thu <span class="token operator">=</span> <span class="token number">4</span></pre></td></tr><tr><td data-num="10"></td><td><pre>    Fri <span class="token operator">=</span> <span class="token number">5</span></pre></td></tr><tr><td data-num="11"></td><td><pre>    Sat <span class="token operator">=</span> <span class="token number">6</span></pre></td></tr><tr><td data-num="12"></td><td><pre></pre></td></tr><tr><td data-num="13"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span>Weekday<span class="token punctuation">.</span>Thu<span class="token punctuation">)</span>  <span class="token comment"># Weekday.Thu</span></pre></td></tr><tr><td data-num="14"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span>Weekday<span class="token punctuation">.</span>Thu<span class="token punctuation">.</span>name<span class="token punctuation">)</span>  <span class="token comment"># Thu</span></pre></td></tr><tr><td data-num="15"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span>Weekday<span class="token punctuation">.</span>Thu<span class="token punctuation">.</span>value<span class="token punctuation">)</span>  <span class="token comment"># 4</span></pre></td></tr><tr><td data-num="16"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span>Weekday<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># Weekday.Wed # 也可以通过 value 来获取对应的枚举</span></pre></td></tr><tr><td data-num="17"></td><td><pre><span class="token keyword">for</span> name<span class="token punctuation">,</span> member <span class="token keyword">in</span> Weekday<span class="token punctuation">.</span>__members__<span class="token punctuation">.</span>items<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="18"></td><td><pre>    <span class="token keyword">print</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> <span class="token string">'=>'</span><span class="token punctuation">,</span> member<span class="token punctuation">,</span> <span class="token string">','</span><span class="token punctuation">,</span> member<span class="token punctuation">.</span>value<span class="token punctuation">)</span></pre></td></tr></table></figure><h4 id="元类"><a class="anchor" href="#元类">#</a> 元类</h4><p>动态语言和静态语言最大的不同，就是函数和类的定义，不是编译时定义的，而是运行时动态创建的。</p><p>通过 <code>type()</code> 函数可以查看一个类型或变量的类型，同时， <code>type()</code> 函数既可以返回一个对象的类型，又可以创建出新的类型，而无需通过 <code>class Hello(object)...</code> 这样的方式定义。</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">def</span> <span class="token function">fn</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> name<span class="token operator">=</span><span class="token string">'world'</span><span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Hello, %s!'</span> <span class="token operator">%</span> name<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="3"></td><td><pre></pre></td></tr><tr><td data-num="4"></td><td><pre>Hello <span class="token operator">=</span> <span class="token builtin">type</span><span class="token punctuation">(</span><span class="token string">'Hello'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token builtin">object</span><span class="token punctuation">,</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token builtin">dict</span><span class="token punctuation">(</span>hello<span class="token operator">=</span>fn<span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="5"></td><td><pre>h <span class="token operator">=</span> Hello<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="6"></td><td><pre>h<span class="token punctuation">.</span>hello<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token comment"># Hello, world!</span></pre></td></tr></table></figure><p>通过 type 函数创建类需要接收三个参数：</p><ol><li>class 类名。</li><li>继承的父类集合。</li><li>class 的方法名称与函数绑定。</li></ol><p>通过 type 函数创建的类和直接创建的类没有任何区别，因为通过 class 定义的类在解释器执行时，实际上也是通过调用 type 函数来进行定义的。正常情况下，我们通过 class 来创建类即可，但 type 函数允许我们动态地将类创建出来。也就是说，动态语言本身支持运行期动态创建类。</p><p>除了使用 type 函数动态创建类以外，要控制类的创建行为，还可以使用 <code>metaclass</code> （元类），元类可以对类进行创建和修改等操作。</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment"># 定义一个元类</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">class</span> <span class="token class-name">ListMetaclass</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token keyword">def</span> <span class="token function">__new__</span><span class="token punctuation">(</span>cls<span class="token punctuation">,</span> name<span class="token punctuation">,</span> bases<span class="token punctuation">,</span> attrs<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="4"></td><td><pre>        attrs<span class="token punctuation">[</span><span class="token string">'add'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">lambda</span> self<span class="token punctuation">,</span> value<span class="token punctuation">:</span> self<span class="token punctuation">.</span>append<span class="token punctuation">(</span>value<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="5"></td><td><pre>        <span class="token keyword">return</span> <span class="token builtin">type</span><span class="token punctuation">.</span>__new__<span class="token punctuation">(</span>cls<span class="token punctuation">,</span> name<span class="token punctuation">,</span> bases<span class="token punctuation">,</span> attrs<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="6"></td><td><pre></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token comment"># 使用元类来创建类</span></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token keyword">class</span> <span class="token class-name">MyList</span><span class="token punctuation">(</span><span class="token builtin">list</span><span class="token punctuation">,</span> metaclass<span class="token operator">=</span>ListMetaclass<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="9"></td><td><pre>    <span class="token keyword">pass</span></pre></td></tr><tr><td data-num="10"></td><td><pre></pre></td></tr><tr><td data-num="11"></td><td><pre>l <span class="token operator">=</span> MyList<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="12"></td><td><pre>l<span class="token punctuation">.</span>add<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="13"></td><td><pre>l<span class="token punctuation">.</span>add<span class="token punctuation">(</span><span class="token number">9</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="14"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span>l<span class="token punctuation">)</span>  <span class="token comment"># [1, 9]</span></pre></td></tr></table></figure><p>通过这种方式创建类，当程序执行到 <code>metaclass=Xxx</code> 时，就会调用对应元类的 <code>__new__()</code> 方法来创建类，在该函数中，通过 <code>type.__new__()</code> 方法创建类，并依次传入以下参数：</p><ol><li>当前准备创建的类的对象。</li><li>类名。</li><li>所继承的父类集合。</li><li>类所有方法的集合。</li></ol><p>这种动态创建类的方式，一个较为常见的引用常见即是 ORM 框架。</p><p><span class="label danger">❗️TODO</span> 待完善</p><h3 id="错误-调试和测试"><a class="anchor" href="#错误-调试和测试">#</a> 错误、调试和测试</h3><h4 id="错误处理"><a class="anchor" href="#错误处理">#</a> 错误处理</h4><p>在程序运行的过程中，如果发生了错误，可以事先约定返回一个错误代码，这样，就可以知道是否有错，以及出错的原因。但是，返回错误码的方式常常容易与业务数据混合在一起，造成调用者必须用大量的代码来判断是否出错，因此，Python 也提供了一套错误处理机制。</p><p>异常捕获：</p><p>当我们认为某些代码可能出现异常时，我们可以通过 <code>try</code> 语句块来运行这段代码，如果出错，则不会继续，而是直接跳转错误代码处理，即 <code>except</code> 语句块中，执行完异常处理之后，如果有 <code>finally</code> 语句块，则执行该语句块。</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">try</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    a <span class="token operator">=</span> <span class="token number">1</span> <span class="token operator">/</span> <span class="token number">0</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token keyword">print</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span>  <span class="token comment"># 不会执行</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token keyword">except</span> ValueError <span class="token keyword">as</span> e<span class="token punctuation">:</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'ValueError:'</span><span class="token punctuation">,</span> e<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token keyword">except</span> ZeroDivisionError <span class="token keyword">as</span> e<span class="token punctuation">:</span>  <span class="token comment"># 错误也可以同时有多个类型</span></pre></td></tr><tr><td data-num="7"></td><td><pre>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'ZeroDivisionError:'</span><span class="token punctuation">,</span> e<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token keyword">else</span><span class="token punctuation">:</span>  <span class="token comment"># 指定未出现异常时的处理</span></pre></td></tr><tr><td data-num="9"></td><td><pre>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'No error!'</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token keyword">finally</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="11"></td><td><pre>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'finally'</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="12"></td><td><pre></pre></td></tr><tr><td data-num="13"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'end'</span><span class="token punctuation">)</span></pre></td></tr></table></figure><p>Python 的错误其实也是 class，所有的错误类型都继承自 <code>BaseException</code> ，所以在使用 <code>except</code> 时需要注意的是，它不但捕获该类型的错误，还把其子类也一并捕获，这时需要注意捕获的层级，先捕获层级较低的异常，后捕获层级较高的异常。</p><p>Python 所有的错误都是从 <code>BaseException</code> 类派生的，常见的错误类型和继承关系可以通过<span class="exturl" data-url="aHR0cHM6Ly9kb2NzLnB5dGhvbi5vcmcvMy9saWJyYXJ5L2V4Y2VwdGlvbnMuaHRtbCNleGNlcHRpb24taGllcmFyY2h5">官方文档</span>进行查看。</p><p>使用 <code>try...expect</code> 也可以跨越多层调用处理异常，而不需要在每一个调用层都重复进行异常处理：</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">def</span> <span class="token function">foo</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token keyword">return</span> <span class="token number">10</span> <span class="token operator">/</span> <span class="token builtin">int</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="3"></td><td><pre></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token keyword">def</span> <span class="token function">bar</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token keyword">return</span> foo<span class="token punctuation">(</span>s<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">2</span></pre></td></tr><tr><td data-num="6"></td><td><pre></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token keyword">def</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="8"></td><td><pre>    <span class="token keyword">try</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="9"></td><td><pre>        bar<span class="token punctuation">(</span><span class="token string">'0'</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="10"></td><td><pre>    <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span></pre></td></tr><tr><td data-num="11"></td><td><pre>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Error:'</span><span class="token punctuation">,</span> e<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="12"></td><td><pre>    <span class="token keyword">finally</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="13"></td><td><pre>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'finally...'</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="14"></td><td><pre></pre></td></tr><tr><td data-num="15"></td><td><pre>main<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr></table></figure><p>如果没有对错误进行处理，错误就会一直向上一级抛出，直到最后被 Python 解释器捕获并打印出错误信息，然后退出程序。</p><p>Python 内置的 <code>logging</code> 模块可以非常容易地记录错误信息：</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">import</span> logging</pre></td></tr><tr><td data-num="2"></td><td><pre></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">def</span> <span class="token function">foo</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token keyword">return</span> <span class="token number">10</span> <span class="token operator">/</span> <span class="token builtin">int</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="5"></td><td><pre></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token keyword">def</span> <span class="token function">bar</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="7"></td><td><pre>    <span class="token keyword">return</span> foo<span class="token punctuation">(</span>s<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">2</span></pre></td></tr><tr><td data-num="8"></td><td><pre></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token keyword">def</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="10"></td><td><pre>    <span class="token keyword">try</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="11"></td><td><pre>        bar<span class="token punctuation">(</span><span class="token string">'0'</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="12"></td><td><pre>    <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span></pre></td></tr><tr><td data-num="13"></td><td><pre>        logging<span class="token punctuation">.</span>exception<span class="token punctuation">(</span>e<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="14"></td><td><pre></pre></td></tr><tr><td data-num="15"></td><td><pre>main<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="16"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'END'</span><span class="token punctuation">)</span></pre></td></tr></table></figure><p>这样就可以在抛出异常之后，程序仍旧可以按照预期的方式执行，而不会因为某一个异常而导致整个程序无法运行。并且，通过配置， <code>logging</code> 还可以把错误记录到日志文件里，方便事后排查。</p><p>因为错误是 class，捕获一个错误就是捕获到该 class 的一个实例。因此，错误并不是凭空产生的，而是有意创建并抛出的。Python 的内置函数会抛出很多类型的错误，但是，我们也可以抛出一个自定义的错误类型。</p><p>如果要抛出错误，首先根据需要，可以定义一个错误的 class，选择好继承关系，然后，用 <code>raise</code> 语句抛出一个错误的实例：</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">class</span> <span class="token class-name">FooError</span><span class="token punctuation">(</span>ValueError<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token keyword">pass</span></pre></td></tr><tr><td data-num="3"></td><td><pre></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token keyword">def</span> <span class="token function">foo</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    n <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    <span class="token keyword">if</span> n<span class="token operator">==</span><span class="token number">0</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="7"></td><td><pre>        <span class="token keyword">raise</span> FooError<span class="token punctuation">(</span><span class="token string">'Invalid value: %s'</span> <span class="token operator">%</span> s<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="8"></td><td><pre>    <span class="token keyword">return</span> <span class="token number">10</span> <span class="token operator">/</span> n</pre></td></tr><tr><td data-num="9"></td><td><pre></pre></td></tr><tr><td data-num="10"></td><td><pre>foo<span class="token punctuation">(</span><span class="token string">'0'</span><span class="token punctuation">)</span></pre></td></tr></table></figure><p>在捕获异常时，我们也可以将异常捕获后继续抛出：</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">def</span> <span class="token function">foo</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    n <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token keyword">if</span> n<span class="token operator">==</span><span class="token number">0</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="4"></td><td><pre>        <span class="token keyword">raise</span> ValueError<span class="token punctuation">(</span><span class="token string">'invalid value: %s'</span> <span class="token operator">%</span> s<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token keyword">return</span> <span class="token number">10</span> <span class="token operator">/</span> n</pre></td></tr><tr><td data-num="6"></td><td><pre></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token keyword">def</span> <span class="token function">bar</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="8"></td><td><pre>    <span class="token keyword">try</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="9"></td><td><pre>        foo<span class="token punctuation">(</span><span class="token string">'0'</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="10"></td><td><pre>    <span class="token keyword">except</span> ValueError <span class="token keyword">as</span> e<span class="token punctuation">:</span></pre></td></tr><tr><td data-num="11"></td><td><pre>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'ValueError!'</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="12"></td><td><pre>        <span class="token keyword">raise</span>  <span class="token comment"># raise 语句如果不带任何参数，则会将错误原样抛出</span></pre></td></tr><tr><td data-num="13"></td><td><pre></pre></td></tr><tr><td data-num="14"></td><td><pre>bar<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr></table></figure><p>此外，还可以在捕获异常之后，将异常进行转换并再次抛出，但是，这种异常转换操作，应当考虑到逻辑的合理性。</p><h4 id="调试"><a class="anchor" href="#调试">#</a> 调试</h4><p>在编码或程序运行过程中，难免会出现很多错误，一个运行良好的程序，通常都需要经过一定的调试。在调试过程中，我们可以通过 <code>print()</code> 的方式将一些对象值输出到控制台查看，但这种方式并不推荐，因为对程序而言， <code>print()</code> 语句本身并无任何作用。因此，在通常的调试过程中，我们可以使用断言来辅助进行调试，凡是可以通过 print 来辅助查看的地方，都可以使用 assert 进行断言。</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">def</span> <span class="token function">foo</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    n <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token keyword">assert</span> n <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token string">'n is zero!'</span>  <span class="token comment"># AssertionError: n is zero!</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token keyword">return</span> <span class="token number">10</span> <span class="token operator">/</span> n</pre></td></tr><tr><td data-num="5"></td><td><pre></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token keyword">def</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="7"></td><td><pre>    foo<span class="token punctuation">(</span><span class="token string">'0'</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="8"></td><td><pre></pre></td></tr><tr><td data-num="9"></td><td><pre>main<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr></table></figure><p>当断言语句判断为 False 时，就会抛出一个 <code>AssertionError</code> 错误。</p><p>如果在 Python 交互环境中执行程序，可以指定是否开启断言调试，默认开启，也可以通过如下方式关闭：</p><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre>$ python -O err.py</pre></td></tr></table></figure><p>除了使用断言，我们也可以使用 <code>logging</code> 的方式来记录错误信息：</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">import</span> logging</pre></td></tr><tr><td data-num="2"></td><td><pre></pre></td></tr><tr><td data-num="3"></td><td><pre>logging<span class="token punctuation">.</span>basicConfig<span class="token punctuation">(</span>level<span class="token operator">=</span>logging<span class="token punctuation">.</span>INFO<span class="token punctuation">)</span>  <span class="token comment"># 指定日志级别</span></pre></td></tr><tr><td data-num="4"></td><td><pre></pre></td></tr><tr><td data-num="5"></td><td><pre>s <span class="token operator">=</span> <span class="token string">'0'</span></pre></td></tr><tr><td data-num="6"></td><td><pre>n <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="7"></td><td><pre>logging<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token string">'n = %d'</span> <span class="token operator">%</span> n<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token number">10</span> <span class="token operator">/</span> n<span class="token punctuation">)</span></pre></td></tr></table></figure><p><code>logging</code> 允许指定记录信息的级别，主要有 <code>debug</code> ， <code>info</code> ， <code>warning</code> ， <code>error</code> 等几个级别。</p><p>Python 日志级别：</p><table><thead><tr><th>级别</th><th>日志函数</th><th>描述</th></tr></thead><tbody><tr><td>DEBUG</td><td>logging.debug()</td><td>最低级别，追踪问题时使用。</td></tr><tr><td>INFO</td><td><span class="exturl" data-url="aHR0cDovL2xvZ2dpbmcuaW5mbw==">logging.info</span>()</td><td>记录程序中一般事件的信息，或确认一切工作正常。</td></tr><tr><td>WARNING</td><td>logging.warning()</td><td>记录信息，用于警告。</td></tr><tr><td>ERROR</td><td>logging.error()</td><td>用于记录程序报错信息。</td></tr><tr><td>CRITICAL</td><td>logging.critical()</td><td>最高级别，记录可能导致程序崩溃的错误。</td></tr></tbody></table><p>另外，还可以使用 Python 的 <code>pdb</code> 调试器，让程序以单步方式运行，可以随时查看运行状态。</p><p><span class="label danger">❗️TODO</span> 待完善</p><p>但一些功能较为强大的 IDE 工具，一般都包含有十分便捷的调试工具，使用这些 IDE 提供的调试工具，通常是最方便的。</p><h4 id="单元测试"><a class="anchor" href="#单元测试">#</a> 单元测试</h4><p>单元测试是用来对一个模块、一个函数或者一个类来进行正确性检验的测试工作。</p><p>为了编写单元测试，我们需要引入 Python 自带的 <code>unittest</code> 模块，编写单元测试时使用的测试类，通常都是从 <code>unittest.TestCase</code> 继承而来，类中的方法以 <code>test</code> 开头，就标识为测试方法，反之，不以 <code>test</code> 开头的方法就不会被标识为测试方法，测试的时候也就不会被执行。</p><p>对每一类测试都需要编写一个 <code>test_xxx()</code> 方法。由于 <code>unittest.TestCase</code> 提供了很多内置的条件判断，我们只需要调用这些方法就可以断言输出是否是我们所期望的。最常用的断言就是 <code>assertEqual()</code> ：</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre>self<span class="token punctuation">.</span>assertEqual<span class="token punctuation">(</span><span class="token builtin">abs</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>  <span class="token comment"># 断言返回结果与预期结果是否相等</span></pre></td></tr><tr><td data-num="2"></td><td><pre></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">with</span> self<span class="token punctuation">.</span>assertRaises<span class="token punctuation">(</span>KeyError<span class="token punctuation">)</span><span class="token punctuation">:</span>  <span class="token comment"># 断言抛出预期类型的 Error</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    value <span class="token operator">=</span> d<span class="token punctuation">[</span><span class="token string">'empty'</span><span class="token punctuation">]</span></pre></td></tr><tr><td data-num="5"></td><td><pre></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token keyword">with</span> self<span class="token punctuation">.</span>assertRaises<span class="token punctuation">(</span>AttributeError<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="7"></td><td><pre>    value <span class="token operator">=</span> d<span class="token punctuation">.</span>empty</pre></td></tr></table></figure><p>要运行一个单元测试，只需要在当前 <code>.py</code> 文件末尾加上如下代码即可：</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    unittest<span class="token punctuation">.</span>main<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr></table></figure><p>这样就可以将测试代码当做正常的 Python 脚本执行。</p><p>但如果在 Python 交互环境中，我们也可以加入参数 <code>-m unittest</code> 来运行单元测试：</p><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre>$ python -m unittest main</pre></td></tr></table></figure><p>如果要对每个单元测试方法的调用时机进行监控，可以使用 <code>setUp()</code> 和 <code>tearDown()</code> 这两个特殊的方法来实现。这两个方法会分别在每一个测试方法调用前后执行。</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">def</span> <span class="token function">setUp</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'test start...'</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="3"></td><td><pre></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token keyword">def</span> <span class="token function">tearDown</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'test end...'</span><span class="token punctuation">)</span></pre></td></tr></table></figure><h4 id="文档测试"><a class="anchor" href="#文档测试">#</a> 文档测试</h4><p>Python 内置的文档测试（doctest）模块可以直接提取注释中的代码并执行测试。</p><p><span class="label danger">❗️TODO</span> 待完善</p><h3 id="io编程"><a class="anchor" href="#io编程">#</a> IO 编程</h3><p>IO 在计算机中通常是指 Input/Output，也就是输入和输出。</p><p>在 IO 编程中，Stream（流）是一个很重要的概念。</p><p>操作 IO 的能力都是由操作系统提供的，每一种编程语言都会把操作系统提供的低级 C 接口封装起来方便使用，Python 也不例外。</p><blockquote><p>一般来说，异步 IO 的复杂度远远高于同步 IO。</p></blockquote><h4 id="文件的读写"><a class="anchor" href="#文件的读写">#</a> 文件的读写</h4><p>读写文件是最常见的 IO 操作。Python 内置了读写文件的函数，用法和 C 是兼容的。</p><p>在磁盘上读写文件的功能其实都是由操作系统提供的，现代操作系统不允许普通的程序直接操作磁盘，所以，读写文件就是请求操作系统打开一个文件对象（通常称为文件描述符），然后，通过操作系统提供的接口从这个文件对象中读取数据（读文件），或者把数据写入这个文件对象（写文件）。</p><p>要以读文件的模式打开一个文件对象，需要使用 Python 内置的 <code>open()</code> 函数，并传入文件名和标示符：</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre>f <span class="token operator">=</span> <span class="token boolean">None</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">try</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    f <span class="token operator">=</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'C:\\Users\\Administrator\\Desktop\\test.txt'</span><span class="token punctuation">,</span> <span class="token string">'r'</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token keyword">print</span><span class="token punctuation">(</span>f<span class="token punctuation">.</span><span class="token builtin">buffer</span><span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token keyword">except</span> FileNotFoundError <span class="token keyword">as</span> e<span class="token punctuation">:</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    <span class="token keyword">print</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token keyword">finally</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="8"></td><td><pre>    f<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr></table></figure><p>其中，参数 <code>r</code> 表示这是一个读操作，如果文件不存在，就会抛出一个 <code>IOError</code> 错误，并告知文件不存在；调用 <code>read()</code> 方法可以读取文件中的内容，并返回字符串；而当文件读取完毕后，需要调用 <code>close()</code> 方法关闭文件。</p><blockquote><p>文件使用完后必须关闭，因为文件对象会占用操作系统的资源，并且操作系统同一时间可打开的文件数量是有限的， <code>close()</code> 方法应当放在 finally 语句块中，保证其一定会执行。</p></blockquote><p>我们可以在 finally 语句块中关闭文件，但有时候会显得比较麻烦，Python 为此也引入了一个 <code>with</code> 语句来帮助自动调用关闭文件的方法。</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'C:\\Users\\Administrator\\Desktop\\test.txt'</span><span class="token punctuation">,</span> <span class="token string">'r'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    buf <span class="token operator">=</span> f<span class="token punctuation">.</span><span class="token builtin">buffer</span><span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token keyword">print</span><span class="token punctuation">(</span>buf<span class="token punctuation">)</span></pre></td></tr></table></figure><p>由于 read 方法默认会读取文件的全部内容，但如果文件本身较大，则应当通过 <code>read(size)</code> 来限定读取文件的大小，如果需要逐行读取，可以使用 <code>readlines()</code> 方法，这个方法的返回值时一个字符串数组。</p><p>如果需要读取一个二进制文件，比如图片、视频等，打开文件时就需要指定参数为 <code>rb</code> 。</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment"># 打开图片文件</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'C:\\Users\\Administrator\\Desktop\\img\\avatar.jpg'</span><span class="token punctuation">,</span> <span class="token string">'rb'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    buf <span class="token operator">=</span> f<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token keyword">print</span><span class="token punctuation">(</span>buf<span class="token punctuation">)</span>  <span class="token comment"># 输出十六进制的字节</span></pre></td></tr></table></figure><p>如果读取时候的编码不对，就很有可能会导致乱码，因此，在打开文件时也可以指定读取文件所使用的编码。</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'C:\\Users\\Administrator\\Desktop\\test.txt'</span><span class="token punctuation">,</span> <span class="token string">'r'</span><span class="token punctuation">,</span> encoding<span class="token operator">=</span><span class="token string">'utf-8'</span><span class="token punctuation">,</span> errors<span class="token operator">=</span><span class="token string">'ignore'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    buf <span class="token operator">=</span> f<span class="token punctuation">.</span><span class="token builtin">buffer</span><span class="token punctuation">.</span>readlines<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token keyword">print</span><span class="token punctuation">(</span>buf<span class="token punctuation">)</span></pre></td></tr></table></figure><p>同时，当读取文件中出现非法编码内容，可以通过指定 <code>errors</code> 参数进行处理。</p><p>写文件与读文件基本一样，只是在打开文件时指定参数为 <code>w</code> 或 <code>wb</code> 即可：</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'C:\\Users\\Administrator\\Desktop\\test.txt'</span><span class="token punctuation">,</span> <span class="token string">'w'</span><span class="token punctuation">,</span> encoding<span class="token operator">=</span><span class="token string">'gbk'</span><span class="token punctuation">,</span> errors<span class="token operator">=</span><span class="token string">'ignore'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    f<span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token string">'How are you?'</span><span class="token punctuation">)</span></pre></td></tr></table></figure><blockquote><p>可以反复调用 <code>write()</code> 来写入文件，但是写入完毕后务必要关闭文件。当我们写文件时，操作系统往往不会立刻把数据写入磁盘，而是放到内存缓存起来，空闲的时候再慢慢写入。只有调用关闭方法时，操作系统才保证把没有写入的数据全部写入磁盘。忘记调用关闭方法的后果是数据可能只写了一部分到磁盘，剩下的丢失了。所以，在读写文件时最后都使用 <code>with</code> 语句。</p></blockquote><p>使用 <code>a</code> 参数，可以设置为追加模式，在原文件内容的基础上，追加新的内容。</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'C:\\Users\\Administrator\\Desktop\\test.txt'</span><span class="token punctuation">,</span> <span class="token string">'a'</span><span class="token punctuation">,</span> encoding<span class="token operator">=</span><span class="token string">'gbk'</span><span class="token punctuation">,</span> errors<span class="token operator">=</span><span class="token string">'ignore'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    f<span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token string">'\rI\'m fine, thank you!'</span><span class="token punctuation">)</span></pre></td></tr></table></figure><h4 id="stringio-与-bytesio"><a class="anchor" href="#stringio-与-bytesio">#</a> StringIO 与 BytesIO</h4><p>很多会后数据读写并不一定是操作文件，也有可能是在内存中进行读写， <code>StringIO</code> 就是用来读写内存中的字符串。</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">from</span> io <span class="token keyword">import</span> StringIO</pre></td></tr><tr><td data-num="2"></td><td><pre></pre></td></tr><tr><td data-num="3"></td><td><pre>f1 <span class="token operator">=</span> StringIO<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="4"></td><td><pre>f1<span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token string">'Hello'</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="5"></td><td><pre>f1<span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token string">' '</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="6"></td><td><pre>f1<span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token string">'Mike!'</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span>f1<span class="token punctuation">.</span>getvalue<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># Hello Mike! # 获取写入后的字符串内容</span></pre></td></tr><tr><td data-num="8"></td><td><pre></pre></td></tr><tr><td data-num="9"></td><td><pre>f2 <span class="token operator">=</span> StringIO<span class="token punctuation">(</span><span class="token string">'Hello Jack!\nHow are you?\nI\'m fine, thanks!'</span><span class="token punctuation">)</span>  <span class="token comment"># 也可以使用字符串初始化 StringIO</span></pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="11"></td><td><pre>    s <span class="token operator">=</span> f2<span class="token punctuation">.</span>readline<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="12"></td><td><pre>    <span class="token keyword">if</span> s <span class="token operator">==</span> <span class="token string">''</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="13"></td><td><pre>        <span class="token keyword">break</span></pre></td></tr><tr><td data-num="14"></td><td><pre>    <span class="token keyword">print</span><span class="token punctuation">(</span>s<span class="token punctuation">.</span>strip<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr></table></figure><p>同理，我们也可以使用 <code>BytesIO</code> 来操作内存中的字节数组。</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">from</span> io <span class="token keyword">import</span> BytesIO</pre></td></tr><tr><td data-num="2"></td><td><pre></pre></td></tr><tr><td data-num="3"></td><td><pre>f1 <span class="token operator">=</span> BytesIO<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="4"></td><td><pre>f1<span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token string">'中文'</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># 写入 bytes</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span>f1<span class="token punctuation">.</span>getvalue<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># b'\xe4\xb8\xad\xe6\x96\x87'</span></pre></td></tr><tr><td data-num="6"></td><td><pre></pre></td></tr><tr><td data-num="7"></td><td><pre>f2 <span class="token operator">=</span> BytesIO<span class="token punctuation">(</span><span class="token string">b'\xe4\xb8\xad\xe6\x96\x87'</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span>f2<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr></table></figure><h4 id="操作文件和目录"><a class="anchor" href="#操作文件和目录">#</a> 操作文件和目录</h4><p>使用 Python 提供的 <code>os</code> 模块，可以操作系统的文件和目录。</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">import</span> os</pre></td></tr><tr><td data-num="2"></td><td><pre></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span>os<span class="token punctuation">.</span>name<span class="token punctuation">)</span>  <span class="token comment"># nt 则表示 windows，posix 则表示 Linux，Unix 或 Mac Os X</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span>os<span class="token punctuation">.</span>uname<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># 获取更加详细的操作系统信息（不支持 windows）</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span>os<span class="token punctuation">.</span>environ<span class="token punctuation">)</span>  <span class="token comment"># 查看操作系统中定义的环境变量</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span>os<span class="token punctuation">.</span>environ<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'JAVA_HOME'</span><span class="token punctuation">,</span> <span class="token string">'Invalid key!'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># 获取某个具体的环境变量</span></pre></td></tr></table></figure><p>操作文件和目录的函数一部分放在 <code>os</code> 模块中，一部分放在 <code>os.path</code> 模块中。</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">import</span> os</pre></td></tr><tr><td data-num="2"></td><td><pre></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span>os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>abspath<span class="token punctuation">(</span><span class="token string">'.'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># 查看当前文件的绝对路径</span></pre></td></tr><tr><td data-num="4"></td><td><pre>path <span class="token operator">=</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span><span class="token string">'A:\\python'</span><span class="token punctuation">,</span> <span class="token string">'workspace'</span><span class="token punctuation">)</span>  <span class="token comment"># 目录路径</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span>path<span class="token punctuation">)</span>  <span class="token comment"># A:\python\workspace</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span>os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>split<span class="token punctuation">(</span>path<span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># ('A:\\', 'python')</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span>os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">'/usr/chinmoku/test/file.txt'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># ('/usr/chinmoku/test', 'file.txt')</span></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span>os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>splitext<span class="token punctuation">(</span><span class="token string">'/usr/chinmoku/test/file.txt'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># ('/usr/chinmoku/test/file', '.txt') # 可以直接得到文件的扩展名</span></pre></td></tr><tr><td data-num="9"></td><td><pre>os<span class="token punctuation">.</span>mkdir<span class="token punctuation">(</span>path<span class="token punctuation">)</span>  <span class="token comment"># 在指定位置创建目录</span></pre></td></tr><tr><td data-num="10"></td><td><pre>os<span class="token punctuation">.</span>rmdir<span class="token punctuation">(</span>path<span class="token punctuation">)</span>  <span class="token comment"># 删除指定位置的目录</span></pre></td></tr></table></figure><blockquote><p>把两个路径合成一个时，不要直接拼字符串，而要通过 <code>os.path.join()</code> 函数，这样可以正确处理不同操作系统的路径分隔符。同理，拆分路径时，也应当通过 <code>os.path.split()</code> 函数进行拆分。</p></blockquote><p>另外还有一些其他常用的文件操作：</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">import</span> os</pre></td></tr><tr><td data-num="2"></td><td><pre></pre></td></tr><tr><td data-num="3"></td><td><pre>os<span class="token punctuation">.</span>rename<span class="token punctuation">(</span><span class="token string">'test.txt'</span><span class="token punctuation">,</span> <span class="token string">'test.py'</span><span class="token punctuation">)</span>  <span class="token comment"># 文件重命名</span></pre></td></tr><tr><td data-num="4"></td><td><pre>os<span class="token punctuation">.</span>remove<span class="token punctuation">(</span><span class="token string">'test.py'</span><span class="token punctuation">)</span>  <span class="token comment"># 删除文件</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token punctuation">[</span>x <span class="token keyword">for</span> x <span class="token keyword">in</span> os<span class="token punctuation">.</span>listdir<span class="token punctuation">(</span><span class="token string">'.'</span><span class="token punctuation">)</span> <span class="token keyword">if</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>isdir<span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span>  <span class="token comment"># 过滤文件，列出当前目录下的所有目录</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token punctuation">[</span>x <span class="token keyword">for</span> x <span class="token keyword">in</span> os<span class="token punctuation">.</span>listdir<span class="token punctuation">(</span><span class="token string">'.'</span><span class="token punctuation">)</span> <span class="token keyword">if</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>isfile<span class="token punctuation">(</span>x<span class="token punctuation">)</span> <span class="token keyword">and</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>splitext<span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">==</span><span class="token string">'.py'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>  <span class="token comment"># 列出当前目录下的所有 .py 文件</span></pre></td></tr></table></figure><h4 id="序列化"><a class="anchor" href="#序列化">#</a> 序列化</h4><p>在程序运行的过程中，所有的变量都是在内存中，可以随时修改，但是一旦程序结束，变量所占用的内存就被操作系统全部回收。如果在此期间没有将修改后的值存储到磁盘上，下次重新运行程序，变量又会被重新初始化。我们把变量从内存中变成可存储或传输的过程称之为序列化，在 Python 中叫 <code>pickling</code> ，在其他语言中也被称之为 serialization，marshalling，flattening 等等。</p><p>序列化之后，就可以把序列化后的内容写入磁盘，或者通过网络传输到别的机器上。反过来，把变量内容从序列化的对象重新读到内存里称之为反序列化，即 <code>unpickling</code> 。Python 提供了 <code>pickle</code> 模块来实现序列化。</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">import</span> pickle</pre></td></tr><tr><td data-num="2"></td><td><pre></pre></td></tr><tr><td data-num="3"></td><td><pre>d <span class="token operator">=</span> <span class="token builtin">dict</span><span class="token punctuation">(</span>name<span class="token operator">=</span><span class="token string">'Bob'</span><span class="token punctuation">,</span> age<span class="token operator">=</span><span class="token number">20</span><span class="token punctuation">,</span> score<span class="token operator">=</span><span class="token number">88</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="4"></td><td><pre>buf <span class="token operator">=</span> pickle<span class="token punctuation">.</span>dumps<span class="token punctuation">(</span>d<span class="token punctuation">)</span>  <span class="token comment"># 将任意对象转换为 bytes</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span>buf<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="6"></td><td><pre></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'C:\\Users\\Administrator\\Desktop\\test.txt'</span><span class="token punctuation">,</span> <span class="token string">'wb'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span></pre></td></tr><tr><td data-num="8"></td><td><pre>    <span class="token comment"># f.write (buf) # 向文件写入 bytes</span></pre></td></tr><tr><td data-num="9"></td><td><pre>    pickle<span class="token punctuation">.</span>dump<span class="token punctuation">(</span>d<span class="token punctuation">,</span> f<span class="token punctuation">)</span>  <span class="token comment"># 序列化并写入文件</span></pre></td></tr></table></figure><p>读取被序列化的文件：</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">import</span> pickle</pre></td></tr><tr><td data-num="2"></td><td><pre></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'C:\\Users\\Administrator\\Desktop\\test.txt'</span><span class="token punctuation">,</span> <span class="token string">'rb'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    res <span class="token operator">=</span> pickle<span class="token punctuation">.</span>load<span class="token punctuation">(</span>f<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token keyword">print</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span>  <span class="token comment"># &#123;'name': 'Bob', 'age': 20, 'score': 88&#125;</span></pre></td></tr></table></figure><p>Python 也提供了对 JSON 数据格式的支持，我们可以很容易地将一个 Python 对象转换为 JSON 对象。</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">import</span> json</pre></td></tr><tr><td data-num="2"></td><td><pre></pre></td></tr><tr><td data-num="3"></td><td><pre>d <span class="token operator">=</span> <span class="token builtin">dict</span><span class="token punctuation">(</span>name<span class="token operator">=</span><span class="token string">'Bob'</span><span class="token punctuation">,</span> age<span class="token operator">=</span><span class="token number">20</span><span class="token punctuation">,</span> score<span class="token operator">=</span><span class="token number">88</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="4"></td><td><pre>s <span class="token operator">=</span> json<span class="token punctuation">.</span>dumps<span class="token punctuation">(</span>d<span class="token punctuation">)</span>  <span class="token comment"># 将 Python 类型序列化为 JSON 字符串</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span>  <span class="token comment"># &#123;"name": "Bob", "age": 20, "score": 88&#125;</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">isinstance</span><span class="token punctuation">(</span>s<span class="token punctuation">,</span> <span class="token builtin">dict</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># False</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">isinstance</span><span class="token punctuation">(</span>s<span class="token punctuation">,</span> <span class="token builtin">str</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># True</span></pre></td></tr></table></figure><p>同样，我们也可以将 JSON 字符串反序列化为 Python 对象。</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">import</span> json</pre></td></tr><tr><td data-num="2"></td><td><pre></pre></td></tr><tr><td data-num="3"></td><td><pre>obj <span class="token operator">=</span> json<span class="token punctuation">.</span>loads<span class="token punctuation">(</span><span class="token string">'&#123;"name": "Bob", "age": 20, "score": 88&#125;'</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">isinstance</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span> <span class="token builtin">str</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># False</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">isinstance</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span> <span class="token builtin">dict</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># True</span></pre></td></tr></table></figure><p>但对于一个 Python 类进行序列化操作则有所不同：</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">import</span> json</pre></td></tr><tr><td data-num="2"></td><td><pre></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">class</span> <span class="token class-name">Student</span><span class="token punctuation">(</span><span class="token builtin">object</span><span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> name<span class="token punctuation">,</span> age<span class="token punctuation">,</span> score<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="5"></td><td><pre>        self<span class="token punctuation">.</span>name <span class="token operator">=</span> name</pre></td></tr><tr><td data-num="6"></td><td><pre>        self<span class="token punctuation">.</span>age <span class="token operator">=</span> age</pre></td></tr><tr><td data-num="7"></td><td><pre>        self<span class="token punctuation">.</span>score <span class="token operator">=</span> score</pre></td></tr><tr><td data-num="8"></td><td><pre></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token keyword">def</span> <span class="token function">student2dict</span><span class="token punctuation">(</span>std<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="10"></td><td><pre>    <span class="token keyword">return</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="11"></td><td><pre>        <span class="token string">'name'</span><span class="token punctuation">:</span> std<span class="token punctuation">.</span>name<span class="token punctuation">,</span></pre></td></tr><tr><td data-num="12"></td><td><pre>        <span class="token string">'age'</span><span class="token punctuation">:</span> std<span class="token punctuation">.</span>age<span class="token punctuation">,</span></pre></td></tr><tr><td data-num="13"></td><td><pre>        <span class="token string">'score'</span><span class="token punctuation">:</span> std<span class="token punctuation">.</span>score</pre></td></tr><tr><td data-num="14"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="15"></td><td><pre></pre></td></tr><tr><td data-num="16"></td><td><pre>s <span class="token operator">=</span> Student<span class="token punctuation">(</span><span class="token string">'Bob'</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">,</span> <span class="token number">88</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="17"></td><td><pre><span class="token comment"># print(json.dumps(s))  # TypeError: Object of type Student is not JSON serializable</span></pre></td></tr><tr><td data-num="18"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span>json<span class="token punctuation">.</span>dumps<span class="token punctuation">(</span>s<span class="token punctuation">,</span> default<span class="token operator">=</span>student2dict<span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># &#123;"name": "Bob", "age": 20, "score": 88&#125;</span></pre></td></tr><tr><td data-num="19"></td><td><pre></pre></td></tr><tr><td data-num="20"></td><td><pre><span class="token comment"># 方法二：通常类的实例都有一个 __dict__ 属性，可以将实例转换为 dict，用来存储实例变量</span></pre></td></tr><tr><td data-num="21"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span>json<span class="token punctuation">.</span>dumps<span class="token punctuation">(</span>s<span class="token punctuation">,</span> default<span class="token operator">=</span><span class="token keyword">lambda</span> obj<span class="token punctuation">:</span> obj<span class="token punctuation">.</span>__dict__<span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># &#123;"name": "Bob", "age": 20, "score": 88&#125;</span></pre></td></tr></table></figure><blockquote><p>并不是所有类的实例都有 <code>__dict__</code> 属性，也有少数例外，例如定义了 <code>__slots__</code> 的类。</p></blockquote><p>将 JSON 字符串反序列化为 Python 类：</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">import</span> json</pre></td></tr><tr><td data-num="2"></td><td><pre></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">class</span> <span class="token class-name">Student</span><span class="token punctuation">(</span><span class="token builtin">object</span><span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> name<span class="token punctuation">,</span> age<span class="token punctuation">,</span> score<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="5"></td><td><pre>        self<span class="token punctuation">.</span>name <span class="token operator">=</span> name</pre></td></tr><tr><td data-num="6"></td><td><pre>        self<span class="token punctuation">.</span>age <span class="token operator">=</span> age</pre></td></tr><tr><td data-num="7"></td><td><pre>        self<span class="token punctuation">.</span>score <span class="token operator">=</span> score</pre></td></tr><tr><td data-num="8"></td><td><pre></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token keyword">def</span> <span class="token function">dict2student</span><span class="token punctuation">(</span>d<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="10"></td><td><pre>    <span class="token keyword">return</span> Student<span class="token punctuation">(</span>d<span class="token punctuation">[</span><span class="token string">'name'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> d<span class="token punctuation">[</span><span class="token string">'age'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> d<span class="token punctuation">[</span><span class="token string">'score'</span><span class="token punctuation">]</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="11"></td><td><pre></pre></td></tr><tr><td data-num="12"></td><td><pre>json_str <span class="token operator">=</span> <span class="token string">'&#123;"name": "Bob", "age": 20, "score": 88&#125;'</span></pre></td></tr><tr><td data-num="13"></td><td><pre>stu <span class="token operator">=</span> json<span class="token punctuation">.</span>loads<span class="token punctuation">(</span>json_str<span class="token punctuation">,</span> object_hook<span class="token operator">=</span>dict2student<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="14"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">isinstance</span><span class="token punctuation">(</span>stu<span class="token punctuation">,</span> <span class="token builtin">str</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># False</span></pre></td></tr><tr><td data-num="15"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">isinstance</span><span class="token punctuation">(</span>stu<span class="token punctuation">,</span> Student<span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># True</span></pre></td></tr></table></figure><h3 id="进程和线程"><a class="anchor" href="#进程和线程">#</a> 进程和线程</h3><h4 id="多进程"><a class="anchor" href="#多进程">#</a> 多进程</h4><p>Unix/Linux 操作系统提供了一个 <code>fork()</code> 系统调用，它非常特殊。普通的函数调用，调用一次，返回一次，但是 <code>fork()</code> 调用一次，返回两次，因为操作系统自动把当前进程（称为父进程）复制了一份（称为子进程），然后，分别在父进程和子进程内返回。</p><p>子进程永远返回 0，而父进程返回子进程的 ID。这样做的理由是，一个父进程可以 fork 出很多子进程，所以，父进程要记下每个子进程的 ID，而子进程只需要调用 <code>getppid()</code> 就可以拿到父进程的 ID。</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">import</span> os</pre></td></tr><tr><td data-num="2"></td><td><pre></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Process (%s) start...'</span> <span class="token operator">%</span> os<span class="token punctuation">.</span>getpid<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="4"></td><td><pre></pre></td></tr><tr><td data-num="5"></td><td><pre>pid <span class="token operator">=</span> os<span class="token punctuation">.</span>fork<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment"># Only works on Unix/Linux/Mac</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token keyword">if</span> pid <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="7"></td><td><pre>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'I am child process (%s) and my parent is %s.'</span> <span class="token operator">%</span> <span class="token punctuation">(</span>os<span class="token punctuation">.</span>getpid<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> os<span class="token punctuation">.</span>getppid<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token keyword">else</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="9"></td><td><pre>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'I (%s) just created a child process (%s).'</span> <span class="token operator">%</span> <span class="token punctuation">(</span>os<span class="token punctuation">.</span>getpid<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> pid<span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="10"></td><td><pre></pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token comment"># Process (876) start...</span></pre></td></tr><tr><td data-num="12"></td><td><pre><span class="token comment"># I (876) just created a child process (877).</span></pre></td></tr><tr><td data-num="13"></td><td><pre><span class="token comment"># I am child process (877) and my parent is 876.</span></pre></td></tr></table></figure><p>Python 在 Windows 环境中是无法调用 fork 函数的，但是这并不意味着 Python 无法在 Windows 环境下编写多进程服务，因为它提供了一个跨平台版本的多进程模块 <code>multiprocessing</code> ，这个模块提供了一个 <code>Process</code> 类来代表一个进程对象。</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">from</span> multiprocessing <span class="token keyword">import</span> Process</pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">import</span> os</pre></td></tr><tr><td data-num="3"></td><td><pre></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token comment"># 子进程要执行的代码</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token keyword">def</span> <span class="token function">run_proc</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Run child process %s (%s)...'</span> <span class="token operator">%</span> <span class="token punctuation">(</span>name<span class="token punctuation">,</span> os<span class="token punctuation">.</span>getpid<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="7"></td><td><pre></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="9"></td><td><pre>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Parent process %s.'</span> <span class="token operator">%</span> os<span class="token punctuation">.</span>getpid<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="10"></td><td><pre>    p <span class="token operator">=</span> Process<span class="token punctuation">(</span>target<span class="token operator">=</span>run_proc<span class="token punctuation">,</span> args<span class="token operator">=</span><span class="token punctuation">(</span><span class="token string">'test'</span><span class="token punctuation">,</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="11"></td><td><pre>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Child process will start.'</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="12"></td><td><pre>    p<span class="token punctuation">.</span>start<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="13"></td><td><pre>    p<span class="token punctuation">.</span>join<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment"># join () 方法可以等待子进程结束后再继续往下运行，通常用于进程间的同步。</span></pre></td></tr><tr><td data-num="14"></td><td><pre>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Child process end.'</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="15"></td><td><pre></pre></td></tr><tr><td data-num="16"></td><td><pre><span class="token comment"># Parent process 11284.</span></pre></td></tr><tr><td data-num="17"></td><td><pre><span class="token comment"># Child process will start.</span></pre></td></tr><tr><td data-num="18"></td><td><pre><span class="token comment"># Run child process test (6740)...</span></pre></td></tr><tr><td data-num="19"></td><td><pre><span class="token comment"># Child process end.</span></pre></td></tr></table></figure><p>创建子进程时，只需要传入一个执行函数和函数的参数，并创建一个 <code>Process</code> 实例，用 <code>start()</code> 方法启动即可。</p><p>但如果要启动大量的子进程，可以用进程池的方式批量创建子进程：</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">from</span> multiprocessing <span class="token keyword">import</span> Pool</pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">import</span> os<span class="token punctuation">,</span> time<span class="token punctuation">,</span> random</pre></td></tr><tr><td data-num="3"></td><td><pre></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token keyword">def</span> <span class="token function">long_time_task</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Run task-%s (%s)...'</span> <span class="token operator">%</span> <span class="token punctuation">(</span>name<span class="token punctuation">,</span> os<span class="token punctuation">.</span>getpid<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    start <span class="token operator">=</span> time<span class="token punctuation">.</span>time<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="7"></td><td><pre>    time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span>random<span class="token punctuation">.</span>random<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">3</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="8"></td><td><pre>    end <span class="token operator">=</span> time<span class="token punctuation">.</span>time<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="9"></td><td><pre>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Task-%s runs %0.2f seconds.'</span> <span class="token operator">%</span> <span class="token punctuation">(</span>name<span class="token punctuation">,</span> <span class="token punctuation">(</span>end <span class="token operator">-</span> start<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="10"></td><td><pre></pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="12"></td><td><pre>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Parent process %s.'</span> <span class="token operator">%</span> os<span class="token punctuation">.</span>getpid<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="13"></td><td><pre>    p <span class="token operator">=</span> Pool<span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span>  <span class="token comment"># 创建进程池并指定大小</span></pre></td></tr><tr><td data-num="14"></td><td><pre>    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="15"></td><td><pre>        p<span class="token punctuation">.</span>apply_async<span class="token punctuation">(</span>long_time_task<span class="token punctuation">,</span> args<span class="token operator">=</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="16"></td><td><pre>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Waiting for all subprocesses done...'</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="17"></td><td><pre>    p<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment"># 调用 join () 之前必须先调用 close ()，调用 close () 之后就不能继续添加新的 Process 了。</span></pre></td></tr><tr><td data-num="18"></td><td><pre>    p<span class="token punctuation">.</span>join<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="19"></td><td><pre>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'All subprocesses done.'</span><span class="token punctuation">)</span></pre></td></tr></table></figure><p><code>Pool</code> 默认大小是 CPU 的核数，但也可以传入参数指定进程数，如果实际运行的进程数超出进程池大小，超出的进程将等待进程池有空闲后才会执行。</p><p>很多时候，子进程并不是自身，而是一个外部进程。我们创建了子进程后，还需要控制子进程的输入和输出。 <code>subprocess</code> 模块可以让我们非常方便地启动一个子进程，然后控制其输入和输出。</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">import</span> subprocess</pre></td></tr><tr><td data-num="2"></td><td><pre></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'$ nslookup www.python.org'</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="4"></td><td><pre>r <span class="token operator">=</span> subprocess<span class="token punctuation">.</span>call<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'nslookup'</span><span class="token punctuation">,</span> <span class="token string">'www.baidu.com'</span><span class="token punctuation">]</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Exit code:'</span><span class="token punctuation">,</span> r<span class="token punctuation">)</span>  <span class="token comment"># Exit code: 0</span></pre></td></tr><tr><td data-num="6"></td><td><pre></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token comment"># $ nslookup www.python.org</span></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token comment"># Server:		192.168.1.1</span></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token comment"># Address:	192.168.1.1</span></pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token comment"># </span></pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token comment"># canonical name = dualstack.python.map.fastly.net</span></pre></td></tr><tr><td data-num="12"></td><td><pre><span class="token comment"># Name:	python.map.fastly.net</span></pre></td></tr><tr><td data-num="13"></td><td><pre><span class="token comment"># Addresses:  2a04:4e42:1a::223</span></pre></td></tr><tr><td data-num="14"></td><td><pre><span class="token comment"># 	  151.101.228.223</span></pre></td></tr><tr><td data-num="15"></td><td><pre><span class="token comment"># Aliases:  www.python.org</span></pre></td></tr><tr><td data-num="16"></td><td><pre><span class="token comment"># </span></pre></td></tr><tr><td data-num="17"></td><td><pre><span class="token comment"># Exit code: 0</span></pre></td></tr></table></figure><p>如果子进程需要输入，可以使用 <code>communicate()</code> 方法实现：</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">import</span> subprocess</pre></td></tr><tr><td data-num="2"></td><td><pre></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'$ nslookup'</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="4"></td><td><pre>p <span class="token operator">=</span> subprocess<span class="token punctuation">.</span>Popen<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'nslookup'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> stdin<span class="token operator">=</span>subprocess<span class="token punctuation">.</span>PIPE<span class="token punctuation">,</span> stdout<span class="token operator">=</span>subprocess<span class="token punctuation">.</span>PIPE<span class="token punctuation">,</span> stderr<span class="token operator">=</span>subprocess<span class="token punctuation">.</span>PIPE<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="5"></td><td><pre>output<span class="token punctuation">,</span> err <span class="token operator">=</span> p<span class="token punctuation">.</span>communicate<span class="token punctuation">(</span><span class="token string">b'set q=mx\npython.org\nexit\n'</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span>output<span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token string">'gbk'</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Exit code:'</span><span class="token punctuation">,</span> p<span class="token punctuation">.</span>returncode<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="8"></td><td><pre></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token comment"># $ nslookup</span></pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token comment"># 默认服务器:  192.168.1.1</span></pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token comment"># Address:  192.168.1.1</span></pre></td></tr><tr><td data-num="12"></td><td><pre><span class="token comment"># </span></pre></td></tr><tr><td data-num="13"></td><td><pre><span class="token comment"># > > 服务器:  192.168.1.1</span></pre></td></tr><tr><td data-num="14"></td><td><pre><span class="token comment"># Address:  192.168.1.1</span></pre></td></tr><tr><td data-num="15"></td><td><pre><span class="token comment"># </span></pre></td></tr><tr><td data-num="16"></td><td><pre><span class="token comment"># python.org   MX preference = 50, mail exchanger = mail.python.org</span></pre></td></tr><tr><td data-num="17"></td><td><pre><span class="token comment"># > </span></pre></td></tr><tr><td data-num="18"></td><td><pre><span class="token comment"># Exit code: 0</span></pre></td></tr></table></figure><p>这里的代码相当于进行了如下操作：</p><p><img data-src="https://img.xfc-exclave.com/2021/09/0644eb76cf69cdc495cdc81798bc4acd1631117532.png" alt="Python子进程输入操作"></p><p>通过上面的操作，我们已经能够自如地创建进程，但进程之间是需要进行通信的，操作系统提供了很多机制来实现进程间的通信。Python 的 <code>multiprocessing</code> 模块包装了底层的机制，提供了 <code>Queue</code> 、 <code>Pipes</code> 等多种方式来交换数据。</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">from</span> multiprocessing <span class="token keyword">import</span> Process<span class="token punctuation">,</span> Queue</pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">import</span> os<span class="token punctuation">,</span> time<span class="token punctuation">,</span> random</pre></td></tr><tr><td data-num="3"></td><td><pre></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token comment"># 写数据进程执行的代码:</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token keyword">def</span> <span class="token function">write</span><span class="token punctuation">(</span>q<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Process to write: %s'</span> <span class="token operator">%</span> os<span class="token punctuation">.</span>getpid<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="7"></td><td><pre>    <span class="token keyword">for</span> value <span class="token keyword">in</span> <span class="token punctuation">[</span><span class="token string">'A'</span><span class="token punctuation">,</span> <span class="token string">'B'</span><span class="token punctuation">,</span> <span class="token string">'C'</span><span class="token punctuation">]</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="8"></td><td><pre>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Put %s to queue...'</span> <span class="token operator">%</span> value<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="9"></td><td><pre>        q<span class="token punctuation">.</span>put<span class="token punctuation">(</span>value<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="10"></td><td><pre>        time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span>random<span class="token punctuation">.</span>random<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="11"></td><td><pre></pre></td></tr><tr><td data-num="12"></td><td><pre><span class="token comment"># 读数据进程执行的代码:</span></pre></td></tr><tr><td data-num="13"></td><td><pre><span class="token keyword">def</span> <span class="token function">read</span><span class="token punctuation">(</span>q<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="14"></td><td><pre>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Process to read: %s'</span> <span class="token operator">%</span> os<span class="token punctuation">.</span>getpid<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="15"></td><td><pre>    <span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="16"></td><td><pre>        value <span class="token operator">=</span> q<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token boolean">True</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="17"></td><td><pre>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Get %s from queue.'</span> <span class="token operator">%</span> value<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="18"></td><td><pre></pre></td></tr><tr><td data-num="19"></td><td><pre><span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="20"></td><td><pre>    <span class="token comment"># 父进程创建 Queue，并传给各个子进程：</span></pre></td></tr><tr><td data-num="21"></td><td><pre>    q <span class="token operator">=</span> Queue<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="22"></td><td><pre>    pw <span class="token operator">=</span> Process<span class="token punctuation">(</span>target<span class="token operator">=</span>write<span class="token punctuation">,</span> args<span class="token operator">=</span><span class="token punctuation">(</span>q<span class="token punctuation">,</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="23"></td><td><pre>    pr <span class="token operator">=</span> Process<span class="token punctuation">(</span>target<span class="token operator">=</span>read<span class="token punctuation">,</span> args<span class="token operator">=</span><span class="token punctuation">(</span>q<span class="token punctuation">,</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="24"></td><td><pre>    <span class="token comment"># 启动子进程 pw，写入:</span></pre></td></tr><tr><td data-num="25"></td><td><pre>    pw<span class="token punctuation">.</span>start<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="26"></td><td><pre>    <span class="token comment"># 启动子进程 pr，读取:</span></pre></td></tr><tr><td data-num="27"></td><td><pre>    pr<span class="token punctuation">.</span>start<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="28"></td><td><pre>    <span class="token comment"># 等待 pw 结束:</span></pre></td></tr><tr><td data-num="29"></td><td><pre>    pw<span class="token punctuation">.</span>join<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="30"></td><td><pre>    <span class="token comment"># pr 进程里是死循环，无法等待其结束，只能强行终止:</span></pre></td></tr><tr><td data-num="31"></td><td><pre>    pr<span class="token punctuation">.</span>terminate<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="32"></td><td><pre></pre></td></tr><tr><td data-num="33"></td><td><pre><span class="token comment"># Process to write: 15180</span></pre></td></tr><tr><td data-num="34"></td><td><pre><span class="token comment"># Put A to queue...</span></pre></td></tr><tr><td data-num="35"></td><td><pre><span class="token comment"># Process to read: 18192</span></pre></td></tr><tr><td data-num="36"></td><td><pre><span class="token comment"># Get A from queue.</span></pre></td></tr><tr><td data-num="37"></td><td><pre><span class="token comment"># Put B to queue...</span></pre></td></tr><tr><td data-num="38"></td><td><pre><span class="token comment"># Get B from queue.</span></pre></td></tr><tr><td data-num="39"></td><td><pre><span class="token comment"># Put C to queue...</span></pre></td></tr><tr><td data-num="40"></td><td><pre><span class="token comment"># Get C from queue.</span></pre></td></tr></table></figure><blockquote><p>在 Unix/Linux 下， <code>multiprocessing</code> 模块封装了 <code>fork()</code> 调用，使我们不需要关注 <code>fork()</code> 的细节。由于 Windows 不支持 <code>fork</code> 调用，因此， <code>multiprocessing</code> 需要 “模拟” 出 <code>fork</code> 的效果，父进程所有 Python 对象都必须通过 pickle 序列化再传到子进程去，所以，如果 <code>multiprocessing</code> 在 Windows 下调用失败了，要先考虑是不是 pickle 失败了。</p></blockquote><h4 id="多线程"><a class="anchor" href="#多线程">#</a> 多线程</h4><p>Python 的线程是真正的 <code>Posix Thread</code> ，而不是模拟出来的线程。</p><p>Python 的标准库提供了两个模块： <code>_thread</code> 和 <code>threading</code> ，前者是低级模块，后者是高级模块，对前者进行了封装。</p><p>在 Python 中，启动一个线程就是把一个函数传入并创建 Thread 实例，然后调用 <code>start()</code> 开始执行：</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">import</span> time<span class="token punctuation">,</span> threading</pre></td></tr><tr><td data-num="2"></td><td><pre></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token comment"># 新线程执行的代码:</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token keyword">def</span> <span class="token function">loop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'thread %s is running...'</span> <span class="token operator">%</span> threading<span class="token punctuation">.</span>current_thread<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>name<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    n <span class="token operator">=</span> <span class="token number">0</span></pre></td></tr><tr><td data-num="7"></td><td><pre>    <span class="token keyword">while</span> n <span class="token operator">&lt;</span> <span class="token number">5</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="8"></td><td><pre>        n <span class="token operator">=</span> n <span class="token operator">+</span> <span class="token number">1</span></pre></td></tr><tr><td data-num="9"></td><td><pre>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'thread %s >>> %s'</span> <span class="token operator">%</span> <span class="token punctuation">(</span>threading<span class="token punctuation">.</span>current_thread<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>name<span class="token punctuation">,</span> n<span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="10"></td><td><pre>        time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="11"></td><td><pre>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'thread %s ended.'</span> <span class="token operator">%</span> threading<span class="token punctuation">.</span>current_thread<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>name<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="12"></td><td><pre></pre></td></tr><tr><td data-num="13"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'thread %s is running...[main]'</span> <span class="token operator">%</span> threading<span class="token punctuation">.</span>current_thread<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>name<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="14"></td><td><pre>t <span class="token operator">=</span> threading<span class="token punctuation">.</span>Thread<span class="token punctuation">(</span>target<span class="token operator">=</span>loop<span class="token punctuation">,</span> name<span class="token operator">=</span><span class="token string">'LoopThread'</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="15"></td><td><pre>t<span class="token punctuation">.</span>start<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="16"></td><td><pre>t<span class="token punctuation">.</span>join<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="17"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'thread %s ended.'</span> <span class="token operator">%</span> threading<span class="token punctuation">.</span>current_thread<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>name<span class="token punctuation">)</span></pre></td></tr></table></figure><p>所有进程都会默认启动一个线程，我们称之为主线程，主线程又可以启动新的线程，Python <code>threading</code> 下的 <code>current_thread()</code> 函数会返回当前线程的实例。主线程实例名称默认为 <code>MainThread</code> ，子线程的名字可以在创建时指定。线程名称仅仅用于显示，没有实际意义，如果不指定子线程名称，Python 就自动给线程命名为 <code>Thread-1</code> ， <code>Thread-2</code> ……</p><p>多线程和多进程最大的不同在于，多进程中，同一个变量，各自有一份拷贝存在于每个进程中，互不影响，而多线程中，所有变量都由所有线程共享，所以，任何一个变量都可以被任何一个线程修改，因此，线程之间共享数据最大的危险在于多个线程同时改一个变量。</p><p>在多线程环境中，线程之间的执行顺序并没有一定的规律，在不同的应用场景中，由于执行顺序的不同，极有可能产生与预期不符的执行结果。如果要确保执行结果的正确性，往往需要对共享操作进行加锁，这样就可以避免多个线程之间的修改冲突。在 Python 中，可以通过 <code>threading.Lock()</code> 来创建锁：</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">import</span> threading</pre></td></tr><tr><td data-num="2"></td><td><pre></pre></td></tr><tr><td data-num="3"></td><td><pre>balance <span class="token operator">=</span> <span class="token number">0</span></pre></td></tr><tr><td data-num="4"></td><td><pre>lock <span class="token operator">=</span> threading<span class="token punctuation">.</span>Lock<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="5"></td><td><pre></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token keyword">def</span> <span class="token function">change_it</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="7"></td><td><pre>    <span class="token keyword">global</span> balance</pre></td></tr><tr><td data-num="8"></td><td><pre>    balance <span class="token operator">=</span> balance <span class="token operator">+</span> n</pre></td></tr><tr><td data-num="9"></td><td><pre>    balance <span class="token operator">=</span> balance <span class="token operator">-</span> n</pre></td></tr><tr><td data-num="10"></td><td><pre></pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token keyword">def</span> <span class="token function">run_thread</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="12"></td><td><pre>    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">100000</span><span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="13"></td><td><pre>        <span class="token comment"># 获取锁</span></pre></td></tr><tr><td data-num="14"></td><td><pre>        lock<span class="token punctuation">.</span>acquire<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="15"></td><td><pre>        <span class="token keyword">try</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="16"></td><td><pre>            change_it<span class="token punctuation">(</span>n<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="17"></td><td><pre>        <span class="token keyword">finally</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="18"></td><td><pre>            <span class="token comment"># 释放锁</span></pre></td></tr><tr><td data-num="19"></td><td><pre>            lock<span class="token punctuation">.</span>release<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="20"></td><td><pre></pre></td></tr><tr><td data-num="21"></td><td><pre><span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="22"></td><td><pre>    t1 <span class="token operator">=</span> threading<span class="token punctuation">.</span>Thread<span class="token punctuation">(</span>target<span class="token operator">=</span>run_thread<span class="token punctuation">,</span> args<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="23"></td><td><pre>    t2 <span class="token operator">=</span> threading<span class="token punctuation">.</span>Thread<span class="token punctuation">(</span>target<span class="token operator">=</span>run_thread<span class="token punctuation">,</span> args<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">,</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="24"></td><td><pre>    t1<span class="token punctuation">.</span>start<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="25"></td><td><pre>    t2<span class="token punctuation">.</span>start<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="26"></td><td><pre>    t1<span class="token punctuation">.</span>join<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="27"></td><td><pre>    t2<span class="token punctuation">.</span>join<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="28"></td><td><pre>    <span class="token keyword">print</span><span class="token punctuation">(</span>balance<span class="token punctuation">)</span></pre></td></tr></table></figure><p>多个线程会对同一把锁产生竞争，竞争成功的线程则允许执行被锁定的操作，未竞争成功的线程则等待获得锁的线程释放锁。</p><blockquote><p>关于锁的内容其实相当丰富，这里仅仅做最简要的说明。</p></blockquote><p>在 Python 中可以使用多线程，但其实并不能有效理由计算机的多核。如果一定要通过多线程利用多核，那只能通过 C 扩展来实现。</p><p>不过，Python 虽然不能利用多线程实现多核任务，但可以通过多进程实现多核任务。多个进程有各自独立的 <code>GIL</code> 锁，互不影响。</p><h4 id="threadlocal"><a class="anchor" href="#threadlocal">#</a> ThreadLocal</h4><p>在多线程环境下，相较于使用全局变量，一个线程使用自己的局部变量更加安全，因为局部变量只有自己可见，不会影响其他线程，而对全局变量的修改必须加锁进行。在多线程环境下，应当尽量减少使用全局变量。</p><p>但是，局部变量的使用也存在一些问题，例如函数在多层调用时，传递参数会相当麻烦，为了解决这一问题，Python 引入了 <code>ThreadLocal</code> 对象。</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">import</span> threading</pre></td></tr><tr><td data-num="2"></td><td><pre></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token comment"># 创建全局 ThreadLocal 对象:</span></pre></td></tr><tr><td data-num="4"></td><td><pre>local_school <span class="token operator">=</span> threading<span class="token punctuation">.</span>local<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment"># 不同线程存储在 ThreadLocal 对象中的属性互不影响</span></pre></td></tr><tr><td data-num="5"></td><td><pre></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token keyword">def</span> <span class="token function">process_student</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="7"></td><td><pre>    <span class="token comment"># 获取当前线程关联的 student:</span></pre></td></tr><tr><td data-num="8"></td><td><pre>    std <span class="token operator">=</span> local_school<span class="token punctuation">.</span>student</pre></td></tr><tr><td data-num="9"></td><td><pre>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Hello, %s (in %s)'</span> <span class="token operator">%</span> <span class="token punctuation">(</span>std<span class="token punctuation">,</span> threading<span class="token punctuation">.</span>current_thread<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="10"></td><td><pre></pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token keyword">def</span> <span class="token function">process_thread</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="12"></td><td><pre>    <span class="token comment"># 绑定 ThreadLocal 的 student:</span></pre></td></tr><tr><td data-num="13"></td><td><pre>    local_school<span class="token punctuation">.</span>student <span class="token operator">=</span> name</pre></td></tr><tr><td data-num="14"></td><td><pre>    process_student<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="15"></td><td><pre></pre></td></tr><tr><td data-num="16"></td><td><pre><span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="17"></td><td><pre>    t1 <span class="token operator">=</span> threading<span class="token punctuation">.</span>Thread<span class="token punctuation">(</span>target<span class="token operator">=</span>process_thread<span class="token punctuation">,</span> args<span class="token operator">=</span><span class="token punctuation">(</span><span class="token string">'Alice'</span><span class="token punctuation">,</span><span class="token punctuation">)</span><span class="token punctuation">,</span> name<span class="token operator">=</span><span class="token string">'Thread-A'</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="18"></td><td><pre>    t2 <span class="token operator">=</span> threading<span class="token punctuation">.</span>Thread<span class="token punctuation">(</span>target<span class="token operator">=</span>process_thread<span class="token punctuation">,</span> args<span class="token operator">=</span><span class="token punctuation">(</span><span class="token string">'Bob'</span><span class="token punctuation">,</span><span class="token punctuation">)</span><span class="token punctuation">,</span> name<span class="token operator">=</span><span class="token string">'Thread-B'</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="19"></td><td><pre>    t1<span class="token punctuation">.</span>start<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="20"></td><td><pre>    t2<span class="token punctuation">.</span>start<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="21"></td><td><pre>    t1<span class="token punctuation">.</span>join<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="22"></td><td><pre>    t2<span class="token punctuation">.</span>join<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="23"></td><td><pre></pre></td></tr><tr><td data-num="24"></td><td><pre><span class="token comment"># Hello, Alice (in Thread-A)</span></pre></td></tr><tr><td data-num="25"></td><td><pre><span class="token comment"># Hello, Bob (in Thread-B)</span></pre></td></tr></table></figure><blockquote><p>可以将 ThreadLocal 类型的全局变量理解为一个 dict ，其内存根据不同线程，分别存放了不同线程下的对象信息，当再次从中获取值时，会自动判断当前是哪一个线程，并取出对应线程下的值。</p></blockquote><p><code>ThreadLocal</code> 最常用的地方就是为每个线程绑定一个数据库连接，HTTP 请求，用户身份信息等，这样一个线程的所有调用到的处理函数都可以非常方便地访问这些资源。</p><p>一个 <code>ThreadLocal</code> 变量虽然是全局变量，但每个线程都只能读写自己线程的独立副本，互不干扰。</p><h4 id="进程与线程对比"><a class="anchor" href="#进程与线程对比">#</a> 进程与线程对比</h4><p><span class="label danger">❗️TODO</span> 此部分概念与其他语言没有任何区别，暂时略去。</p><h4 id="分布式线程"><a class="anchor" href="#分布式线程">#</a> 分布式线程</h4><p>Python 的 <code>multiprocessing</code> 模块不但支持多进程，其中 <code>managers</code> 子模块还支持把多进程分布到多台机器上。一个服务进程可以作为调度者，依靠网络通信，可以将任务分布到其他多个进程中。由于 <code>managers</code> 模块封装很好，因此完全不必了解网络通信的细节，就可以很容易地编写分布式多进程程序。</p><p>在多进程章节中，我们已经能够让多个进程通过 <code>Queue</code> 在同一台主机上进行通讯。而如果需要在多个主机上实现进程之间的通讯，则需要 <code>managers</code> 模块将 Queue 通过网络暴露出去，其他主机的进程就可以访问这个 Queue 了。</p><p>创建并启动服务进程：</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">#!/usr/bin/env python3</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token comment"># -*- coding: utf-8 -*-</span></pre></td></tr><tr><td data-num="3"></td><td><pre></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token keyword">import</span> random<span class="token punctuation">,</span> time<span class="token punctuation">,</span> queue</pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token keyword">from</span> multiprocessing<span class="token punctuation">.</span>managers <span class="token keyword">import</span> BaseManager</pre></td></tr><tr><td data-num="6"></td><td><pre></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token comment"># 发送任务队列</span></pre></td></tr><tr><td data-num="8"></td><td><pre>task_queue <span class="token operator">=</span> queue<span class="token punctuation">.</span>Queue<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token comment"># 接收结果队列</span></pre></td></tr><tr><td data-num="10"></td><td><pre>result_queue <span class="token operator">=</span> queue<span class="token punctuation">.</span>Queue<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="11"></td><td><pre></pre></td></tr><tr><td data-num="12"></td><td><pre><span class="token comment"># 继承 BaseManager</span></pre></td></tr><tr><td data-num="13"></td><td><pre><span class="token keyword">class</span> <span class="token class-name">QueueManager</span><span class="token punctuation">(</span>BaseManager<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="14"></td><td><pre>    <span class="token keyword">pass</span></pre></td></tr><tr><td data-num="15"></td><td><pre></pre></td></tr><tr><td data-num="16"></td><td><pre><span class="token keyword">def</span> <span class="token function">return_task_queue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="17"></td><td><pre>    <span class="token comment"># global 用于函数内部，修改全局变量的值</span></pre></td></tr><tr><td data-num="18"></td><td><pre>    <span class="token keyword">global</span> task_queue</pre></td></tr><tr><td data-num="19"></td><td><pre>    <span class="token keyword">return</span> task_queue</pre></td></tr><tr><td data-num="20"></td><td><pre></pre></td></tr><tr><td data-num="21"></td><td><pre><span class="token keyword">def</span> <span class="token function">return_result_queue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="22"></td><td><pre>    <span class="token keyword">global</span> result_queue</pre></td></tr><tr><td data-num="23"></td><td><pre>    <span class="token keyword">return</span> result_queue</pre></td></tr><tr><td data-num="24"></td><td><pre></pre></td></tr><tr><td data-num="25"></td><td><pre><span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="26"></td><td><pre>    <span class="token comment"># 将两个 Queue 注册到网络上，callable 参数关联 Queue 对象</span></pre></td></tr><tr><td data-num="27"></td><td><pre>    <span class="token comment"># ！win10 中 callale 不对 lambda 匿名函数做处理</span></pre></td></tr><tr><td data-num="28"></td><td><pre>    QueueManager<span class="token punctuation">.</span>register<span class="token punctuation">(</span><span class="token string">'get_task_queue'</span><span class="token punctuation">,</span> <span class="token builtin">callable</span><span class="token operator">=</span>return_task_queue<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="29"></td><td><pre>    QueueManager<span class="token punctuation">.</span>register<span class="token punctuation">(</span><span class="token string">'get_result_queue'</span><span class="token punctuation">,</span> <span class="token builtin">callable</span><span class="token operator">=</span>return_result_queue<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="30"></td><td><pre>    <span class="token comment"># 绑定端口 5000，这 5000 怎么来的？两个文件中的端口一样就行！，设置验证码 abc</span></pre></td></tr><tr><td data-num="31"></td><td><pre>    <span class="token comment"># 通过 QueueManager 将 Queue 暴露出去</span></pre></td></tr><tr><td data-num="32"></td><td><pre>    manager <span class="token operator">=</span> QueueManager<span class="token punctuation">(</span>address<span class="token operator">=</span><span class="token punctuation">(</span><span class="token string">'127.0.0.1'</span><span class="token punctuation">,</span> <span class="token number">5000</span><span class="token punctuation">)</span><span class="token punctuation">,</span> authkey<span class="token operator">=</span><span class="token string">b'abc'</span><span class="token punctuation">)</span>  <span class="token comment"># authkey，保证通讯不被其他程序恶意干扰</span></pre></td></tr><tr><td data-num="33"></td><td><pre>    manager<span class="token punctuation">.</span>start<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="34"></td><td><pre>    task <span class="token operator">=</span> manager<span class="token punctuation">.</span>get_task_queue<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="35"></td><td><pre>    result <span class="token operator">=</span> manager<span class="token punctuation">.</span>get_result_queue<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="36"></td><td><pre>    <span class="token comment"># 放 10 个任务进去</span></pre></td></tr><tr><td data-num="37"></td><td><pre>    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="38"></td><td><pre>        n <span class="token operator">=</span> random<span class="token punctuation">.</span>randint<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="39"></td><td><pre>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Put task %d...'</span> <span class="token operator">%</span> n<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="40"></td><td><pre>        <span class="token comment"># 将数据放到任务队列</span></pre></td></tr><tr><td data-num="41"></td><td><pre>        task<span class="token punctuation">.</span>put<span class="token punctuation">(</span>n<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="42"></td><td><pre>    <span class="token comment"># 取任务执行结果</span></pre></td></tr><tr><td data-num="43"></td><td><pre>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Try get results...'</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="44"></td><td><pre>    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="45"></td><td><pre>        <span class="token comment"># 从结果队列中取结果</span></pre></td></tr><tr><td data-num="46"></td><td><pre>        <span class="token comment"># 等待 10 是因为计算需要时间</span></pre></td></tr><tr><td data-num="47"></td><td><pre>        r <span class="token operator">=</span> result<span class="token punctuation">.</span>get<span class="token punctuation">(</span>timeout<span class="token operator">=</span><span class="token number">10</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="48"></td><td><pre>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Result: %s'</span> <span class="token operator">%</span> r<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="49"></td><td><pre>    <span class="token comment"># 关闭</span></pre></td></tr><tr><td data-num="50"></td><td><pre>    manager<span class="token punctuation">.</span>shutdown<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="51"></td><td><pre>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'master exit.'</span><span class="token punctuation">)</span></pre></td></tr></table></figure><p>创建并启动工作进程：</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">#!/usr/bin/env python3</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token comment"># -*- coding: utf-8 -*-</span></pre></td></tr><tr><td data-num="3"></td><td><pre></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token keyword">import</span> time<span class="token punctuation">,</span> sys<span class="token punctuation">,</span> queue</pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token keyword">from</span> multiprocessing<span class="token punctuation">.</span>managers <span class="token keyword">import</span> BaseManager</pre></td></tr><tr><td data-num="6"></td><td><pre></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token keyword">class</span> <span class="token class-name">QueueManager</span><span class="token punctuation">(</span>BaseManager<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="8"></td><td><pre>    <span class="token keyword">pass</span></pre></td></tr><tr><td data-num="9"></td><td><pre></pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="11"></td><td><pre>    QueueManager<span class="token punctuation">.</span>register<span class="token punctuation">(</span><span class="token string">'get_task_queue'</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="12"></td><td><pre>    QueueManager<span class="token punctuation">.</span>register<span class="token punctuation">(</span><span class="token string">'get_result_queue'</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="13"></td><td><pre></pre></td></tr><tr><td data-num="14"></td><td><pre>    server_addr <span class="token operator">=</span> <span class="token string">'127.0.0.1'</span></pre></td></tr><tr><td data-num="15"></td><td><pre>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Connect to server %s...'</span> <span class="token operator">%</span> server_addr<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="16"></td><td><pre>    <span class="token comment"># 端口设置和 task_master.py 中一样</span></pre></td></tr><tr><td data-num="17"></td><td><pre>    m <span class="token operator">=</span> QueueManager<span class="token punctuation">(</span>address<span class="token operator">=</span><span class="token punctuation">(</span>server_addr<span class="token punctuation">,</span> <span class="token number">5000</span><span class="token punctuation">)</span><span class="token punctuation">,</span> authkey<span class="token operator">=</span><span class="token string">b'abc'</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="18"></td><td><pre>    <span class="token comment"># 连接网络</span></pre></td></tr><tr><td data-num="19"></td><td><pre>    m<span class="token punctuation">.</span>connect<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="20"></td><td><pre></pre></td></tr><tr><td data-num="21"></td><td><pre>    task <span class="token operator">=</span> m<span class="token punctuation">.</span>get_task_queue<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment"># 如果不在同一台主机，必须通过 manager.get... 方式获得 Queue 接口</span></pre></td></tr><tr><td data-num="22"></td><td><pre>    result <span class="token operator">=</span> m<span class="token punctuation">.</span>get_result_queue<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="23"></td><td><pre></pre></td></tr><tr><td data-num="24"></td><td><pre>    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="25"></td><td><pre>        <span class="token keyword">try</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="26"></td><td><pre>            <span class="token comment"># 接收任务队列中的数据</span></pre></td></tr><tr><td data-num="27"></td><td><pre>            n <span class="token operator">=</span> task<span class="token punctuation">.</span>get<span class="token punctuation">(</span>timeout<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="28"></td><td><pre>            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Run task %d*%d'</span> <span class="token operator">%</span> <span class="token punctuation">(</span>n<span class="token punctuation">,</span> n<span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="29"></td><td><pre>            r <span class="token operator">=</span> <span class="token string">'%d*%d=%d'</span> <span class="token operator">%</span> <span class="token punctuation">(</span>n<span class="token punctuation">,</span> n<span class="token punctuation">,</span> n <span class="token operator">*</span> n<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="30"></td><td><pre>            time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="31"></td><td><pre>            <span class="token comment"># 放进结果队列</span></pre></td></tr><tr><td data-num="32"></td><td><pre>            result<span class="token punctuation">.</span>put<span class="token punctuation">(</span>r<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="33"></td><td><pre>        <span class="token keyword">except</span> queue<span class="token punctuation">.</span>Queue<span class="token punctuation">.</span>Empty<span class="token punctuation">:</span></pre></td></tr><tr><td data-num="34"></td><td><pre>            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'task queue is empty'</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="35"></td><td><pre>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'work done'</span><span class="token punctuation">)</span></pre></td></tr></table></figure><p>依次启动服务进程和工作进程，得到如下结果：</p><p><img data-src="https://img.xfc-exclave.com/2021/09/4a6ff34f81b982ebe1c8a97074be21011631199550.png" alt="image-20210909210504132"></p><p>以上就是一个简单的 Master/Worker 模型。</p><blockquote><p>Queue 其实是存储在服务进程中的，并使用 <code>QueueManager</code> 来进行管理，工作进程通过注册的队列名称查找匹配到指定的队列，并从队列中获得传输的值。</p><p>同时也需要注意，Queue 的作用是用来传递任务和接收结果，每个任务的描述数据量应当要尽量小。</p></blockquote><h3 id="正则表达式"><a class="anchor" href="#正则表达式">#</a> 正则表达式</h3><p>Python 提供 <code>re</code> 模块，包含所有正则表达式的功能，但需要注意正则表达式在 Python 中的转义，推荐使用 <code>r</code> 前缀以便忽略转义。</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">import</span> re</pre></td></tr><tr><td data-num="2"></td><td><pre></pre></td></tr><tr><td data-num="3"></td><td><pre>res1 <span class="token operator">=</span> re<span class="token punctuation">.</span>match<span class="token punctuation">(</span><span class="token string">r'^\d&#123;3&#125;\-\d&#123;3,8&#125;$'</span><span class="token punctuation">,</span> <span class="token string">'010-12345'</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span>res1<span class="token punctuation">)</span>  <span class="token comment"># &lt;re.Match object; span=(0, 9), match='010-12345'></span></pre></td></tr><tr><td data-num="5"></td><td><pre>res2 <span class="token operator">=</span> re<span class="token punctuation">.</span>match<span class="token punctuation">(</span><span class="token string">r'^\d&#123;3&#125;\-\d&#123;3,8&#125;$'</span><span class="token punctuation">,</span> <span class="token string">'010 12345'</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span>res2<span class="token punctuation">)</span>  <span class="token comment"># None</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'a b   c'</span><span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">' '</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># ['a', 'b', '', '', 'c'] # 无法识别连续的空格</span></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span>re<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">r'\s+'</span><span class="token punctuation">,</span> <span class="token string">'a b   c'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># ['a', 'b', 'c']</span></pre></td></tr><tr><td data-num="9"></td><td><pre>phone <span class="token operator">=</span> <span class="token builtin">input</span><span class="token punctuation">(</span><span class="token string">'请输入手机号：'</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token keyword">if</span> re<span class="token punctuation">.</span>match<span class="token punctuation">(</span><span class="token string">r'^(13[0-9]|14[5|7]|15[0|1|2|3|4|5|6|7|8|9]|18[0|1|2|3|5|6|7|8|9])\d&#123;8&#125;$'</span><span class="token punctuation">,</span> phone<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="11"></td><td><pre>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'手机号验证通过！'</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="12"></td><td><pre><span class="token keyword">else</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="13"></td><td><pre>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'手机号格式错误！'</span><span class="token punctuation">)</span></pre></td></tr></table></figure><blockquote><p>正则表达式能够帮助我们有效地对字符串进行格式验证，但对于使用场景的不同，有时候正则也并非是绝对的。</p></blockquote><p>在 Python 中使用正则表达式时，解释器会进行如下操作：</p><ol><li>编译正则表达式，如果正则表达式的字符串本身不合法，则会报错。</li><li>用编译后的正则表达式去匹配字符串。</li></ol><h3 id="常用内建模块"><a class="anchor" href="#常用内建模块">#</a> 常用内建模块</h3><h4 id="datetime"><a class="anchor" href="#datetime">#</a> datetime</h4><p>datetime 是 Python 处理日期和时间的标准库。</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">from</span> datetime <span class="token keyword">import</span> datetime<span class="token punctuation">,</span> timedelta</pre></td></tr><tr><td data-num="2"></td><td><pre></pre></td></tr><tr><td data-num="3"></td><td><pre>now <span class="token operator">=</span> datetime<span class="token punctuation">.</span>now<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span>now<span class="token punctuation">)</span>  <span class="token comment"># 2021-09-09 22:23:34.810674</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token punctuation">(</span>now<span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># &lt;class 'datetime.datetime'></span></pre></td></tr><tr><td data-num="6"></td><td><pre>dt <span class="token operator">=</span> datetime<span class="token punctuation">(</span><span class="token number">2021</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">22</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">)</span>  <span class="token comment"># 用指定日期时间创建 datetime</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span>dt<span class="token punctuation">)</span>  <span class="token comment"># 2021-09-09 22:30:00</span></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span>dt<span class="token punctuation">.</span>timestamp<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># 1631197800.0 # 日期转时间戳，单位：秒</span></pre></td></tr><tr><td data-num="9"></td><td><pre>t <span class="token operator">=</span> <span class="token number">1631197800.0</span></pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span>datetime<span class="token punctuation">.</span>fromtimestamp<span class="token punctuation">(</span>t<span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># 2021-09-09 22:30:00 # 时间戳转时间</span></pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span>datetime<span class="token punctuation">.</span>utcfromtimestamp<span class="token punctuation">(</span>t<span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># 2021-09-09 14:30:00 # UTC 时间</span></pre></td></tr><tr><td data-num="12"></td><td><pre><span class="token comment"># 时间格式转换</span></pre></td></tr><tr><td data-num="13"></td><td><pre>cday <span class="token operator">=</span> datetime<span class="token punctuation">.</span>strptime<span class="token punctuation">(</span><span class="token string">'2021-9-7 18:19:59'</span><span class="token punctuation">,</span> <span class="token string">'%Y-%m-%d %H:%M:%S'</span><span class="token punctuation">)</span>  <span class="token comment"># 字符串转时间</span></pre></td></tr><tr><td data-num="14"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span>cday<span class="token punctuation">)</span>  <span class="token comment"># 2021-09-07 18:19:59</span></pre></td></tr><tr><td data-num="15"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span>now<span class="token punctuation">.</span>strftime<span class="token punctuation">(</span><span class="token string">'%a, %b %d %H:%M'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># Thu, Sep 09 22:47 # 时间转字符串</span></pre></td></tr><tr><td data-num="16"></td><td><pre><span class="token comment"># 日期加减</span></pre></td></tr><tr><td data-num="17"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span>now<span class="token punctuation">)</span>  <span class="token comment"># 2021-09-09 22:50:17.151719</span></pre></td></tr><tr><td data-num="18"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span>now <span class="token operator">+</span> timedelta<span class="token punctuation">(</span>hours<span class="token operator">=</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># 2021-09-10 08:50:17.151719</span></pre></td></tr><tr><td data-num="19"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span>now <span class="token operator">-</span> timedelta<span class="token punctuation">(</span>days<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># 2021-09-08 22:50:17.151719</span></pre></td></tr><tr><td data-num="20"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span>now <span class="token operator">+</span> timedelta<span class="token punctuation">(</span>days<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">,</span> hours<span class="token operator">=</span><span class="token number">12</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># 2021-09-12 10:50:17.151719</span></pre></td></tr></table></figure><h4 id="collections"><a class="anchor" href="#collections">#</a> collections</h4><p>collections 是 Python 内建的一个集合模块，提供了许多有用的集合类。</p><ol><li><p>namedtuple</p><p>Python 提供了一个 <code>namedtuple</code> 函数，可以用来创建自定义的 <code>tuple</code> 对象，并且规定了 tuple 元素的个数，并可以用属性而不是索引来引用 tuple 的某个元素。</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">from</span> collections <span class="token keyword">import</span> namedtuple</pre></td></tr><tr><td data-num="2"></td><td><pre></pre></td></tr><tr><td data-num="3"></td><td><pre>Point <span class="token operator">=</span> namedtuple<span class="token punctuation">(</span><span class="token string">'Point'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">'x'</span><span class="token punctuation">,</span> <span class="token string">'y'</span><span class="token punctuation">]</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="4"></td><td><pre>p <span class="token operator">=</span> Point<span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">,</span> <span class="token number">125</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span>p<span class="token punctuation">.</span>y<span class="token punctuation">)</span>  <span class="token comment"># 125</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">isinstance</span><span class="token punctuation">(</span>p<span class="token punctuation">,</span> Point<span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># True</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">isinstance</span><span class="token punctuation">(</span>p<span class="token punctuation">,</span> <span class="token builtin">tuple</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># True</span></pre></td></tr><tr><td data-num="8"></td><td><pre></pre></td></tr><tr><td data-num="9"></td><td><pre>Circle <span class="token operator">=</span> namedtuple<span class="token punctuation">(</span><span class="token string">'Circle'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">'x'</span><span class="token punctuation">,</span> <span class="token string">'y'</span><span class="token punctuation">,</span> <span class="token string">'r'</span><span class="token punctuation">]</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="10"></td><td><pre>c <span class="token operator">=</span> Circle<span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span>c<span class="token punctuation">.</span>r<span class="token punctuation">)</span>  <span class="token comment"># 5</span></pre></td></tr></table></figure><p>使用 namedtuple 可以很方便地表示一些坐标、点或某些数据集。</p></li><li><p>deque</p><p>由于 list 是线性存储，所以它在按索引查找时很快，但删除和修改时很慢， <code>deque</code> 则是为了高效实现插入和删除操作的双向列表，适合用于队列和栈。</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">from</span> collections <span class="token keyword">import</span> deque</pre></td></tr><tr><td data-num="2"></td><td><pre></pre></td></tr><tr><td data-num="3"></td><td><pre>q <span class="token operator">=</span> deque<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'a'</span><span class="token punctuation">,</span> <span class="token string">'b'</span><span class="token punctuation">,</span> <span class="token string">'c'</span><span class="token punctuation">]</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="4"></td><td><pre>q<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token string">'x'</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span>q<span class="token punctuation">)</span>  <span class="token comment"># deque(['a', 'b', 'c', 'x'])</span></pre></td></tr><tr><td data-num="6"></td><td><pre>q<span class="token punctuation">.</span>appendleft<span class="token punctuation">(</span><span class="token string">'y'</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span>q<span class="token punctuation">)</span>  <span class="token comment"># deque(['y', 'a', 'b', 'c', 'x'])</span></pre></td></tr></table></figure><blockquote><p>deque 除了实现 list 的 <code>append()</code> 和 <code>pop()</code> 外，还支持 <code>appendleft()</code> 和 <code>popleft()</code> ，这样就可以非常高效地往头部添加或删除元素。</p></blockquote></li><li><p>defaultdict</p><p>使用 dict 时，如果引用的 Key 不存在，就会抛出 <code>KeyError</code> 。如果希望 key 不存在时，返回一个默认值，就可以用 <code>defaultdict</code> ：</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">from</span> collections <span class="token keyword">import</span> defaultdict</pre></td></tr><tr><td data-num="2"></td><td><pre></pre></td></tr><tr><td data-num="3"></td><td><pre>dd <span class="token operator">=</span> defaultdict<span class="token punctuation">(</span><span class="token keyword">lambda</span><span class="token punctuation">:</span> <span class="token string">'N/A'</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="4"></td><td><pre>dd<span class="token punctuation">[</span><span class="token string">'key1'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">'abc'</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span>dd<span class="token punctuation">[</span><span class="token string">'key1'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>  <span class="token comment"># abc</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span>dd<span class="token punctuation">[</span><span class="token string">'key2'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>  <span class="token comment"># N/A</span></pre></td></tr></table></figure><p>除了返回默认值之外，defaultdict 和 dict 没有其他任何区别。</p></li><li><p>OrderedDict</p><p>使用 dict 时，Key 是无序的，如果要保持 Key 的顺序，可以用 <code>OrderedDict</code> ：</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">from</span> collections <span class="token keyword">import</span> OrderedDict</pre></td></tr><tr><td data-num="2"></td><td><pre></pre></td></tr><tr><td data-num="3"></td><td><pre>od <span class="token operator">=</span> OrderedDict<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token string">'a'</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token string">'b'</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token string">'c'</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span>od<span class="token punctuation">)</span>  <span class="token comment"># OrderedDict ([('a', 2), ('b', 3), ('c', 1)]) # 有序</span></pre></td></tr></table></figure><p>注意： <code>OrderedDict</code> 的 Key 会按照插入的顺序排列，不是 Key 本身的排序。</p></li><li><p>ChainMap</p><p><code>ChainMap</code> 可以把一组 dict 串起来并组成一个逻辑上的 dict 。ChainMap 本身也是一个 dict，但是查找的时候，会按照顺序在内部的 dict 依次查找。</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">from</span> collections <span class="token keyword">import</span> ChainMap</pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">import</span> os<span class="token punctuation">,</span> argparse</pre></td></tr><tr><td data-num="3"></td><td><pre></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token comment"># 构造缺省参数:</span></pre></td></tr><tr><td data-num="5"></td><td><pre>defaults <span class="token operator">=</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    <span class="token string">'color'</span><span class="token punctuation">:</span> <span class="token string">'red'</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="7"></td><td><pre>    <span class="token string">'user'</span><span class="token punctuation">:</span> <span class="token string">'guest'</span></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="9"></td><td><pre></pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token comment"># 构造命令行参数:</span></pre></td></tr><tr><td data-num="11"></td><td><pre>parser <span class="token operator">=</span> argparse<span class="token punctuation">.</span>ArgumentParser<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="12"></td><td><pre>parser<span class="token punctuation">.</span>add_argument<span class="token punctuation">(</span><span class="token string">'-u'</span><span class="token punctuation">,</span> <span class="token string">'--user'</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="13"></td><td><pre>parser<span class="token punctuation">.</span>add_argument<span class="token punctuation">(</span><span class="token string">'-c'</span><span class="token punctuation">,</span> <span class="token string">'--color'</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="14"></td><td><pre>namespace <span class="token operator">=</span> parser<span class="token punctuation">.</span>parse_args<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="15"></td><td><pre>command_line_args <span class="token operator">=</span> <span class="token punctuation">&#123;</span>k<span class="token punctuation">:</span> v <span class="token keyword">for</span> k<span class="token punctuation">,</span> v <span class="token keyword">in</span> <span class="token builtin">vars</span><span class="token punctuation">(</span>namespace<span class="token punctuation">)</span><span class="token punctuation">.</span>items<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">if</span> v<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="16"></td><td><pre></pre></td></tr><tr><td data-num="17"></td><td><pre><span class="token comment"># 组合成 ChainMap:</span></pre></td></tr><tr><td data-num="18"></td><td><pre>combined <span class="token operator">=</span> ChainMap<span class="token punctuation">(</span>command_line_args<span class="token punctuation">,</span> os<span class="token punctuation">.</span>environ<span class="token punctuation">,</span> defaults<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="19"></td><td><pre></pre></td></tr><tr><td data-num="20"></td><td><pre><span class="token comment"># 打印参数:</span></pre></td></tr><tr><td data-num="21"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'color=%s'</span> <span class="token operator">%</span> combined<span class="token punctuation">[</span><span class="token string">'color'</span><span class="token punctuation">]</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="22"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'user=%s'</span> <span class="token operator">%</span> combined<span class="token punctuation">[</span><span class="token string">'user'</span><span class="token punctuation">]</span><span class="token punctuation">)</span></pre></td></tr></table></figure><p>运行结果：</p><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre>A:<span class="token punctuation">\</span>pycharm-workspace<span class="token punctuation">\</span>py-test<span class="token operator">></span>python main.py</pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token assign-left variable">color</span><span class="token operator">=</span>red</pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token assign-left variable">user</span><span class="token operator">=</span>guest</pre></td></tr><tr><td data-num="4"></td><td><pre></pre></td></tr><tr><td data-num="5"></td><td><pre>A:<span class="token punctuation">\</span>pycharm-workspace<span class="token punctuation">\</span>py-test<span class="token operator">></span>python main.py -u Chimoku</pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token assign-left variable">color</span><span class="token operator">=</span>red</pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token assign-left variable">user</span><span class="token operator">=</span>Chimoku</pre></td></tr></table></figure></li><li><p>Counter</p><p>Counter 是一个简单的计数器，实际上它也是 dict 的一个子类。</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment"># 使用 Counter 统计字符出现的个数</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">from</span> collections <span class="token keyword">import</span> Counter</pre></td></tr><tr><td data-num="3"></td><td><pre></pre></td></tr><tr><td data-num="4"></td><td><pre>c <span class="token operator">=</span> Counter<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token keyword">for</span> ch <span class="token keyword">in</span> <span class="token string">'programming'</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    c<span class="token punctuation">[</span>ch<span class="token punctuation">]</span> <span class="token operator">=</span> c<span class="token punctuation">[</span>ch<span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token number">1</span></pre></td></tr><tr><td data-num="7"></td><td><pre></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span>  <span class="token comment"># Counter(&#123;'r': 2, 'g': 2, 'm': 2, 'p': 1, 'o': 1, 'a': 1, 'i': 1, 'n': 1&#125;)</span></pre></td></tr><tr><td data-num="9"></td><td><pre>c<span class="token punctuation">.</span>update<span class="token punctuation">(</span><span class="token string">"playing"</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span>  <span class="token comment"># Counter(&#123;'g': 3, 'p': 2, 'r': 2, 'a': 2, 'm': 2, 'i': 2, 'n': 2, 'o': 1, 'l': 1, 'y': 1&#125;)</span></pre></td></tr></table></figure></li></ol><h4 id="base64"><a class="anchor" href="#base64">#</a> base64</h4><p>Base64 是一种用 64 个字符来表示任意二进制数据的方法，Python 内置的 <code>base64</code> 可以直接进行 base64 的编解码：</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">import</span> base64</pre></td></tr><tr><td data-num="2"></td><td><pre></pre></td></tr><tr><td data-num="3"></td><td><pre>en <span class="token operator">=</span> base64<span class="token punctuation">.</span>b64encode<span class="token punctuation">(</span><span class="token string">b'binary\x00string'</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span>en<span class="token punctuation">)</span>  <span class="token comment"># b'YmluYXJ5AHN0cmluZw=='</span></pre></td></tr><tr><td data-num="5"></td><td><pre>de <span class="token operator">=</span> base64<span class="token punctuation">.</span>b64decode<span class="token punctuation">(</span><span class="token string">b'YmluYXJ5AHN0cmluZw=='</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span>de<span class="token punctuation">)</span>  <span class="token comment"># b'binary\x00string'</span></pre></td></tr></table></figure><p>由于标准的 Base64 编码后可能出现字符 <code>+</code> 和 <code>/</code> ，在 URL 中就不能直接作为参数，所以又有一种 <code>url safe</code> 的 base64 编码，其实就是把字符 <code>+</code> 和 <code>/</code> 分别变成 <code>-</code> 和 <code>_</code> ：</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">import</span> base64</pre></td></tr><tr><td data-num="2"></td><td><pre></pre></td></tr><tr><td data-num="3"></td><td><pre>en_byte <span class="token operator">=</span> <span class="token string">b'i\xb7\x1d\xfb\xef\xff'</span></pre></td></tr><tr><td data-num="4"></td><td><pre>en2 <span class="token operator">=</span> base64<span class="token punctuation">.</span>b64encode<span class="token punctuation">(</span>en_byte<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span>en2<span class="token punctuation">)</span>  <span class="token comment"># b'abcd++//'</span></pre></td></tr><tr><td data-num="6"></td><td><pre>uen <span class="token operator">=</span> base64<span class="token punctuation">.</span>urlsafe_b64encode<span class="token punctuation">(</span>en_byte<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span>uen<span class="token punctuation">)</span>  <span class="token comment"># b'abcd--__'</span></pre></td></tr><tr><td data-num="8"></td><td><pre>ude <span class="token operator">=</span> base64<span class="token punctuation">.</span>urlsafe_b64decode<span class="token punctuation">(</span>uen<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span>ude <span class="token operator">==</span> en_byte<span class="token punctuation">)</span>  <span class="token comment"># True</span></pre></td></tr></table></figure><p>Base64 适用于小段内容的编码，比如数字证书签名、Cookie 的内容等，但是，由于 <code>=</code> 字符也可能出现在 Base64 编码中，但 <code>=</code> 用在 URL、Cookie 里面会造成歧义，所以，很多 Base64 编码后会把 <code>=</code> 去掉。</p><p>Base64 是一种任意二进制到文本字符串的编码方法，常用于在 URL、Cookie、网页中传输少量二进制数据。</p><h4 id="struct"><a class="anchor" href="#struct">#</a> struct</h4><p>在 Python 中并没有专门用于处理字节的数据类型，但是由于 <code>b'str'</code> 可以用来表示字节，所以，Python 通常用二进制字符串来表示字节数组。</p><p>Python 提供了一个 <code>struct</code> 模块用来解决 bytes 和其他二进制数据类型之间的转换问题。struct 模块的 pack 函数把任意数据类型变成 bytes：</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">import</span> struct</pre></td></tr><tr><td data-num="2"></td><td><pre></pre></td></tr><tr><td data-num="3"></td><td><pre>a <span class="token operator">=</span> struct<span class="token punctuation">.</span>pack<span class="token punctuation">(</span><span class="token string">'>I'</span><span class="token punctuation">,</span> <span class="token number">10240099</span><span class="token punctuation">)</span>  <span class="token comment"># >I 是处理指令，</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span>  <span class="token comment"># b'\x00\x9c@c'</span></pre></td></tr><tr><td data-num="5"></td><td><pre>un <span class="token operator">=</span> struct<span class="token punctuation">.</span>unpack<span class="token punctuation">(</span><span class="token string">'>IH'</span><span class="token punctuation">,</span> <span class="token string">b'\xf0\xf0\xf0\xf0\x80\x80'</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span>un<span class="token punctuation">)</span>  <span class="token comment"># (4042322160, 32896)</span></pre></td></tr></table></figure><p>其中， <code>&gt;</code> 表示字节顺序是 big-endian，也就是网络序， <code>I</code> 表示 4 字节无符号整数。后面的参数个数要和处理指令一致。</p><p>而 <code>unpack</code> 则是将 bytes 转换为相应的数据类型。</p><p>尽管 Python 不适合编写底层操作字节流的代码，但在对性能要求不高的地方，利用 <code>struct</code> 将会提供很大的便利。</p><h4 id="hashlib"><a class="anchor" href="#hashlib">#</a> hashlib</h4><p>Python 的 hashlib 提供了常见的摘要算法，如 MD5，SHA1 等等。</p><p>摘要算法又称哈希算法、散列算法。它通过一个函数，把任意长度的数据转换为一个长度固定的数据串（通常用 16 进制的字符串表示）。</p><p>摘要算法就是通过摘要函数 <code>f()</code> 对任意长度的数据 <code>data</code> 计算出固定长度的摘要 <code>digest</code> ，目的是为了发现原始数据是否被人篡改过。</p><p>摘要算法之所以能指出数据是否被篡改过，就是因为摘要函数是一个单向函数，计算 <code>f(data)</code> 很容易，但通过 digest 反推 data 却非常困难。而且，对原始数据做一个 bit 的修改，都会导致计算出的摘要完全不同。</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment"># MD5 摘要算法</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">import</span> hashlib</pre></td></tr><tr><td data-num="3"></td><td><pre></pre></td></tr><tr><td data-num="4"></td><td><pre>md5 <span class="token operator">=</span> hashlib<span class="token punctuation">.</span>md5<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="5"></td><td><pre>md5<span class="token punctuation">.</span>update<span class="token punctuation">(</span><span class="token string">'how to use md5 in python hashlib?'</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span>md5<span class="token punctuation">.</span>hexdigest<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># d26a53750bc40b38b65a520292f69306</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token comment"># 摘要算法支持将原始字符串进行分段计算，其计算结果不受影响</span></pre></td></tr><tr><td data-num="8"></td><td><pre>md5_2 <span class="token operator">=</span> hashlib<span class="token punctuation">.</span>md5<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="9"></td><td><pre>md5_2<span class="token punctuation">.</span>update<span class="token punctuation">(</span><span class="token string">'how to use md5 '</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="10"></td><td><pre>md5_2<span class="token punctuation">.</span>update<span class="token punctuation">(</span><span class="token string">'in python hashlib?'</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span>md5_2<span class="token punctuation">.</span>hexdigest<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>__eq__<span class="token punctuation">(</span>md5<span class="token punctuation">.</span>hexdigest<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># True</span></pre></td></tr></table></figure><p>MD5 是最常见的摘要算法，速度很快，生成结果是固定的 128 bit 字节，通常用一个 32 位的 16 进制字符串表示。</p><p>另一种常见的摘要算法是 SHA1，调用 SHA1 和调用 MD5 完全类似：</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">import</span> hashlib</pre></td></tr><tr><td data-num="2"></td><td><pre></pre></td></tr><tr><td data-num="3"></td><td><pre>sha1 <span class="token operator">=</span> hashlib<span class="token punctuation">.</span>sha1<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="4"></td><td><pre>sha1<span class="token punctuation">.</span>update<span class="token punctuation">(</span><span class="token string">'how to use sha1 in '</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="5"></td><td><pre>sha1<span class="token punctuation">.</span>update<span class="token punctuation">(</span><span class="token string">'python hashlib?'</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span>sha1<span class="token punctuation">.</span>hexdigest<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># 2c76b57293ce30acef38d98f6046927161b46a44</span></pre></td></tr></table></figure><p>SHA1 的结果是 160 bit 字节，通常用一个 40 位的 16 进制字符串表示。比 SHA1 更安全的算法是 SHA256 和 SHA512，不过越安全的算法不仅越慢，而且摘要长度更长。</p><blockquote><p>对于两个完全不同的数据，它们通过摘要算法计算出的结果是有可能一样的，但是这种几率十分小。</p></blockquote><p>MD5 算法经常应用在用户账号密码中，但是对于一些常规的高频的密码，通过 MD5 算法加密的结果也是固定的，为了保证用户的账号安全，可以在加密的时候对用户的密码进行加盐处理，这样能保证用户的密码通过加密后的结果不会与常规字符串加密后的结果相同。</p><p>摘要算法在很多地方都有广泛的应用。要注意摘要算法不是加密算法，不能用于加密（因为无法通过摘要反推明文），只能用于防篡改，但是它的单向计算特性决定了可以在不存储明文口令的情况下验证用户口令。</p><h4 id="hmac"><a class="anchor" href="#hmac">#</a> hmac</h4><p>Hmac（Keyed-Hashing for Message Authentication）通过一个标准算法，在计算哈希的过程中，将 key 混入计算过程中，和我们自定义的加 salt 算法不同，Hmac 算法针对所有哈希算法都通用，无论是 MD5 还是 SHA-1。采用 Hmac 替代我们自己的 salt 算法，可以使程序算法更标准化，也更安全。</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">import</span> hmac</pre></td></tr><tr><td data-num="2"></td><td><pre></pre></td></tr><tr><td data-num="3"></td><td><pre>message <span class="token operator">=</span> <span class="token string">b'Hi, boy!'</span></pre></td></tr><tr><td data-num="4"></td><td><pre>key <span class="token operator">=</span> <span class="token string">b'randomkey'</span></pre></td></tr><tr><td data-num="5"></td><td><pre>h <span class="token operator">=</span> hmac<span class="token punctuation">.</span>new<span class="token punctuation">(</span>key<span class="token punctuation">,</span> message<span class="token punctuation">,</span> digestmod<span class="token operator">=</span><span class="token string">'MD5'</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="6"></td><td><pre>h<span class="token punctuation">.</span>update<span class="token punctuation">(</span><span class="token string">b' how are you?'</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="7"></td><td><pre>r <span class="token operator">=</span> h<span class="token punctuation">.</span>hexdigest<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span>r<span class="token punctuation">)</span>  <span class="token comment"># ae64cbf0742a13a1c8e2e3341779d2b3</span></pre></td></tr></table></figure><p>hmac 和普通 hash 算法非常类似。hmac 输出的长度和原始哈希算法的长度一致。但注意传入的 key 和 message 都是 <code>bytes</code> 类型， <code>str</code> 类型需要首先编码为 <code>bytes</code> 。</p><h4 id="itertools"><a class="anchor" href="#itertools">#</a> itertools</h4><p>Python 的内建模块 <code>itertools</code> 提供了非常有用的用于操作迭代对象的函数。</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">import</span> itertools</pre></td></tr><tr><td data-num="2"></td><td><pre></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token comment"># 无限自然数序列</span></pre></td></tr><tr><td data-num="4"></td><td><pre>iter_num <span class="token operator">=</span> itertools<span class="token punctuation">.</span>count<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token keyword">for</span> n <span class="token keyword">in</span> iter_num<span class="token punctuation">:</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    <span class="token keyword">print</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span>  <span class="token comment"># print Ctrl+C to stop</span></pre></td></tr><tr><td data-num="7"></td><td><pre></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token comment"># 字符无限循环</span></pre></td></tr><tr><td data-num="9"></td><td><pre>iter_str <span class="token operator">=</span> itertools<span class="token punctuation">.</span>cycle<span class="token punctuation">(</span><span class="token string">'ABCD'</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token keyword">for</span> n <span class="token keyword">in</span> iter_str<span class="token punctuation">:</span></pre></td></tr><tr><td data-num="11"></td><td><pre>    <span class="token keyword">print</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span>  <span class="token comment"># print Ctrl+C to stop</span></pre></td></tr><tr><td data-num="12"></td><td><pre></pre></td></tr><tr><td data-num="13"></td><td><pre><span class="token comment"># 将指定内容重复指定次数</span></pre></td></tr><tr><td data-num="14"></td><td><pre>iter_repeat <span class="token operator">=</span> itertools<span class="token punctuation">.</span>repeat<span class="token punctuation">(</span><span class="token string">'AB'</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="15"></td><td><pre><span class="token keyword">for</span> n <span class="token keyword">in</span> iter_repeat<span class="token punctuation">:</span></pre></td></tr><tr><td data-num="16"></td><td><pre>    <span class="token keyword">print</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="17"></td><td><pre></pre></td></tr><tr><td data-num="18"></td><td><pre><span class="token comment"># takewhile ()：从无限序列中根据条件截取有限序列</span></pre></td></tr><tr><td data-num="19"></td><td><pre>iter_takewhile <span class="token operator">=</span> itertools<span class="token punctuation">.</span>count<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="20"></td><td><pre>r <span class="token operator">=</span> itertools<span class="token punctuation">.</span>takewhile<span class="token punctuation">(</span><span class="token keyword">lambda</span> x<span class="token punctuation">:</span> x <span class="token operator">&lt;=</span> <span class="token number">5</span><span class="token punctuation">,</span> iter_takewhile<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="21"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">list</span><span class="token punctuation">(</span>r<span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># [1, 2, 3, 4, 5]</span></pre></td></tr><tr><td data-num="22"></td><td><pre></pre></td></tr><tr><td data-num="23"></td><td><pre><span class="token comment"># chain ()：将多个迭代对象串联起来</span></pre></td></tr><tr><td data-num="24"></td><td><pre>chin_list <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span></pre></td></tr><tr><td data-num="25"></td><td><pre><span class="token keyword">for</span> c <span class="token keyword">in</span> itertools<span class="token punctuation">.</span>chain<span class="token punctuation">(</span><span class="token string">'ABC'</span><span class="token punctuation">,</span> <span class="token string">'XYZ'</span><span class="token punctuation">,</span> <span class="token string">'O'</span><span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="26"></td><td><pre>    chin_list<span class="token punctuation">.</span>append<span class="token punctuation">(</span>c<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="27"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span>chin_list<span class="token punctuation">)</span>  <span class="token comment"># ['A', 'B', 'C', 'X', 'Y', 'Z', 'O']</span></pre></td></tr><tr><td data-num="28"></td><td><pre></pre></td></tr><tr><td data-num="29"></td><td><pre><span class="token comment"># groupby ()：将迭代对象中连续的相同元素进行分组（可以指定规则）</span></pre></td></tr><tr><td data-num="30"></td><td><pre>list_group <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span></pre></td></tr><tr><td data-num="31"></td><td><pre><span class="token keyword">for</span> key<span class="token punctuation">,</span> group <span class="token keyword">in</span> itertools<span class="token punctuation">.</span>groupby<span class="token punctuation">(</span><span class="token string">'AaaBBbaAcC'</span><span class="token punctuation">,</span> <span class="token keyword">lambda</span> c<span class="token punctuation">:</span> c<span class="token punctuation">.</span>upper<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="32"></td><td><pre>    list_sub <span class="token operator">=</span> <span class="token punctuation">[</span>key<span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span><span class="token builtin">list</span><span class="token punctuation">(</span>group<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">]</span></pre></td></tr><tr><td data-num="33"></td><td><pre>    list_group<span class="token punctuation">.</span>append<span class="token punctuation">(</span>list_sub<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="34"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span>list_group<span class="token punctuation">)</span>  <span class="token comment"># [['A', 'Aaa'], ['B', 'BBb'], ['A', 'aA'], ['C', 'cC']]</span></pre></td></tr></table></figure><p>itertools 生成的迭代对象，其内部的元素只有在进行迭代的时候才会生成。</p><h4 id="contextlib"><a class="anchor" href="#contextlib">#</a> contextlib</h4><p>在 Python 中，在进行文件读写后，需要对显式关闭文件，但为了使用方便，也可以使用 <code>with</code> 语句进行简化。但实际上，with 语句不只适用于 IO 操作，而是适用于任何正确实现上下文管理的对象，而上下文管理是通过 <code>__enter__</code> 和 <code>__exit__</code> 方法来实现的，如下：</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">class</span> <span class="token class-name">Query</span><span class="token punctuation">(</span><span class="token builtin">object</span><span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> name<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="3"></td><td><pre>        self<span class="token punctuation">.</span>name <span class="token operator">=</span> name</pre></td></tr><tr><td data-num="4"></td><td><pre></pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token keyword">def</span> <span class="token function">__enter__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="6"></td><td><pre>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Query start -->'</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="7"></td><td><pre>        <span class="token keyword">return</span> self</pre></td></tr><tr><td data-num="8"></td><td><pre></pre></td></tr><tr><td data-num="9"></td><td><pre>    <span class="token keyword">def</span> <span class="token function">__exit__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> exc_type<span class="token punctuation">,</span> exc_value<span class="token punctuation">,</span> traceback<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="10"></td><td><pre>        <span class="token keyword">if</span> exc_type<span class="token punctuation">:</span></pre></td></tr><tr><td data-num="11"></td><td><pre>            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'---- [Something Error] ----'</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="12"></td><td><pre>        <span class="token keyword">else</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="13"></td><td><pre>            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'&lt;-- Query end'</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="14"></td><td><pre></pre></td></tr><tr><td data-num="15"></td><td><pre>    <span class="token keyword">def</span> <span class="token function">query</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="16"></td><td><pre>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Query info about %s...'</span> <span class="token operator">%</span> self<span class="token punctuation">.</span>name<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="17"></td><td><pre></pre></td></tr><tr><td data-num="18"></td><td><pre><span class="token keyword">with</span> Query<span class="token punctuation">(</span><span class="token string">'Baidu'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> q<span class="token punctuation">:</span></pre></td></tr><tr><td data-num="19"></td><td><pre>    q<span class="token punctuation">.</span>query<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="20"></td><td><pre></pre></td></tr><tr><td data-num="21"></td><td><pre><span class="token comment"># Query start --></span></pre></td></tr><tr><td data-num="22"></td><td><pre><span class="token comment"># Query info about Baidu...</span></pre></td></tr><tr><td data-num="23"></td><td><pre><span class="token comment"># &lt;-- Query end</span></pre></td></tr></table></figure><p>对于需要进行上下文管理的对象，也可以使用 Python 的标准库 <code>contextlib</code> 进行简化书写：</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">from</span> contextlib <span class="token keyword">import</span> contextmanager</pre></td></tr><tr><td data-num="2"></td><td><pre></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">class</span> <span class="token class-name">Query</span><span class="token punctuation">(</span><span class="token builtin">object</span><span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> name<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="5"></td><td><pre>        self<span class="token punctuation">.</span>name <span class="token operator">=</span> name</pre></td></tr><tr><td data-num="6"></td><td><pre></pre></td></tr><tr><td data-num="7"></td><td><pre>    <span class="token keyword">def</span> <span class="token function">query</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="8"></td><td><pre>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Query info about %s...'</span> <span class="token operator">%</span> self<span class="token punctuation">.</span>name<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="9"></td><td><pre></pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token decorator annotation punctuation">@contextmanager</span></pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token keyword">def</span> <span class="token function">create_query</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="12"></td><td><pre>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Query start -->'</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="13"></td><td><pre>    <span class="token keyword">yield</span> Query<span class="token punctuation">(</span>name<span class="token punctuation">)</span>  <span class="token comment"># 执行 with 语句块中的内容</span></pre></td></tr><tr><td data-num="14"></td><td><pre>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'&lt;-- Query end'</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="15"></td><td><pre></pre></td></tr><tr><td data-num="16"></td><td><pre><span class="token keyword">with</span> create_query<span class="token punctuation">(</span><span class="token string">'Baidu'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> q<span class="token punctuation">:</span></pre></td></tr><tr><td data-num="17"></td><td><pre>    q<span class="token punctuation">.</span>query<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="18"></td><td><pre></pre></td></tr><tr><td data-num="19"></td><td><pre><span class="token comment"># Query start --></span></pre></td></tr><tr><td data-num="20"></td><td><pre><span class="token comment"># Query info about Baidu...</span></pre></td></tr><tr><td data-num="21"></td><td><pre><span class="token comment"># &lt;-- Query end</span></pre></td></tr></table></figure><p>其中， <code>yield</code> 语句相当于调用执行了 with 语句块中的代码内容。yield 语句前后的代码，将分别在 with 语句块执行前后执行，它们之间的执行顺序为：</p><ol><li>with 语句执行 yield 之前的代码。</li><li>yield 调用执行 with 语句块中的代码。</li><li>执行 yield 之后的代码。</li></ol><p>如果一个对象没有实现上下文，那么它就不能用于 with 语句，但我们可以使用 <code>closing()</code> 来将普通对象变为上下文对象，例如：</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">from</span> contextlib <span class="token keyword">import</span> closing</pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">from</span> urllib<span class="token punctuation">.</span>request <span class="token keyword">import</span> urlopen</pre></td></tr><tr><td data-num="3"></td><td><pre></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token comment"># 获取 python 官网 html 内容</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token keyword">with</span> closing<span class="token punctuation">(</span>urlopen<span class="token punctuation">(</span><span class="token string">'https://www.python.org'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">as</span> page<span class="token punctuation">:</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    <span class="token keyword">for</span> line <span class="token keyword">in</span> page<span class="token punctuation">:</span></pre></td></tr><tr><td data-num="7"></td><td><pre>        <span class="token keyword">print</span><span class="token punctuation">(</span>line<span class="token punctuation">)</span></pre></td></tr></table></figure><p>但其实，closing 函数在源码中的定义也很简单：</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">class</span> <span class="token class-name">closing</span><span class="token punctuation">(</span>AbstractContextManager<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> thing<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="3"></td><td><pre>        self<span class="token punctuation">.</span>thing <span class="token operator">=</span> thing</pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token keyword">def</span> <span class="token function">__enter__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="5"></td><td><pre>        <span class="token keyword">return</span> self<span class="token punctuation">.</span>thing</pre></td></tr><tr><td data-num="6"></td><td><pre>    <span class="token keyword">def</span> <span class="token function">__exit__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> <span class="token operator">*</span>exc_info<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="7"></td><td><pre>        self<span class="token punctuation">.</span>thing<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr></table></figure><p>它本质上也是定义了 <code>__enter__</code> 和 <code>__exit__</code> 方法使对象实现了上下文管理。</p><h4 id="urllib"><a class="anchor" href="#urllib">#</a> urllib</h4><p>urllib 提供了一系列操作 URL 的功能，它可以模拟浏览器发送网络请求。</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">from</span> contextlib <span class="token keyword">import</span> closing</pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">from</span> urllib <span class="token keyword">import</span> request</pre></td></tr><tr><td data-num="3"></td><td><pre></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token comment"># 获取百度首页 html 内容</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token keyword">with</span> closing<span class="token punctuation">(</span>request<span class="token punctuation">.</span>urlopen<span class="token punctuation">(</span><span class="token string">'https://www.baidu.com'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    data <span class="token operator">=</span> f<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="7"></td><td><pre>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Status:'</span><span class="token punctuation">,</span> f<span class="token punctuation">.</span>status<span class="token punctuation">,</span> f<span class="token punctuation">.</span>reason<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="8"></td><td><pre>    <span class="token keyword">for</span> k<span class="token punctuation">,</span> v <span class="token keyword">in</span> f<span class="token punctuation">.</span>getheaders<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="9"></td><td><pre>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'%s: %s'</span> <span class="token operator">%</span> <span class="token punctuation">(</span>k<span class="token punctuation">,</span> v<span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="10"></td><td><pre>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Data:'</span><span class="token punctuation">,</span> data<span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr></table></figure><p>同时，在发送请求时，也可以指定请求头信息：</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">from</span> contextlib <span class="token keyword">import</span> closing</pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">from</span> urllib <span class="token keyword">import</span> request</pre></td></tr><tr><td data-num="3"></td><td><pre></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token comment"># 获取百度首页 html 内容（模拟 iPhone 的移动版）</span></pre></td></tr><tr><td data-num="5"></td><td><pre>req <span class="token operator">=</span> request<span class="token punctuation">.</span>Request<span class="token punctuation">(</span><span class="token string">'http://www.baidu.com/'</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="6"></td><td><pre>req<span class="token punctuation">.</span>add_header<span class="token punctuation">(</span><span class="token string">'User-Agent'</span><span class="token punctuation">,</span> <span class="token string">'Mozilla/6.0 (iPhone; CPU iPhone OS 8_0 like Mac OS X) AppleWebKit/536.26 (KHTML, like Gecko) Version/8.0 Mobile/10A5376e Safari/8536.25'</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token keyword">with</span> closing<span class="token punctuation">(</span>request<span class="token punctuation">.</span>urlopen<span class="token punctuation">(</span>req<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span></pre></td></tr><tr><td data-num="8"></td><td><pre>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Status:'</span><span class="token punctuation">,</span> f<span class="token punctuation">.</span>status<span class="token punctuation">,</span> f<span class="token punctuation">.</span>reason<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="9"></td><td><pre>    <span class="token keyword">for</span> k<span class="token punctuation">,</span> v <span class="token keyword">in</span> f<span class="token punctuation">.</span>getheaders<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="10"></td><td><pre>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'%s: %s'</span> <span class="token operator">%</span> <span class="token punctuation">(</span>k<span class="token punctuation">,</span> v<span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="11"></td><td><pre>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Data:'</span><span class="token punctuation">,</span> f<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr></table></figure><p>如需模拟 post 请求，则需要将数据以 bytes 的形式传入，例如：</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">from</span> contextlib <span class="token keyword">import</span> closing</pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">from</span> urllib <span class="token keyword">import</span> request<span class="token punctuation">,</span> parse</pre></td></tr><tr><td data-num="3"></td><td><pre></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Welcome to login xxx...'</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="5"></td><td><pre>email <span class="token operator">=</span> <span class="token builtin">input</span><span class="token punctuation">(</span><span class="token string">'Email: '</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="6"></td><td><pre>passwd <span class="token operator">=</span> <span class="token builtin">input</span><span class="token punctuation">(</span><span class="token string">'Password: '</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="7"></td><td><pre>login_data <span class="token operator">=</span> parse<span class="token punctuation">.</span>urlencode<span class="token punctuation">(</span><span class="token punctuation">[</span></pre></td></tr><tr><td data-num="8"></td><td><pre>    <span class="token punctuation">(</span><span class="token string">'username'</span><span class="token punctuation">,</span> email<span class="token punctuation">)</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="9"></td><td><pre>    <span class="token punctuation">(</span><span class="token string">'password'</span><span class="token punctuation">,</span> passwd<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token punctuation">]</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="11"></td><td><pre></pre></td></tr><tr><td data-num="12"></td><td><pre>req <span class="token operator">=</span> request<span class="token punctuation">.</span>Request<span class="token punctuation">(</span><span class="token string">'https://www.youhost.com/login'</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="13"></td><td><pre><span class="token keyword">with</span> closing<span class="token punctuation">(</span>request<span class="token punctuation">.</span>urlopen<span class="token punctuation">(</span>req<span class="token punctuation">,</span> data<span class="token operator">=</span>login_data<span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span></pre></td></tr><tr><td data-num="14"></td><td><pre>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Status:'</span><span class="token punctuation">,</span> f<span class="token punctuation">.</span>status<span class="token punctuation">,</span> f<span class="token punctuation">.</span>reason<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="15"></td><td><pre>    <span class="token keyword">for</span> k<span class="token punctuation">,</span> v <span class="token keyword">in</span> f<span class="token punctuation">.</span>getheaders<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="16"></td><td><pre>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'%s: %s'</span> <span class="token operator">%</span> <span class="token punctuation">(</span>k<span class="token punctuation">,</span> v<span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="17"></td><td><pre>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Data:'</span><span class="token punctuation">,</span> f<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr></table></figure><h4 id="xml"><a class="anchor" href="#xml">#</a> XML</h4><p>操作 XML 有两种方法：DOM 和 SAX。DOM 会把整个 XML 读入内存，解析为树，因此占用内存大，解析慢，优点是可以任意遍历树的节点。SAX 是流模式，边读边解析，占用内存小，解析快，缺点是我们需要自己处理事件。</p><p>在 Python 中使用 SAX 解析 XML 非常简洁，它通常会产生三个事件：</p><ol><li>start_element：xml 元素开始标签。</li><li>char_data：xml 元素环绕内容。</li><li>end_element：xml 元素结束标签。</li></ol><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">from</span> xml<span class="token punctuation">.</span>parsers<span class="token punctuation">.</span>expat <span class="token keyword">import</span> ParserCreate</pre></td></tr><tr><td data-num="2"></td><td><pre></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">class</span> <span class="token class-name">DefaultSaxHandler</span><span class="token punctuation">(</span><span class="token builtin">object</span><span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token keyword">def</span> <span class="token function">start_element</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> name<span class="token punctuation">,</span> attrs<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="5"></td><td><pre>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'sax:start_element: %s, attrs: %s'</span> <span class="token operator">%</span> <span class="token punctuation">(</span>name<span class="token punctuation">,</span> <span class="token builtin">str</span><span class="token punctuation">(</span>attrs<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="6"></td><td><pre></pre></td></tr><tr><td data-num="7"></td><td><pre>    <span class="token keyword">def</span> <span class="token function">end_element</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> name<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="8"></td><td><pre>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'sax:end_element: %s'</span> <span class="token operator">%</span> name<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="9"></td><td><pre></pre></td></tr><tr><td data-num="10"></td><td><pre>    <span class="token keyword">def</span> <span class="token function">char_data</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> text<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="11"></td><td><pre>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'sax:char_data: %s'</span> <span class="token operator">%</span> text<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="12"></td><td><pre></pre></td></tr><tr><td data-num="13"></td><td><pre></pre></td></tr><tr><td data-num="14"></td><td><pre>xml <span class="token operator">=</span> <span class="token triple-quoted-string string">r'''&lt;?xml version="1.0"?></span></pre></td></tr><tr><td data-num="15"></td><td><pre>&lt;ol></pre></td></tr><tr><td data-num="16"></td><td><pre>    &lt;li>&lt;a href="/python">Python&lt;/a>&lt;/li></pre></td></tr><tr><td data-num="17"></td><td><pre>    &lt;li>&lt;a href="/java">Java&lt;/a>&lt;/li></pre></td></tr><tr><td data-num="18"></td><td><pre>&lt;/ol></pre></td></tr><tr><td data-num="19"></td><td><pre>'''</pre></td></tr><tr><td data-num="20"></td><td><pre></pre></td></tr><tr><td data-num="21"></td><td><pre>handler <span class="token operator">=</span> DefaultSaxHandler<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="22"></td><td><pre>parser <span class="token operator">=</span> ParserCreate<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="23"></td><td><pre>parser<span class="token punctuation">.</span>StartElementHandler <span class="token operator">=</span> handler<span class="token punctuation">.</span>start_element</pre></td></tr><tr><td data-num="24"></td><td><pre>parser<span class="token punctuation">.</span>EndElementHandler <span class="token operator">=</span> handler<span class="token punctuation">.</span>end_element</pre></td></tr><tr><td data-num="25"></td><td><pre>parser<span class="token punctuation">.</span>CharacterDataHandler <span class="token operator">=</span> handler<span class="token punctuation">.</span>char_data</pre></td></tr><tr><td data-num="26"></td><td><pre>parser<span class="token punctuation">.</span>Parse<span class="token punctuation">(</span>xml<span class="token punctuation">)</span></pre></td></tr></table></figure><blockquote><p>相比 JSON 而言，XML 较为复杂，组装数据也很不方便，推荐优先使用 JSON。</p></blockquote><h4 id="htmlparser"><a class="anchor" href="#htmlparser">#</a> HTMLParser</h4><p>HTML 本质上是 XML 的子集，但是 HTML 的语法没有 XML 那么严格，所以不能用标准的 DOM 或 SAX 来解析 HTML。Python 为此提供了 HTMLParser 来非常方便地解析 HTML。</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">from</span> html<span class="token punctuation">.</span>parser <span class="token keyword">import</span> HTMLParser</pre></td></tr><tr><td data-num="2"></td><td><pre></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">class</span> <span class="token class-name">MyHTMLParser</span><span class="token punctuation">(</span>HTMLParser<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token keyword">def</span> <span class="token function">handle_starttag</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> tag<span class="token punctuation">,</span> attrs<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="5"></td><td><pre>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'&lt;%s>'</span> <span class="token operator">%</span> tag<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="6"></td><td><pre></pre></td></tr><tr><td data-num="7"></td><td><pre>    <span class="token keyword">def</span> <span class="token function">handle_endtag</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> tag<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="8"></td><td><pre>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'&lt;/%s>'</span> <span class="token operator">%</span> tag<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="9"></td><td><pre></pre></td></tr><tr><td data-num="10"></td><td><pre>    <span class="token keyword">def</span> <span class="token function">handle_startendtag</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> tag<span class="token punctuation">,</span> attrs<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="11"></td><td><pre>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'&lt;%s/>'</span> <span class="token operator">%</span> tag<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="12"></td><td><pre></pre></td></tr><tr><td data-num="13"></td><td><pre>    <span class="token keyword">def</span> <span class="token function">handle_data</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> data<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="14"></td><td><pre>        <span class="token keyword">print</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="15"></td><td><pre></pre></td></tr><tr><td data-num="16"></td><td><pre>    <span class="token keyword">def</span> <span class="token function">handle_comment</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> data<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="17"></td><td><pre>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'&lt;!--'</span><span class="token punctuation">,</span> data<span class="token punctuation">,</span> <span class="token string">'-->'</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="18"></td><td><pre></pre></td></tr><tr><td data-num="19"></td><td><pre>    <span class="token keyword">def</span> <span class="token function">handle_entityref</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> name<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="20"></td><td><pre>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'&amp;%s;'</span> <span class="token operator">%</span> name<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="21"></td><td><pre></pre></td></tr><tr><td data-num="22"></td><td><pre>    <span class="token keyword">def</span> <span class="token function">handle_charref</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> name<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="23"></td><td><pre>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'&amp;#%s;'</span> <span class="token operator">%</span> name<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="24"></td><td><pre></pre></td></tr><tr><td data-num="25"></td><td><pre>parser <span class="token operator">=</span> MyHTMLParser<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="26"></td><td><pre>parser<span class="token punctuation">.</span>feed<span class="token punctuation">(</span><span class="token triple-quoted-string string">'''&lt;html></span></pre></td></tr><tr><td data-num="27"></td><td><pre>&lt;head>&lt;/head></pre></td></tr><tr><td data-num="28"></td><td><pre>&lt;body></pre></td></tr><tr><td data-num="29"></td><td><pre>&lt;!-- test html parser --></pre></td></tr><tr><td data-num="30"></td><td><pre>    &lt;p>Some &lt;a href=\"#\">html&lt;/a> HTML&amp;nbsp;tutorial...&lt;br>END&lt;/p></pre></td></tr><tr><td data-num="31"></td><td><pre>&lt;/body>&lt;/html>'''<span class="token punctuation">)</span></pre></td></tr></table></figure><p><code>feed()</code> 方法可以多次调用，因此，对于一个 HTML 字符串，也可以进行分段处理。</p><h3 id="常用第三方模块"><a class="anchor" href="#常用第三方模块">#</a> 常用第三方模块</h3><p>基本上 Python 所有第三方模块都会在 <span class="exturl" data-url="aHR0cHM6Ly9weXBpLnB5dGhvbi5vcmcv">PyPI - the Python Package Index</span> 进行注册，需要使用时，直接通过 pip 进行安装即可。</p><h4 id="pillow"><a class="anchor" href="#pillow">#</a> Pillow</h4><p>PIL：Python Imaging Library。</p><ol><li><p>安装 Pillow</p><p>如果已经安装 Anaconda，那么 Pillow 可以直接使用，如果未安装 Anaconda，则需要执行命令 <code>pip install pillow</code> 进行安装。</p></li><li><p>使用 Pillow 操作图像</p><p>缩小图像并进行模糊处理：</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">from</span> PIL <span class="token keyword">import</span> Image<span class="token punctuation">,</span> ImageFilter</pre></td></tr><tr><td data-num="2"></td><td><pre></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token comment"># 打开一个 jpg 图像文件，注意是当前路径:</span></pre></td></tr><tr><td data-num="4"></td><td><pre>im <span class="token operator">=</span> Image<span class="token punctuation">.</span><span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'A:\\img\\test.jpg'</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token comment"># 获得图像尺寸:</span></pre></td></tr><tr><td data-num="6"></td><td><pre>w<span class="token punctuation">,</span> h <span class="token operator">=</span> im<span class="token punctuation">.</span>size</pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Original image size: %sx%s'</span> <span class="token operator">%</span> <span class="token punctuation">(</span>w<span class="token punctuation">,</span> h<span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token comment"># 缩放到 50%:</span></pre></td></tr><tr><td data-num="9"></td><td><pre>im<span class="token punctuation">.</span>thumbnail<span class="token punctuation">(</span><span class="token punctuation">(</span>w <span class="token operator">//</span> <span class="token number">2</span><span class="token punctuation">,</span> h <span class="token operator">//</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Resize image to: %sx%s'</span> <span class="token operator">%</span> <span class="token punctuation">(</span>w <span class="token operator">//</span> <span class="token number">2</span><span class="token punctuation">,</span> h <span class="token operator">//</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token comment"># 应用模糊滤镜:</span></pre></td></tr><tr><td data-num="12"></td><td><pre>im2 <span class="token operator">=</span> im<span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span>ImageFilter<span class="token punctuation">.</span>BLUR<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="13"></td><td><pre><span class="token comment"># 把缩放后的图像用 jpeg 格式保存:</span></pre></td></tr><tr><td data-num="14"></td><td><pre>im2<span class="token punctuation">.</span>save<span class="token punctuation">(</span><span class="token string">'A:\\img\\test2.jpg'</span><span class="token punctuation">,</span> <span class="token string">'jpeg'</span><span class="token punctuation">)</span></pre></td></tr></table></figure><p>除了缩放和模糊处理外，还可以进行如切片、旋转、滤镜、输出文字、调色板等一些列图像操作。</p><p>生成验证码图片：</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">from</span> PIL <span class="token keyword">import</span> Image<span class="token punctuation">,</span> ImageDraw<span class="token punctuation">,</span> ImageFont<span class="token punctuation">,</span> ImageFilter</pre></td></tr><tr><td data-num="2"></td><td><pre></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">import</span> random</pre></td></tr><tr><td data-num="4"></td><td><pre></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token comment"># 随机字母:</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token keyword">def</span> <span class="token function">rndChar</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="7"></td><td><pre>    <span class="token keyword">return</span> <span class="token builtin">chr</span><span class="token punctuation">(</span>random<span class="token punctuation">.</span>randint<span class="token punctuation">(</span><span class="token number">65</span><span class="token punctuation">,</span> <span class="token number">90</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="8"></td><td><pre></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token comment"># 随机颜色 1:</span></pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token keyword">def</span> <span class="token function">rndColor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="11"></td><td><pre>    <span class="token keyword">return</span> <span class="token punctuation">(</span>random<span class="token punctuation">.</span>randint<span class="token punctuation">(</span><span class="token number">64</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">,</span> random<span class="token punctuation">.</span>randint<span class="token punctuation">(</span><span class="token number">64</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">,</span> random<span class="token punctuation">.</span>randint<span class="token punctuation">(</span><span class="token number">64</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="12"></td><td><pre></pre></td></tr><tr><td data-num="13"></td><td><pre><span class="token comment"># 随机颜色 2:</span></pre></td></tr><tr><td data-num="14"></td><td><pre><span class="token keyword">def</span> <span class="token function">rndColor2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="15"></td><td><pre>    <span class="token keyword">return</span> <span class="token punctuation">(</span>random<span class="token punctuation">.</span>randint<span class="token punctuation">(</span><span class="token number">32</span><span class="token punctuation">,</span> <span class="token number">127</span><span class="token punctuation">)</span><span class="token punctuation">,</span> random<span class="token punctuation">.</span>randint<span class="token punctuation">(</span><span class="token number">32</span><span class="token punctuation">,</span> <span class="token number">127</span><span class="token punctuation">)</span><span class="token punctuation">,</span> random<span class="token punctuation">.</span>randint<span class="token punctuation">(</span><span class="token number">32</span><span class="token punctuation">,</span> <span class="token number">127</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="16"></td><td><pre></pre></td></tr><tr><td data-num="17"></td><td><pre><span class="token comment"># 240 x 60:</span></pre></td></tr><tr><td data-num="18"></td><td><pre>width <span class="token operator">=</span> <span class="token number">60</span> <span class="token operator">*</span> <span class="token number">4</span></pre></td></tr><tr><td data-num="19"></td><td><pre>height <span class="token operator">=</span> <span class="token number">60</span></pre></td></tr><tr><td data-num="20"></td><td><pre>image <span class="token operator">=</span> Image<span class="token punctuation">.</span>new<span class="token punctuation">(</span><span class="token string">'RGB'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>width<span class="token punctuation">,</span> height<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="21"></td><td><pre><span class="token comment"># 创建 Font 对象:</span></pre></td></tr><tr><td data-num="22"></td><td><pre>font <span class="token operator">=</span> ImageFont<span class="token punctuation">.</span>truetype<span class="token punctuation">(</span><span class="token string">'arial.ttf'</span><span class="token punctuation">,</span> <span class="token number">36</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="23"></td><td><pre><span class="token comment"># 创建 Draw 对象:</span></pre></td></tr><tr><td data-num="24"></td><td><pre>draw <span class="token operator">=</span> ImageDraw<span class="token punctuation">.</span>Draw<span class="token punctuation">(</span>image<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="25"></td><td><pre><span class="token comment"># 填充每个像素:</span></pre></td></tr><tr><td data-num="26"></td><td><pre><span class="token keyword">for</span> x <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>width<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="27"></td><td><pre>    <span class="token keyword">for</span> y <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>height<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="28"></td><td><pre>        draw<span class="token punctuation">.</span>point<span class="token punctuation">(</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">,</span> fill<span class="token operator">=</span>rndColor<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="29"></td><td><pre><span class="token comment"># 输出文字:</span></pre></td></tr><tr><td data-num="30"></td><td><pre><span class="token keyword">for</span> t <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="31"></td><td><pre>    draw<span class="token punctuation">.</span>text<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">60</span> <span class="token operator">*</span> t <span class="token operator">+</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">,</span> rndChar<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> font<span class="token operator">=</span>font<span class="token punctuation">,</span> fill<span class="token operator">=</span>rndColor2<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="32"></td><td><pre><span class="token comment"># 模糊:</span></pre></td></tr><tr><td data-num="33"></td><td><pre>image <span class="token operator">=</span> image<span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span>ImageFilter<span class="token punctuation">.</span>BLUR<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="34"></td><td><pre>image<span class="token punctuation">.</span>save<span class="token punctuation">(</span><span class="token string">'A:\\img\\captcha.jpg'</span><span class="token punctuation">,</span> <span class="token string">'jpeg'</span><span class="token punctuation">)</span></pre></td></tr></table></figure><p><img data-src="https://img.xfc-exclave.com/2021/09/aefae28314fc57e0bdd4a2986c0eef9a1632739425.jpg" alt="Python生成验证码"></p><blockquote><p>更多好玩的功能，参考官方文档：<span class="exturl" data-url="aHR0cHM6Ly9waWxsb3cucmVhZHRoZWRvY3Mub3Jn">https://pillow.readthedocs.org</span></p></blockquote></li></ol><h4 id="requests"><a class="anchor" href="#requests">#</a> requests</h4><p>相比于 urllib 模块，requests 模块在处理 URL 资源时更加方便。</p><p>如果已经安装 Anaconda，那么 requests 可以直接使用，如果未安装 Anaconda，则需要执行命令 <code>pip install requests</code> 进行安装。</p><p>常用方法示例：</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">import</span> requests</pre></td></tr><tr><td data-num="2"></td><td><pre></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token comment"># GET 请求</span></pre></td></tr><tr><td data-num="4"></td><td><pre>r <span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">"http://www.baidu.com/s"</span><span class="token punctuation">,</span> params<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token string">'wd'</span><span class="token punctuation">:</span> <span class="token string">'python'</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span>r<span class="token punctuation">.</span>url<span class="token punctuation">)</span>  <span class="token comment"># https://www.baidu.com/s?wd=python</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span>r<span class="token punctuation">.</span>encoding<span class="token punctuation">)</span>  <span class="token comment"># ISO-8859-1（requests 自动检测编码）</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span>r<span class="token punctuation">.</span>status_code<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span>r<span class="token punctuation">.</span>text<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span>r<span class="token punctuation">.</span>content<span class="token punctuation">)</span>  <span class="token comment"># 获取响应的 bytes 内容</span></pre></td></tr><tr><td data-num="10"></td><td><pre></pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token comment"># 处理 json 内容</span></pre></td></tr><tr><td data-num="12"></td><td><pre>r2 <span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'https://v2.jinrishici.com/one.json'</span><span class="token punctuation">)</span>  <span class="token comment"># 今日诗词 API</span></pre></td></tr><tr><td data-num="13"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span>r2<span class="token punctuation">.</span>json<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="14"></td><td><pre></pre></td></tr><tr><td data-num="15"></td><td><pre><span class="token comment"># 设置请求头</span></pre></td></tr><tr><td data-num="16"></td><td><pre>r3 <span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">"http://www.baidu.com/s"</span><span class="token punctuation">,</span> params<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token string">'wd'</span><span class="token punctuation">:</span> <span class="token string">'python'</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span> headers<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token string">'User-Agent'</span><span class="token punctuation">:</span> <span class="token string">'Mozilla/5.0 (iPhone; CPU iPhone OS 11_0 like Mac OS X) AppleWebKit'</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="17"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span>r3<span class="token punctuation">.</span>text<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="18"></td><td><pre></pre></td></tr><tr><td data-num="19"></td><td><pre><span class="token comment"># POST 请求（默认使用 application/x-www-form-urlencoded 编码）</span></pre></td></tr><tr><td data-num="20"></td><td><pre>r4 <span class="token operator">=</span> requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span><span class="token string">'https://www.test.com/login'</span><span class="token punctuation">,</span> data<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token string">'email'</span><span class="token punctuation">:</span> <span class="token string">'abc@example.com'</span><span class="token punctuation">,</span> <span class="token string">'password'</span><span class="token punctuation">:</span> <span class="token string">'123456'</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="21"></td><td><pre></pre></td></tr><tr><td data-num="22"></td><td><pre><span class="token comment"># POST 传递 JSON 数据</span></pre></td></tr><tr><td data-num="23"></td><td><pre>params <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token string">'email'</span><span class="token punctuation">:</span> <span class="token string">'abc@example.com'</span><span class="token punctuation">,</span> <span class="token string">'password'</span><span class="token punctuation">:</span> <span class="token string">'123456'</span><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="24"></td><td><pre>r5 <span class="token operator">=</span> requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span><span class="token string">'https://www.test.com/login'</span><span class="token punctuation">,</span> json<span class="token operator">=</span>params<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="25"></td><td><pre></pre></td></tr><tr><td data-num="26"></td><td><pre><span class="token comment"># POST 上传文件</span></pre></td></tr><tr><td data-num="27"></td><td><pre>upload_files <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token string">'file'</span><span class="token punctuation">:</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'A:\\xls\\test.xls'</span><span class="token punctuation">,</span> <span class="token string">'rb'</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span>  <span class="token comment"># 注意使用 rb 读取，保证文件完整</span></pre></td></tr><tr><td data-num="28"></td><td><pre>r6 <span class="token operator">=</span> requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span><span class="token string">'https://www.test.com/upload'</span><span class="token punctuation">,</span> files<span class="token operator">=</span>upload_files<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="29"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span>r6<span class="token punctuation">.</span>headers<span class="token punctuation">)</span>  <span class="token comment"># 获取响应头信息</span></pre></td></tr><tr><td data-num="30"></td><td><pre></pre></td></tr><tr><td data-num="31"></td><td><pre><span class="token comment"># Cookies 传送与接收、请求超时</span></pre></td></tr><tr><td data-num="32"></td><td><pre>cs <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token string">'token'</span><span class="token punctuation">:</span> <span class="token string">'123456'</span><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="33"></td><td><pre>r7 <span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'https://www.test.com/testCookies'</span><span class="token punctuation">,</span> cookies<span class="token operator">=</span>cs<span class="token punctuation">,</span> timeout<span class="token operator">=</span><span class="token number">2.5</span><span class="token punctuation">)</span>  <span class="token comment"># 2.5 秒后超时</span></pre></td></tr><tr><td data-num="34"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span>r<span class="token punctuation">.</span>cookies<span class="token punctuation">[</span><span class="token string">'status'</span><span class="token punctuation">]</span><span class="token punctuation">)</span></pre></td></tr></table></figure><h4 id="chardet"><a class="anchor" href="#chardet">#</a> chardet</h4><p>chardet 主要用于检测编码。</p><p>如果已经安装 Anaconda，那么 chardet 可以直接使用，如果未安装 Anaconda，则需要执行命令 <code>pip install chardet</code> 进行安装。</p><p>常用方法示例：</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">import</span> chardet <span class="token keyword">as</span> chardet</pre></td></tr><tr><td data-num="2"></td><td><pre></pre></td></tr><tr><td data-num="3"></td><td><pre>ce <span class="token operator">=</span> chardet<span class="token punctuation">.</span>detect<span class="token punctuation">(</span><span class="token string">b'Hello, world!'</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span>ce<span class="token punctuation">)</span>  <span class="token comment"># &#123;'encoding': 'ascii', 'confidence': 1.0, 'language': ''&#125;</span></pre></td></tr><tr><td data-num="5"></td><td><pre></pre></td></tr><tr><td data-num="6"></td><td><pre>data <span class="token operator">=</span> <span class="token string">'一帷风动百虫绝，连月推山雪见归'</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token string">'gbk'</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span>chardet<span class="token punctuation">.</span>detect<span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># &#123;'encoding': 'GB2312', 'confidence': 0.99, 'language': 'Chinese'&#125;</span></pre></td></tr><tr><td data-num="8"></td><td><pre></pre></td></tr><tr><td data-num="9"></td><td><pre>data <span class="token operator">=</span> <span class="token string">'一帷风动百虫绝，连月推山雪见归'</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span>chardet<span class="token punctuation">.</span>detect<span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># &#123;'encoding': 'utf-8', 'confidence': 0.99, 'language': ''&#125;</span></pre></td></tr><tr><td data-num="11"></td><td><pre></pre></td></tr><tr><td data-num="12"></td><td><pre>data <span class="token operator">=</span> <span class="token string">'チンモクのブログ'</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token string">'euc-jp'</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="13"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span>chardet<span class="token punctuation">.</span>detect<span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># &#123;'encoding': 'EUC-JP', 'confidence': 0.99, 'language': 'Japanese'&#125;</span></pre></td></tr></table></figure><p>通过编码检测后，再进行内容解码，能够有效避免很多转码异常。</p><h4 id="psutil"><a class="anchor" href="#psutil">#</a> psutil</h4><p>psutil: process and system utilities，可以用于获取系统信息，并且支持跨平台使用。</p><p>如果已经安装 Anaconda，那么 psutil 可以直接使用，如果未安装 Anaconda，则需要执行命令 <code>pip install psutil</code> 进行安装。</p><p>常用方法示例：</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">import</span> psutil</pre></td></tr><tr><td data-num="2"></td><td><pre></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token comment"># 获取 CPU 逻辑数量</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span>psutil<span class="token punctuation">.</span>cpu_count<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># 8</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token comment"># 获取 CPU 物理核心</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span>psutil<span class="token punctuation">.</span>cpu_count<span class="token punctuation">(</span>logical<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># 8</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token comment"># 统计 CPU 的用户／系统／空闲时间</span></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span>psutil<span class="token punctuation">.</span>cpu_times<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment">#</span></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token comment"># 实现类似 top 命令的 CPU 使用率，每秒刷新一次</span></pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token keyword">for</span> x <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="11"></td><td><pre>    <span class="token keyword">print</span><span class="token punctuation">(</span>psutil<span class="token punctuation">.</span>cpu_percent<span class="token punctuation">(</span>interval<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> percpu<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="12"></td><td><pre><span class="token comment"># 获取物理内存信息</span></pre></td></tr><tr><td data-num="13"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span>psutil<span class="token punctuation">.</span>virtual_memory<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="14"></td><td><pre><span class="token comment"># svmem(total=25701597184, available=17957904384, percent=30.1, used=7743692800, free=17957904384)</span></pre></td></tr><tr><td data-num="15"></td><td><pre><span class="token comment"># 获取交换内存信息</span></pre></td></tr><tr><td data-num="16"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span>psutil<span class="token punctuation">.</span>swap_memory<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="17"></td><td><pre><span class="token comment"># sswap(total=29459693568, used=12058066944, free=17401626624, percent=40.9, sin=0, sout=0)</span></pre></td></tr><tr><td data-num="18"></td><td><pre><span class="token comment"># 获取磁盘信息</span></pre></td></tr><tr><td data-num="19"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span>psutil<span class="token punctuation">.</span>disk_partitions<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># 磁盘分区信息</span></pre></td></tr><tr><td data-num="20"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span>psutil<span class="token punctuation">.</span>disk_usage<span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># 磁盘使用情况</span></pre></td></tr><tr><td data-num="21"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span>psutil<span class="token punctuation">.</span>disk_io_counters<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># 磁盘 IO</span></pre></td></tr><tr><td data-num="22"></td><td><pre><span class="token comment"># 获取网络信息</span></pre></td></tr><tr><td data-num="23"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span>psutil<span class="token punctuation">.</span>net_io_counters<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># 获取网络读写字节／包的个数</span></pre></td></tr><tr><td data-num="24"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span>psutil<span class="token punctuation">.</span>net_if_addrs<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># 获取网络接口信息</span></pre></td></tr><tr><td data-num="25"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span>psutil<span class="token punctuation">.</span>net_if_stats<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># 获取网络接口状态</span></pre></td></tr><tr><td data-num="26"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span>psutil<span class="token punctuation">.</span>net_connections<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># 获取当前网络连接信息</span></pre></td></tr><tr><td data-num="27"></td><td><pre><span class="token comment"># 获取进程信息</span></pre></td></tr><tr><td data-num="28"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span>psutil<span class="token punctuation">.</span>pids<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># 获取所有进程</span></pre></td></tr><tr><td data-num="29"></td><td><pre>p <span class="token operator">=</span> psutil<span class="token punctuation">.</span>Process<span class="token punctuation">(</span><span class="token number">1300</span><span class="token punctuation">)</span>  <span class="token comment"># 获取指定进程</span></pre></td></tr><tr><td data-num="30"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span>p<span class="token punctuation">.</span>name<span class="token punctuation">)</span>  <span class="token comment"># 进程名称</span></pre></td></tr><tr><td data-num="31"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span>p<span class="token punctuation">.</span>cwd<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># 进程工作目录</span></pre></td></tr><tr><td data-num="32"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span>p<span class="token punctuation">.</span>cmdline<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># 进程启动的命令行</span></pre></td></tr><tr><td data-num="33"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span>p<span class="token punctuation">.</span>ppid<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># 父进程 ID</span></pre></td></tr><tr><td data-num="34"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span>p<span class="token punctuation">.</span>parent<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># 父进程</span></pre></td></tr><tr><td data-num="35"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span>p<span class="token punctuation">.</span>children<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># 子进程列表</span></pre></td></tr><tr><td data-num="36"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span>p<span class="token punctuation">.</span>status<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># 进程状态</span></pre></td></tr><tr><td data-num="37"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span>p<span class="token punctuation">.</span>create_time<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># 进程创建时间</span></pre></td></tr><tr><td data-num="38"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span>p<span class="token punctuation">.</span>cpu_times<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># 进程使用的 CPU 时间</span></pre></td></tr><tr><td data-num="39"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span>p<span class="token punctuation">.</span>memory_info<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># 进程使用的内存</span></pre></td></tr><tr><td data-num="40"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span>p<span class="token punctuation">.</span>connections<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># 进程相关的网络连接</span></pre></td></tr><tr><td data-num="41"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span>p<span class="token punctuation">.</span>num_threads<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># 进程的线程数量</span></pre></td></tr><tr><td data-num="42"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span>p<span class="token punctuation">.</span>threads<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># 进程的所有线程</span></pre></td></tr><tr><td data-num="43"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span>p<span class="token punctuation">.</span>environ<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># 进程环境变量</span></pre></td></tr><tr><td data-num="44"></td><td><pre>p<span class="token punctuation">.</span>terminate<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment"># 结束进程</span></pre></td></tr></table></figure><blockquote><p>如在实际项目中需要查询相关功能，参考官方文档：<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2dpYW1wYW9sby9wc3V0aWw=">https://github.com/giampaolo/psutil</span></p></blockquote><h3 id="virtualenv"><a class="anchor" href="#virtualenv">#</a> virtualenv</h3><p>如果在同一台主机上，需要使用到多个不同的 Python 运行环境，这时就需要使用 <code>virtualenv</code> 对 Python 环境进行隔离。</p><p>安装 virtualenv：</p><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre>$ pip3 <span class="token function">install</span> virtualenv</pre></td></tr></table></figure><h3 id="图形界面"><a class="anchor" href="#图形界面">#</a> 图形界面</h3><p>Python 支持多种图形界面的第三方库，包括但不限于：</p><ul><li>Tk</li><li>wxWidgets</li><li>Qt</li><li>GTK</li></ul><p>此外，Python 也自带有支持 Tk 的 <code>Tkinter</code> ，无需安装任何包，就可以直接使用。</p><blockquote><p>Tk 是一个图形库，支持多个操作系统，使用 Tcl 语言开发，它会调用操作系统提供的本地 GUI 接口，完成最终的 GUI。而 Tkinter 则对访问 Tk 的接口进行了封装。</p></blockquote><p><img data-src="https://img.xfc-exclave.com/2021/09/9781b3431d0c919dc04554e2670049781632925720.png" alt="Python图形界面"></p><h4 id="海龟绘图"><a class="anchor" href="#海龟绘图">#</a> 海龟绘图</h4><p>绘制长方形：</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment"># 导入 turtle 包的所有内容:</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">from</span> turtle <span class="token keyword">import</span> <span class="token operator">*</span></pre></td></tr><tr><td data-num="3"></td><td><pre></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token comment"># 设置笔刷宽度:</span></pre></td></tr><tr><td data-num="5"></td><td><pre>width<span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="6"></td><td><pre></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token comment"># 前进:</span></pre></td></tr><tr><td data-num="8"></td><td><pre>forward<span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token comment"># 右转 90 度:</span></pre></td></tr><tr><td data-num="10"></td><td><pre>right<span class="token punctuation">(</span><span class="token number">90</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="11"></td><td><pre></pre></td></tr><tr><td data-num="12"></td><td><pre><span class="token comment"># 笔刷颜色:</span></pre></td></tr><tr><td data-num="13"></td><td><pre>pencolor<span class="token punctuation">(</span><span class="token string">'red'</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="14"></td><td><pre>forward<span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="15"></td><td><pre>right<span class="token punctuation">(</span><span class="token number">90</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="16"></td><td><pre></pre></td></tr><tr><td data-num="17"></td><td><pre>pencolor<span class="token punctuation">(</span><span class="token string">'green'</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="18"></td><td><pre>forward<span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="19"></td><td><pre>right<span class="token punctuation">(</span><span class="token number">90</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="20"></td><td><pre></pre></td></tr><tr><td data-num="21"></td><td><pre>pencolor<span class="token punctuation">(</span><span class="token string">'blue'</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="22"></td><td><pre>forward<span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="23"></td><td><pre>right<span class="token punctuation">(</span><span class="token number">90</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="24"></td><td><pre></pre></td></tr><tr><td data-num="25"></td><td><pre><span class="token comment"># 调用 done () 使得窗口等待被关闭，否则将立刻关闭窗口</span></pre></td></tr><tr><td data-num="26"></td><td><pre>done<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr></table></figure><p>结合 Python 的逻辑判断，可以绘制复杂的图像，例如五个五角星：</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">from</span> turtle <span class="token keyword">import</span> <span class="token operator">*</span></pre></td></tr><tr><td data-num="2"></td><td><pre></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">def</span> <span class="token function">drawStar</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    pu<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    goto<span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    pd<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="7"></td><td><pre>    <span class="token comment"># set heading: 0</span></pre></td></tr><tr><td data-num="8"></td><td><pre>    seth<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="9"></td><td><pre>    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="10"></td><td><pre>        fd<span class="token punctuation">(</span><span class="token number">40</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="11"></td><td><pre>        rt<span class="token punctuation">(</span><span class="token number">144</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="12"></td><td><pre></pre></td></tr><tr><td data-num="13"></td><td><pre><span class="token keyword">for</span> x <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">250</span><span class="token punctuation">,</span> <span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="14"></td><td><pre>    drawStar<span class="token punctuation">(</span>x<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="15"></td><td><pre></pre></td></tr><tr><td data-num="16"></td><td><pre>done<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr></table></figure><p>使用递归还可以绘制复杂的图形，例如绘制一棵树：</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">from</span> turtle <span class="token keyword">import</span> <span class="token operator">*</span></pre></td></tr><tr><td data-num="2"></td><td><pre></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token comment"># 设置色彩模式是 RGB:</span></pre></td></tr><tr><td data-num="4"></td><td><pre>colormode<span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="5"></td><td><pre></pre></td></tr><tr><td data-num="6"></td><td><pre>lt<span class="token punctuation">(</span><span class="token number">90</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="7"></td><td><pre></pre></td></tr><tr><td data-num="8"></td><td><pre>lv <span class="token operator">=</span> <span class="token number">14</span></pre></td></tr><tr><td data-num="9"></td><td><pre>l <span class="token operator">=</span> <span class="token number">120</span></pre></td></tr><tr><td data-num="10"></td><td><pre>s <span class="token operator">=</span> <span class="token number">45</span></pre></td></tr><tr><td data-num="11"></td><td><pre></pre></td></tr><tr><td data-num="12"></td><td><pre>width<span class="token punctuation">(</span>lv<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="13"></td><td><pre></pre></td></tr><tr><td data-num="14"></td><td><pre><span class="token comment"># 初始化 RGB 颜色:</span></pre></td></tr><tr><td data-num="15"></td><td><pre>r <span class="token operator">=</span> <span class="token number">0</span></pre></td></tr><tr><td data-num="16"></td><td><pre>g <span class="token operator">=</span> <span class="token number">0</span></pre></td></tr><tr><td data-num="17"></td><td><pre>b <span class="token operator">=</span> <span class="token number">0</span></pre></td></tr><tr><td data-num="18"></td><td><pre>pencolor<span class="token punctuation">(</span>r<span class="token punctuation">,</span> g<span class="token punctuation">,</span> b<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="19"></td><td><pre></pre></td></tr><tr><td data-num="20"></td><td><pre>penup<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="21"></td><td><pre>bk<span class="token punctuation">(</span>l<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="22"></td><td><pre>pendown<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="23"></td><td><pre>fd<span class="token punctuation">(</span>l<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="24"></td><td><pre></pre></td></tr><tr><td data-num="25"></td><td><pre><span class="token keyword">def</span> <span class="token function">draw_tree</span><span class="token punctuation">(</span>l<span class="token punctuation">,</span> level<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="26"></td><td><pre>    <span class="token keyword">global</span> r<span class="token punctuation">,</span> g<span class="token punctuation">,</span> b</pre></td></tr><tr><td data-num="27"></td><td><pre>    <span class="token comment"># save the current pen width</span></pre></td></tr><tr><td data-num="28"></td><td><pre>    w <span class="token operator">=</span> width<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="29"></td><td><pre></pre></td></tr><tr><td data-num="30"></td><td><pre>    <span class="token comment"># narrow the pen width</span></pre></td></tr><tr><td data-num="31"></td><td><pre>    width<span class="token punctuation">(</span>w <span class="token operator">*</span> <span class="token number">3.0</span> <span class="token operator">/</span> <span class="token number">4.0</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="32"></td><td><pre>    <span class="token comment"># set color:</span></pre></td></tr><tr><td data-num="33"></td><td><pre>    r <span class="token operator">=</span> r <span class="token operator">+</span> <span class="token number">1</span></pre></td></tr><tr><td data-num="34"></td><td><pre>    g <span class="token operator">=</span> g <span class="token operator">+</span> <span class="token number">2</span></pre></td></tr><tr><td data-num="35"></td><td><pre>    b <span class="token operator">=</span> b <span class="token operator">+</span> <span class="token number">3</span></pre></td></tr><tr><td data-num="36"></td><td><pre>    pencolor<span class="token punctuation">(</span>r <span class="token operator">%</span> <span class="token number">200</span><span class="token punctuation">,</span> g <span class="token operator">%</span> <span class="token number">200</span><span class="token punctuation">,</span> b <span class="token operator">%</span> <span class="token number">200</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="37"></td><td><pre></pre></td></tr><tr><td data-num="38"></td><td><pre>    l <span class="token operator">=</span> <span class="token number">3.0</span> <span class="token operator">/</span> <span class="token number">4.0</span> <span class="token operator">*</span> l</pre></td></tr><tr><td data-num="39"></td><td><pre></pre></td></tr><tr><td data-num="40"></td><td><pre>    lt<span class="token punctuation">(</span>s<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="41"></td><td><pre>    fd<span class="token punctuation">(</span>l<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="42"></td><td><pre></pre></td></tr><tr><td data-num="43"></td><td><pre>    <span class="token keyword">if</span> level <span class="token operator">&lt;</span> lv<span class="token punctuation">:</span></pre></td></tr><tr><td data-num="44"></td><td><pre>        draw_tree<span class="token punctuation">(</span>l<span class="token punctuation">,</span> level <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="45"></td><td><pre>    bk<span class="token punctuation">(</span>l<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="46"></td><td><pre>    rt<span class="token punctuation">(</span><span class="token number">2</span> <span class="token operator">*</span> s<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="47"></td><td><pre>    fd<span class="token punctuation">(</span>l<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="48"></td><td><pre></pre></td></tr><tr><td data-num="49"></td><td><pre>    <span class="token keyword">if</span> level <span class="token operator">&lt;</span> lv<span class="token punctuation">:</span></pre></td></tr><tr><td data-num="50"></td><td><pre>        draw_tree<span class="token punctuation">(</span>l<span class="token punctuation">,</span> level <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="51"></td><td><pre>    bk<span class="token punctuation">(</span>l<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="52"></td><td><pre>    lt<span class="token punctuation">(</span>s<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="53"></td><td><pre></pre></td></tr><tr><td data-num="54"></td><td><pre>    <span class="token comment"># restore the previous pen width</span></pre></td></tr><tr><td data-num="55"></td><td><pre>    width<span class="token punctuation">(</span>w<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="56"></td><td><pre></pre></td></tr><tr><td data-num="57"></td><td><pre>speed<span class="token punctuation">(</span><span class="token string">"fastest"</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="58"></td><td><pre></pre></td></tr><tr><td data-num="59"></td><td><pre>draw_tree<span class="token punctuation">(</span>l<span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="60"></td><td><pre></pre></td></tr><tr><td data-num="61"></td><td><pre>done<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr></table></figure><p>运行最终显示效果：</p><p><img data-src="https://img.xfc-exclave.com/2021/09/cc970c3e845202acb2f87328a1068eaa1632750998.png" alt="Python海龟绘图-树"></p><h3 id="网络编程"><a class="anchor" href="#网络编程">#</a> 网络编程</h3><h4 id="tcpip-简介"><a class="anchor" href="#tcpip-简介">#</a> TCP/IP 简介</h4><p>略。</p><h4 id="tcp编程"><a class="anchor" href="#tcp编程">#</a> TCP 编程</h4><p>Socket 是网络编程的一个抽象概念。通常我们用一个 Socket 表示打开了一个网络链接，而打开一个 Socket 则需要知道目标计算机的 IP、端口和协议类型。</p><p>创建一个基于 TCP 的 Socket 客户端连接：</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment"># 导入 socket 库:</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">import</span> socket</pre></td></tr><tr><td data-num="3"></td><td><pre></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token comment"># 创建一个 socket:</span></pre></td></tr><tr><td data-num="5"></td><td><pre>s <span class="token operator">=</span> socket<span class="token punctuation">.</span>socket<span class="token punctuation">(</span>socket<span class="token punctuation">.</span>AF_INET<span class="token punctuation">,</span> socket<span class="token punctuation">.</span>SOCK_STREAM<span class="token punctuation">)</span>  <span class="token comment"># AF_INET 指 IPv4 协议，AF_INET6 指 IPv6 协议。SOCK_STREAM 指定使用面向流的 TCP 协议</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token comment"># 建立连接:</span></pre></td></tr><tr><td data-num="7"></td><td><pre>s<span class="token punctuation">.</span>connect<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token string">'www.test.com'</span><span class="token punctuation">,</span> <span class="token number">80</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># 参数为 tuple 类型</span></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token comment"># 发送数据:</span></pre></td></tr><tr><td data-num="9"></td><td><pre>s<span class="token punctuation">.</span>send<span class="token punctuation">(</span><span class="token string">b'GET / HTTP/1.1\r\nHost: www.test.com\r\nConnection: close\r\n\r\n'</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token comment"># 接收数据:</span></pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token builtin">buffer</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span></pre></td></tr><tr><td data-num="12"></td><td><pre><span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="13"></td><td><pre>    <span class="token comment"># 每次最多接收 1k 字节:</span></pre></td></tr><tr><td data-num="14"></td><td><pre>    d <span class="token operator">=</span> s<span class="token punctuation">.</span>recv<span class="token punctuation">(</span><span class="token number">1024</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="15"></td><td><pre>    <span class="token keyword">if</span> d<span class="token punctuation">:</span></pre></td></tr><tr><td data-num="16"></td><td><pre>        <span class="token builtin">buffer</span><span class="token punctuation">.</span>append<span class="token punctuation">(</span>d<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="17"></td><td><pre>    <span class="token keyword">else</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="18"></td><td><pre>        <span class="token keyword">break</span>  <span class="token comment"># 当接收到空，退出接收</span></pre></td></tr><tr><td data-num="19"></td><td><pre>data <span class="token operator">=</span> <span class="token string">b''</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span><span class="token builtin">buffer</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="20"></td><td><pre><span class="token comment"># 关闭连接:</span></pre></td></tr><tr><td data-num="21"></td><td><pre>s<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="22"></td><td><pre><span class="token comment"># 自定义处理数据</span></pre></td></tr><tr><td data-num="23"></td><td><pre>header<span class="token punctuation">,</span> html <span class="token operator">=</span> data<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">b'\r\n\r\n'</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="24"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span>header<span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="25"></td><td><pre><span class="token comment"># 把接收的数据写入文件:</span></pre></td></tr><tr><td data-num="26"></td><td><pre><span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'index.html'</span><span class="token punctuation">,</span> <span class="token string">'wb'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span></pre></td></tr><tr><td data-num="27"></td><td><pre>    f<span class="token punctuation">.</span>write<span class="token punctuation">(</span>html<span class="token punctuation">)</span></pre></td></tr></table></figure><p>服务器端通常会打开一个固定的端口，用于监听所有的客户端连接。对于大量的客户端连接，需要对连接的 Socket 进行识别，一个 Socket 依赖 4 项：服务器地址、服务器端口、客户端地址、客户端端口来唯一确定一个 Socket。此外，服务器端需要具备同时相应多个客户端的能力，所以，每个连接都需要一个新的进程或者新的线程来处理。</p><p>创建服务端：</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">import</span> socket</pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">import</span> threading</pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">from</span> datetime <span class="token keyword">import</span> time</pre></td></tr><tr><td data-num="4"></td><td><pre></pre></td></tr><tr><td data-num="5"></td><td><pre>s <span class="token operator">=</span> socket<span class="token punctuation">.</span>socket<span class="token punctuation">(</span>socket<span class="token punctuation">.</span>AF_INET<span class="token punctuation">,</span> socket<span class="token punctuation">.</span>SOCK_STREAM<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token comment"># 监听端口:</span></pre></td></tr><tr><td data-num="7"></td><td><pre>s<span class="token punctuation">.</span>bind<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token string">'127.0.0.1'</span><span class="token punctuation">,</span> <span class="token number">9999</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token comment"># 监听端口并指定等待连接的最大数量</span></pre></td></tr><tr><td data-num="9"></td><td><pre>s<span class="token punctuation">.</span>listen<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Waiting for connection...'</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="11"></td><td><pre></pre></td></tr><tr><td data-num="12"></td><td><pre><span class="token keyword">def</span> <span class="token function">tcplink</span><span class="token punctuation">(</span>sock<span class="token punctuation">,</span> addr<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="13"></td><td><pre>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Accept new connection from %s:%s...'</span> <span class="token operator">%</span> addr<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="14"></td><td><pre>    sock<span class="token punctuation">.</span>send<span class="token punctuation">(</span><span class="token string">b'Welcome!'</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="15"></td><td><pre>    <span class="token comment"># 持续监听客户端消息</span></pre></td></tr><tr><td data-num="16"></td><td><pre>    <span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="17"></td><td><pre>        data <span class="token operator">=</span> sock<span class="token punctuation">.</span>recv<span class="token punctuation">(</span><span class="token number">1024</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="18"></td><td><pre>        time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="19"></td><td><pre>        <span class="token comment"># 当客户端发送了 exit 时，断开连接</span></pre></td></tr><tr><td data-num="20"></td><td><pre>        <span class="token keyword">if</span> <span class="token keyword">not</span> data <span class="token keyword">or</span> data<span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token string">'exit'</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="21"></td><td><pre>            <span class="token keyword">break</span></pre></td></tr><tr><td data-num="22"></td><td><pre>        sock<span class="token punctuation">.</span>send<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token string">'Hello, %s!'</span> <span class="token operator">%</span> data<span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="23"></td><td><pre>    sock<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="24"></td><td><pre>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Connection from %s:%s closed.'</span> <span class="token operator">%</span> addr<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="25"></td><td><pre></pre></td></tr><tr><td data-num="26"></td><td><pre><span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="27"></td><td><pre>    <span class="token comment"># 接收一个新连接:</span></pre></td></tr><tr><td data-num="28"></td><td><pre>    sock<span class="token punctuation">,</span> addr <span class="token operator">=</span> s<span class="token punctuation">.</span>accept<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="29"></td><td><pre>    <span class="token comment"># 创建新线程来处理 TCP 连接:</span></pre></td></tr><tr><td data-num="30"></td><td><pre>    <span class="token comment"># 每个连接都必须创建新线程（或进程）来处理，否则，单线程在处理连接的过程中，无法接受其他客户端的连接</span></pre></td></tr><tr><td data-num="31"></td><td><pre>    t <span class="token operator">=</span> threading<span class="token punctuation">.</span>Thread<span class="token punctuation">(</span>target<span class="token operator">=</span>tcplink<span class="token punctuation">,</span> args<span class="token operator">=</span><span class="token punctuation">(</span>sock<span class="token punctuation">,</span> addr<span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="32"></td><td><pre>    t<span class="token punctuation">.</span>start<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr></table></figure><p>可以创建客户端来对和上面的服务端进行通信：</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre>s <span class="token operator">=</span> socket<span class="token punctuation">.</span>socket<span class="token punctuation">(</span>socket<span class="token punctuation">.</span>AF_INET<span class="token punctuation">,</span> socket<span class="token punctuation">.</span>SOCK_STREAM<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token comment"># 建立连接:</span></pre></td></tr><tr><td data-num="3"></td><td><pre>s<span class="token punctuation">.</span>connect<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token string">'127.0.0.1'</span><span class="token punctuation">,</span> <span class="token number">9999</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token comment"># 接收欢迎消息:</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span>s<span class="token punctuation">.</span>recv<span class="token punctuation">(</span><span class="token number">1024</span><span class="token punctuation">)</span><span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token keyword">for</span> data <span class="token keyword">in</span> <span class="token punctuation">[</span><span class="token string">b'Li Bai'</span><span class="token punctuation">,</span> <span class="token string">b'Du Fu'</span><span class="token punctuation">,</span> <span class="token string">b'Ou Yangxiu'</span><span class="token punctuation">]</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="7"></td><td><pre>    <span class="token comment"># 发送数据:</span></pre></td></tr><tr><td data-num="8"></td><td><pre>    s<span class="token punctuation">.</span>send<span class="token punctuation">(</span>data<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="9"></td><td><pre>    <span class="token keyword">print</span><span class="token punctuation">(</span>s<span class="token punctuation">.</span>recv<span class="token punctuation">(</span><span class="token number">1024</span><span class="token punctuation">)</span><span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="10"></td><td><pre>s<span class="token punctuation">.</span>send<span class="token punctuation">(</span><span class="token string">b'exit'</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="11"></td><td><pre>s<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr></table></figure><blockquote><p>注意：同一台主机，同一个端口，同一时间只能被一个 Socket 绑定。</p></blockquote><h4 id="udp编程"><a class="anchor" href="#udp编程">#</a> UDP 编程</h4><p>TCP 是建立可靠连接，并且通信双方都可以以流的形式发送数据。相对 TCP，UDP 则是面向无连接的协议。</p><p>使用 UDP 协议时，不需要建立连接，只需要知道对方的 IP 和端口，就可以直接发数据包，但它不能保证接收方一定收到。</p><p>虽然用 UDP 传输数据不可靠，但它的优点是和 TCP 比，速度快，对于不要求可靠到达的数据，就可以使用 UDP 协议。</p><p>UDP 服务端示例：</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">import</span> socket</pre></td></tr><tr><td data-num="2"></td><td><pre></pre></td></tr><tr><td data-num="3"></td><td><pre>s <span class="token operator">=</span> socket<span class="token punctuation">.</span>socket<span class="token punctuation">(</span>socket<span class="token punctuation">.</span>AF_INET<span class="token punctuation">,</span> socket<span class="token punctuation">.</span>SOCK_DGRAM<span class="token punctuation">)</span>  <span class="token comment"># SOCK_DGRAM 指定了这个 Socket 的类型是 UDP</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token comment"># 绑定端口:</span></pre></td></tr><tr><td data-num="5"></td><td><pre>s<span class="token punctuation">.</span>bind<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token string">'127.0.0.1'</span><span class="token punctuation">,</span> <span class="token number">9999</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Bind UDP on 9999...'</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="7"></td><td><pre></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="9"></td><td><pre>    <span class="token comment"># 接收数据:</span></pre></td></tr><tr><td data-num="10"></td><td><pre>    data<span class="token punctuation">,</span> addr <span class="token operator">=</span> s<span class="token punctuation">.</span>recvfrom<span class="token punctuation">(</span><span class="token number">1024</span><span class="token punctuation">)</span>  <span class="token comment"># 返回数据和客户端的地址与端口</span></pre></td></tr><tr><td data-num="11"></td><td><pre>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Received from %s:%s.'</span> <span class="token operator">%</span> addr<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="12"></td><td><pre>    s<span class="token punctuation">.</span>sendto<span class="token punctuation">(</span><span class="token string">b'Hello, %s!'</span> <span class="token operator">%</span> data<span class="token punctuation">,</span> addr<span class="token punctuation">)</span></pre></td></tr></table></figure><p>UDP 客户端示例：</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">import</span> socket</pre></td></tr><tr><td data-num="2"></td><td><pre></pre></td></tr><tr><td data-num="3"></td><td><pre>s <span class="token operator">=</span> socket<span class="token punctuation">.</span>socket<span class="token punctuation">(</span>socket<span class="token punctuation">.</span>AF_INET<span class="token punctuation">,</span> socket<span class="token punctuation">.</span>SOCK_DGRAM<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token keyword">for</span> data <span class="token keyword">in</span> <span class="token punctuation">[</span><span class="token string">b'Michael'</span><span class="token punctuation">,</span> <span class="token string">b'Tracy'</span><span class="token punctuation">,</span> <span class="token string">b'Sarah'</span><span class="token punctuation">]</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token comment"># 发送数据:</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    s<span class="token punctuation">.</span>sendto<span class="token punctuation">(</span>data<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token string">'127.0.0.1'</span><span class="token punctuation">,</span> <span class="token number">9999</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="7"></td><td><pre>    <span class="token comment"># 接收数据:</span></pre></td></tr><tr><td data-num="8"></td><td><pre>    <span class="token keyword">print</span><span class="token punctuation">(</span>s<span class="token punctuation">.</span>recv<span class="token punctuation">(</span><span class="token number">1024</span><span class="token punctuation">)</span><span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="9"></td><td><pre>s<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr></table></figure><p>在使用 UDP 进行通信时，服务端并不需要调用 listen 方法进行监听，而是直接接收来自客户端的数据，客户端也不需要调用 connect 来建立连接，直接通过 sendto 方法发送数据即可。</p><p>UDP 与 TCP 最大的区别在于是否建立连接，也由此推导出 UDP 具有传输数据不可靠的特点。此外，UDP 和 TCP 的端口是互不冲突的，即它们可以同时使用同一个端口。</p><h3 id="电子邮件"><a class="anchor" href="#电子邮件">#</a> 电子邮件</h3><h4 id="smtp-发送邮件"><a class="anchor" href="#smtp-发送邮件">#</a> SMTP 发送邮件</h4><p>SMTP 是发送邮件的协议，可以使用它来发送纯文本邮件、HTML 邮件以及带附件的邮件。Python 对 SMTP 支持有 <code>smtplib</code> 和 <code>email</code> 两个模块，email 负责构造邮件，smtplib 负责发送邮件。</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">from</span> email <span class="token keyword">import</span> encoders</pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">from</span> email<span class="token punctuation">.</span>header <span class="token keyword">import</span> Header</pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">from</span> email<span class="token punctuation">.</span>mime<span class="token punctuation">.</span>text <span class="token keyword">import</span> MIMEText</pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token keyword">from</span> email<span class="token punctuation">.</span>utils <span class="token keyword">import</span> parseaddr<span class="token punctuation">,</span> formataddr</pre></td></tr><tr><td data-num="5"></td><td><pre></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token keyword">import</span> smtplib</pre></td></tr><tr><td data-num="7"></td><td><pre></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token keyword">def</span> <span class="token function">_format_addr</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="9"></td><td><pre>    name<span class="token punctuation">,</span> addr <span class="token operator">=</span> parseaddr<span class="token punctuation">(</span>s<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="10"></td><td><pre>    <span class="token keyword">return</span> formataddr<span class="token punctuation">(</span><span class="token punctuation">(</span>Header<span class="token punctuation">(</span>name<span class="token punctuation">,</span> <span class="token string">'utf-8'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> addr<span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="11"></td><td><pre></pre></td></tr><tr><td data-num="12"></td><td><pre><span class="token comment"># 输入 Email 地址和口令:</span></pre></td></tr><tr><td data-num="13"></td><td><pre>from_addr <span class="token operator">=</span> <span class="token builtin">input</span><span class="token punctuation">(</span><span class="token string">'From: '</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="14"></td><td><pre>password <span class="token operator">=</span> <span class="token builtin">input</span><span class="token punctuation">(</span><span class="token string">'Password: '</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="15"></td><td><pre><span class="token comment"># 输入收件人地址:</span></pre></td></tr><tr><td data-num="16"></td><td><pre>to_addr <span class="token operator">=</span> <span class="token builtin">input</span><span class="token punctuation">(</span><span class="token string">'To: '</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="17"></td><td><pre><span class="token comment"># 输入 SMTP 服务器地址:</span></pre></td></tr><tr><td data-num="18"></td><td><pre>smtp_server <span class="token operator">=</span> <span class="token builtin">input</span><span class="token punctuation">(</span><span class="token string">'SMTP server: '</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="19"></td><td><pre></pre></td></tr><tr><td data-num="20"></td><td><pre>msg <span class="token operator">=</span> MIMEText<span class="token punctuation">(</span><span class="token string">'君莫笑，我们蓝溪阁不是你的保姆！！！'</span><span class="token punctuation">,</span> <span class="token string">'plain'</span><span class="token punctuation">,</span> <span class="token string">'utf-8'</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="21"></td><td><pre>msg<span class="token punctuation">[</span><span class="token string">'From'</span><span class="token punctuation">]</span> <span class="token operator">=</span> _format_addr<span class="token punctuation">(</span><span class="token string">'蓝溪阁 &lt;%s>'</span> <span class="token operator">%</span> from_addr<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="22"></td><td><pre>msg<span class="token punctuation">[</span><span class="token string">'To'</span><span class="token punctuation">]</span> <span class="token operator">=</span> _format_addr<span class="token punctuation">(</span><span class="token string">'叶修 &lt;%s>'</span> <span class="token operator">%</span> to_addr<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="23"></td><td><pre>msg<span class="token punctuation">[</span><span class="token string">'Subject'</span><span class="token punctuation">]</span> <span class="token operator">=</span> Header<span class="token punctuation">(</span><span class="token string">'来自蓝溪阁的声明'</span><span class="token punctuation">,</span> <span class="token string">'utf-8'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="24"></td><td><pre></pre></td></tr><tr><td data-num="25"></td><td><pre>server <span class="token operator">=</span> smtplib<span class="token punctuation">.</span>SMTP<span class="token punctuation">(</span>smtp_server<span class="token punctuation">,</span> <span class="token number">25</span><span class="token punctuation">)</span>  <span class="token comment"># SMTP 协议默认端口是 25</span></pre></td></tr><tr><td data-num="26"></td><td><pre>server<span class="token punctuation">.</span>set_debuglevel<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>  <span class="token comment"># 打印出和 SMTP 服务器交互的所有信息</span></pre></td></tr><tr><td data-num="27"></td><td><pre>server<span class="token punctuation">.</span>login<span class="token punctuation">(</span>from_addr<span class="token punctuation">,</span> password<span class="token punctuation">)</span>  <span class="token comment"># 登录 SMTP 服务器</span></pre></td></tr><tr><td data-num="28"></td><td><pre>server<span class="token punctuation">.</span>sendmail<span class="token punctuation">(</span>from_addr<span class="token punctuation">,</span> <span class="token punctuation">[</span>to_addr<span class="token punctuation">]</span><span class="token punctuation">,</span> msg<span class="token punctuation">.</span>as_string<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="29"></td><td><pre>server<span class="token punctuation">.</span>quit<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr></table></figure><p>如果需要发送 html 内容，只需要传递 html 文本，并指定对应的类型参数即可：</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre>msg <span class="token operator">=</span> MIMEText<span class="token punctuation">(</span><span class="token string">'&lt;html>&lt;body>&lt;h1>来自岚希阁某河的最新消息&lt;/h1>'</span> <span class="token operator">+</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token string">'&lt;p>嘉世、霸图、蓝雨、蓝溪阁、薇草各大战队将在集结人马在&lt;a href="http://www.python.org">这个地点&lt;/a>进行埋伏，野图BOSS是个陷进。&lt;/p>'</span> <span class="token operator">+</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token string">'&lt;/body>&lt;/html>'</span><span class="token punctuation">,</span> <span class="token string">'html'</span><span class="token punctuation">,</span> <span class="token string">'utf-8'</span><span class="token punctuation">)</span></pre></td></tr></table></figure><h4 id="pop3-收取邮件"><a class="anchor" href="#pop3-收取邮件">#</a> POP3 收取邮件</h4><p>收取邮件就是编写一个 MUA 作为客户端，从 MDA 把邮件获取到用户的电脑或者手机上。收取邮件最常用的协议是 POP 协议，目前版本号是 3，俗称 POP3。</p><p>注意，POP3 协议收取的不是一个已经可以阅读的邮件本身，而是邮件的原始文本，还需要用 email 模块提供的各种类来解析原始文本，变成可阅读的邮件对象。</p><p>通过 POP3 获取最新的一封邮件内容：</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">import</span> poplib</pre></td></tr><tr><td data-num="2"></td><td><pre></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token comment"># 输入邮件地址，口令和 POP3 服务器地址:</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token keyword">from</span> email<span class="token punctuation">.</span>header <span class="token keyword">import</span> decode_header</pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token keyword">from</span> email<span class="token punctuation">.</span>parser <span class="token keyword">import</span> Parser</pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token keyword">from</span> email<span class="token punctuation">.</span>utils <span class="token keyword">import</span> parseaddr</pre></td></tr><tr><td data-num="7"></td><td><pre></pre></td></tr><tr><td data-num="8"></td><td><pre>email <span class="token operator">=</span> <span class="token builtin">input</span><span class="token punctuation">(</span><span class="token string">'Email: '</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="9"></td><td><pre>password <span class="token operator">=</span> <span class="token builtin">input</span><span class="token punctuation">(</span><span class="token string">'Password: '</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="10"></td><td><pre>pop3_server <span class="token operator">=</span> <span class="token builtin">input</span><span class="token punctuation">(</span><span class="token string">'POP3 server: '</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="11"></td><td><pre></pre></td></tr><tr><td data-num="12"></td><td><pre><span class="token comment"># 连接到 POP3 服务器:</span></pre></td></tr><tr><td data-num="13"></td><td><pre>server <span class="token operator">=</span> poplib<span class="token punctuation">.</span>POP3<span class="token punctuation">(</span>pop3_server<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="14"></td><td><pre><span class="token comment"># 可以打开或关闭调试信息:</span></pre></td></tr><tr><td data-num="15"></td><td><pre>server<span class="token punctuation">.</span>set_debuglevel<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="16"></td><td><pre><span class="token comment"># 可选：打印 POP3 服务器的欢迎文字:</span></pre></td></tr><tr><td data-num="17"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span>server<span class="token punctuation">.</span>getwelcome<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="18"></td><td><pre></pre></td></tr><tr><td data-num="19"></td><td><pre><span class="token comment"># 身份认证:</span></pre></td></tr><tr><td data-num="20"></td><td><pre>server<span class="token punctuation">.</span>user<span class="token punctuation">(</span>email<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="21"></td><td><pre>server<span class="token punctuation">.</span>pass_<span class="token punctuation">(</span>password<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="22"></td><td><pre></pre></td></tr><tr><td data-num="23"></td><td><pre><span class="token comment"># stat () 返回邮件数量和占用空间:</span></pre></td></tr><tr><td data-num="24"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Messages: %s. Size: %s'</span> <span class="token operator">%</span> server<span class="token punctuation">.</span>stat<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="25"></td><td><pre><span class="token comment"># list () 返回所有邮件的编号:</span></pre></td></tr><tr><td data-num="26"></td><td><pre>resp<span class="token punctuation">,</span> mails<span class="token punctuation">,</span> octets <span class="token operator">=</span> server<span class="token punctuation">.</span><span class="token builtin">list</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="27"></td><td><pre><span class="token comment"># 可以查看返回的列表类似 [b'1 82923', b'2 2184', ...]</span></pre></td></tr><tr><td data-num="28"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span>mails<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="29"></td><td><pre></pre></td></tr><tr><td data-num="30"></td><td><pre><span class="token comment"># 获取最新一封邮件，注意索引号从 1 开始:</span></pre></td></tr><tr><td data-num="31"></td><td><pre>index <span class="token operator">=</span> <span class="token builtin">len</span><span class="token punctuation">(</span>mails<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="32"></td><td><pre>resp<span class="token punctuation">,</span> lines<span class="token punctuation">,</span> octets <span class="token operator">=</span> server<span class="token punctuation">.</span>retr<span class="token punctuation">(</span>index<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="33"></td><td><pre></pre></td></tr><tr><td data-num="34"></td><td><pre><span class="token comment"># lines 存储了邮件的原始文本的每一行，</span></pre></td></tr><tr><td data-num="35"></td><td><pre><span class="token comment"># 可以获得整个邮件的原始文本:</span></pre></td></tr><tr><td data-num="36"></td><td><pre>msg_content <span class="token operator">=</span> <span class="token string">b'\r\n'</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span>lines<span class="token punctuation">)</span><span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="37"></td><td><pre><span class="token comment"># 稍后解析出邮件:</span></pre></td></tr><tr><td data-num="38"></td><td><pre>msg <span class="token operator">=</span> Parser<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>parsestr<span class="token punctuation">(</span>msg_content<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="39"></td><td><pre></pre></td></tr><tr><td data-num="40"></td><td><pre><span class="token comment"># 解析邮件内容</span></pre></td></tr><tr><td data-num="41"></td><td><pre><span class="token keyword">def</span> <span class="token function">decode_str</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="42"></td><td><pre>    value<span class="token punctuation">,</span> charset <span class="token operator">=</span> decode_header<span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span></pre></td></tr><tr><td data-num="43"></td><td><pre>    <span class="token keyword">if</span> charset<span class="token punctuation">:</span></pre></td></tr><tr><td data-num="44"></td><td><pre>        value <span class="token operator">=</span> value<span class="token punctuation">.</span>decode<span class="token punctuation">(</span>charset<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="45"></td><td><pre>    <span class="token keyword">return</span> value</pre></td></tr><tr><td data-num="46"></td><td><pre></pre></td></tr><tr><td data-num="47"></td><td><pre><span class="token keyword">def</span> <span class="token function">guess_charset</span><span class="token punctuation">(</span>msg<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="48"></td><td><pre>    charset <span class="token operator">=</span> msg<span class="token punctuation">.</span>get_charset<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="49"></td><td><pre>    <span class="token keyword">if</span> charset <span class="token keyword">is</span> <span class="token boolean">None</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="50"></td><td><pre>        content_type <span class="token operator">=</span> msg<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'Content-Type'</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">.</span>lower<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="51"></td><td><pre>        pos <span class="token operator">=</span> content_type<span class="token punctuation">.</span>find<span class="token punctuation">(</span><span class="token string">'charset='</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="52"></td><td><pre>        <span class="token keyword">if</span> pos <span class="token operator">>=</span> <span class="token number">0</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="53"></td><td><pre>            charset <span class="token operator">=</span> content_type<span class="token punctuation">[</span>pos <span class="token operator">+</span> <span class="token number">8</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">.</span>strip<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="54"></td><td><pre>    <span class="token keyword">return</span> charset</pre></td></tr><tr><td data-num="55"></td><td><pre></pre></td></tr><tr><td data-num="56"></td><td><pre><span class="token comment"># indent 用于缩进显示:</span></pre></td></tr><tr><td data-num="57"></td><td><pre><span class="token keyword">def</span> <span class="token function">print_info</span><span class="token punctuation">(</span>msg<span class="token punctuation">,</span> indent<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="58"></td><td><pre>    <span class="token keyword">if</span> indent <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="59"></td><td><pre>        <span class="token keyword">for</span> header <span class="token keyword">in</span> <span class="token punctuation">[</span><span class="token string">'From'</span><span class="token punctuation">,</span> <span class="token string">'To'</span><span class="token punctuation">,</span> <span class="token string">'Subject'</span><span class="token punctuation">]</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="60"></td><td><pre>            value <span class="token operator">=</span> msg<span class="token punctuation">.</span>get<span class="token punctuation">(</span>header<span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="61"></td><td><pre>            <span class="token keyword">if</span> value<span class="token punctuation">:</span></pre></td></tr><tr><td data-num="62"></td><td><pre>                <span class="token keyword">if</span> header<span class="token operator">==</span><span class="token string">'Subject'</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="63"></td><td><pre>                    value <span class="token operator">=</span> decode_str<span class="token punctuation">(</span>value<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="64"></td><td><pre>                <span class="token keyword">else</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="65"></td><td><pre>                    hdr<span class="token punctuation">,</span> addr <span class="token operator">=</span> parseaddr<span class="token punctuation">(</span>value<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="66"></td><td><pre>                    name <span class="token operator">=</span> decode_str<span class="token punctuation">(</span>hdr<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="67"></td><td><pre>                    value <span class="token operator">=</span> <span class="token string">u'%s &lt;%s>'</span> <span class="token operator">%</span> <span class="token punctuation">(</span>name<span class="token punctuation">,</span> addr<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="68"></td><td><pre>            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'%s%s: %s'</span> <span class="token operator">%</span> <span class="token punctuation">(</span><span class="token string">'  '</span> <span class="token operator">*</span> indent<span class="token punctuation">,</span> header<span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="69"></td><td><pre>    <span class="token keyword">if</span> <span class="token punctuation">(</span>msg<span class="token punctuation">.</span>is_multipart<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="70"></td><td><pre>        parts <span class="token operator">=</span> msg<span class="token punctuation">.</span>get_payload<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="71"></td><td><pre>        <span class="token keyword">for</span> n<span class="token punctuation">,</span> part <span class="token keyword">in</span> <span class="token builtin">enumerate</span><span class="token punctuation">(</span>parts<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="72"></td><td><pre>            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'%spart %s'</span> <span class="token operator">%</span> <span class="token punctuation">(</span><span class="token string">'  '</span> <span class="token operator">*</span> indent<span class="token punctuation">,</span> n<span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="73"></td><td><pre>            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'%s--------------------'</span> <span class="token operator">%</span> <span class="token punctuation">(</span><span class="token string">'  '</span> <span class="token operator">*</span> indent<span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="74"></td><td><pre>            print_info<span class="token punctuation">(</span>part<span class="token punctuation">,</span> indent <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="75"></td><td><pre>    <span class="token keyword">else</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="76"></td><td><pre>        content_type <span class="token operator">=</span> msg<span class="token punctuation">.</span>get_content_type<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="77"></td><td><pre>        <span class="token keyword">if</span> content_type<span class="token operator">==</span><span class="token string">'text/plain'</span> <span class="token keyword">or</span> content_type<span class="token operator">==</span><span class="token string">'text/html'</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="78"></td><td><pre>            content <span class="token operator">=</span> msg<span class="token punctuation">.</span>get_payload<span class="token punctuation">(</span>decode<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="79"></td><td><pre>            charset <span class="token operator">=</span> guess_charset<span class="token punctuation">(</span>msg<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="80"></td><td><pre>            <span class="token keyword">if</span> charset<span class="token punctuation">:</span></pre></td></tr><tr><td data-num="81"></td><td><pre>                content <span class="token operator">=</span> content<span class="token punctuation">.</span>decode<span class="token punctuation">(</span>charset<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="82"></td><td><pre>            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'%sText: %s'</span> <span class="token operator">%</span> <span class="token punctuation">(</span><span class="token string">'  '</span> <span class="token operator">*</span> indent<span class="token punctuation">,</span> content <span class="token operator">+</span> <span class="token string">'...'</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="83"></td><td><pre>        <span class="token keyword">else</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="84"></td><td><pre>            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'%sAttachment: %s'</span> <span class="token operator">%</span> <span class="token punctuation">(</span><span class="token string">'  '</span> <span class="token operator">*</span> indent<span class="token punctuation">,</span> content_type<span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="85"></td><td><pre></pre></td></tr><tr><td data-num="86"></td><td><pre>print_info<span class="token punctuation">(</span>msg<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="87"></td><td><pre></pre></td></tr><tr><td data-num="88"></td><td><pre><span class="token comment"># 可以根据邮件索引号直接从服务器删除邮件:</span></pre></td></tr><tr><td data-num="89"></td><td><pre><span class="token comment"># server.dele(index)</span></pre></td></tr><tr><td data-num="90"></td><td><pre><span class="token comment"># 关闭连接:</span></pre></td></tr><tr><td data-num="91"></td><td><pre>server<span class="token punctuation">.</span>quit<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr></table></figure><h3 id="数据库访问"><a class="anchor" href="#数据库访问">#</a> 数据库访问</h3><blockquote><p>注意，相关的数据库环境，需要自行安装。</p></blockquote><h4 id="使用sqlite"><a class="anchor" href="#使用sqlite">#</a> 使用 SQLite</h4><p>SQLite 是一种嵌入式数据库，它的数据库就是一个文件。由于 SQLite 本身是 C 语言开发的，而且体积很小，所以，经常被集成到各种应用程序中，甚至在 iOS 和 Android 应用中都可以集成。在 Python 中也内置了 SQLite3，可以直接使用。</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">import</span> sqlite3</pre></td></tr><tr><td data-num="2"></td><td><pre></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token comment"># 1. 创建连接（数据库文件是 test.db，如果文件不存在，会自动在当前目录创建）</span></pre></td></tr><tr><td data-num="4"></td><td><pre>conn <span class="token operator">=</span> sqlite3<span class="token punctuation">.</span>connect<span class="token punctuation">(</span><span class="token string">'test.db'</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token comment"># 2. 创建一个游标 Cursor</span></pre></td></tr><tr><td data-num="6"></td><td><pre>cursor <span class="token operator">=</span> conn<span class="token punctuation">.</span>cursor<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token comment"># 3. 执行 SQL 语句（创建 user 表并添加数据）</span></pre></td></tr><tr><td data-num="8"></td><td><pre>cursor<span class="token punctuation">.</span>execute<span class="token punctuation">(</span><span class="token string">'create table user (id varchar(20) primary key, name varchar(20))'</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="9"></td><td><pre>cursor<span class="token punctuation">.</span>execute<span class="token punctuation">(</span><span class="token string">'insert into user (id, name) values (\'1\', \'Michael\')'</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span>cursor<span class="token punctuation">.</span>rowcount<span class="token punctuation">)</span>  <span class="token comment"># 在执行增删改操作时，通过 rowcount 返回影响的行数，可用于判断执行是否符合预期</span></pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token comment"># 4. 关闭游标 Cursor</span></pre></td></tr><tr><td data-num="12"></td><td><pre>cursor<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="13"></td><td><pre><span class="token comment"># 5. 提交事务</span></pre></td></tr><tr><td data-num="14"></td><td><pre>conn<span class="token punctuation">.</span>commit<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="15"></td><td><pre><span class="token comment"># 6. 关闭连接</span></pre></td></tr><tr><td data-num="16"></td><td><pre>conn<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr></table></figure><p>查询数据与添加数据大同小异：</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">import</span> sqlite3</pre></td></tr><tr><td data-num="2"></td><td><pre></pre></td></tr><tr><td data-num="3"></td><td><pre>conn <span class="token operator">=</span> sqlite3<span class="token punctuation">.</span>connect<span class="token punctuation">(</span><span class="token string">'test.db'</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="4"></td><td><pre>cursor <span class="token operator">=</span> conn<span class="token punctuation">.</span>cursor<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="5"></td><td><pre>cursor<span class="token punctuation">.</span>execute<span class="token punctuation">(</span><span class="token string">'select * from user where id=?'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token string">'1'</span><span class="token punctuation">,</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="6"></td><td><pre>values <span class="token operator">=</span> cursor<span class="token punctuation">.</span>fetchall<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment"># 通过 fetchall 获取到 list 类型的结果集，其内的每个元素都是一个 tuple，对应一行记录</span></pre></td></tr><tr><td data-num="7"></td><td><pre>cursor<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="8"></td><td><pre>conn<span class="token punctuation">.</span>commit<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="9"></td><td><pre>conn<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span>values<span class="token punctuation">)</span>  <span class="token comment"># [('1', 'Michael')]</span></pre></td></tr></table></figure><p>如果需要执行的 sql 语句中含有参数，则需要传入 tuple 类型的参数，并与 sql 语句中的 <code>?</code> 占位符进行匹配，从而构造完整的 sql 语句。如需了解更多更细致的 SQLite 知识，请另行学习。</p><h4 id="使用mysql"><a class="anchor" href="#使用mysql">#</a> 使用 MySQL</h4><p>SQLite 的特点是轻量级、可嵌入，但不能承受高并发访问，适合桌面和移动应用。而 MySQL 是为服务器端设计的数据库，能承受高并发访问，同时占用的内存也远远大于 SQLite。</p><p>MySQL 安装，自行百度。</p><p>由于 MySQL 服务器以独立的进程运行，并通过网络对外服务，所以，需要支持 Python 的 MySQL 驱动来连接到 MySQL 服务器。使用如下命令安装驱动：</p><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre>$ pip <span class="token function">install</span> mysql-connector-python --allow-external mysql-connector-python</pre></td></tr><tr><td data-num="2"></td><td><pre>$ pip <span class="token function">install</span> mysql-connector <span class="token comment"># 备选驱动</span></pre></td></tr></table></figure><p>MySQL 连接示例：</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">import</span> mysql<span class="token punctuation">.</span>connector</pre></td></tr><tr><td data-num="2"></td><td><pre></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token comment"># 创建 MySQL 表并添加数据记录</span></pre></td></tr><tr><td data-num="4"></td><td><pre>conn <span class="token operator">=</span> mysql<span class="token punctuation">.</span>connector<span class="token punctuation">.</span>connect<span class="token punctuation">(</span>user<span class="token operator">=</span><span class="token string">'root'</span><span class="token punctuation">,</span> password<span class="token operator">=</span><span class="token string">'password'</span><span class="token punctuation">,</span> database<span class="token operator">=</span><span class="token string">'test'</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="5"></td><td><pre>cursor <span class="token operator">=</span> conn<span class="token punctuation">.</span>cursor<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="6"></td><td><pre>cursor<span class="token punctuation">.</span>execute<span class="token punctuation">(</span><span class="token string">'create table user (id varchar(20) primary key, name varchar(20))'</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token comment"># 注意 MySQL 的占位符是 % s</span></pre></td></tr><tr><td data-num="8"></td><td><pre>cursor<span class="token punctuation">.</span>execute<span class="token punctuation">(</span><span class="token string">'insert into user (id, name) values (%s, %s)'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">'1'</span><span class="token punctuation">,</span> <span class="token string">'Michael'</span><span class="token punctuation">]</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span>cursor<span class="token punctuation">.</span>rowcount<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="10"></td><td><pre>conn<span class="token punctuation">.</span>commit<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment"># 事务必须提交才能生效</span></pre></td></tr><tr><td data-num="11"></td><td><pre>cursor<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="12"></td><td><pre></pre></td></tr><tr><td data-num="13"></td><td><pre><span class="token comment"># 查询数据</span></pre></td></tr><tr><td data-num="14"></td><td><pre>cursor <span class="token operator">=</span> conn<span class="token punctuation">.</span>cursor<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="15"></td><td><pre>cursor<span class="token punctuation">.</span>execute<span class="token punctuation">(</span><span class="token string">'select * from user where id = %s'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token string">'1'</span><span class="token punctuation">,</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="16"></td><td><pre>values <span class="token operator">=</span> cursor<span class="token punctuation">.</span>fetchall<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="17"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span>values<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="18"></td><td><pre>cursor<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="19"></td><td><pre>conn<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr></table></figure><blockquote><p>由于 Python 的 <code>DB-API</code> 定义都是通用的，所以，操作 MySQL 的数据库代码和 SQLite 类似。</p></blockquote><h4 id="使用sqlalchemy"><a class="anchor" href="#使用sqlalchemy">#</a> 使用 SQLAlchemy</h4><p><code>SQLAlchemy</code> 是 Python 中一个通过 ORM 操作数据库的框架。</p><p>SQLAlchemy 对象关系映射器提供了一种方法，用于将用户定义的 Python 类与数据库表相关联，并将这些类（对象）的实例与其对应表中的行相关联。它包括一个透明地同步对象及其相关行之间状态的所有变化的系统，称为工作单元，以及根据用户定义的类及其定义的彼此之间的关系表达数据库查询的系统。它可以让我们使用类和对象的方式操作数据库，从而从繁琐的 sql 语句中解脱出来。</p><p>安装 SQLAlchemy：</p><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre>$ pip <span class="token function">install</span> sqlalchemy</pre></td></tr></table></figure><p>SQLAlchemy 操作数据库示例：</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">from</span> sqlalchemy <span class="token keyword">import</span> Column<span class="token punctuation">,</span> String<span class="token punctuation">,</span> create_engine<span class="token punctuation">,</span> ForeignKey</pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">from</span> sqlalchemy<span class="token punctuation">.</span>orm <span class="token keyword">import</span> sessionmaker<span class="token punctuation">,</span> relationship</pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">from</span> sqlalchemy<span class="token punctuation">.</span>ext<span class="token punctuation">.</span>declarative <span class="token keyword">import</span> declarative_base</pre></td></tr><tr><td data-num="4"></td><td><pre></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token comment"># 创建对象的基类:</span></pre></td></tr><tr><td data-num="6"></td><td><pre>Base <span class="token operator">=</span> declarative_base<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="7"></td><td><pre></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token comment"># 定义 User 对象:</span></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token keyword">class</span> <span class="token class-name">User</span><span class="token punctuation">(</span>Base<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="10"></td><td><pre>    <span class="token comment"># 表的名字:</span></pre></td></tr><tr><td data-num="11"></td><td><pre>    __tablename__ <span class="token operator">=</span> <span class="token string">'user'</span></pre></td></tr><tr><td data-num="12"></td><td><pre></pre></td></tr><tr><td data-num="13"></td><td><pre>    <span class="token comment"># 表的结构:</span></pre></td></tr><tr><td data-num="14"></td><td><pre>    <span class="token builtin">id</span> <span class="token operator">=</span> Column<span class="token punctuation">(</span>String<span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">,</span> primary_key<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="15"></td><td><pre>    name <span class="token operator">=</span> Column<span class="token punctuation">(</span>String<span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token comment"># 一对多:</span></pre></td></tr><tr><td data-num="16"></td><td><pre>    books <span class="token operator">=</span> relationship<span class="token punctuation">(</span><span class="token string">'Book'</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="17"></td><td><pre></pre></td></tr><tr><td data-num="18"></td><td><pre><span class="token keyword">class</span> <span class="token class-name">Book</span><span class="token punctuation">(</span>Base<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="19"></td><td><pre>    __tablename__ <span class="token operator">=</span> <span class="token string">'book'</span></pre></td></tr><tr><td data-num="20"></td><td><pre></pre></td></tr><tr><td data-num="21"></td><td><pre>    <span class="token builtin">id</span> <span class="token operator">=</span> Column<span class="token punctuation">(</span>String<span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">,</span> primary_key<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="22"></td><td><pre>    name <span class="token operator">=</span> Column<span class="token punctuation">(</span>String<span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="23"></td><td><pre>    <span class="token comment"># “多” 的一方的 book 表是通过外键关联到 user 表的:</span></pre></td></tr><tr><td data-num="24"></td><td><pre>    user_id <span class="token operator">=</span> Column<span class="token punctuation">(</span>String<span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">,</span> ForeignKey<span class="token punctuation">(</span><span class="token string">'user.id'</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="25"></td><td><pre></pre></td></tr><tr><td data-num="26"></td><td><pre><span class="token comment"># 初始化数据库连接:</span></pre></td></tr><tr><td data-num="27"></td><td><pre>engine <span class="token operator">=</span> create_engine<span class="token punctuation">(</span><span class="token string">'mysql+mysqlconnector://root:password@localhost:3306/test'</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="28"></td><td><pre><span class="token comment"># 创建 DBSession 类型:</span></pre></td></tr><tr><td data-num="29"></td><td><pre>DBSession <span class="token operator">=</span> sessionmaker<span class="token punctuation">(</span>bind<span class="token operator">=</span>engine<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="30"></td><td><pre></pre></td></tr><tr><td data-num="31"></td><td><pre><span class="token comment"># ------- 新增数据 -------</span></pre></td></tr><tr><td data-num="32"></td><td><pre><span class="token comment"># 创建 session 对象:</span></pre></td></tr><tr><td data-num="33"></td><td><pre>session <span class="token operator">=</span> DBSession<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="34"></td><td><pre><span class="token comment"># 创建新 User 对象:</span></pre></td></tr><tr><td data-num="35"></td><td><pre>new_user <span class="token operator">=</span> User<span class="token punctuation">(</span><span class="token builtin">id</span><span class="token operator">=</span><span class="token string">'5'</span><span class="token punctuation">,</span> name<span class="token operator">=</span><span class="token string">'Bob'</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="36"></td><td><pre><span class="token comment"># 添加到 session:</span></pre></td></tr><tr><td data-num="37"></td><td><pre>session<span class="token punctuation">.</span>add<span class="token punctuation">(</span>new_user<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="38"></td><td><pre><span class="token comment"># 提交即保存到数据库:</span></pre></td></tr><tr><td data-num="39"></td><td><pre>session<span class="token punctuation">.</span>commit<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="40"></td><td><pre><span class="token comment"># 关闭 session:</span></pre></td></tr><tr><td data-num="41"></td><td><pre>session<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="42"></td><td><pre></pre></td></tr><tr><td data-num="43"></td><td><pre><span class="token comment"># ------- 查询数据 -------</span></pre></td></tr><tr><td data-num="44"></td><td><pre><span class="token comment"># 创建 Session:</span></pre></td></tr><tr><td data-num="45"></td><td><pre>session <span class="token operator">=</span> DBSession<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="46"></td><td><pre><span class="token comment"># 创建 Query 查询，filter 是 where 条件，最后调用 one () 返回唯一行，如果调用 all () 则返回所有行:</span></pre></td></tr><tr><td data-num="47"></td><td><pre>user <span class="token operator">=</span> session<span class="token punctuation">.</span>query<span class="token punctuation">(</span>User<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span>User<span class="token punctuation">.</span><span class="token builtin">id</span><span class="token operator">==</span><span class="token string">'5'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>one<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="48"></td><td><pre><span class="token comment"># 打印类型和对象的 name 属性:</span></pre></td></tr><tr><td data-num="49"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'type:'</span><span class="token punctuation">,</span> <span class="token builtin">type</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="50"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'name:'</span><span class="token punctuation">,</span> user<span class="token punctuation">.</span>name<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="51"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'books:'</span><span class="token punctuation">,</span> user<span class="token punctuation">.</span>books<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="52"></td><td><pre><span class="token comment"># 关闭 Session:</span></pre></td></tr><tr><td data-num="53"></td><td><pre>session<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr></table></figure><h3 id="web-开发"><a class="anchor" href="#web-开发">#</a> Web 开发</h3><h4 id="http-协议简介"><a class="anchor" href="#http-协议简介">#</a> HTTP 协议简介</h4><p>略。</p><h4 id="html-简介"><a class="anchor" href="#html-简介">#</a> HTML 简介</h4><p>略。</p><h4 id="wsgi-接口"><a class="anchor" href="#wsgi-接口">#</a> WSGI 接口</h4><p>WSGI：Web Server Gateway Interface。</p><p>创建脚本文件 <span class="exturl" data-url="aHR0cDovL2FwcGxpY2F0aW9uLnB5">application.py</span>：</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment"># application 函数需要由 WSGI 来调用</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">def</span> <span class="token function">start</span><span class="token punctuation">(</span>environ<span class="token punctuation">,</span> start_response<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    start_response<span class="token punctuation">(</span><span class="token string">'200 OK'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token string">'Content-Type'</span><span class="token punctuation">,</span> <span class="token string">'text/html'</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span>  <span class="token comment"># Header 只能发送一次</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    body <span class="token operator">=</span> <span class="token string">'&lt;h1>Hello, %s!&lt;/h1>'</span> <span class="token operator">%</span> <span class="token punctuation">(</span>environ<span class="token punctuation">[</span><span class="token string">'PATH_INFO'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token punctuation">]</span> <span class="token keyword">or</span> <span class="token string">'web'</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token keyword">return</span> <span class="token punctuation">[</span>body<span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span><span class="token punctuation">]</span></pre></td></tr></table></figure><p>在同级目录下创建 <span class="exturl" data-url="aHR0cDovL3NlcnZlci5weQ==">server.py</span>：</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment"># 使用 Python 内置的 WSGI 服务器（不推荐，仅供开发测试时使用）</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">from</span> wsgiref<span class="token punctuation">.</span>simple_server <span class="token keyword">import</span> make_server</pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">from</span> application <span class="token keyword">import</span> start</pre></td></tr><tr><td data-num="4"></td><td><pre></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token comment"># 创建一个服务器，IP 地址为空，端口是 8000，处理函数是 application:</span></pre></td></tr><tr><td data-num="6"></td><td><pre>httpd <span class="token operator">=</span> make_server<span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">,</span> <span class="token number">8000</span><span class="token punctuation">,</span> start<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Serving HTTP on port 8000...'</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token comment"># 开始监听 HTTP 请求:</span></pre></td></tr><tr><td data-num="9"></td><td><pre>httpd<span class="token punctuation">.</span>serve_forever<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr></table></figure><p>启动 <span class="exturl" data-url="aHR0cDovL3NlcnZlci5weQ==">server.py</span> 并在浏览器访问 <span class="exturl" data-url="aHR0cDovL2xvY2FsaG9zdDo4MDAw">http://localhost:8000</span> ，可以正常访问，说明 web 服务启动成功。</p><p>HTTP 请求的所有输入信息都可以通过 <code>environ</code> 获得，HTTP 响应的输出都可以通过 <code>start_response()</code> 加上函数返回值作为 Body。</p><h4 id="使用-web-框架"><a class="anchor" href="#使用-web-框架">#</a> 使用 Web 框架</h4><p>Python 的 web 框架较多，最为主流的主要有以下几款：</p><ol><li>Flask</li><li>Django</li><li>Tornado</li><li>Twisted</li></ol><p>知乎上有话题讨论这些框架：<span class="exturl" data-url="aHR0cHM6Ly93d3cuemhpaHUuY29tL3F1ZXN0aW9uLzIwNzA2MzMz">https://www.zhihu.com/question/20706333</span></p><blockquote><p>这里演示如何使用 flask 框架来提供服务，其他框架的使用方法类似。</p></blockquote><p>安装：</p><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre>$ pip <span class="token function">install</span> flask</pre></td></tr></table></figure><p>使用示例：</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">from</span> flask <span class="token keyword">import</span> Flask</pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">from</span> flask <span class="token keyword">import</span> request</pre></td></tr><tr><td data-num="3"></td><td><pre></pre></td></tr><tr><td data-num="4"></td><td><pre>app <span class="token operator">=</span> Flask<span class="token punctuation">(</span>__name__<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="5"></td><td><pre></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">,</span> methods<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'GET'</span><span class="token punctuation">,</span> <span class="token string">'POST'</span><span class="token punctuation">]</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token keyword">def</span> <span class="token function">home</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="8"></td><td><pre>    <span class="token keyword">return</span> <span class="token string">'&lt;h1>Home&lt;/h1>&lt;div>&lt;a href="/signin">to login&lt;/a>&lt;/div>'</span></pre></td></tr><tr><td data-num="9"></td><td><pre></pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">'/signin'</span><span class="token punctuation">,</span> methods<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'GET'</span><span class="token punctuation">]</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token keyword">def</span> <span class="token function">signin_form</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="12"></td><td><pre>    <span class="token keyword">return</span> <span class="token triple-quoted-string string">'''&lt;form action="/signin" method="post"></span></pre></td></tr><tr><td data-num="13"></td><td><pre>              &lt;p>&lt;input name="username">&lt;/p></pre></td></tr><tr><td data-num="14"></td><td><pre>              &lt;p>&lt;input name="password" type="password">&lt;/p></pre></td></tr><tr><td data-num="15"></td><td><pre>              &lt;p>&lt;button type="submit">Sign In&lt;/button>&lt;/p></pre></td></tr><tr><td data-num="16"></td><td><pre>              &lt;/form>'''</pre></td></tr><tr><td data-num="17"></td><td><pre></pre></td></tr><tr><td data-num="18"></td><td><pre><span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">'/signin'</span><span class="token punctuation">,</span> methods<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'POST'</span><span class="token punctuation">]</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="19"></td><td><pre><span class="token keyword">def</span> <span class="token function">signin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="20"></td><td><pre>    <span class="token comment"># 需要从 request 对象读取表单内容：</span></pre></td></tr><tr><td data-num="21"></td><td><pre>    <span class="token keyword">if</span> request<span class="token punctuation">.</span>form<span class="token punctuation">[</span><span class="token string">'username'</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token string">'admin'</span> <span class="token keyword">and</span> request<span class="token punctuation">.</span>form<span class="token punctuation">[</span><span class="token string">'password'</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token string">'password'</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="22"></td><td><pre>        <span class="token keyword">return</span> <span class="token string">'&lt;h3>Hello, admin!&lt;/h3>'</span></pre></td></tr><tr><td data-num="23"></td><td><pre>    <span class="token keyword">return</span> <span class="token string">'&lt;h3>Bad username or password.&lt;/h3>&lt;br>&lt;p>redirect to &lt;a href="/signin">login page&lt;/a>&lt;/p>'</span></pre></td></tr><tr><td data-num="24"></td><td><pre></pre></td></tr><tr><td data-num="25"></td><td><pre><span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="26"></td><td><pre>    app<span class="token punctuation">.</span>run<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr></table></figure><h4 id="使用模板"><a class="anchor" href="#使用模板">#</a> 使用模板</h4><p>在 web 开发中，MVC 是一种最常见的设计思想，Python 也同样支持 MVC 的设计模式。</p><p>新建 <span class="exturl" data-url="aHR0cDovL2FwcC5weQ==">app.py</span>：</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">from</span> flask <span class="token keyword">import</span> Flask<span class="token punctuation">,</span> request<span class="token punctuation">,</span> render_template</pre></td></tr><tr><td data-num="2"></td><td><pre></pre></td></tr><tr><td data-num="3"></td><td><pre>app <span class="token operator">=</span> Flask<span class="token punctuation">(</span>__name__<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="4"></td><td><pre></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">,</span> methods<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'GET'</span><span class="token punctuation">,</span> <span class="token string">'POST'</span><span class="token punctuation">]</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token keyword">def</span> <span class="token function">home</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="7"></td><td><pre>    <span class="token keyword">return</span> render_template<span class="token punctuation">(</span><span class="token string">'home.html'</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="8"></td><td><pre></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">'/signin'</span><span class="token punctuation">,</span> methods<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'GET'</span><span class="token punctuation">]</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token keyword">def</span> <span class="token function">signin_form</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="11"></td><td><pre>    <span class="token keyword">return</span> render_template<span class="token punctuation">(</span><span class="token string">'form.html'</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="12"></td><td><pre></pre></td></tr><tr><td data-num="13"></td><td><pre><span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">'/signin'</span><span class="token punctuation">,</span> methods<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'POST'</span><span class="token punctuation">]</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="14"></td><td><pre><span class="token keyword">def</span> <span class="token function">signin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="15"></td><td><pre>    username <span class="token operator">=</span> request<span class="token punctuation">.</span>form<span class="token punctuation">[</span><span class="token string">'username'</span><span class="token punctuation">]</span></pre></td></tr><tr><td data-num="16"></td><td><pre>    password <span class="token operator">=</span> request<span class="token punctuation">.</span>form<span class="token punctuation">[</span><span class="token string">'password'</span><span class="token punctuation">]</span></pre></td></tr><tr><td data-num="17"></td><td><pre>    <span class="token keyword">if</span> username<span class="token operator">==</span><span class="token string">'admin'</span> <span class="token keyword">and</span> password<span class="token operator">==</span><span class="token string">'password'</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="18"></td><td><pre>        <span class="token keyword">return</span> render_template<span class="token punctuation">(</span><span class="token string">'signin-ok.html'</span><span class="token punctuation">,</span> username<span class="token operator">=</span>username<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="19"></td><td><pre>    <span class="token keyword">return</span> render_template<span class="token punctuation">(</span><span class="token string">'form.html'</span><span class="token punctuation">,</span> message<span class="token operator">=</span><span class="token string">'Bad username or password'</span><span class="token punctuation">,</span> username<span class="token operator">=</span>username<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="20"></td><td><pre></pre></td></tr><tr><td data-num="21"></td><td><pre><span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="22"></td><td><pre>    app<span class="token punctuation">.</span>run<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr></table></figure><p>在 <span class="exturl" data-url="aHR0cDovL2FwcC5weQ==">app.py</span> 同级目录下创建文件夹 templates，并在其中添加 html 文件：</p><figure class="highlight html"><figcaption data-lang="HTML"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">&lt;!-- form.html --></span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="4"></td><td><pre>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">></span></span>Please Sign In<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="7"></td><td><pre>  <span class="token comment"></span></pre></td></tr><tr><td data-num="8"></td><td><pre>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>form</span> <span class="token attr-name">action</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/signin<span class="token punctuation">"</span></span> <span class="token attr-name">method</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>post<span class="token punctuation">"</span></span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="9"></td><td><pre>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>legend</span><span class="token punctuation">></span></span>Please sign in:<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>legend</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="10"></td><td><pre>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>username<span class="token punctuation">"</span></span> <span class="token attr-name">placeholder</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Username<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="11"></td><td><pre>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>password<span class="token punctuation">"</span></span> <span class="token attr-name">placeholder</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Password<span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>password<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="12"></td><td><pre>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>submit<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>Sign In<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="13"></td><td><pre>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>form</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="14"></td><td><pre><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="15"></td><td><pre><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="16"></td><td><pre></pre></td></tr><tr><td data-num="17"></td><td><pre><span class="token comment">&lt;!-- home.html --></span></pre></td></tr><tr><td data-num="18"></td><td><pre><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="19"></td><td><pre><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="20"></td><td><pre>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">></span></span>Home<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="21"></td><td><pre><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="22"></td><td><pre><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="23"></td><td><pre>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span> <span class="token special-attr"><span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token value css language-css"><span class="token property">font-style</span><span class="token punctuation">:</span>italic</span><span class="token punctuation">"</span></span></span><span class="token punctuation">></span></span>Home<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="24"></td><td><pre><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="25"></td><td><pre><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="26"></td><td><pre></pre></td></tr><tr><td data-num="27"></td><td><pre><span class="token comment">&lt;!-- signin-ok.html --></span></pre></td></tr><tr><td data-num="28"></td><td><pre><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="29"></td><td><pre><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="30"></td><td><pre>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">></span></span>Welcome, <span class="token comment"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="31"></td><td><pre><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="32"></td><td><pre><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="33"></td><td><pre>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">></span></span>Welcome, <span class="token comment"></span>!<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="34"></td><td><pre><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="35"></td><td><pre><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">></span></span></pre></td></tr></table></figure><blockquote><p>Flask 框架默认使用 <code>jinja2</code> 作为视图渲染模板。它使用 <code>&#123;&#123; name &#125;&#125;</code> 进行占位，表示一个需要替换的变量，如果需要使用循环、条件判断等指令语句，在 Jinja2 中则是使用 <code>&#123;% ... %&#125;</code> 进行表示。</p><p>不同 web 框架指定使用的渲染模板各不相同，但它们基本上都是通过占位符进行匹配替换实现的模板动态生成，在原理上大同小异。</p></blockquote><h3 id="异步io"><a class="anchor" href="#异步io">#</a> 异步 IO</h3><p>关于 IO 的理论叙述，我已经在文章 <a href="/computer-science/java-learning-path/1-basic/01-java-basic/">Java 基础知识大盘点</a>的 IO 章节有过详细的整理，尽管语言不同，但是基本原理和概念是完全一致的。</p><h4 id="协程"><a class="anchor" href="#协程">#</a> 协程</h4><p>协程（Coroutine），又称微线程，纤程。</p><p>协程其实就是一个子程序，但与普通子程序不同，协程在执行过程中，其子程序内部是可以中断的，让出执行权，等到适当的时候再继续执行。</p><p>协程是单个线程执行，并非多线程，它的优势在于执行效率高，因为它是通过同一线程内部的多个子程序之间进行切换实现异步的，不会产生额外的线程开销。另外，协程由于只是单个线程，所以并不需要引入锁机制来写操作冲突。</p><p>为了充分发挥协程的执行效率，通常会将协程和多进程结合使用，以便能够利用多核 CPU。</p><p>协程示例：</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">def</span> <span class="token function">consumer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    r <span class="token operator">=</span> <span class="token string">''</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="4"></td><td><pre>        n <span class="token operator">=</span> <span class="token keyword">yield</span> r</pre></td></tr><tr><td data-num="5"></td><td><pre>        <span class="token keyword">if</span> <span class="token keyword">not</span> n<span class="token punctuation">:</span></pre></td></tr><tr><td data-num="6"></td><td><pre>            <span class="token keyword">return</span></pre></td></tr><tr><td data-num="7"></td><td><pre>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'[CONSUMER] Consuming %s...'</span> <span class="token operator">%</span> n<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="8"></td><td><pre>        r <span class="token operator">=</span> <span class="token string">'200 OK'</span></pre></td></tr><tr><td data-num="9"></td><td><pre></pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token keyword">def</span> <span class="token function">produce</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="11"></td><td><pre>    c<span class="token punctuation">.</span>send<span class="token punctuation">(</span><span class="token boolean">None</span><span class="token punctuation">)</span>  <span class="token comment"># 1. 在一个生成器函数未启动之前，是不能传递值进去的，需要执行 c.send (None) 或 next (c) 来返回生成器的第一个值</span></pre></td></tr><tr><td data-num="12"></td><td><pre>    n <span class="token operator">=</span> <span class="token number">0</span></pre></td></tr><tr><td data-num="13"></td><td><pre>    <span class="token keyword">while</span> n <span class="token operator">&lt;</span> <span class="token number">5</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="14"></td><td><pre>        n <span class="token operator">=</span> n <span class="token operator">+</span> <span class="token number">1</span></pre></td></tr><tr><td data-num="15"></td><td><pre>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'[PRODUCER] Producing %s...'</span> <span class="token operator">%</span> n<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="16"></td><td><pre>        r <span class="token operator">=</span> c<span class="token punctuation">.</span>send<span class="token punctuation">(</span>n<span class="token punctuation">)</span>  <span class="token comment"># 启动生成器，并传入参数，接着 yield 语句继续执行</span></pre></td></tr><tr><td data-num="17"></td><td><pre>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'[PRODUCER] Consumer return: %s'</span> <span class="token operator">%</span> r<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="18"></td><td><pre>    c<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment"># 结束生成器的生命周期</span></pre></td></tr><tr><td data-num="19"></td><td><pre></pre></td></tr><tr><td data-num="20"></td><td><pre>c <span class="token operator">=</span> consumer<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="21"></td><td><pre>produce<span class="token punctuation">(</span>c<span class="token punctuation">)</span></pre></td></tr></table></figure><p>这一段代码的执行顺序大致如下：</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment"># 伪代码：</span></pre></td></tr><tr><td data-num="2"></td><td><pre>produce<span class="token punctuation">(</span>consumer<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># 1. 将 consumer 函数作为参数传递给 produce 函数</span></pre></td></tr><tr><td data-num="3"></td><td><pre>c<span class="token punctuation">.</span>send<span class="token punctuation">(</span><span class="token boolean">None</span><span class="token punctuation">)</span>  <span class="token comment"># 2. 初始化生成器函数，进入 consumer 函数</span></pre></td></tr><tr><td data-num="4"></td><td><pre>r <span class="token operator">=</span> <span class="token string">''</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token comment"># 进入 while True 循环</span></pre></td></tr><tr><td data-num="6"></td><td><pre>n <span class="token operator">=</span> <span class="token keyword">yield</span> r  <span class="token comment"># 3. 此时 r 为空，n 未定义，跳出 consumer 函数，并标记当前跳出点（假设为 A 点），继续执行 c.send (None) 后续代码</span></pre></td></tr><tr><td data-num="7"></td><td><pre>n <span class="token operator">=</span> <span class="token number">0</span></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token comment"># 进入 while n &lt; 5 循环（第一轮循环）</span></pre></td></tr><tr><td data-num="9"></td><td><pre>n <span class="token operator">=</span> n <span class="token operator">+</span> <span class="token number">1</span></pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'[PRODUCER] Producing %s...'</span> <span class="token operator">%</span> n<span class="token punctuation">)</span>  <span class="token comment"># 此时 n=1</span></pre></td></tr><tr><td data-num="11"></td><td><pre>r <span class="token operator">=</span> c<span class="token punctuation">.</span>send<span class="token punctuation">(</span>n<span class="token punctuation">)</span>  <span class="token comment"># 4. 再次进入生成器，查找上次标记的点 A，并从点 A 开始继续执行代码（此时 n=1）</span></pre></td></tr><tr><td data-num="12"></td><td><pre><span class="token comment"># 判断 if not n</span></pre></td></tr><tr><td data-num="13"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'[CONSUMER] Consuming %s...'</span> <span class="token operator">%</span> n<span class="token punctuation">)</span>  <span class="token comment"># 此时 n=1</span></pre></td></tr><tr><td data-num="14"></td><td><pre>r <span class="token operator">=</span> <span class="token string">'200 OK'</span></pre></td></tr><tr><td data-num="15"></td><td><pre>n <span class="token operator">=</span> <span class="token keyword">yield</span> r  <span class="token comment"># 5. 此时 r='200 OK'，n=1，跳出 consumer 函数，并标记当前跳出点（假设为 B 点），继续执行 c.send (n) 后续代码</span></pre></td></tr><tr><td data-num="16"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'[PRODUCER] Consumer return: %s'</span> <span class="token operator">%</span> r<span class="token punctuation">)</span>  <span class="token comment"># 此时 r='200 OK'</span></pre></td></tr><tr><td data-num="17"></td><td><pre><span class="token comment"># 进入第二轮循环</span></pre></td></tr><tr><td data-num="18"></td><td><pre>n <span class="token operator">=</span> n <span class="token operator">+</span> <span class="token number">1</span></pre></td></tr><tr><td data-num="19"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'[PRODUCER] Producing %s...'</span> <span class="token operator">%</span> n<span class="token punctuation">)</span>  <span class="token comment"># 此时 n=2</span></pre></td></tr><tr><td data-num="20"></td><td><pre>r <span class="token operator">=</span> c<span class="token punctuation">.</span>send<span class="token punctuation">(</span>n<span class="token punctuation">)</span>  <span class="token comment"># 6. 再次进入生成器，查找上次标记的点 B，并从点 B 开始继续执行代码（此时 n=2）</span></pre></td></tr><tr><td data-num="21"></td><td><pre><span class="token comment"># 判断 if not n</span></pre></td></tr><tr><td data-num="22"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'[CONSUMER] Consuming %s...'</span> <span class="token operator">%</span> n<span class="token punctuation">)</span>  <span class="token comment"># 此时 n=2</span></pre></td></tr><tr><td data-num="23"></td><td><pre><span class="token comment"># ...</span></pre></td></tr><tr><td data-num="24"></td><td><pre><span class="token comment"># ...（按照这样的步骤循环，直到 while n &lt; 5 条件不满足）</span></pre></td></tr><tr><td data-num="25"></td><td><pre>c<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment"># 结束生成器的生命周期</span></pre></td></tr></table></figure><h4 id="asyncio"><a class="anchor" href="#asyncio">#</a> asyncio</h4><p><code>asyncio</code> 的编程模型就是一个消息循环。从 asyncio 模块中直接获取一个 <code>EventLoop</code> 的引用，然后把需要执行的协程扔到 EventLoop 中执行，就实现了异步 IO。</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">import</span> asyncio</pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">import</span> threading</pre></td></tr><tr><td data-num="3"></td><td><pre></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token keyword">async</span> <span class="token keyword">def</span> <span class="token function">hello</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Hello! (%s)'</span> <span class="token operator">%</span> threading<span class="token punctuation">.</span>currentThread<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    r <span class="token operator">=</span> <span class="token keyword">await</span> asyncio<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>  <span class="token comment"># 异步调用 asyncio.sleep (1)</span></pre></td></tr><tr><td data-num="7"></td><td><pre>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Bye-bye! (%s)'</span> <span class="token operator">%</span> threading<span class="token punctuation">.</span>currentThread<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="8"></td><td><pre></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token comment"># 获取 EventLoop:</span></pre></td></tr><tr><td data-num="10"></td><td><pre>loop <span class="token operator">=</span> asyncio<span class="token punctuation">.</span>get_event_loop<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="11"></td><td><pre>tasks <span class="token operator">=</span> <span class="token punctuation">[</span>hello<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> hello<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span></pre></td></tr><tr><td data-num="12"></td><td><pre><span class="token comment"># 执行 coroutine</span></pre></td></tr><tr><td data-num="13"></td><td><pre>loop<span class="token punctuation">.</span>run_until_complete<span class="token punctuation">(</span>asyncio<span class="token punctuation">.</span>wait<span class="token punctuation">(</span>tasks<span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="14"></td><td><pre>loop<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr></table></figure><p>对于这种异步操作，在 <code>3.8</code> 之前的 Python 旧版本中，其书写方式略有不同：</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">import</span> threading</pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">import</span> asyncio</pre></td></tr><tr><td data-num="3"></td><td><pre></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token decorator annotation punctuation">@asyncio<span class="token punctuation">.</span>coroutine</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token keyword">def</span> <span class="token function">hello</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Hello! (%s)'</span> <span class="token operator">%</span> threading<span class="token punctuation">.</span>currentThread<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="7"></td><td><pre>    <span class="token keyword">yield</span> <span class="token keyword">from</span> asyncio<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>  <span class="token comment"># 异步调用 asyncio.sleep (1)</span></pre></td></tr><tr><td data-num="8"></td><td><pre>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Bye-bye! (%s)'</span> <span class="token operator">%</span> threading<span class="token punctuation">.</span>currentThread<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="9"></td><td><pre></pre></td></tr><tr><td data-num="10"></td><td><pre>loop <span class="token operator">=</span> asyncio<span class="token punctuation">.</span>get_event_loop<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="11"></td><td><pre>tasks <span class="token operator">=</span> <span class="token punctuation">[</span>hello<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> hello<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span></pre></td></tr><tr><td data-num="12"></td><td><pre>loop<span class="token punctuation">.</span>run_until_complete<span class="token punctuation">(</span>asyncio<span class="token punctuation">.</span>wait<span class="token punctuation">(</span>tasks<span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="13"></td><td><pre>loop<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr></table></figure><p>使用这种方式，我们可以进行很多异步 IO，例如网络资源的访问操作：</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">import</span> asyncio</pre></td></tr><tr><td data-num="2"></td><td><pre></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">async</span> <span class="token keyword">def</span> <span class="token function">wget</span><span class="token punctuation">(</span>host<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'wget %s...'</span> <span class="token operator">%</span> host<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    connect <span class="token operator">=</span> asyncio<span class="token punctuation">.</span>open_connection<span class="token punctuation">(</span>host<span class="token punctuation">,</span> <span class="token number">80</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    reader<span class="token punctuation">,</span> writer <span class="token operator">=</span> <span class="token keyword">await</span> connect</pre></td></tr><tr><td data-num="7"></td><td><pre>    header <span class="token operator">=</span> <span class="token string">'GET / HTTP/1.0\r\nHost: %s\r\n\r\n'</span> <span class="token operator">%</span> host</pre></td></tr><tr><td data-num="8"></td><td><pre>    writer<span class="token punctuation">.</span>write<span class="token punctuation">(</span>header<span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="9"></td><td><pre>    <span class="token keyword">await</span> writer<span class="token punctuation">.</span>drain<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="10"></td><td><pre>    <span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="11"></td><td><pre>        line <span class="token operator">=</span> <span class="token keyword">await</span> reader<span class="token punctuation">.</span>readline<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="12"></td><td><pre>        <span class="token keyword">if</span> line <span class="token operator">==</span> <span class="token string">b'\r\n'</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="13"></td><td><pre>            <span class="token keyword">break</span></pre></td></tr><tr><td data-num="14"></td><td><pre>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'%s header > %s'</span> <span class="token operator">%</span> <span class="token punctuation">(</span>host<span class="token punctuation">,</span> line<span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>rstrip<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="15"></td><td><pre>    <span class="token comment"># Ignore the body, close the socket</span></pre></td></tr><tr><td data-num="16"></td><td><pre>    writer<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="17"></td><td><pre></pre></td></tr><tr><td data-num="18"></td><td><pre>loop <span class="token operator">=</span> asyncio<span class="token punctuation">.</span>get_event_loop<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="19"></td><td><pre>tasks <span class="token operator">=</span> <span class="token punctuation">[</span>wget<span class="token punctuation">(</span>host<span class="token punctuation">)</span> <span class="token keyword">for</span> host <span class="token keyword">in</span> <span class="token punctuation">[</span><span class="token string">'www.sina.com.cn'</span><span class="token punctuation">,</span> <span class="token string">'www.sohu.com'</span><span class="token punctuation">,</span> <span class="token string">'www.163.com'</span><span class="token punctuation">]</span><span class="token punctuation">]</span></pre></td></tr><tr><td data-num="20"></td><td><pre>loop<span class="token punctuation">.</span>run_until_complete<span class="token punctuation">(</span>asyncio<span class="token punctuation">.</span>wait<span class="token punctuation">(</span>tasks<span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="21"></td><td><pre>loop<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr></table></figure><p>由示例可见，通过异步 IO，我们可以实现一个线程通过 coroutine 来并发完成多个任务。</p><p>如果将 asyncio 用在服务器端，例如 Web 服务器，由于 HTTP 连接就是 IO 操作，因此可以用 单线程 + <code>coroutine</code> 实现多用户的高并发支持。</p><blockquote><p>相关扩展内容：<span class="exturl" data-url="aHR0cHM6Ly9yZWFscHl0aG9uLmNvbS9hc3luYy1pby1weXRob24=">https://realpython.com/async-io-python</span></p></blockquote><h4 id="aiohttp"><a class="anchor" href="#aiohttp">#</a> aiohttp</h4><p>asyncio 实现了 TCP、UDP、SSL 等协议，aiohttp 则是基于 asyncio 实现的 HTTP 框架。</p><p>安装 aiohttp ：</p><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre>$ pip <span class="token function">install</span> aiohttp</pre></td></tr></table></figure><p>异步创建 TCP 服务：</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">import</span> asyncio</pre></td></tr><tr><td data-num="2"></td><td><pre></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">from</span> aiohttp <span class="token keyword">import</span> web</pre></td></tr><tr><td data-num="4"></td><td><pre></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token keyword">async</span> <span class="token keyword">def</span> <span class="token function">index</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    <span class="token keyword">await</span> asyncio<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">0.5</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="7"></td><td><pre>    <span class="token keyword">return</span> web<span class="token punctuation">.</span>Response<span class="token punctuation">(</span>body<span class="token operator">=</span><span class="token string">b'&lt;h1>Index&lt;/h1>'</span><span class="token punctuation">,</span> content_type<span class="token operator">=</span><span class="token string">'text/html'</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="8"></td><td><pre></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token keyword">async</span> <span class="token keyword">def</span> <span class="token function">hello</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="10"></td><td><pre>    <span class="token keyword">await</span> asyncio<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">0.5</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="11"></td><td><pre>    text <span class="token operator">=</span> <span class="token string">'&lt;h1>hello, %s!&lt;/h1>'</span> <span class="token operator">%</span> request<span class="token punctuation">.</span>match_info<span class="token punctuation">[</span><span class="token string">'name'</span><span class="token punctuation">]</span></pre></td></tr><tr><td data-num="12"></td><td><pre>    <span class="token keyword">return</span> web<span class="token punctuation">.</span>Response<span class="token punctuation">(</span>body<span class="token operator">=</span>text<span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> content_type<span class="token operator">=</span><span class="token string">'text/html'</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="13"></td><td><pre></pre></td></tr><tr><td data-num="14"></td><td><pre><span class="token keyword">async</span> <span class="token keyword">def</span> <span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="15"></td><td><pre>    app <span class="token operator">=</span> web<span class="token punctuation">.</span>Application<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="16"></td><td><pre>    app<span class="token punctuation">.</span>router<span class="token punctuation">.</span>add_get<span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">,</span> index<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="17"></td><td><pre>    app<span class="token punctuation">.</span>router<span class="token punctuation">.</span>add_get<span class="token punctuation">(</span><span class="token string">'/hello/&#123;name&#125;'</span><span class="token punctuation">,</span> hello<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="18"></td><td><pre>    runner <span class="token operator">=</span> web<span class="token punctuation">.</span>AppRunner<span class="token punctuation">(</span>app<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="19"></td><td><pre>    <span class="token keyword">await</span> runner<span class="token punctuation">.</span>setup<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="20"></td><td><pre>    site <span class="token operator">=</span> web<span class="token punctuation">.</span>TCPSite<span class="token punctuation">(</span>runner<span class="token punctuation">,</span> <span class="token string">'127.0.0.1'</span><span class="token punctuation">,</span> <span class="token number">8000</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="21"></td><td><pre>    <span class="token keyword">await</span> site<span class="token punctuation">.</span>start<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="22"></td><td><pre>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Server started at http://127.0.0.1:8000...'</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="23"></td><td><pre>    <span class="token keyword">return</span> site</pre></td></tr><tr><td data-num="24"></td><td><pre></pre></td></tr><tr><td data-num="25"></td><td><pre>loop <span class="token operator">=</span> asyncio<span class="token punctuation">.</span>get_event_loop<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="26"></td><td><pre>loop<span class="token punctuation">.</span>run_until_complete<span class="token punctuation">(</span>init<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="27"></td><td><pre>loop<span class="token punctuation">.</span>run_forever<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr></table></figure><h3 id="项目实践"><a class="anchor" href="#项目实践">#</a> 项目实践</h3><h4 id="参考学习项目"><a class="anchor" href="#参考学习项目">#</a> 参考学习项目</h4><blockquote><p>由于个人能力所限，这里的项目实战主要着重介绍 Python Web 相关项目，如后续有其他 Python 方向，将记录在单独的文章中。</p></blockquote><p>由于手动编写项目实战篇幅较大，而且也费时很长，这里提供几个开源项目进行学习，看懂这些代码，并且能够根据自身需要，对这些代码进行符合自己业务需求的修改，如果你仔细梳理过这些开源项目，相信你对于常规的 Python 项目开发，都能够得心应手。</p><table><thead><tr><th>项目名</th><th>官网</th><th>备注</th></tr></thead><tbody><tr><td>Django-Vue-Admin</td><td><span class="exturl" data-url="aHR0cHM6Ly9kamFuZ28tdnVlLWFkbWluLmNvbQ==">https://django-vue-admin.com</span></td><td>WEB 应用，基于 RuoYi</td></tr><tr><td>Simple UI</td><td><span class="exturl" data-url="aHR0cHM6Ly9zaW1wbGV1aS43MndvLmNvbS9zaW1wbGV1aQ==">https://simpleui.72wo.com/simpleui</span></td><td>WEB 应用，博客系统</td></tr></tbody></table><h4 id="自主开发项目"><a class="anchor" href="#自主开发项目">#</a> 自主开发项目</h4><p>学习完上面的基础知识，尝试用已掌握的知识开发一个自己的项目吧！</p><p><span class="label danger">❗️TODO</span> 待完善</p><h3 id="文末总结"><a class="anchor" href="#文末总结">#</a> 文末总结</h3><div class="note info"><p>跟着廖雪峰的官网教程过了一遍，除去实战部分，大约用了一个月的时间，总体来说感觉难度不是太大，大概是因为有三四年的 Java 开发经验垫底的缘故吧，一些知识上手感觉还是挺快的。但也有些部分是随意跳过了的，对于这些，我都是一旦梳理清了逻辑，就照搬了廖雪峰官网的代码作为记录。但以我自己的经验来看，这应该不是什么大问题，重要在于结合实际项目，零星的知识点太过于孤立，而且当接触了多种开发语言后，单独理解某一两个独立的知识点也是容易引起混淆的。最有效的方法还是学习了这些基础知识后，完完整整地应用到实际的项目中，这不仅可以帮助加深印象，也可以将各个知识点贯穿进行理解。而且在实际项目中，很多问题才会更加直观地呈现出来。</p></div><h3 id="参考"><a class="anchor" href="#参考">#</a> 参考</h3><ul><li>独立博客：<span class="exturl" data-url="aHR0cHM6Ly93d3cubGlhb3h1ZWZlbmcuY29tL3dpa2kvMTAxNjk1OTY2MzYwMjQwMA==">廖雪峰的官方网站</span></li></ul><div class="tags"><a href="/tags/python/" rel="tag"><i class="ic i-tag"></i> python</a></div></div><footer><div class="meta"><span id="computer-science/python/python-all-base/" class="item leancloud_visitors" data-flag-title="Python 基础知识全通关" title="閲覧数"><span class="icon"><i class="ic i-eye"></i> </span><span class="text">閲覧数</span> <span class="leancloud-visitors-count"></span> <span class="text">回</span></span></div><div class="reward"><button><i class="ic i-heartbeat"></i> 寄付</button><p>*~(￣▽￣)~[お茶]を一杯ください</p><div id="qr"><div><img data-src="/images/wechatpay.png" alt="チンモク WeChat 支払う"><p>WeChat 支払う</p></div><div><img data-src="/images/alipay.png" alt="チンモク Alipay"><p>Alipay</p></div><div><img data-src="/images/paypal.png" alt="チンモク PayPal"><p>PayPal</p></div></div></div><div id="copyright"><ul><li class="author"><strong>著者： </strong>チンモク <i class="ic i-at"><em>@</em></i>チンモクのブログ</li><li class="link"><strong>記事へのリンク：</strong> <a href="https://www.chinmoku.cc/computer-science/python/python-all-base/" title="Python 基础知识全通关">https://www.chinmoku.cc/computer-science/python/python-all-base/</a></li><li class="license"><strong>著作権表示： </strong>このブログ内のすべての記事は、特別な記載がない限り <span class="exturl" data-url="aHR0cHM6Ly9jcmVhdGl2ZWNvbW1vbnMub3JnL2xpY2Vuc2VzL2J5LW5jLXNhLzQuMC9kZWVkLnpo"><i class="ic i-creative-commons"><em>(CC)</em></i>BY-NC-SA</span> の下のライセンスで保護されています。</li></ul></div></footer></article></div><div class="post-nav"><div class="item left"><a href="/computer-science/java-learning-path/2-intermediate/webservice-tutorial/" itemprop="url" rel="prev" data-background-image="https:&#x2F;&#x2F;reference-1301046789.cos.ap-nanjing.myqcloud.com&#x2F;blog-img&#x2F;956184f0881a11ebb6edd017c2d2eca2.jpg" title="WebService，如此而已"><span class="type">前の記事</span> <span class="category"><i class="ic i-flag"></i> 进阶篇</span><h3>WebService，如此而已</h3></a></div><div class="item right"><a href="/language/japanese/standard-japanese/standard-japanese-02-ing/" itemprop="url" rel="next" data-background-image="https:&#x2F;&#x2F;reference-1301046789.cos.ap-nanjing.myqcloud.com&#x2F;blog-img&#x2F;098dcf3d770e481385c3eafc7c1f7dd1.jpg" title="標準日本語の入門（二）"><span class="type">次の記事</span> <span class="category"><i class="ic i-flag"></i> 標準日本語入門</span><h3>標準日本語の入門（二）</h3></a></div></div><div class="wrap" id="comments"></div></div><div id="sidebar"><div class="inner"><div class="panels"><div class="inner"><div class="contents panel pjax" data-title="見出し"><ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AE%80%E4%BB%8B"><span class="toc-number">1.</span> <span class="toc-text">简介</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%89%E8%A3%85"><span class="toc-number">2.</span> <span class="toc-text">安装</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#windows-%E7%8E%AF%E5%A2%83"><span class="toc-number">2.1.</span> <span class="toc-text">Windows 环境</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#linux-%E7%8E%AF%E5%A2%83"><span class="toc-number">2.2.</span> <span class="toc-text">Linux 环境</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#hello-world"><span class="toc-number">3.</span> <span class="toc-text">Hello World</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%91%BD%E4%BB%A4%E8%A1%8C%E6%A8%A1%E5%BC%8F%E4%B8%8E-python-%E4%BA%A4%E4%BA%92%E6%A8%A1%E5%BC%8F"><span class="toc-number">3.1.</span> <span class="toc-text">命令行模式与 Python 交互模式</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%80%89%E6%8B%A9%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7"><span class="toc-number">3.2.</span> <span class="toc-text">选择开发工具</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%BE%93%E5%85%A5%E6%89%93%E5%8D%B0"><span class="toc-number">3.3.</span> <span class="toc-text">输入打印</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#python-%E5%9F%BA%E7%A1%80"><span class="toc-number">4.</span> <span class="toc-text">Python 基础</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B%E5%92%8C%E5%8F%98%E9%87%8F"><span class="toc-number">4.1.</span> <span class="toc-text">数据类型和变量</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AD%97%E7%AC%A6%E4%B8%B2%E5%92%8C%E7%BC%96%E7%A0%81"><span class="toc-number">4.2.</span> <span class="toc-text">字符串和编码</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#list-%E5%92%8C-tuple"><span class="toc-number">4.3.</span> <span class="toc-text">list 和 tuple</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#list"><span class="toc-number">4.3.1.</span> <span class="toc-text">list</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#tuple"><span class="toc-number">4.3.2.</span> <span class="toc-text">tuple</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%9D%A1%E4%BB%B6%E5%88%A4%E6%96%AD"><span class="toc-number">4.4.</span> <span class="toc-text">条件判断</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%BE%AA%E7%8E%AF"><span class="toc-number">4.5.</span> <span class="toc-text">循环</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#dict-%E5%92%8C-set"><span class="toc-number">4.6.</span> <span class="toc-text">dict 和 set</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#dict"><span class="toc-number">4.6.1.</span> <span class="toc-text">dict</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#set"><span class="toc-number">4.6.2.</span> <span class="toc-text">set</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%87%BD%E6%95%B0"><span class="toc-number">5.</span> <span class="toc-text">函数</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%B0%83%E7%94%A8%E5%87%BD%E6%95%B0"><span class="toc-number">5.1.</span> <span class="toc-text">调用函数</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AE%9A%E4%B9%89%E5%87%BD%E6%95%B0"><span class="toc-number">5.2.</span> <span class="toc-text">定义函数</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%87%BD%E6%95%B0%E7%9A%84%E5%8F%82%E6%95%B0"><span class="toc-number">5.3.</span> <span class="toc-text">函数的参数</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%80%92%E5%BD%92%E5%87%BD%E6%95%B0"><span class="toc-number">5.4.</span> <span class="toc-text">递归函数</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%AB%98%E7%BA%A7%E7%89%B9%E6%80%A7"><span class="toc-number">6.</span> <span class="toc-text">高级特性</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%88%87%E7%89%87"><span class="toc-number">6.1.</span> <span class="toc-text">切片</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%BF%AD%E4%BB%A3"><span class="toc-number">6.2.</span> <span class="toc-text">迭代</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%88%97%E8%A1%A8%E7%94%9F%E6%88%90%E5%BC%8F"><span class="toc-number">6.3.</span> <span class="toc-text">列表生成式</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%94%9F%E6%88%90%E5%99%A8"><span class="toc-number">6.4.</span> <span class="toc-text">生成器</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%BF%AD%E4%BB%A3%E5%99%A8"><span class="toc-number">6.5.</span> <span class="toc-text">迭代器</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%87%BD%E6%95%B0%E5%BC%8F%E7%BC%96%E7%A8%8B"><span class="toc-number">7.</span> <span class="toc-text">函数式编程</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%AB%98%E9%98%B6%E5%87%BD%E6%95%B0"><span class="toc-number">7.1.</span> <span class="toc-text">高阶函数</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#map-reduce"><span class="toc-number">7.1.1.</span> <span class="toc-text">map &#x2F; reduce</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#filter"><span class="toc-number">7.1.2.</span> <span class="toc-text">filter</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#sorted"><span class="toc-number">7.1.3.</span> <span class="toc-text">sorted</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%BF%94%E5%9B%9E%E5%87%BD%E6%95%B0"><span class="toc-number">7.2.</span> <span class="toc-text">返回函数</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8C%BF%E5%90%8D%E5%87%BD%E6%95%B0"><span class="toc-number">7.3.</span> <span class="toc-text">匿名函数</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%A3%85%E9%A5%B0%E5%99%A8"><span class="toc-number">7.4.</span> <span class="toc-text">装饰器</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%81%8F%E5%87%BD%E6%95%B0"><span class="toc-number">7.5.</span> <span class="toc-text">偏函数</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A8%A1%E5%9D%97"><span class="toc-number">8.</span> <span class="toc-text">模块</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E6%A8%A1%E5%9D%97"><span class="toc-number">8.1.</span> <span class="toc-text">使用模块</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AE%89%E8%A3%85%E7%AC%AC%E4%B8%89%E6%96%B9%E6%A8%A1%E5%9D%97"><span class="toc-number">8.2.</span> <span class="toc-text">安装第三方模块</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1%E7%BC%96%E7%A8%8B"><span class="toc-number">9.</span> <span class="toc-text">面向对象编程</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%B1%BB%E5%92%8C%E5%AE%9E%E4%BE%8B"><span class="toc-number">9.1.</span> <span class="toc-text">类和实例</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%AE%BF%E9%97%AE%E9%99%90%E5%88%B6"><span class="toc-number">9.2.</span> <span class="toc-text">访问限制</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%BB%A7%E6%89%BF%E5%92%8C%E5%A4%9A%E6%80%81"><span class="toc-number">9.3.</span> <span class="toc-text">继承和多态</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96%E5%AF%B9%E8%B1%A1%E4%BF%A1%E6%81%AF"><span class="toc-number">9.4.</span> <span class="toc-text">获取对象信息</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AE%9E%E4%BE%8B%E5%B1%9E%E6%80%A7%E5%92%8C%E7%B1%BB%E5%B1%9E%E6%80%A7"><span class="toc-number">9.5.</span> <span class="toc-text">实例属性和类属性</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1%E9%AB%98%E7%BA%A7%E7%BC%96%E7%A8%8B"><span class="toc-number">10.</span> <span class="toc-text">面向对象高级编程</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#_slots_"><span class="toc-number">10.1.</span> <span class="toc-text">_slots_</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#property"><span class="toc-number">10.2.</span> <span class="toc-text">@property</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%A4%9A%E9%87%8D%E7%BB%A7%E6%89%BF"><span class="toc-number">10.3.</span> <span class="toc-text">多重继承</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AE%9A%E5%88%B6%E7%B1%BB"><span class="toc-number">10.4.</span> <span class="toc-text">定制类</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#_str_"><span class="toc-number">10.4.1.</span> <span class="toc-text">_str_</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#_iter_"><span class="toc-number">10.4.2.</span> <span class="toc-text">_iter_</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#_getitem_"><span class="toc-number">10.4.3.</span> <span class="toc-text">_getitem_</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#_getattr_"><span class="toc-number">10.4.4.</span> <span class="toc-text">_getattr_</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#_call_"><span class="toc-number">10.4.5.</span> <span class="toc-text">_call_</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%9E%9A%E4%B8%BE%E7%B1%BB"><span class="toc-number">10.5.</span> <span class="toc-text">枚举类</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%85%83%E7%B1%BB"><span class="toc-number">10.6.</span> <span class="toc-text">元类</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%94%99%E8%AF%AF-%E8%B0%83%E8%AF%95%E5%92%8C%E6%B5%8B%E8%AF%95"><span class="toc-number">11.</span> <span class="toc-text">错误、调试和测试</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%94%99%E8%AF%AF%E5%A4%84%E7%90%86"><span class="toc-number">11.1.</span> <span class="toc-text">错误处理</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%B0%83%E8%AF%95"><span class="toc-number">11.2.</span> <span class="toc-text">调试</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8D%95%E5%85%83%E6%B5%8B%E8%AF%95"><span class="toc-number">11.3.</span> <span class="toc-text">单元测试</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%96%87%E6%A1%A3%E6%B5%8B%E8%AF%95"><span class="toc-number">11.4.</span> <span class="toc-text">文档测试</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#io%E7%BC%96%E7%A8%8B"><span class="toc-number">12.</span> <span class="toc-text">IO 编程</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%96%87%E4%BB%B6%E7%9A%84%E8%AF%BB%E5%86%99"><span class="toc-number">12.1.</span> <span class="toc-text">文件的读写</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#stringio-%E4%B8%8E-bytesio"><span class="toc-number">12.2.</span> <span class="toc-text">StringIO 与 BytesIO</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%93%8D%E4%BD%9C%E6%96%87%E4%BB%B6%E5%92%8C%E7%9B%AE%E5%BD%95"><span class="toc-number">12.3.</span> <span class="toc-text">操作文件和目录</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%BA%8F%E5%88%97%E5%8C%96"><span class="toc-number">12.4.</span> <span class="toc-text">序列化</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%BF%9B%E7%A8%8B%E5%92%8C%E7%BA%BF%E7%A8%8B"><span class="toc-number">13.</span> <span class="toc-text">进程和线程</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%A4%9A%E8%BF%9B%E7%A8%8B"><span class="toc-number">13.1.</span> <span class="toc-text">多进程</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%A4%9A%E7%BA%BF%E7%A8%8B"><span class="toc-number">13.2.</span> <span class="toc-text">多线程</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#threadlocal"><span class="toc-number">13.3.</span> <span class="toc-text">ThreadLocal</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%BF%9B%E7%A8%8B%E4%B8%8E%E7%BA%BF%E7%A8%8B%E5%AF%B9%E6%AF%94"><span class="toc-number">13.4.</span> <span class="toc-text">进程与线程对比</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%88%86%E5%B8%83%E5%BC%8F%E7%BA%BF%E7%A8%8B"><span class="toc-number">13.5.</span> <span class="toc-text">分布式线程</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F"><span class="toc-number">14.</span> <span class="toc-text">正则表达式</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B8%B8%E7%94%A8%E5%86%85%E5%BB%BA%E6%A8%A1%E5%9D%97"><span class="toc-number">15.</span> <span class="toc-text">常用内建模块</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#datetime"><span class="toc-number">15.1.</span> <span class="toc-text">datetime</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#collections"><span class="toc-number">15.2.</span> <span class="toc-text">collections</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#base64"><span class="toc-number">15.3.</span> <span class="toc-text">base64</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#struct"><span class="toc-number">15.4.</span> <span class="toc-text">struct</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#hashlib"><span class="toc-number">15.5.</span> <span class="toc-text">hashlib</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#hmac"><span class="toc-number">15.6.</span> <span class="toc-text">hmac</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#itertools"><span class="toc-number">15.7.</span> <span class="toc-text">itertools</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#contextlib"><span class="toc-number">15.8.</span> <span class="toc-text">contextlib</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#urllib"><span class="toc-number">15.9.</span> <span class="toc-text">urllib</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#xml"><span class="toc-number">15.10.</span> <span class="toc-text">XML</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#htmlparser"><span class="toc-number">15.11.</span> <span class="toc-text">HTMLParser</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B8%B8%E7%94%A8%E7%AC%AC%E4%B8%89%E6%96%B9%E6%A8%A1%E5%9D%97"><span class="toc-number">16.</span> <span class="toc-text">常用第三方模块</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#pillow"><span class="toc-number">16.1.</span> <span class="toc-text">Pillow</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#requests"><span class="toc-number">16.2.</span> <span class="toc-text">requests</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#chardet"><span class="toc-number">16.3.</span> <span class="toc-text">chardet</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#psutil"><span class="toc-number">16.4.</span> <span class="toc-text">psutil</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#virtualenv"><span class="toc-number">17.</span> <span class="toc-text">virtualenv</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9B%BE%E5%BD%A2%E7%95%8C%E9%9D%A2"><span class="toc-number">18.</span> <span class="toc-text">图形界面</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%B5%B7%E9%BE%9F%E7%BB%98%E5%9B%BE"><span class="toc-number">18.1.</span> <span class="toc-text">海龟绘图</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B"><span class="toc-number">19.</span> <span class="toc-text">网络编程</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#tcpip-%E7%AE%80%E4%BB%8B"><span class="toc-number">19.1.</span> <span class="toc-text">TCP&#x2F;IP 简介</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#tcp%E7%BC%96%E7%A8%8B"><span class="toc-number">19.2.</span> <span class="toc-text">TCP 编程</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#udp%E7%BC%96%E7%A8%8B"><span class="toc-number">19.3.</span> <span class="toc-text">UDP 编程</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%94%B5%E5%AD%90%E9%82%AE%E4%BB%B6"><span class="toc-number">20.</span> <span class="toc-text">电子邮件</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#smtp-%E5%8F%91%E9%80%81%E9%82%AE%E4%BB%B6"><span class="toc-number">20.1.</span> <span class="toc-text">SMTP 发送邮件</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#pop3-%E6%94%B6%E5%8F%96%E9%82%AE%E4%BB%B6"><span class="toc-number">20.2.</span> <span class="toc-text">POP3 收取邮件</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E5%BA%93%E8%AE%BF%E9%97%AE"><span class="toc-number">21.</span> <span class="toc-text">数据库访问</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8sqlite"><span class="toc-number">21.1.</span> <span class="toc-text">使用 SQLite</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8mysql"><span class="toc-number">21.2.</span> <span class="toc-text">使用 MySQL</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8sqlalchemy"><span class="toc-number">21.3.</span> <span class="toc-text">使用 SQLAlchemy</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web-%E5%BC%80%E5%8F%91"><span class="toc-number">22.</span> <span class="toc-text">Web 开发</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#http-%E5%8D%8F%E8%AE%AE%E7%AE%80%E4%BB%8B"><span class="toc-number">22.1.</span> <span class="toc-text">HTTP 协议简介</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#html-%E7%AE%80%E4%BB%8B"><span class="toc-number">22.2.</span> <span class="toc-text">HTML 简介</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#wsgi-%E6%8E%A5%E5%8F%A3"><span class="toc-number">22.3.</span> <span class="toc-text">WSGI 接口</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8-web-%E6%A1%86%E6%9E%B6"><span class="toc-number">22.4.</span> <span class="toc-text">使用 Web 框架</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E6%A8%A1%E6%9D%BF"><span class="toc-number">22.5.</span> <span class="toc-text">使用模板</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BC%82%E6%AD%A5io"><span class="toc-number">23.</span> <span class="toc-text">异步 IO</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8D%8F%E7%A8%8B"><span class="toc-number">23.1.</span> <span class="toc-text">协程</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#asyncio"><span class="toc-number">23.2.</span> <span class="toc-text">asyncio</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#aiohttp"><span class="toc-number">23.3.</span> <span class="toc-text">aiohttp</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%A1%B9%E7%9B%AE%E5%AE%9E%E8%B7%B5"><span class="toc-number">24.</span> <span class="toc-text">项目实践</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8F%82%E8%80%83%E5%AD%A6%E4%B9%A0%E9%A1%B9%E7%9B%AE"><span class="toc-number">24.1.</span> <span class="toc-text">参考学习项目</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%87%AA%E4%B8%BB%E5%BC%80%E5%8F%91%E9%A1%B9%E7%9B%AE"><span class="toc-number">24.2.</span> <span class="toc-text">自主开发项目</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%96%87%E6%9C%AB%E6%80%BB%E7%BB%93"><span class="toc-number">25.</span> <span class="toc-text">文末总结</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8F%82%E8%80%83"><span class="toc-number">26.</span> <span class="toc-text">参考</span></a></li></ol></div><div class="related panel pjax" data-title="関連記事"><ul><li class="active"><a href="/computer-science/python/python-all-base/" rel="bookmark" title="Python 基础知识全通关">Python 基础知识全通关</a></li><li><a href="/computer-science/python/django-tutorial/" rel="bookmark" title="Django 网站全栈开发教程">Django 网站全栈开发教程</a></li></ul></div><div class="overview panel" data-title="概要"><div class="author" itemprop="author" itemscope itemtype="http://schema.org/Person"><img class="image" itemprop="image" alt="チンモク" data-src="/images/avatar.jpg"><p class="name" itemprop="name">チンモク</p><div class="description" itemprop="description">本站主要以 Java 开发总结文章为主，也会向技术周边进行适当的扩展。此外，偶尔会更新部分其他学习或感兴趣的内容，如语言学习、文本翻译、文艺创作等。</div></div><nav class="state"><div class="item posts"><a href="/archives/"><span class="count">20</span> <span class="name">ポスト</span></a></div><div class="item categories"><a href="/categories/"><span class="count">13</span> <span class="name">カテゴリ</span></a></div><div class="item tags"><a href="/tags/"><span class="count">17</span> <span class="name">タグ</span></a></div></nav><div class="social"><span class="exturl item github" data-url="aHR0cHM6Ly9naXRodWIuY29tL3hmYy1leGNsYXZl" title="https:&#x2F;&#x2F;github.com&#x2F;xfc-exclave"><i class="ic i-github"></i></span> <span class="exturl item twitter" data-url="aHR0cHM6Ly90d2l0dGVyLmNvbS95b3VybmFtZQ==" title="https:&#x2F;&#x2F;twitter.com&#x2F;yourname"><i class="ic i-twitter"></i></span> <span class="exturl item zhihu" data-url="aHR0cHM6Ly93d3cuemhpaHUuY29tL3Blb3BsZS95b3VybmFtZQ==" title="https:&#x2F;&#x2F;www.zhihu.com&#x2F;people&#x2F;yourname"><i class="ic i-zhihu"></i></span> <span class="exturl item music" data-url="aHR0cHM6Ly9tdXNpYy4xNjMuY29tLyMvdXNlci9ob21lP2lkPTExMjg2ODg2Mw==" title="https:&#x2F;&#x2F;music.163.com&#x2F;#&#x2F;user&#x2F;home?id&#x3D;112868863"><i class="ic i-cloud-music"></i></span> <span class="exturl item weibo" data-url="aHR0cHM6Ly93ZWliby5jb20vYW1laGltZQ==" title="https:&#x2F;&#x2F;weibo.com&#x2F;amehime"><i class="ic i-weibo"></i></span> <span class="exturl item about" data-url="aHR0cHM6Ly9hYm91dC5tZS95b3VybmFtZQ==" title="https:&#x2F;&#x2F;about.me&#x2F;yourname"><i class="ic i-address-card"></i></span> <span class="exturl item email" data-url="bWFpbHRvOnhmY19leGNsYXZlQDE2My5jb20=" title="mailto:xfc_exclave@163.com"><i class="ic i-envelope"></i></span></div><ul class="menu"><li class="item"><a href="/" rel="section"><i class="ic i-home"></i>ホーム</a></li><li class="item dropdown"><a href="javascript:void(0);"><i class="ic i-feather"></i>投稿</a><ul class="submenu"><li class="item"><a href="/archives/" rel="section"><i class="ic i-list-alt"></i>アーカイブ</a></li><li class="item"><a href="/categories/" rel="section"><i class="ic i-th"></i>カテゴリ</a></li><li class="item"><a href="/tags/" rel="section"><i class="ic i-tags"></i>タグ</a></li></ul></li><li class="item dropdown"><a href="javascript:void(0);"><i class="ic i-link-circle"></i>リンク</a><ul class="submenu"><li class="item"><a href="/friends/" rel="section"><i class="ic i-heart"></i>友人帳</a></li><li class="item"><a href="/websites/" rel="section"><i class="ic i-sun"></i>サイト</a></li></ul></li><li class="item"><a href="/plan/" rel="section"><i class="ic i-stars"></i>学習計画</a></li></ul></div></div></div><ul id="quick"><li class="prev pjax"><a href="/computer-science/java-learning-path/2-intermediate/webservice-tutorial/" rel="prev" title="前の記事"><i class="ic i-chevron-left"></i></a></li><li class="up"><i class="ic i-arrow-up"></i></li><li class="down"><i class="ic i-arrow-down"></i></li><li class="next pjax"><a href="/language/japanese/standard-japanese/standard-japanese-02-ing/" rel="next" title="次の記事"><i class="ic i-chevron-right"></i></a></li><li class="percent"></li></ul></div></div><div class="dimmer"></div></div></main><footer id="footer"><div class="inner"><div class="widgets"><div class="rpost pjax"><h2>ランダムな記事</h2><ul><li class="item"><div class="breadcrumb"></div><span><a href="/blog-log/" title="【长期置顶】博客文章更新日志">【长期置顶】博客文章更新日志</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/computer-science/" title="カテゴリ 计算机科学">计算机科学</a> <i class="ic i-angle-right"></i> <a href="/categories/computer-science/java-learning-path/" title="カテゴリ JAVA 学习路线">JAVA 学习路线</a> <i class="ic i-angle-right"></i> <a href="/categories/computer-science/java-learning-path/%E8%BF%9B%E9%98%B6%E7%AF%87/" title="カテゴリ 进阶篇">进阶篇</a></div><span><a href="/computer-science/java-learning-path/2-intermediate/springcloud-tutorial/" title="SpringCloud 教程（Finchley.RELEASE）">SpringCloud 教程（Finchley.RELEASE）</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/computer-science/" title="カテゴリ 计算机科学">计算机科学</a> <i class="ic i-angle-right"></i> <a href="/categories/computer-science/java-learning-path/" title="カテゴリ JAVA 学习路线">JAVA 学习路线</a> <i class="ic i-angle-right"></i> <a href="/categories/computer-science/java-learning-path/%E8%BF%9B%E9%98%B6%E7%AF%87/" title="カテゴリ 进阶篇">进阶篇</a></div><span><a href="/computer-science/java-learning-path/2-intermediate/webservice-tutorial/" title="WebService，如此而已">WebService，如此而已</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/computer-science/" title="カテゴリ 计算机科学">计算机科学</a> <i class="ic i-angle-right"></i> <a href="/categories/computer-science/java-learning-path/" title="カテゴリ JAVA 学习路线">JAVA 学习路线</a> <i class="ic i-angle-right"></i> <a href="/categories/computer-science/java-learning-path/%E5%9F%BA%E7%A1%80%E7%AF%87/" title="カテゴリ 基础篇">基础篇</a></div><span><a href="/computer-science/java-learning-path/1-basic/01-java-basic/" title="JAVA 基础知识大盘点">JAVA 基础知识大盘点</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/computer-science/" title="カテゴリ 计算机科学">计算机科学</a> <i class="ic i-angle-right"></i> <a href="/categories/computer-science/java-learning-path/" title="カテゴリ JAVA 学习路线">JAVA 学习路线</a> <i class="ic i-angle-right"></i> <a href="/categories/computer-science/java-learning-path/%E8%BF%9B%E9%98%B6%E7%AF%87/" title="カテゴリ 进阶篇">进阶篇</a></div><span><a href="/computer-science/java-learning-path/2-intermediate/mybatis-tutorial/" title="MyBatis 教程">MyBatis 教程</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/computer-science/" title="カテゴリ 计算机科学">计算机科学</a> <i class="ic i-angle-right"></i> <a href="/categories/computer-science/java-learning-path/" title="カテゴリ JAVA 学习路线">JAVA 学习路线</a> <i class="ic i-angle-right"></i> <a href="/categories/computer-science/java-learning-path/%E8%BF%9B%E9%98%B6%E7%AF%87/" title="カテゴリ 进阶篇">进阶篇</a></div><span><a href="/computer-science/java-learning-path/2-intermediate/spring-tutorial/" title="Spring 教程">Spring 教程</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/computer-science/" title="カテゴリ 计算机科学">计算机科学</a> <i class="ic i-angle-right"></i> <a href="/categories/computer-science/Python%E5%85%A5%E9%97%A8%E6%95%99%E7%A8%8B/" title="カテゴリ Python 入门教程">Python 入门教程</a></div><span><a href="/computer-science/python/python-all-base/" title="Python 基础知识全通关">Python 基础知识全通关</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/computer-science/" title="カテゴリ 计算机科学">计算机科学</a> <i class="ic i-angle-right"></i> <a href="/categories/computer-science/java-learning-path/" title="カテゴリ JAVA 学习路线">JAVA 学习路线</a> <i class="ic i-angle-right"></i> <a href="/categories/computer-science/java-learning-path/%E9%AB%98%E7%BA%A7%E7%AF%87/" title="カテゴリ 高级篇">高级篇</a></div><span><a href="/computer-science/java-learning-path/3-advanced/mongodb-tutorial/" title="MongoDB 基础教程">MongoDB 基础教程</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/computer-science/" title="カテゴリ 计算机科学">计算机科学</a> <i class="ic i-angle-right"></i> <a href="/categories/computer-science/java-learning-path/" title="カテゴリ JAVA 学习路线">JAVA 学习路线</a> <i class="ic i-angle-right"></i> <a href="/categories/computer-science/java-learning-path/%E5%9F%BA%E7%A1%80%E7%AF%87/" title="カテゴリ 基础篇">基础篇</a></div><span><a href="/computer-science/java-learning-path/1-basic/02-java-concurrency/" title="Java 并发编程知识整理">Java 并发编程知识整理</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/%E5%BB%BA%E7%AB%99%E5%91%A8%E8%BE%B9%E7%9F%A5%E8%AF%86/" title="カテゴリ 建站周边知识">建站周边知识</a></div><span><a href="/computer-science/others/blog-without-server/" title="Hexo - 技术小白搭建个人博客">Hexo - 技术小白搭建个人博客</a></span></li></ul></div><div><h2>最近のコメント</h2><ul class="leancloud-recent-comment"></ul></div></div><div class="status"><div class="copyright">&copy; 2020 – <span itemprop="copyrightYear">2021</span> <span class="with-love"><i class="ic i-sakura rotate"></i> </span><span class="author" itemprop="copyrightHolder">チンモク @ Chinmoku</span></div><div class="count"><span class="post-meta-item-icon"><i class="ic i-chart-area"></i> </span><span title="単語の総数">526k 単語</span> <span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="ic i-coffee"></i> </span><span title="読書の合計時間">7:58</span></div><div class="powered-by">Powered by <span class="exturl" data-url="aHR0cHM6Ly9oZXhvLmlv">Hexo</span> & Theme.<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2FtZWhpbWUvaGV4by10aGVtZS1zaG9rYQ==">Shoka</span></div></div></div></footer></div><script data-config type="text/javascript">var LOCAL={path:"computer-science/python/python-all-base/",favicon:{show:"（●´3｀●）やれやれだぜ",hide:"(´Д｀)大変だ！"},search:{placeholder:"検索…",empty:"「 ${query} 」については何も見つかりませんでした",stats:"${time} ms以内に ${hits} 件の結果が見つかりました"},valine:!0,copy_tex:!0,katex:!0,fancybox:!0,copyright:"コピーは成功しました。 <br> 再印刷については、 ％s 契約に従ってください。",ignores:[function(e){return e.includes("#")},function(e){return new RegExp(LOCAL.path+"$").test(e)}]}</script><script src="https://cdn.polyfill.io/v2/polyfill.js"></script><script src="//cdn.jsdelivr.net/combine/npm/pace-js@1.0.2/pace.min.js,npm/pjax@0.2.8/pjax.min.js,npm/whatwg-fetch@3.4.0/dist/fetch.umd.min.js,npm/animejs@3.2.0/lib/anime.min.js,npm/algoliasearch@4/dist/algoliasearch-lite.umd.js,npm/instantsearch.js@4/dist/instantsearch.production.min.js,npm/lozad@1/dist/lozad.min.js,npm/quicklink@2/dist/quicklink.umd.js"></script><script src="/js/app.js?v=0.2.5"></script></body></html>