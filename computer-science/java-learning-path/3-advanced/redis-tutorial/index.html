<!DOCTYPE html><html lang="ja"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=2"><meta name="theme-color" content="#FFF"><link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png"><link rel="icon" type="image/ico" sizes="32x32" href="/images/favicon.ico"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link rel="alternate" type="application/rss+xml" title="ãƒãƒ³ãƒ¢ã‚¯ã®ãƒ–ãƒ­ã‚°" href="https://www.chinmoku.cc/rss.xml"><link rel="alternate" type="application/atom+xml" title="ãƒãƒ³ãƒ¢ã‚¯ã®ãƒ–ãƒ­ã‚°" href="https://www.chinmoku.cc/atom.xml"><link rel="alternate" type="application/json" title="ãƒãƒ³ãƒ¢ã‚¯ã®ãƒ–ãƒ­ã‚°" href="https://www.chinmoku.cc/feed.json"><link rel="stylesheet" href="//fonts.googleapis.com/css?family=Mulish:300,300italic,400,400italic,700,700italic%7CFredericka%20the%20Great:300,300italic,400,400italic,700,700italic%7CNoto%20Serif%20JP:300,300italic,400,400italic,700,700italic%7CNoto%20Serif%20SC:300,300italic,400,400italic,700,700italic%7CInconsolata:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext"><link rel="stylesheet" href="/css/app.css?v=0.2.5"><meta name="keywords" content="java,Spring Cloud Alibaba"><link rel="canonical" href="https://www.chinmoku.cc/computer-science/java-learning-path/3-advanced/redis-tutorial/"><title>Redis å¦‚ä½•ä¿è¯é«˜æ€§èƒ½ - è¿›é˜¶ç¯‡ - JAVA å­¦ä¹ è·¯çº¿ - è®¡ç®—æœºç§‘å­¦ | Chinmoku = ãƒãƒ³ãƒ¢ã‚¯ã®ãƒ–ãƒ­ã‚° = éœ²ã®ä¸–ã¯ã€€éœ²ã®ä¸–ãªãŒã‚‰ã€€ã•ã‚ŠãªãŒã‚‰</title><meta name="generator" content="Hexo 5.4.0"></head><body itemscope itemtype="http://schema.org/WebPage"><div id="loading"><div class="cat"><div class="body"></div><div class="head"><div class="face"></div></div><div class="foot"><div class="tummy-end"></div><div class="bottom"></div><div class="legs left"></div><div class="legs right"></div></div><div class="paw"><div class="hands left"></div><div class="hands right"></div></div></div></div><div id="container"><header id="header" itemscope itemtype="http://schema.org/WPHeader"><div class="inner"><div id="brand"><div class="pjax"><h1 itemprop="name headline">Redis å¦‚ä½•ä¿è¯é«˜æ€§èƒ½</h1><div class="meta"><span class="item" title="ä½œæˆæ—¥ï¼š2022-02-14 12:08:17"><span class="icon"><i class="ic i-calendar"></i> </span><span class="text">æŠ•ç¨¿æ—¥</span> <time itemprop="dateCreated datePublished" datetime="2022-02-14T12:08:17+08:00">2022-02-14</time> </span><span class="item" title="å˜èªæ•°"><span class="icon"><i class="ic i-pen"></i> </span><span class="text">å˜èªæ•°</span> <span>22k</span> <span class="text">å˜èª</span> </span><span class="item" title="èª­æ›¸ã®æ™‚é–“"><span class="icon"><i class="ic i-clock"></i> </span><span class="text">èª­æ›¸ã®æ™‚é–“</span> <span>20 åˆ†</span></span></div></div></div><nav id="nav"><div class="inner"><div class="toggle"><div class="lines" aria-label="ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ãƒãƒ¼ã®åˆ‡ã‚Šæ›¿ãˆ"><span class="line"></span> <span class="line"></span> <span class="line"></span></div></div><ul class="menu"><li class="item title"><a href="/" rel="start">Chinmoku</a></li></ul><ul class="right"><li class="item theme"><i class="ic i-sun"></i></li><li class="item search"><i class="ic i-search"></i></li></ul></div></nav></div><div id="imgs" class="pjax"><ul><li class="item" data-background-image="https://reference-1301046789.cos.ap-nanjing.myqcloud.com/blog-img/4ae1442a0f73424c8987519b5681a4bd.jpg"></li><li class="item" data-background-image="https://reference-1301046789.cos.ap-nanjing.myqcloud.com/blog-img/4decaf34f91f4614832d697333b4ed9d.jpg"></li><li class="item" data-background-image="https://reference-1301046789.cos.ap-nanjing.myqcloud.com/blog-img/1bcdc38e208c49ec82ab8d479c377176.jpg"></li><li class="item" data-background-image="https://reference-1301046789.cos.ap-nanjing.myqcloud.com/blog-img/8ed354f4fff64091b043dcecfd6769a4.jpg"></li><li class="item" data-background-image="https://reference-1301046789.cos.ap-nanjing.myqcloud.com/blog-img/55c2ff13880611ebb6edd017c2d2eca2.png"></li><li class="item" data-background-image="https://reference-1301046789.cos.ap-nanjing.myqcloud.com/blog-img/07b503e152ef46a986cc0e6652bc0307.jpg"></li></ul></div></header><div id="waves"><svg class="waves" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto"><defs><path id="gentle-wave" d="M-160 44c30 0 58-18 88-18s 58 18 88 18 58-18 88-18 58 18 88 18 v44h-352z"/></defs><g class="parallax"><use xlink:href="#gentle-wave" x="48" y="0"/><use xlink:href="#gentle-wave" x="48" y="3"/><use xlink:href="#gentle-wave" x="48" y="5"/><use xlink:href="#gentle-wave" x="48" y="7"/></g></svg></div><main><div class="inner"><div id="main" class="pjax"><div class="article wrap"><div class="breadcrumb" itemscope itemtype="https://schema.org/BreadcrumbList"><i class="ic i-home"></i> <span><a href="/">ãƒ›ãƒ¼ãƒ </a></span><i class="ic i-angle-right"></i> <span itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem"><a href="/categories/computer-science/" itemprop="item" rel="index" title="ã‚«ãƒ†ã‚´ãƒª è®¡ç®—æœºç§‘å­¦"><span itemprop="name">è®¡ç®—æœºç§‘å­¦</span></a><meta itemprop="position" content="1"></span><i class="ic i-angle-right"></i> <span itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem"><a href="/categories/computer-science/java-learning-path/" itemprop="item" rel="index" title="ã‚«ãƒ†ã‚´ãƒª JAVA å­¦ä¹ è·¯çº¿"><span itemprop="name">JAVA å­¦ä¹ è·¯çº¿</span></a><meta itemprop="position" content="2"></span><i class="ic i-angle-right"></i> <span class="current" itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem"><a href="/categories/computer-science/java-learning-path/%E8%BF%9B%E9%98%B6%E7%AF%87/" itemprop="item" rel="index" title="ã‚«ãƒ†ã‚´ãƒª è¿›é˜¶ç¯‡"><span itemprop="name">è¿›é˜¶ç¯‡</span></a><meta itemprop="position" content="3"></span></div><article itemscope itemtype="http://schema.org/Article" class="post block" lang="ja"><link itemprop="mainEntityOfPage" href="https://www.chinmoku.cc/computer-science/java-learning-path/3-advanced/redis-tutorial/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/images/avatar.jpg"><meta itemprop="name" content="ãƒãƒ³ãƒ¢ã‚¯"><meta itemprop="description" content="éœ²ã®ä¸–ã¯ã€€éœ²ã®ä¸–ãªãŒã‚‰ã€€ã•ã‚ŠãªãŒã‚‰, æœ¬ç«™ä¸»è¦ä»¥ Java å¼€å‘æ€»ç»“æ–‡ç« ä¸ºä¸»ï¼Œä¹Ÿä¼šå‘æŠ€æœ¯å‘¨è¾¹è¿›è¡Œé€‚å½“çš„æ‰©å±•ã€‚æ­¤å¤–ï¼Œå¶å°”ä¼šæ›´æ–°éƒ¨åˆ†å…¶ä»–å­¦ä¹ æˆ–æ„Ÿå…´è¶£çš„å†…å®¹ï¼Œå¦‚è¯­è¨€å­¦ä¹ ã€æ–‡æœ¬ç¿»è¯‘ã€æ–‡è‰ºåˆ›ä½œç­‰ã€‚"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="ãƒãƒ³ãƒ¢ã‚¯ã®ãƒ–ãƒ­ã‚°"></span><div class="body md" itemprop="articleBody"><div class="note info no-icon"><p>æœ€è¿‘æ˜¯çœŸçš„æ˜¯å¤ªæ‡’äº†ğŸ˜¥ï¼Œéƒ½å¿«å¿˜è®°è¦å†™åšå®¢è¿™ä¸€å›äº‹äº†ã€‚ä¹‹å‰è¿˜å¯ä»¥å€Ÿå£è¯´å·¥ä½œå¤ªå¿™ï¼Œç°åœ¨å°±åªèƒ½å¦ç‡åœ°æ‰¿è®¤äº†ã€‚æ„è¯†åˆ°è¿™ç‚¹ï¼Œèµ¶ç´§ç‹ ç‹ åœ°å‘¼äº†è‡ªå·±ä¸€è€³å…‰ï¼Œç»§ç»­å­¦ä¹ ï¼ŒğŸ˜¡Fightingï¼ï¼ï¼ã€‚</p></div><h3 id="redis-ç®€ä»‹"><a class="anchor" href="#redis-ç®€ä»‹">#</a> Redis ç®€ä»‹</h3><blockquote><p>å…³äº NoSQL çš„ä¼˜ç¼ºç‚¹ï¼ŒåŠå…¶ä¸å…³ç³»å‹æ•°æ®åº“çš„å¯¹æ¯”ï¼Œæ­¤å‰å·²åœ¨ <a href="/computer-science/java-learning-path/3-advanced/mongodb-tutorial/">MongoDB åŸºç¡€æ•™ç¨‹</a>ä¸€æ–‡ä¸­å·²æœ‰æè¿°ï¼Œå¯è‡ªè¡Œå‰å¾€æŸ¥çœ‹ã€‚</p></blockquote><p>Redis è¯ç”Ÿäº 2009 å¹´ï¼Œå…¶å…¨ç§°æ˜¯ Remote Dictionary Serverï¼Œè¿œç¨‹è¯å…¸æœåŠ¡å™¨ï¼Œæ˜¯ä¸€ä¸ªåŸºäºå†…å­˜çš„é”®å€¼å‹ NoSQL æ•°æ®åº“ã€‚</p><p>Redis ç‰¹å¾ï¼š</p><ul><li>é”®å€¼å‹ï¼Œvalue æ”¯æŒå¤šç§ä¸åŒæ•°æ®ç»“æ„ï¼ŒåŠŸèƒ½ä¸°å¯Œã€‚</li><li>å•çº¿ç¨‹ï¼Œæ¯ä¸ªå‘½ä»¤å…·å¤‡åŸå­æ€§ã€‚</li><li>ä½å»¶è¿Ÿï¼Œé€Ÿåº¦å¿«ï¼ˆåŸºäºå†…å­˜ï¼ŒIO å¤šè·¯å¤ç”¨ï¼Œè‰¯å¥½çš„ç¼–ç ï¼‰ã€‚</li><li>æ”¯æŒæ•°æ®æŒä¹…åŒ–ã€‚</li><li>æ”¯æŒä¸»ä»é›†ç¾¤ã€åˆ†ç‰‡é›†ç¾¤ã€‚</li><li>æ”¯æŒå¤šè¯­è¨€å®¢æˆ·ç«¯ã€‚</li></ul><h3 id="å¸è½½å®‰è£…"><a class="anchor" href="#å¸è½½å®‰è£…">#</a> å¸è½½å®‰è£…</h3><h4 id="redis-å¸è½½"><a class="anchor" href="#redis-å¸è½½">#</a> Redis å¸è½½</h4><figure class="highlight shell"><figcaption data-lang="Bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token function">ps</span> aux <span class="token operator">|</span> <span class="token function">grep</span> redis <span class="token comment"># æŸ¥çœ‹æ˜¯å¦å¯åŠ¨ redisï¼Œå¦‚å·²å¯åŠ¨åˆ™åœæ­¢</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token function">whereis</span> redis <span class="token comment"># æœç´¢ redisï¼Œæ ¸å¯¹å¹¶åˆ é™¤å¯¹åº”æ–‡ä»¶åŠç›®å½•</span></pre></td></tr></table></figure><h4 id="redis-å®‰è£…"><a class="anchor" href="#redis-å®‰è£…">#</a> Redis å®‰è£…</h4><ol><li><p>Redis å®‰è£…å¯åŠ¨</p><figure class="highlight shell"><figcaption data-lang="Bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token builtin class-name">cd</span> /usr/local</pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token function">mkdir</span> redis</pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token builtin class-name">cd</span> redis/</pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token function">wget</span> https://download.redis.io/releases/redis-6.2.6.tar.gz</pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token function">tar</span> xzf redis-6.2.6.tar.gz</pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token builtin class-name">cd</span> redis-6.2.6</pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token function">make</span> <span class="token operator">&amp;&amp;</span> <span class="token function">make</span> <span class="token function">install</span></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token comment"># æ£€æŸ¥å®‰è£…</span></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token builtin class-name">cd</span> /usr/local/bin</pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token comment"># ä»»æ„ä½ç½®è¿è¡Œ redis</span></pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token builtin class-name">cd</span> ~</pre></td></tr><tr><td data-num="12"></td><td><pre>redis-server <span class="token comment"># å‰å°å¯åŠ¨</span></pre></td></tr><tr><td data-num="13"></td><td><pre><span class="token comment"># åå°å¯åŠ¨</span></pre></td></tr><tr><td data-num="14"></td><td><pre><span class="token builtin class-name">cd</span> /usr/local/redis/redis-6.2.6</pre></td></tr><tr><td data-num="15"></td><td><pre><span class="token function">cp</span> redis.conf redis.conf.backup <span class="token comment"># backup</span></pre></td></tr><tr><td data-num="16"></td><td><pre><span class="token function">vi</span> redis.conf <span class="token comment"># æ ¹æ®éœ€è¦ä¿®æ”¹é…ç½®</span></pre></td></tr><tr><td data-num="17"></td><td><pre>redis-server redis.conf</pre></td></tr><tr><td data-num="18"></td><td><pre><span class="token function">ps</span> aux <span class="token operator">|</span> <span class="token function">grep</span> redis</pre></td></tr></table></figure><p>redis.conf é…ç½®é¡¹ç¤ºä¾‹ï¼š</p><figure class="highlight properties"><figcaption data-lang=".properties"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment"># ç›‘å¬åœ°å€ï¼Œå­¦ä¹ æ—¶å¯ä»¥æ”¾å¼€å…è®¸æ‰€æœ‰ IP</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token attr-name">bind</span> <span class="token attr-value">0.0.0.0</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token comment"># åå°è¿è¡Œï¼Œé»˜è®¤ä¸ºå‰å°è¿è¡Œ</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token attr-name">daemonize</span> <span class="token attr-value">yes</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token comment"># è®¾ç½® redis å¯†ç </span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token attr-name">requirepass</span> <span class="token attr-value">foobared</span></pre></td></tr></table></figure></li><li><p>Redis å¼€æœºè‡ªå¯</p><figure class="highlight shell"><figcaption data-lang="Bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment"># ç¼–è¾‘å¯åŠ¨è„šæœ¬</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token function">vi</span> /etc/systemd/system/redis.service</pre></td></tr><tr><td data-num="3"></td><td><pre>systemctl daemon-reload <span class="token comment"># é‡è½½ç³»ç»ŸæœåŠ¡</span></pre></td></tr><tr><td data-num="4"></td><td><pre>systemctl start redis <span class="token comment"># å¯åŠ¨ redis</span></pre></td></tr><tr><td data-num="5"></td><td><pre>systemctl status redis <span class="token comment"># æŸ¥çœ‹ redis çŠ¶æ€</span></pre></td></tr><tr><td data-num="6"></td><td><pre>systemctl stop redis <span class="token comment"># åœæ­¢ redis</span></pre></td></tr><tr><td data-num="7"></td><td><pre>systemctl <span class="token builtin class-name">enable</span> redis <span class="token comment"># å…è®¸ redis å¼€æœºè‡ªå¯</span></pre></td></tr></table></figure><p>redis.service å¯åŠ¨è„šæœ¬å†…å®¹ç¤ºä¾‹å¦‚ä¸‹ï¼š</p><figure class="highlight properties"><figcaption data-lang=".properties"></figcaption><table><tr><td data-num="1"></td><td><pre>[Unit]</pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token attr-name">Description</span><span class="token punctuation">=</span><span class="token attr-value">redis-server</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token attr-name">After</span><span class="token punctuation">=</span><span class="token attr-value">network.target</span></pre></td></tr><tr><td data-num="4"></td><td><pre></pre></td></tr><tr><td data-num="5"></td><td><pre>[Service]</pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token attr-name">Type</span><span class="token punctuation">=</span><span class="token attr-value">forking</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token attr-name">ExecStart</span><span class="token punctuation">=</span><span class="token attr-value">/usr/local/bin/redis-server /usr/local/redis/redis-6.2.6/redis.conf</span></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token attr-name">PrivateTmp</span><span class="token punctuation">=</span><span class="token attr-value">true</span></pre></td></tr><tr><td data-num="9"></td><td><pre></pre></td></tr><tr><td data-num="10"></td><td><pre>[Install]</pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token attr-name">WantedBy</span><span class="token punctuation">=</span><span class="token attr-value">multi-user.target</span></pre></td></tr></table></figure><p>æ³¨ï¼š</p><ul><li>å¦‚å¯åŠ¨ä¸æˆåŠŸï¼Œå°è¯•æ£€æŸ¥é…ç½®æ–‡ä»¶å†…å®¹æ˜¯å¦æ­£ç¡®ï¼Œç«¯å£æ˜¯å¦è¢«å ç”¨ã€‚</li></ul></li></ol><h4 id="redis-è¿æ¥"><a class="anchor" href="#redis-è¿æ¥">#</a> Redis è¿æ¥</h4><ol><li><p>å‘½ä»¤è¡Œå®¢æˆ·ç«¯ï¼šredis-cli</p><figure class="highlight shell"><figcaption data-lang="Bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token builtin class-name">cd</span> ~ <span class="token comment"># ä»»æ„ä½ç½®</span></pre></td></tr><tr><td data-num="2"></td><td><pre>redis-cli -h <span class="token number">127.0</span>.0.1 -p <span class="token number">6379</span> <span class="token comment"># è¯­æ³•ï¼šredis-cli [options] [commonds]</span></pre></td></tr><tr><td data-num="3"></td><td><pre>AUTH foobared <span class="token comment"># è¯­æ³•ï¼šAUTH [username] password</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token builtin class-name">set</span> name chinmoku</pre></td></tr><tr><td data-num="5"></td><td><pre>get name</pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token builtin class-name">exit</span> <span class="token comment"># é€€å‡º</span></pre></td></tr></table></figure></li><li><p>å›¾å½¢åŒ–å®¢æˆ·ç«¯ï¼šRedisDesktopManager</p><p>æºç åœ°å€ï¼š<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL3VnbGlkZS9SZWRpc0Rlc2t0b3BNYW5hZ2VyL3JlbGVhc2Vz">https://github.com/uglide/RedisDesktopManager/releases</span></p><p>æºç ä¸‹è½½åéœ€è¦æ‰‹åŠ¨ç¼–è¯‘ï¼Œä¹Ÿå¯ä»¥<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2xld29yay9SZWRpc0Rlc2t0b3BNYW5hZ2VyLVdpbmRvd3MvcmVsZWFzZXM=">ç‚¹å‡»æ­¤å¤„</span>ä¸‹è½½å¯¹åº”çš„ç¼–è¯‘ç‰ˆæœ¬ã€‚</p><p>æ³¨ï¼š</p><ul><li><p>é€šè¿‡ windows è¿æ¥æœåŠ¡å™¨çš„ redis æœåŠ¡ï¼Œéœ€è¦æ³¨æ„å¯¹åº”çš„é˜²ç«å¢™ã€å®‰å…¨ç»„ç­‰æ˜¯å¦å¼€æ”¾ã€‚</p><figure class="highlight shell"><figcaption data-lang="Bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment"># æ·»åŠ é˜²ç«å¢™æŒ‡å®šç«¯å£</span></pre></td></tr><tr><td data-num="2"></td><td><pre>firewall-cmd --add-port<span class="token operator">=</span><span class="token number">6379</span>/tcp --permanent</pre></td></tr><tr><td data-num="3"></td><td><pre>firewall-cmd --reload <span class="token comment"># é‡è½½ç”Ÿæ•ˆ</span></pre></td></tr></table></figure></li></ul></li></ol><h3 id="redis-å‘½ä»¤"><a class="anchor" href="#redis-å‘½ä»¤">#</a> Redis å‘½ä»¤</h3><h4 id="æ•°æ®ç»“æ„"><a class="anchor" href="#æ•°æ®ç»“æ„">#</a> æ•°æ®ç»“æ„</h4><p>Redis æ˜¯ä¸€ä¸ªä»¥ <code>key-value</code> å½¢å¼å­˜å‚¨æ•°æ®çš„æ•°æ®åº“ï¼Œkey ä¸€èˆ¬æ˜¯ String ç±»å‹ï¼Œä½† value ç±»å‹åˆ™å­˜åœ¨å¤šç§ï¼š</p><p>åŸºæœ¬æ•°æ®ç±»å‹ï¼š</p><ul><li><p>String - å­˜å‚¨å­—ç¬¦ä¸²ï¼Œä¾‹å¦‚ï¼š <code>hello world</code> ã€‚</p></li><li><p>Hash - å­˜å‚¨è¾ƒä¸ºå¤æ‚çš„æ•°æ®ç»“æ„ï¼Œä¾‹å¦‚ï¼š <code>&#123;name: &quot;Chinmoku&quot;, age: 20&#125;</code> ã€‚</p></li><li><p>List - å­˜å‚¨æ•°ç»„åˆ—è¡¨ï¼Œä¾‹å¦‚ï¼š <code>[A, B, C, C]</code> ã€‚</p></li><li><p>Set - å­˜å‚¨å…ƒç´ ä¸å¯é‡å¤çš„æ•°ç»„ï¼Œä¾‹å¦‚ï¼š <code>&#123;A, B, C&#125;</code> ã€‚</p></li><li><p>SortedSet - å­˜å‚¨æœ‰åºçš„ï¼Œä¸”å…ƒç´ ä¸å¯é‡å¤çš„æ•°ç»„ï¼Œä¾‹å¦‚ï¼š <code>&#123;A: 1, B: 2, C: 3&#125;</code> ã€‚</p></li></ul><p>ç‰¹æ®Šç±»å‹ï¼š</p><ul><li>GEO</li><li>BitMap</li><li>HyperLog</li></ul><h4 id="é€šç”¨å‘½ä»¤"><a class="anchor" href="#é€šç”¨å‘½ä»¤">#</a> é€šç”¨å‘½ä»¤</h4><div class="note danger no-icon"><p>Redis å‘½ä»¤å‚è€ƒï¼š<span class="exturl" data-url="aHR0cHM6Ly9yZWRpcy5pby9jb21tYW5kcw==">https://redis.io/commands</span></p><p>æˆ–è€…é€šè¿‡ <code>help [commands]</code> å³å¯æŸ¥çœ‹ç›¸å…³å‘½ä»¤ç”¨æ³•ã€‚</p></div><p>Redis é€šç”¨å‘½ä»¤ç¤ºä¾‹ï¼š</p><ol><li><p>KEYS pattern æŸ¥è¯¢ä»¥å­—æ¯ a å¼€å¤´çš„ keyã€‚</p><blockquote><p>ç”±äº redis æ˜¯å•çº¿ç¨‹æ‰§è¡Œï¼Œå½“æ•°æ®é‡è¾ƒå¤§æ—¶ï¼Œä¼šå¯¼è‡´ä¸šåŠ¡é˜»å¡ï¼Œä¸å»ºè®®åœ¨ç”Ÿäº§ç¯å¢ƒä¸‹ä½¿ç”¨ã€‚</p></blockquote></li><li><p>DEL key [key ...] åˆ é™¤æŒ‡å®šçš„ä¸€ä¸ªæˆ–å¤šä¸ª keyã€‚</p></li><li><p>EXISTS key [key ...] åˆ¤æ–­æŒ‡å®šçš„ key æ˜¯å¦å­˜åœ¨ã€‚</p></li><li><p>EXPIRE key seconds è®¾ç½® key çš„æœ‰æ•ˆæœŸã€‚</p></li><li><p>TTL key è·å– key çš„æœ‰æ•ˆæœŸã€‚</p><blockquote><p>å¦‚ä¸æŒ‡å®šï¼Œåˆ™é»˜è®¤ä¸º -1 è¡¨ç¤ºæ°¸ä¹…æœ‰æ•ˆã€‚å¦‚æœ key ä¸å­˜åœ¨ï¼ŒæŸ¥è¯¢å…¶æœ‰æ•ˆæœŸåˆ™ä¼šè¿”å› <code>-2</code> ã€‚</p></blockquote></li></ol><h4 id="string-ç±»å‹"><a class="anchor" href="#string-ç±»å‹">#</a> String ç±»å‹</h4><p>String ç±»å‹æ˜¯ redis ä¸­æœ€ç®€å•çš„æ•°æ®ç±»å‹ï¼Œä½†å…¶ value æ ¹æ®å­—ç¬¦ä¸²çš„ä¸åŒæ ¼å¼ï¼Œåˆå¯ä»¥åˆ†ä¸ºä¸‰ç±»ï¼š</p><ul><li>string æ™®é€šå­—ç¬¦ä¸²ã€‚</li><li>int æ•´æ•°ç±»å‹ï¼Œå¯ä»¥è¿›è¡Œè‡ªå¢ã€è‡ªå‡ç­‰æ“ä½œã€‚</li><li>float æµ®ç‚¹ç±»å‹ï¼Œå¯ä»¥è¿›è¡Œè‡ªå¢ã€è‡ªå‡ç­‰æ“ä½œã€‚</li></ul><blockquote><p>ä¸è®ºæ˜¯å“ªç§æ ¼å¼çš„å­—ç¬¦ä¸²ç±»å‹ï¼Œå…¶åº•å±‚éƒ½æ˜¯ä½¿ç”¨å­—èŠ‚æ•°ç»„è¿›è¡Œå­˜å‚¨çš„ï¼Œåªæ˜¯é‡‡ç”¨çš„ç¼–ç æ–¹å¼ä¸åŒè€Œå·²ã€‚å­—ç¬¦ä¸²ç±»å‹çš„æœ€å¤§ç©ºé—´ä¸èƒ½è¶…è¿‡ 512mã€‚</p></blockquote><p>String ç±»å‹å¸¸è§å‘½ä»¤ï¼š</p><ol><li>SET key value</li><li>GET key</li><li>MSET key value [key value ...] æ‰¹é‡æ’å…¥ã€‚</li><li>MGET key [key ...] æ‰¹é‡è·å–ã€‚</li><li>INCR key è®¾ç½®æŸä¸ª key è‡ªå¢ã€‚</li><li>INCRBY key increment è‡ªå¢å¹…åº¦ã€‚</li><li>INCRBYFLOAT key increment è®¾ç½®æµ®ç‚¹æ•°è‡ªå¢ã€‚</li><li>SETNX key value å½“ key ä¸å­˜åœ¨æ—¶ï¼Œæ‰è¿›è¡Œæ’å…¥ã€‚</li><li>SETEX key seconds value è®¾ç½®æŒ‡å®š key çš„æœ‰æ•ˆæœŸã€‚</li></ol><blockquote><p>PS. Redis ä¸­ key çš„å±‚çº§æ ¼å¼ï¼š</p><p>åœ¨ä¸šåŠ¡ä½¿ç”¨è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬å®šä¹‰çš„ key è¦æ±‚å…¨å±€å”¯ä¸€ï¼Œå¾€å¾€æ˜¯ä»¥å¯¹è±¡çš„ ID æ¥è¡¨ç¤ºï¼Œä½†å½“ redis ä¸­å­˜åœ¨ä¸åŒç±»å‹çš„å¯¹è±¡æ—¶ï¼Œkey é‡å¤çš„å‡ ç‡ä¼šç›¸åº”åœ°å¢åŠ ï¼Œå¹¶ä¸”éš¾ä»¥å¯¹ä¸åŒçš„ key è¿›è¡ŒåŒºåˆ†ã€‚å› æ­¤ï¼Œåœ¨ redis ä½¿ç”¨è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬é€šå¸¸ä¼šå¯¹ redis çš„ key æ ¼å¼åšå‡ºä¸€å®šçš„é™åˆ¶ï¼Œä½†è¿™ç§é™åˆ¶å¹¶ä¸æ˜¯å¼ºåˆ¶çš„ï¼Œä¼ä¸šæˆ–å¼€å‘è€…å¯ä»¥è‡ªè¡Œè®¾è®¡ï¼Œä¾‹å¦‚ï¼š <code>é¡¹ç›®å:ä¸šåŠ¡å:id</code> ã€‚</p><p>æ­¤å¤–ï¼Œè¿™ç§ key çš„è®¾è®¡æ–¹å¼ï¼Œåœ¨éƒ¨åˆ† redis å®¢æˆ·ç«¯ä¸­ï¼Œä¹Ÿå¯ä»¥å½¢æˆä¸åŒçš„å±‚çº§æ˜¾ç¤ºã€‚</p></blockquote><h4 id="hash-ç±»å‹"><a class="anchor" href="#hash-ç±»å‹">#</a> Hash ç±»å‹</h4><p>Hash ç±»å‹ï¼Œä¹Ÿå«æ•£åˆ—ï¼Œå…¶ value æ˜¯ä¸€ä¸ªæ— åºå­—å…¸ï¼Œç±»ä¼¼äº java ä¸­çš„ HashMap ç»“æ„ã€‚</p><p>Hash ç±»å‹å¸¸è§å‘½ä»¤ï¼š</p><ol><li>HSET key field value [field value ...]</li><li>HGET key field</li><li>HMSET key field value [field value ...] è®¾ç½®å¤šä¸ª Hash å­—æ®µã€‚</li><li>HMGET key field [field ...] è·å–å¤šä¸ª Hash å­—æ®µã€‚</li><li>HGETALL key è·å– key å¯¹åº”çš„æ‰€æœ‰ Hash é”®å€¼å¯¹ã€‚</li><li>HKEYS key è·å– key å¯¹åº”çš„æ‰€æœ‰ Hash é”®ã€‚</li><li>HVALS key è·å– key å¯¹åº”çš„æ‰€æœ‰ Hash å€¼ã€‚</li><li>HINCRBY key field increment è®¾ç½® Hash ä¸­æŸä¸€å­—æ®µæŒ‰æ­¥é•¿è‡ªå¢ã€‚</li><li>HSETNX key field value å½“æŸä¸€ key å¯¹åº” Hash çš„å­—æ®µä¸å­˜åœ¨æ—¶ï¼Œæ‰è¿›è¡Œèµ‹å€¼ã€‚</li></ol><p>ğŸˆ <strong>ä¸ºä»€ä¹ˆ redis ä¸­æ¨èä½¿ç”¨ Hash è€Œé String æ¥å­˜å‚¨ JSON çš„æ•°æ®ç»“æ„ï¼Ÿ</strong></p><p>åœ¨ Redis ä¸­ä½¿ç”¨ String çš„æ•°æ®ç»“æ„æ¥å­˜å‚¨ JSONï¼Œå…¶å®æ˜¯å°† JSON å­—ç¬¦ä¸²åºåˆ—åŒ–ä¹‹åå†è¿›è¡Œå­˜å‚¨çš„ï¼Œå½“éœ€è¦è·å– JSON å†…éƒ¨çš„æŸä¸ªå­—æ®µæ—¶ï¼Œå¿…é¡»è·å–æ•´ä¸ªå­—ç¬¦ä¸²å†…å®¹ï¼Œè€Œä½¿ç”¨ Hash ç»“æ„å­˜å‚¨ JSON æ•°æ®æ—¶ï¼Œåˆ™ä¼šå°† JSON ä¸­çš„æ¯ä¸ªå­—æ®µç‹¬ç«‹å­˜å‚¨ï¼Œå®ƒæ›´åŠ æ–¹ä¾¿å¯¹ JSON ä¸­çš„å•ä¸ªå­—æ®µåš CRUD æ“ä½œã€‚</p><h4 id="list-ç±»å‹"><a class="anchor" href="#list-ç±»å‹">#</a> List ç±»å‹</h4><p>Redis ä¸­çš„ List å¯ä»¥çœ‹åšæ˜¯ä¸€ä¸ªåŒå‘é“¾è¡¨ï¼Œæ—¢å¯ä»¥æ”¯æŒæ­£å‘æ£€ç´¢ï¼Œä¹Ÿæ”¯æŒåå‘æ£€ç´¢ã€‚ä¸ Java ä¸­çš„ LinkedList ç›¸ä¼¼ï¼Œå®ƒä¹Ÿå…·æœ‰å¦‚ä¸‹ç‰¹å¾ï¼š</p><ul><li>æœ‰åºã€‚</li><li>å¯é‡å¤ã€‚</li><li>æ’å…¥å’Œåˆ é™¤æ•ˆç‡é«˜ã€‚</li><li>æŸ¥è¯¢æ•ˆç‡è¾ƒä½ã€‚</li></ul><p>List ç±»å‹å¸¸è§å‘½ä»¤ï¼š</p><ol><li>LPUSH key element [element ...] å‘æ•°ç»„å·¦ä¾§è¿½åŠ å…ƒç´ ã€‚</li></ol><blockquote><p>ä½¿ç”¨ LPUSH åï¼Œå…¶æ”¾å…¥å’Œå–å‡ºå…ƒç´ çš„é¡ºåºæ˜¯ç›¸åçš„ï¼Œä¸ä¹‹å¯¹åº”çš„è¿™æ˜¯ RPUSHã€‚</p></blockquote><ol start="2"><li><p>LPOP key [count] ä»å·¦ä¾§å¼€å§‹è·å–å¹¶ç§»é™¤æ•°ç»„ä¸­çš„å…ƒç´ ã€‚</p></li><li><p>LRANGE key start stop è·å–æ•°ç»„ä¸­æŒ‡å®šä¸‹æ ‡èŒƒå›´å†…çš„å…ƒç´ ã€‚</p></li><li><p>BLPOP key [key ...] timeout ä»å·¦ä¾§å¼€å§‹é˜»å¡å¼åœ°è·å–å¹¶ç§»é™¤æ•°ç»„ä¸­çš„å…ƒç´ ã€‚</p><blockquote><p>å½“ BLPOP æ— æ³•è·å–åˆ°å…ƒç´ æ—¶ï¼Œä¼šç­‰å¾…æŒ‡å®šçš„æ—¶é—´ï¼Œè‹¥ç­‰å¾…æœŸé—´å¯ä»¥è·å–åˆ°å…ƒç´ ï¼Œåˆ™ç›´æ¥å–å‡ºå¹¶è¿”å›ï¼›å¦‚ç­‰å¾…æ—¶é—´è¿‡æœŸä»æœªè·å–åˆ°å…ƒç´ ï¼Œåˆ™è¿”å› <code>nil</code> ã€‚</p></blockquote></li></ol><p>ğŸˆ <strong>å¦‚ä½•åˆ©ç”¨ Redis çš„ List æ•°æ®ç»“æ„æ¥æ¨¡æ‹Ÿæ ˆã€é˜Ÿåˆ—åŠé˜»å¡é˜Ÿåˆ—ï¼Ÿ</strong></p><p>ä½¿ç”¨ LPUSH å’Œ LPOPï¼Œæˆ– RPUSH å’Œ RPOPï¼Œéƒ½ä»å·¦ä¾§æˆ–éƒ½ä»å³ä¾§å­˜å…¥å’Œå–å‡ºå…ƒç´ ï¼Œåˆ™å¯ä»¥æ¨¡æ‹Ÿæ ˆçš„æ•°æ®ç»“æ„ï¼›ç›¸ååœ°ï¼Œå·¦ä¾§å­˜å…¥å³ä¾§å–å‡ºï¼Œæˆ–å³ä¾§å­˜å…¥å·¦ä¾§å–å‡ºï¼Œåˆ™å¯ä»¥æ¨¡æ‹Ÿé˜Ÿåˆ—çš„æ•°æ®ç»“æ„ã€‚è€Œå¯¹äºé˜»å¡é˜Ÿåˆ—ï¼Œåˆ™æ˜¯åœ¨é˜Ÿåˆ—ç‰¹å¾åŸºç¡€ä¸Šï¼Œå–å‡ºå…ƒç´ æ—¶ï¼Œä½¿ç”¨ BLOPO æˆ– BRPOP å³å¯ã€‚</p><h4 id="set-ç±»å‹"><a class="anchor" href="#set-ç±»å‹">#</a> Set ç±»å‹</h4><p>Redis ä¸­çš„ Set ç»“æ„ä¸ Java ä¸­çš„ HashSet ç›¸ä¼¼ï¼Œå®ƒä¹Ÿå…·å¤‡ä¸ HashSet ç±»ä¼¼çš„ç‰¹å¾ï¼š</p><ul><li>æ— åºã€‚</li><li>ä¸å¯é‡å¤ã€‚</li><li>æŸ¥è¯¢æ•ˆç‡é«˜ã€‚</li><li>æ”¯æŒäº¤é›†ã€å¹¶é›†ã€å·®é›†ç­‰ã€‚</li></ul><p>Set ç±»å‹å¸¸è§å‘½ä»¤ï¼š</p><ol><li>SADD key member [member ...] å‘ Set ä¸­æ’å…¥å…ƒç´ ã€‚</li><li>SREM key member [member ...] ç§»é™¤ Set ä¸­çš„å…ƒç´ ã€‚</li><li>SCARD key æŸ¥è¯¢ Set ä¸­å…ƒç´ æ•°é‡ã€‚</li><li>SISMEMBER key member åˆ¤æ–­ Set ä¸­æ˜¯å¦å­˜åœ¨æŸå…ƒç´ ã€‚</li><li>SMEMBERS key è·å– Set ä¸­æ‰€æœ‰å…ƒç´ ã€‚</li><li>SINTER key [key ...] äº¤é›†ã€‚</li><li>SDIFF key [key ...] å·®é›†ã€‚</li><li>SUNION key [key ...] å¹¶é›†ã€‚</li></ol><h4 id="sortedset-ç±»å‹"><a class="anchor" href="#sortedset-ç±»å‹">#</a> SortedSet ç±»å‹</h4><p>Redis ä¸­çš„ SortedSet æ˜¯ä¸€ä¸ªå¯æ’åºçš„ Set é›†åˆã€‚SortedSet ä¸­æ¯ä¸€ä¸ªå…ƒç´ éƒ½å¸¦æœ‰ä¸€ä¸ª score å±æ€§ï¼Œå¯ä»¥åŸºäº score å±æ€§å¯¹å…ƒç´ è¿›è¡Œæ’åºï¼Œå…¶åº•å±‚å®ç°æ˜¯ä¸€ä¸ªè·³è¡¨ï¼ˆSkipListï¼‰åŠ  Hash è¡¨ã€‚SortedSet å…·å¤‡å¦‚ä¸‹ç‰¹å¾ï¼š</p><ul><li>å¯æ’åºã€‚</li><li>ä¸é‡å¤ã€‚</li><li>æŸ¥è¯¢æ•ˆç‡é«˜ã€‚</li></ul><p>SortedSet ç±»å‹å¸¸è§å‘½ä»¤ï¼š</p><ol><li>ZADD key</li><li>ZREM key member [member ...]</li><li>ZSCORE key member è·å–æŸå…ƒç´ çš„ score å€¼ã€‚</li><li>ZRANK key member è·å–æŸå…ƒç´ åœ¨è¯¥é›†åˆä¸­çš„æ’åã€‚</li><li>ZCARD key</li><li>ZCOUNT key min max ç»Ÿè®¡æŒ‡å®š score èŒƒå›´å†…çš„å…ƒç´ ä¸ªæ•°ã€‚</li><li>ZINCRBY key increment member ä½¿é›†åˆä¸­æŒ‡å®šå…ƒç´ æŒ‰æ­¥é•¿è‡ªå¢ã€‚</li><li>ZRANGE key min max è·å–æŒ‡å®šæ’åèŒƒå›´çš„å…ƒç´ ã€‚</li><li>ZRANGEBYSCORE key min max è·å–æŒ‡å®š score èŒƒå›´çš„å…ƒç´ ã€‚</li><li>ZINTER numkeys key [key ...] äº¤é›†ã€‚</li><li>ZDIFF numkeys key [key ...] å·®é›†ã€‚</li><li>ZUNION numkeys key [key ...] å¹¶é›†ã€‚</li></ol><blockquote><p>SortedSet æŸ¥è¯¢æ’åºé»˜è®¤é‡‡ç”¨å‡åºï¼Œå¦‚éœ€ä½¿ç”¨é™åºï¼Œåªéœ€åœ¨å­—æ¯ Z ä¹‹åæ·»åŠ  REV å³å¯ï¼Œå¦‚ ZREVRANGEã€‚</p></blockquote><h3 id="java-å®¢æˆ·ç«¯"><a class="anchor" href="#java-å®¢æˆ·ç«¯">#</a> Java å®¢æˆ·ç«¯</h3><p>Redis å®˜æ–¹æ¨èå¦‚ä¸‹ä¸‰æ¬¾å®¢æˆ·ç«¯äº§å“ï¼š</p><ol><li>Jedisï¼Œå…¶ç‰¹ç‚¹æ˜¯å­¦ä¹ æˆæœ¬ä½ï¼ŒåŸºæœ¬ä½¿ç”¨ redis å‘½ä»¤ä½œä¸º API æ–¹æ³•åã€‚ä½†åŸºäº Jedis çš„è¿æ¥æ— æ³•ä¿è¯çº¿ç¨‹å®‰å…¨ï¼Œåœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸‹éœ€è¦åŸºäºè¿æ¥æ± æ¥ä½¿ç”¨ã€‚</li><li>Lettuceï¼ŒåŸºäº Netty å®ç°ï¼Œæ”¯æŒåŒæ­¥ã€å¼‚æ­¥å’Œå“åº”å¼ç¼–ç¨‹ï¼Œå¹¶ä¸”æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œæ”¯æŒ Redis å“¨å…µæ¨¡å¼ã€é›†ç¾¤æ¨¡å¼å’Œç®¡é“æ¨¡å¼ã€‚</li><li>Redissonï¼Œæ˜¯ä¸€ä¸ªåŸºäº Redis å®ç°çš„åˆ†å¸ƒå¼ã€å¯ä¼¸ç¼©çš„ Java æ•°æ®ç»“æ„é›†åˆï¼ŒåŒ…å«äº†è¯¸å¦‚ Mapã€Queueã€Lockã€Semaphereã€AtomicLong ç­‰å¼ºå¤§åŠŸèƒ½ã€‚</li></ol><blockquote><p>å‡ºäºå¯¹æœ¬æ–‡ç¯‡å¹…çš„è€ƒè™‘ï¼Œæ­¤å¤„ä»…å¯¹ Jedis åšæ‰©å±•ä»‹ç»ï¼Œå¦‚å¯¹å…¶ä»–å®¢æˆ·ç«¯äº§å“æ„Ÿå…´è¶£ï¼Œå¯è‡ªè¡Œäº†è§£ã€‚</p><p>PS. ç»¼åˆå„ç§ Redis å®¢æˆ·ç«¯çš„ä¼˜ç¼ºç‚¹ï¼Œä¹Ÿå¯ä»¥è€ƒè™‘ä½¿ç”¨ Spring é›†æˆçš„å·¥å…·åŒ… <code>Spring Data Redis</code> ã€‚</p></blockquote><h4 id="jedis"><a class="anchor" href="#jedis">#</a> Jedis</h4><p>é¡¹ç›®åœ°å€ï¼š<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL3JlZGlzL2plZGlz">https://github.com/redis/jedis</span></p><p><strong>åŸºæœ¬ä½¿ç”¨æ–¹å¼ï¼š</strong></p><ol><li><p>æ·»åŠ ä¾èµ–ï¼š <code>redis.clients.jedis:4.1.1</code> ã€‚</p></li><li><p>å»ºç«‹è¿æ¥ï¼š</p><figure class="highlight java"><figcaption data-lang="java"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">private</span> <span class="token class-name">Jedis</span> jedis<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="2"></td><td><pre></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token annotation punctuation">@BeforeEach</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token keyword">void</span> <span class="token function">setUp</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    jedis <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Jedis</span><span class="token punctuation">(</span><span class="token string">"127.0.0.1"</span><span class="token punctuation">,</span> <span class="token number">6379</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// å»ºç«‹è¿æ¥</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    jedis<span class="token punctuation">.</span><span class="token function">auth</span><span class="token punctuation">(</span><span class="token string">"123456"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// å¯†ç </span></pre></td></tr><tr><td data-num="7"></td><td><pre>    jedis<span class="token punctuation">.</span><span class="token function">select</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// é€‰æ‹©åº“</span></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure></li><li><p>æµ‹è¯•ä½¿ç”¨ï¼š</p><figure class="highlight java"><figcaption data-lang="java"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token annotation punctuation">@Test</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">void</span> <span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token class-name">String</span> result <span class="token operator">=</span> jedis<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">"name"</span><span class="token punctuation">,</span> <span class="token string">"Chinmoku"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"result = "</span> <span class="token operator">+</span> result<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token class-name">String</span> name <span class="token operator">=</span> jedis<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"name"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"name = "</span> <span class="token operator">+</span> name<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><blockquote><p>ç±»ä¼¼åœ°ï¼Œå…¶ä»– redis ç›¸å…³æ“ä½œè°ƒç”¨çš„æ–¹æ³•åç§°ï¼Œä¹ŸåŸºæœ¬ä¸ redis å‘½ä»¤ç›¸åŒã€‚</p></blockquote></li><li><p>é‡Šæ”¾èµ„æºï¼š</p><figure class="highlight java"><figcaption data-lang="java"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token annotation punctuation">@AfterEach</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">void</span> <span class="token function">tearDown</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token keyword">if</span> <span class="token punctuation">(</span>jedis <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>        jedis<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure></li></ol><p><strong>Jedis è¿æ¥æ± ï¼š</strong></p><p>Jedis æœ¬èº«æ˜¯çº¿ç¨‹ä¸å®‰å…¨çš„ï¼Œå¹¶ä¸”é¢‘ç¹åœ°åˆ›å»ºå’Œé”€æ¯è¿æ¥ä¼šäº§ç”Ÿæå¤§çš„æ€§èƒ½æ¶ˆè€—ï¼Œå› æ­¤åœ¨ä½¿ç”¨ Jedis çš„è¿‡ç¨‹ä¸­ï¼Œä¸æ¨èä½¿ç”¨ Jedis ç›´è¿ï¼Œè€Œå»ºè®®å®ç°è¿æ¥æ± ã€‚</p><figure class="highlight java"><figcaption data-lang="java"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">JedisConnectionFactory</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">JedisPool</span> jedisPoll<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    </pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token keyword">static</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>        <span class="token class-name">JedisPoolConfig</span> jedisPoolConfig <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">JedisPoolConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>        jedisPoolConfig<span class="token punctuation">.</span><span class="token function">setMaxTotal</span><span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// æœ€å¤§è¿æ¥æ•°</span></pre></td></tr><tr><td data-num="7"></td><td><pre>        jedisPoolConfig<span class="token punctuation">.</span><span class="token function">setMaxIdle</span><span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// æœ€å¤§ç©ºé—²è¿æ¥æ•°</span></pre></td></tr><tr><td data-num="8"></td><td><pre>        jedisPoolConfig<span class="token punctuation">.</span><span class="token function">setMinIdle</span><span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// æœ€å°ç©ºé—²è¿æ¥æ•°</span></pre></td></tr><tr><td data-num="9"></td><td><pre>        jedisPoolConfig<span class="token punctuation">.</span><span class="token function">setMaxWaitMillis</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// æœ€é•¿ç­‰å¾…æ—¶é—´</span></pre></td></tr><tr><td data-num="10"></td><td><pre>        jedisPoll <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">JedisPool</span><span class="token punctuation">(</span>jedisPoolConfig<span class="token punctuation">,</span> <span class="token string">"127.0.0.1"</span><span class="token punctuation">,</span> <span class="token number">6379</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">,</span> <span class="token string">"123456"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="11"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="12"></td><td><pre>    </pre></td></tr><tr><td data-num="13"></td><td><pre>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">Jedis</span> <span class="token function">getJedis</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="14"></td><td><pre>        <span class="token keyword">return</span> jedisPool<span class="token punctuation">.</span><span class="token function">getResource</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="15"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="16"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><h4 id="springdataredis"><a class="anchor" href="#springdataredis">#</a> SpringDataRedis</h4><p>SpringData æ˜¯ Sring ä¸­æ•°æ®æ“ä½œçš„æ¨¡å—ï¼ŒåŒ…å«å¯¹å„ç§æ•°æ®åº“çš„é›†æˆï¼Œå…¶ä¸­å¯¹ Redis çš„é›†æˆæ¨¡å—å³ä¸º SpringDataRedisï¼š</p><ul><li>æä¾›äº†å¯¹ä¸åŒ Redis å®¢æˆ·ç«¯çš„æ•´åˆï¼ˆLettuce å’Œ Jedisï¼‰ã€‚</li><li>æä¾›äº† RedisTemplate ç»Ÿä¸€ API æ¥æ“ä½œ Redisã€‚</li><li>æ”¯æŒ Redis çš„å‘å¸ƒè®¢é˜…æ¨¡å¼ã€‚</li><li>æ”¯æŒ Redis çš„å“¨å…µæ¨¡å¼å’Œé›†ç¾¤æ¨¡å¼ã€‚</li><li>æ”¯æŒåŸºäº Lettuce çš„å“åº”å¼ç¼–ç¨‹ã€‚</li><li>æ”¯æŒåŸºäº JDKã€JSONã€å­—ç¬¦ä¸²ã€Spring å¯¹è±¡çš„æ•°æ®åºåˆ—å·åŠååºåˆ—åŒ–ã€‚</li><li>æ”¯æŒåŸºäº Redis çš„ JDKCollection å®ç°ã€‚</li></ul><blockquote><p>SpringDataRedis å®˜æ–¹æ–‡æ¡£ï¼š<span class="exturl" data-url="aHR0cHM6Ly9zcHJpbmcuaW8vcHJvamVjdHMvc3ByaW5nLWRhdGEtcmVkaXM=">https://spring.io/projects/spring-data-redis</span></p></blockquote><p>SpringDataRedis æä¾›äº† RedisTemplate å·¥å…·ç±»ï¼Œå…¶ä¸­å°è£…äº†å„ç§å¯¹ Redis çš„æ“ä½œï¼Œå¹¶ä¸”å°†ä¸åŒæ•°æ®ç±»å‹çš„æ“ä½œ API å°è£…åˆ°äº†ä¸åŒçš„ç±»å‹ä¸­ï¼š</p><table><thead><tr><th>API</th><th>è¿”å›å€¼ç±»å‹</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>redisTemplate.opsForValue()</td><td>valueOperations</td><td>æ“ä½œ String ç±»å‹æ•°æ®</td></tr><tr><td>redisTemplate.opsForHash()</td><td>HashOperations</td><td>æ“ä½œ Hash ç±»å‹æ•°æ®</td></tr><tr><td>redisTemplate.opsForList()</td><td>ListOperations</td><td>æ“ä½œ List ç±»å‹æ•°æ®</td></tr><tr><td>redisTemplate.opsForSet()</td><td>SetOperations</td><td>æ“ä½œ Set ç±»å‹æ•°æ®</td></tr><tr><td>redisTemplate.opsForZSet()</td><td>ZSetOperations</td><td>æ“ä½œ SortedSet ç±»å‹æ•°æ®</td></tr><tr><td>redisTemplate</td><td></td><td>é€šç”¨å‘½ä»¤</td></tr></tbody></table><p><strong>åŸºæœ¬ä½¿ç”¨æ–¹å¼ï¼š</strong></p><ol><li><p>æ·»åŠ ä¾èµ–ï¼š</p><ul><li>Redis ä¾èµ–ï¼š <code>org.springframework.boot.spring-boot-starter-data-redis:2.6.2</code> ã€‚</li><li>è¿æ¥æ± ä¾èµ–ï¼š <code>org.apache.commons.commons-pool2:2.11.1</code> ã€‚</li></ul></li><li><p>é…ç½®æ–‡ä»¶ï¼š</p><figure class="highlight yaml"><figcaption data-lang="YAML"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token key atrule">spring</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="2"></td><td><pre>  <span class="token key atrule">redis</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token key atrule">host</span><span class="token punctuation">:</span> 127.0.0.1</pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">6379</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token key atrule">password</span><span class="token punctuation">:</span> <span class="token number">123456</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    <span class="token comment"># é»˜è®¤ä½¿ç”¨ lettuceï¼Œå¦‚éœ€ä½¿ç”¨ jedisï¼Œéœ€å¼•å…¥å¯¹åº”ä¾èµ–</span></pre></td></tr><tr><td data-num="7"></td><td><pre>    <span class="token key atrule">lettuce</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="8"></td><td><pre>      <span class="token key atrule">pool</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="9"></td><td><pre>        <span class="token key atrule">max-active</span><span class="token punctuation">:</span> <span class="token number">8</span></pre></td></tr><tr><td data-num="10"></td><td><pre>        <span class="token key atrule">max-idle</span><span class="token punctuation">:</span> <span class="token number">8</span></pre></td></tr><tr><td data-num="11"></td><td><pre>        <span class="token key atrule">min-idle</span><span class="token punctuation">:</span> <span class="token number">0</span></pre></td></tr><tr><td data-num="12"></td><td><pre>        <span class="token key atrule">max-wait</span><span class="token punctuation">:</span> <span class="token number">100</span> <span class="token comment"># è¿æ¥ç­‰å¾…æ—¶é—´</span></pre></td></tr><tr><td data-num="13"></td><td><pre>        <span class="token key atrule">timeout</span><span class="token punctuation">:</span> <span class="token number">600</span> <span class="token comment"># è¿æ¥è¶…æ—¶æ—¶é—´</span></pre></td></tr></table></figure></li><li><p>æ³¨å…¥ RedisTemplate å¹¶ä½¿ç”¨ï¼š</p><figure class="highlight java"><figcaption data-lang="java"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token annotation punctuation">@Autowired</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">private</span> <span class="token class-name">RedisTemplate</span> redisTemplate<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token annotation punctuation">@Test</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token keyword">void</span> <span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    redisTemplate<span class="token punctuation">.</span><span class="token function">opsForValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">"name"</span><span class="token punctuation">,</span> <span class="token string">"chinmoku"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// æ’å…¥</span></pre></td></tr><tr><td data-num="7"></td><td><pre>    <span class="token class-name">Object</span> name <span class="token operator">=</span> redisTemplate<span class="token punctuation">.</span><span class="token function">opsForValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"name"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// è¯»å–</span></pre></td></tr><tr><td data-num="8"></td><td><pre>    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"name = "</span> <span class="token operator">+</span> name<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="9"></td><td><pre>    <span class="token comment">// å­˜å‚¨å¯¹è±¡</span></pre></td></tr><tr><td data-num="10"></td><td><pre>    redisTemplate<span class="token punctuation">.</span><span class="token function">opsForValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">"user:1"</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">User</span><span class="token punctuation">(</span><span class="token string">"chinmoku"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="11"></td><td><pre>    <span class="token class-name">User</span> user <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">User</span><span class="token punctuation">)</span> redisTemplate<span class="token punctuation">.</span><span class="token function">opsForValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"user:1"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="12"></td><td><pre>    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"user = "</span> <span class="token operator">+</span> user<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="13"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure></li></ol><p><strong>SpringDataRedis åºåˆ—åŒ–æ–¹å¼ï¼š</strong></p><p>SpringDataRedis å¯ä»¥æ¥æ”¶ä»»æ„ Object ä½œä¸ºå€¼å†™å…¥ Redisï¼Œä½†åœ¨å†™å…¥ä¹‹å‰éƒ½ä¼šå°†å…¶åºåˆ—åŒ–ä¸ºå­—èŠ‚å½¢å¼ï¼Œå¹¶ä¸”é»˜è®¤é‡‡ç”¨ JdkSerializationRedisSerializerï¼Œè¿™ä¼šå¯¼è‡´å¯è¯»æ€§å·®å’Œä¸å¿…è¦çš„å†…å­˜å ç”¨çš„é—®é¢˜ã€‚å› æ­¤ï¼Œæˆ‘ä»¬å¯ä»¥å¯¹ SpringDataRedis è¿›è¡Œä¸ªæ€§åŒ–å®ç°ï¼š</p><figure class="highlight java"><figcaption data-lang="java"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">/**</span></pre></td></tr><tr><td data-num="2"></td><td><pre> * SpringDataRedis è‡ªå®šä¹‰åºåˆ—åŒ–æ–¹å¼</pre></td></tr><tr><td data-num="3"></td><td><pre> */</pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token annotation punctuation">@Configuation</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">RedisConfig</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    </pre></td></tr><tr><td data-num="7"></td><td><pre>    <span class="token annotation punctuation">@Bean</span></pre></td></tr><tr><td data-num="8"></td><td><pre>    <span class="token keyword">public</span> <span class="token class-name">RedisTemplate</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">></span></span> <span class="token function">redisTemplate</span><span class="token punctuation">(</span><span class="token class-name">RedisConnectionFactory</span> redisConnectionFactory<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">UnknownHostException</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="9"></td><td><pre>        <span class="token class-name">RedisTemplate</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">></span></span> redisTemplate <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RedisTemplate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="10"></td><td><pre>        <span class="token comment">// è®¾ç½®è¿æ¥å·¥å‚</span></pre></td></tr><tr><td data-num="11"></td><td><pre>        redisTemplate<span class="token punctuation">.</span><span class="token function">setConnectionFactory</span><span class="token punctuation">(</span>redisConnectionFactory<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="12"></td><td><pre>        <span class="token comment">// è®¾ç½®åºåˆ—åŒ–å·¥å…·ï¼ˆæ³¨ï¼šä½¿ç”¨ json åºåˆ—åŒ–éœ€è¦å¼•å…¥ jackson-databind ä¾èµ–ï¼‰</span></pre></td></tr><tr><td data-num="13"></td><td><pre>        <span class="token class-name">GenericJackson2JsonRedisSerializer</span> jsonRedisSerializer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">GenericJackson2JsonRedisSerializer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="14"></td><td><pre></pre></td></tr><tr><td data-num="15"></td><td><pre>        <span class="token comment">//key å’Œ hashKey é‡‡ç”¨ string åºåˆ—åŒ–</span></pre></td></tr><tr><td data-num="16"></td><td><pre>        redisTemplate<span class="token punctuation">.</span><span class="token function">setKeySerializer</span><span class="token punctuation">(</span><span class="token class-name">RedisSerializer</span><span class="token punctuation">.</span><span class="token function">string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="17"></td><td><pre>        redisTemplate<span class="token punctuation">.</span><span class="token function">setHashKeySerializer</span><span class="token punctuation">(</span><span class="token class-name">RedisSerializer</span><span class="token punctuation">.</span><span class="token function">string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="18"></td><td><pre>        <span class="token comment">//value å’Œ hashValue é‡‡ç”¨ json åºåˆ—åŒ–</span></pre></td></tr><tr><td data-num="19"></td><td><pre>        redisTemplate<span class="token punctuation">.</span><span class="token function">setValueSerializer</span><span class="token punctuation">(</span>jsonRedisSerializer<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="20"></td><td><pre>        redisTemplate<span class="token punctuation">.</span><span class="token function">setHashValueSerializer</span><span class="token punctuation">(</span>jsonRedisSerializer<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="21"></td><td><pre>        <span class="token keyword">return</span> redisTemplate<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="22"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="23"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p>å¦‚ä¸Šç¤ºä¾‹ï¼Œå½“å­˜å‚¨ Java å¯¹è±¡æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ JSON åºåˆ—åŒ–å™¨ï¼Œè‡ªåŠ¨å®ç°å¯¹è±¡çš„åºåˆ—åŒ–å’Œååºåˆ—åŒ–ï¼Œä½†è¿™ç§æ–¹å¼ä¼šåœ¨ Redis ä¸­é¢å¤–å­˜å‚¨ä¸€ä¸ª <code>@class</code> å­—æ®µï¼Œç”¨äºæŒ‡å®šåºåˆ—åŒ–å’Œååºåˆ—åŒ–å¯¹è±¡æ‰€å±çš„ç±»ï¼Œè¿™ä¹Ÿä¼šåœ¨ä¸€å®šç¨‹åº¦ä¸Šé€ æˆä¸å¿…è¦çš„ç©ºé—´æµªè´¹ã€‚</p><p>ä¸ºäº†èŠ‚çœç©ºé—´ï¼Œåœ¨ç¼–ç è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬é€šå¸¸æ¨èåœ¨å­˜å‚¨æ•°æ®ä¹‹å‰ï¼Œæ‰‹åŠ¨è¿›è¡Œå¯¹è±¡çš„åºåˆ—åŒ–å¤„ç†ï¼Œç„¶åå†é€šè¿‡ String åºåˆ—åŒ–æ–¹å¼è¿›è¡Œå­˜å‚¨ï¼›å–å€¼æ—¶ï¼Œå†é€šè¿‡ç¨‹åºåˆ¤æ–­è¿›è¡Œååºåˆ—åŒ–ã€‚ä¸ºæ­¤ï¼Œå¯¹äº String ç±»å‹çš„æ•°æ®å­˜å‚¨ï¼ŒSpringDataRedis æä¾›äº†ä¸€ä¸ª StringRedisTemplate ç±»ï¼Œå®ƒé»˜è®¤å³é‡‡ç”¨ String åºåˆ—åŒ–æ–¹å¼ï¼š</p><figure class="highlight java"><figcaption data-lang="java"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token annotation punctuation">@Autowired</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">private</span> <span class="token class-name">StringRedisTemplate</span> stringRedisTemplate<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token comment">// JSON å·¥å…·ï¼ˆä¹Ÿå¯ä»¥ä½¿ç”¨å…¶ä»–åºåˆ—åŒ–å·¥å…·ï¼Œå¦‚ fastjson ç­‰ï¼‰</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">ObjectMapper</span> mapper <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ObjectMapper</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token annotation punctuation">@Test</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token keyword">void</span> <span class="token function">testStringTemplate</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">JsonProcessingException</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="8"></td><td><pre>    <span class="token class-name">User</span> user <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">User</span><span class="token punctuation">(</span><span class="token string">"chinmoku"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="9"></td><td><pre>    <span class="token comment">// æ‰‹åŠ¨åºåˆ—åŒ–</span></pre></td></tr><tr><td data-num="10"></td><td><pre>    <span class="token class-name">String</span> json <span class="token operator">=</span> mapper<span class="token punctuation">.</span><span class="token function">writeValueAsString</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="11"></td><td><pre>    redisTemplate<span class="token punctuation">.</span><span class="token function">opsForValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">"user:1"</span><span class="token punctuation">,</span> json<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="12"></td><td><pre>    </pre></td></tr><tr><td data-num="13"></td><td><pre>    <span class="token class-name">String</span> value <span class="token operator">=</span> redisTemplate<span class="token punctuation">.</span><span class="token function">opsForValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"user:1"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="14"></td><td><pre>    <span class="token class-name">User</span> u <span class="token operator">=</span> mapper<span class="token punctuation">.</span><span class="token function">readVal</span><span class="token punctuation">(</span>value<span class="token punctuation">,</span> <span class="token class-name">User</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// ååºåˆ—åŒ–</span></pre></td></tr><tr><td data-num="15"></td><td><pre>    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"user = "</span> <span class="token operator">+</span> u<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="16"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p><strong>RedisTemplate æ“ä½œ Hashï¼š</strong></p><figure class="highlight java"><figcaption data-lang="java"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token annotation punctuation">@Test</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">void</span> <span class="token function">testHash</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    stringRedisTemplate<span class="token punctuation">.</span><span class="token function">opsForHash</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"user:2"</span><span class="token punctuation">,</span> <span class="token string">"name"</span><span class="token punctuation">,</span> <span class="token string">"zhangsan"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    stringRedisTemplate<span class="token punctuation">.</span><span class="token function">opsForHash</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"user:2"</span><span class="token punctuation">,</span> <span class="token string">"age"</span><span class="token punctuation">,</span> <span class="token string">"21"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Object</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">></span></span> entries <span class="token operator">=</span> stringRedisTemplate<span class="token punctuation">.</span><span class="token function">opsForHash</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">entries</span><span class="token punctuation">(</span><span class="token string">"user:2"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"entries = "</span> <span class="token operator">+</span> entries<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><h3 id="ç¼“å­˜é—®é¢˜åŠè§£å†³æ–¹æ¡ˆ"><a class="anchor" href="#ç¼“å­˜é—®é¢˜åŠè§£å†³æ–¹æ¡ˆ">#</a> ç¼“å­˜é—®é¢˜åŠè§£å†³æ–¹æ¡ˆ</h3><h4 id="ç¼“å­˜æ›´æ–°ç­–ç•¥"><a class="anchor" href="#ç¼“å­˜æ›´æ–°ç­–ç•¥">#</a> ç¼“å­˜æ›´æ–°ç­–ç•¥</h4><p>æ‰€è°“ç¼“å­˜ï¼Œå°±æ˜¯æ•°æ®äº¤æ¢çš„ç¼“å†²åŒºï¼Œæ˜¯å­˜å‚¨æ•°æ®çš„åœ°æ–¹ï¼Œä¸€èˆ¬è¯»å†™æ€§èƒ½è¾ƒé«˜ã€‚</p><p>æ“ä½œç¼“å­˜å’Œæ•°æ®åº“æ—¶ï¼Œéœ€è¦è€ƒè™‘å¦‚ä¸‹ä¸‰ä¸ªé—®é¢˜ï¼š</p><ol><li><p>æ›´æ–°æ•°æ®åº“æ—¶ï¼Œå¯¹äºç¼“å­˜æ•°æ®ï¼Œæ˜¯åº”å½“æ‰§è¡Œæ›´æ–°æ“ä½œè¿˜æ˜¯åˆ é™¤æ“ä½œï¼Ÿ</p><ul><li>æ›´æ–°ç¼“å­˜ï¼šæ¯æ¬¡æ›´æ–°æ•°æ®åº“éƒ½æ›´æ–°ç¼“å­˜ï¼Œå®¹æ˜“äº§ç”Ÿè¾ƒå¤šçš„æ— æ•ˆå†™æ“ä½œã€‚</li><li>åˆ é™¤ç¼“å­˜ï¼šæ›´æ–°æ•°æ®åº“æ—¶ä½¿ç¼“å­˜å¤±æ•ˆï¼ŒæŸ¥è¯¢æ•°æ®åº“æ—¶å†æ›´æ–°ç¼“å­˜ï¼ˆæ¨èï¼‰ã€‚</li></ul></li><li><p>å¦‚ä½•ä¿è¯ç¼“å­˜å’Œæ•°æ®åº“æ“ä½œåŒæ—¶æˆåŠŸæˆ–åŒæ—¶å¤±è´¥ï¼Ÿ</p><ul><li>å•ç³»ç»Ÿç¯å¢ƒä¸‹ï¼Œéœ€è¦å°†ç¼“å­˜å’Œæ•°æ®åº“æ“ä½œæ”¾åœ¨åŒä¸€ä¸ªäº‹åŠ¡ä¸­ã€‚</li><li>åˆ†å¸ƒå¼ç³»ç»Ÿç¯å¢ƒä¸‹ï¼Œå¯ä»¥åˆ©ç”¨ TCC ç­‰åˆ†å¸ƒå¼äº‹åŠ¡æ–¹æ¡ˆã€‚</li></ul></li><li><p>æ‰§è¡Œæ•°æ®æ“ä½œæ—¶ï¼Œå…ˆæ“ä½œç¼“å­˜è¿˜æ˜¯æ•°æ®åº“ï¼Ÿ</p><p><img data-src="https://img.xfc-exclave.com/2022/03/d1f36fa6ee35a9c1a98578527399f1e21647090860.png" alt="redis-cache"></p><p>å¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œä¸è®ºæ˜¯å…ˆæ“ä½œç¼“å­˜è¿˜æ˜¯å…ˆæ“ä½œæ•°æ®åº“ï¼Œåœ¨å¹¶å‘ç¯å¢ƒä¸‹ï¼Œéƒ½æœ‰å¯èƒ½å‡ºç°æ•°æ®ä¸ä¸€è‡´é—®é¢˜ã€‚ä½†é€šå¸¸è€Œè¨€ï¼Œç¼“å­˜æ“ä½œæ•ˆç‡è¿œé«˜äºæ•°æ®åº“æ“ä½œæ•ˆç‡ï¼Œå› æ­¤å…ˆæ“ä½œæ•°æ®åº“ï¼Œå†åˆ é™¤ç¼“å­˜å‡ºç°æ•°æ®ä¸ä¸€è‡´çš„æ¦‚ç‡è¾ƒä½ï¼Œä½†ä¹Ÿä»…é™äºæ¦‚ç‡è¾ƒä½è€Œå·²ï¼Œä»å­˜åœ¨æ•°æ®ä¸ä¸€è‡´çš„é£é™©ã€‚</p></li></ol><p><strong>æ‰©å±•ï¼š</strong></p><p>åŸºäºæ•°æ®åº“ä¸ç¼“å­˜ä¹‹é—´çš„æ•°æ®ä¸ä¸€è‡´é—®é¢˜ï¼Œç›®å‰æœ‰å¦‚ä¸‹å‡ ç§è¾ƒä¸ºå¸¸è§çš„è§£å†³æ–¹æ¡ˆï¼š</p><ol><li><p>å»¶æ—¶åŒåˆ </p><p>æ‰€è°“çš„å»¶æ—¶åŒåˆ ï¼Œå¯ä»¥é€šè¿‡å¦‚ä¸‹ä¼ªä»£ç è¿›è¡Œè¡¨ç¤ºï¼š</p><figure class="highlight java"><figcaption data-lang="java"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">update</span><span class="token punctuation">(</span><span class="token class-name">String</span> key<span class="token punctuation">,</span> <span class="token class-name">Object</span> data<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    redis<span class="token punctuation">.</span><span class="token function">delKey</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    db<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    redis<span class="token punctuation">.</span><span class="token function">delKey</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p>è¿™é‡Œçš„å»¶æ—¶ï¼Œä¸»è¦æ˜¯ä¸ºäº†ç¡®ä¿åœ¨è¿›è¡Œç¬¬äºŒæ¬¡åˆ é™¤ä¹‹å‰ï¼Œå…¶ä»–äº¤å‰çº¿ç¨‹å·²ç»å®Œæˆæ•°æ®åº“æŸ¥è¯¢å’Œæ›´æ–°ç¼“å­˜æ“ä½œï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><p><img data-src="https://img.xfc-exclave.com/2022/03/a3ba9a6e4004b2806121e1c35cb7be771647095968.png" alt="redis-cache-sleep"></p><p>åœ¨å»¶æ—¶åŒåˆ è¿‡ç¨‹ä¸­ï¼Œå¦‚æœå­˜åœ¨å…¶ä»–çº¿ç¨‹å¯¹ç¼“å­˜è¿›è¡Œæ›´æ–°ï¼Œé‚£ä¹ˆè¯¥æ›´æ–°ç¼“å­˜çš„çº¿ç¨‹æ‰€å¾—æ•°æ®ä»ä¸ºæ—§æ•°æ®ï¼Œä½†æ–°çš„çº¿ç¨‹è®¿é—®æ—¶ï¼Œèƒ½ä¿è¯å¾—åˆ°çš„æ•°æ®æ˜¯æ–°çš„æ•°æ®ã€‚</p></li><li><p>å¼‚æ­¥æ›´æ–°ç¼“å­˜</p><p>TODO</p><blockquote><p>å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œåœ¨ä¿è¯ Redis æ€§èƒ½çš„å‰æä¸‹ï¼Œæ•°æ®åº“ä¸ç¼“å­˜ä¹‹é—´çš„æ•°æ®å…¶å®æ˜¯æ— æ³•ä¿è¯ç»å¯¹ä¸€è‡´çš„ï¼Œæˆ‘ä»¬é€šå¸¸æ‰€è¯´çš„ç¼“å­˜ä¸€è‡´æ€§ï¼Œå¾€å¾€éœ€è¦å°†å®é™…ä¸šåŠ¡åœºæ™¯çº³å…¥è€ƒè™‘èŒƒå›´ï¼Œè¿›è¡Œç»¼åˆè€ƒè™‘ã€‚</p></blockquote></li></ol><h4 id="ç¼“å­˜ç©¿é€"><a class="anchor" href="#ç¼“å­˜ç©¿é€">#</a> ç¼“å­˜ç©¿é€</h4><p>ç¼“å­˜ç©¿é€æ˜¯æŒ‡å®¢æˆ·ç«¯è¯·æ±‚çš„æ•°æ®åœ¨ç¼“å­˜å’Œæ•°æ®åº“ä¸­å‡ä¸å­˜åœ¨ï¼Œè¿™æ ·å°±ä½¿å¾—ç¼“å­˜æ°¸è¿œæ— æ³•ç”Ÿæ•ˆï¼Œå¯¼è‡´è¯·æ±‚å§‹ç»ˆéƒ½ä¼šç›´æ¥è®¿é—®æ•°æ®åº“ï¼Œä»è€Œå½±å“æœåŠ¡æ€§èƒ½ã€‚</p><p>é’ˆå¯¹ç¼“å­˜ç©¿é€ï¼Œæœ‰å¦‚ä¸‹ä¸¤ç§å¸¸è§è§£å†³æ–¹æ¡ˆï¼š</p><ol><li><p>ç¼“å­˜ç©ºå¯¹è±¡ï¼šå³å½“æ•°æ®åº“ä¸­ä¸å­˜åœ¨è¯¥æ•°æ®æ—¶ï¼Œåˆ™å‘ç¼“å­˜ä¸­å­˜å…¥ç©ºå¯¹è±¡ï¼ŒåŒæ—¶è®¾ç½®è¾ƒçŸ­çš„è¿‡æœŸæ—¶é—´ã€‚</p><p>ä¼˜ç‚¹ï¼šå®ç°ç®€å•ï¼Œæ–¹ä¾¿ç»´æŠ¤ã€‚</p><p>ç¼ºç‚¹ï¼š</p><ul><li>å ç”¨ä¸å¿…è¦çš„å†…å­˜ã€‚</li><li>å¯èƒ½é€ æˆçŸ­æœŸæ•°æ®ä¸ä¸€è‡´ï¼ˆé’ˆå¯¹è¿™ä¸€ç¼ºç‚¹ï¼Œå¯ä»¥åœ¨æ›´æ–°æ•°æ®æ—¶åŒæ­¥æ›´æ–°åˆ°ç¼“å­˜ï¼‰ã€‚</li></ul></li><li><p>å¸ƒéš†è¿‡æ»¤</p><p>ç›¸å…³ä»‹ç»å¯æŸ¥é˜…<span class="exturl" data-url="aHR0cHM6Ly9iYWlrZS5iYWlkdS5jb20vaXRlbS8lRTUlQjglODMlRTklOUElODYlRTglQkYlODclRTYlQkIlQTQlRTUlOTklQTg=">å¸ƒéš†è¿‡æ»¤å™¨_ç™¾åº¦ç™¾ç§‘</span>ã€‚</p><p>ä¼˜ç‚¹ï¼šå†…å­˜å ç”¨å°‘ï¼Œæ²¡æœ‰å¤šä½™çš„ keyã€‚</p><p>ç¼ºç‚¹ï¼š</p><ul><li>å®ç°å¤æ‚ã€‚</li><li>å­˜åœ¨è¯¯åˆ¤çš„å¯èƒ½ã€‚</li></ul></li></ol><blockquote><p>é™¤æ­¤ä¹‹å¤–ï¼Œåœ¨ä¸šåŠ¡ä¸Šæˆ‘ä»¬ä¹Ÿåº”å½“åšç›¸åº”çš„æ§åˆ¶ï¼Œä¾‹å¦‚å¢åŠ  ID å¤æ‚åº¦ã€åšå¥½æ•°æ®çš„åŸºç¡€æ ¼å¼æ ¡éªŒã€åŠ å¼ºç”¨æˆ·æƒé™æ ¡éªŒã€åšå¥½çƒ­ç‚¹æ•°æ®é™æµç­‰ã€‚</p></blockquote><h4 id="ç¼“å­˜é›ªå´©"><a class="anchor" href="#ç¼“å­˜é›ªå´©">#</a> ç¼“å­˜é›ªå´©</h4><p>ç¼“å­˜é›ªå´©æ˜¯æŒ‡åœ¨åŒä¸€æ—¶æ®µå†…çš„ç¼“å­˜ key åŒæ—¶å¤±æ•ˆæˆ–è€… Redis æœåŠ¡å®•æœºï¼Œå¯¼è‡´å¤§é‡è¯·æ±‚ç›´æ¥åˆ°è¾¾æ•°æ®åº“ï¼Œç»™æ•°æ®åº“å¸¦æ¥å·¨å¤§å‹åŠ›ã€‚</p><p>é’ˆå¯¹ç¼“å­˜é›ªå´©ï¼Œæœ‰å¦‚ä¸‹å‡ ç§å¸¸è§è§£å†³æ–¹æ¡ˆï¼š</p><ol><li>ç»™ä¸åŒ key çš„ TTL æ·»åŠ éšæœºå€¼ï¼Œå°½é‡åˆ†æ•£ç¼“å­˜çš„è¿‡æœŸæ—¶é—´ã€‚</li><li>åˆ©ç”¨ Redis é›†ç¾¤æé«˜æœåŠ¡çš„å¯ç”¨æ€§ï¼ˆä»¥è§£å†³ Redis æœåŠ¡å®•æœºé—®é¢˜ï¼‰ã€‚</li><li>ç»™ç¼“å­˜æœåŠ¡æ·»åŠ é™çº§é™æµç­–ç•¥ï¼Œåšå¥½æœåŠ¡å®¹é”™ã€‚</li><li>ç»™ä¸šåŠ¡æ·»åŠ å¤šçº§ç¼“å­˜ã€‚</li></ol><h4 id="ç¼“å­˜å‡»ç©¿"><a class="anchor" href="#ç¼“å­˜å‡»ç©¿">#</a> ç¼“å­˜å‡»ç©¿</h4><p>ç¼“å­˜å‡»ç©¿ä¹Ÿè¢«ç§°ä¸ºçƒ­ç‚¹ key é—®é¢˜ï¼Œå°±æ˜¯ä¸€ä¸ªè¢«é«˜å¹¶å‘è®¿é—®å¹¶ä¸”ç¼“å­˜é‡å»ºä¸šåŠ¡è¾ƒä¸ºå¤æ‚çš„ key çªç„¶å¤±æ•ˆï¼Œå¤§é‡è¯·æ±‚ç¬é—´è®¿é—®åˆ°æ•°æ®åº“ï¼Œå¯¼è‡´æ•°æ®åº“æ‰¿å—å·¨å¤§å‹åŠ›ã€‚</p><p>é’ˆå¯¹ç¼“å­˜å‡»ç©¿ï¼Œæœ‰å¦‚ä¸‹å‡ ç§å¸¸è§è§£å†³æ–¹æ¡ˆï¼š</p><ol><li><p>äº’æ–¥é”</p><p>é‡å»ºæ•°æ®æ—¶ï¼Œè¿›è¡ŒåŠ é”ï¼Œè·å–åˆ°é”çš„çº¿ç¨‹æ‰è¿›è¡Œæ•°æ®é‡å»ºï¼Œå…¶ä»–çº¿ç¨‹è¿›è¡Œä¸€å®šçš„ç­‰å¾…å’Œé‡è¯•ã€‚è¿™ç§æ–¹æ¡ˆç”±äºéœ€è¦çº¿ç¨‹ç­‰å¾…ï¼Œæ€§èƒ½ç›¸å¯¹è¾ƒå·®ã€‚</p></li><li><p>é€»è¾‘è¿‡æœŸ</p><p>ä¸é‡‡ç”¨ Redis æä¾›çš„ TTLï¼Œè€Œæ˜¯è‡ªå®šä¹‰ä¸€ä¸ªé€»è¾‘è¿‡æœŸå­—æ®µç”¨äºè®°å½•è¿‡æœŸæ—¶é—´ï¼Œå½“ç¨‹åºé€šè¿‡è¯¥å­—æ®µåˆ¤æ–­æ•°æ®è¿‡æœŸæ—¶ï¼Œåˆ™ä½¿ç”¨äº’æ–¥é”å¼€å¯ä¸€ä¸ªæ–°çš„çº¿ç¨‹ï¼Œç”¨è¯¥çº¿ç¨‹æ¥æ‰§è¡Œæ›´æ–°ç¼“å­˜æ•°æ®æ“ä½œï¼Œæ›´æ–°å®Œæ•°æ®åï¼Œé‡Šæ”¾é”ã€‚å…¶ä»–æœªè·å–åˆ°äº’æ–¥é”æ—¶ï¼Œç›´æ¥è¿”å›ç¼“å­˜ä¸­çš„æ—§æ•°æ®ã€‚</p></li></ol><h4 id="ä»£ç å®ç°"><a class="anchor" href="#ä»£ç å®ç°">#</a> ä»£ç å®ç°</h4><blockquote><p>ä¸ºäº†æ›´åŠ æ–¹ä¾¿å¼€å‘è¿‡ç¨‹ä¸­ï¼Œå¯¹è§£å†³ç¼“å­˜ç©¿é€å’Œç¼“å­˜å‡»ç©¿ç­‰é—®é¢˜æ•´ç†æ€è·¯ï¼Œæ­¤å¤„å¼•ç”¨ä¸€ä»½é»‘é©¬æ•™å­¦ç¼–å†™çš„ç¤ºä¾‹ä»£ç ï¼Œ<span class="exturl" data-url="aHR0cHM6Ly9naXRlZS5jb20vaHV5aTYxMi9obS1kaWFucGluZy9ibG9iL21hc3Rlci9zcmMvbWFpbi9qYXZhL2NvbS9obWRwL3V0aWxzL0NhY2hlQ2xpZW50LmphdmE=">ç‚¹å‡»æ­¤å¤„</span>å¯ä»¥æŸ¥çœ‹æºä»£ç ä½ç½®ã€‚</p></blockquote><figure class="highlight java"><figcaption data-lang="java"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token annotation punctuation">@Slf4j</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token annotation punctuation">@Component</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CacheClient</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="4"></td><td><pre></pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">StringRedisTemplate</span> stringRedisTemplate<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="6"></td><td><pre></pre></td></tr><tr><td data-num="7"></td><td><pre>    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">ExecutorService</span> CACHE_REBUILD_EXECUTOR <span class="token operator">=</span> <span class="token class-name">Executors</span><span class="token punctuation">.</span><span class="token function">newFixedThreadPool</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="8"></td><td><pre></pre></td></tr><tr><td data-num="9"></td><td><pre>    <span class="token keyword">public</span> <span class="token class-name">CacheClient</span><span class="token punctuation">(</span><span class="token class-name">StringRedisTemplate</span> stringRedisTemplate<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="10"></td><td><pre>        <span class="token keyword">this</span><span class="token punctuation">.</span>stringRedisTemplate <span class="token operator">=</span> stringRedisTemplate<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="11"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="12"></td><td><pre></pre></td></tr><tr><td data-num="13"></td><td><pre>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">set</span><span class="token punctuation">(</span><span class="token class-name">String</span> key<span class="token punctuation">,</span> <span class="token class-name">Object</span> value<span class="token punctuation">,</span> <span class="token class-name">Long</span> time<span class="token punctuation">,</span> <span class="token class-name">TimeUnit</span> unit<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="14"></td><td><pre>        stringRedisTemplate<span class="token punctuation">.</span><span class="token function">opsForValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> <span class="token class-name">JSONUtil</span><span class="token punctuation">.</span><span class="token function">toJsonStr</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">,</span> time<span class="token punctuation">,</span> unit<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="15"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="16"></td><td><pre></pre></td></tr><tr><td data-num="17"></td><td><pre>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setWithLogicalExpire</span><span class="token punctuation">(</span><span class="token class-name">String</span> key<span class="token punctuation">,</span> <span class="token class-name">Object</span> value<span class="token punctuation">,</span> <span class="token class-name">Long</span> time<span class="token punctuation">,</span> <span class="token class-name">TimeUnit</span> unit<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="18"></td><td><pre>        <span class="token comment">// è®¾ç½®é€»è¾‘è¿‡æœŸ</span></pre></td></tr><tr><td data-num="19"></td><td><pre>        <span class="token class-name">RedisData</span> redisData <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RedisData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="20"></td><td><pre>        redisData<span class="token punctuation">.</span><span class="token function">setData</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="21"></td><td><pre>        redisData<span class="token punctuation">.</span><span class="token function">setExpireTime</span><span class="token punctuation">(</span><span class="token class-name">LocalDateTime</span><span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">plusSeconds</span><span class="token punctuation">(</span>unit<span class="token punctuation">.</span><span class="token function">toSeconds</span><span class="token punctuation">(</span>time<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="22"></td><td><pre>        <span class="token comment">// å†™å…¥ Redis</span></pre></td></tr><tr><td data-num="23"></td><td><pre>        stringRedisTemplate<span class="token punctuation">.</span><span class="token function">opsForValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> <span class="token class-name">JSONUtil</span><span class="token punctuation">.</span><span class="token function">toJsonStr</span><span class="token punctuation">(</span>redisData<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="24"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="25"></td><td><pre></pre></td></tr><tr><td data-num="26"></td><td><pre>    <span class="token keyword">public</span> <span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">R</span><span class="token punctuation">,</span>ID<span class="token punctuation">></span></span> <span class="token class-name">R</span> <span class="token function">queryWithPassThrough</span><span class="token punctuation">(</span><span class="token class-name">String</span> keyPrefix<span class="token punctuation">,</span> <span class="token class-name">ID</span> id<span class="token punctuation">,</span> <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">R</span><span class="token punctuation">></span></span> type<span class="token punctuation">,</span> <span class="token class-name">Function</span><span class="token generics"><span class="token punctuation">&lt;</span>ID<span class="token punctuation">,</span> <span class="token class-name">R</span><span class="token punctuation">></span></span> dbFallback<span class="token punctuation">,</span> <span class="token class-name">Long</span> time<span class="token punctuation">,</span> <span class="token class-name">TimeUnit</span> unit<span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="27"></td><td><pre>        <span class="token class-name">String</span> key <span class="token operator">=</span> keyPrefix <span class="token operator">+</span> id<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="28"></td><td><pre>        <span class="token comment">// 1. ä» redis æŸ¥è¯¢å•†é“ºç¼“å­˜</span></pre></td></tr><tr><td data-num="29"></td><td><pre>        <span class="token class-name">String</span> json <span class="token operator">=</span> stringRedisTemplate<span class="token punctuation">.</span><span class="token function">opsForValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="30"></td><td><pre>        <span class="token comment">// 2. åˆ¤æ–­æ˜¯å¦å­˜åœ¨</span></pre></td></tr><tr><td data-num="31"></td><td><pre>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">StrUtil</span><span class="token punctuation">.</span><span class="token function">isNotBlank</span><span class="token punctuation">(</span>json<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="32"></td><td><pre>            <span class="token comment">// 3. å­˜åœ¨ï¼Œç›´æ¥è¿”å›</span></pre></td></tr><tr><td data-num="33"></td><td><pre>            <span class="token keyword">return</span> <span class="token class-name">JSONUtil</span><span class="token punctuation">.</span><span class="token function">toBean</span><span class="token punctuation">(</span>json<span class="token punctuation">,</span> type<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="34"></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="35"></td><td><pre>        <span class="token comment">// åˆ¤æ–­å‘½ä¸­çš„æ˜¯å¦æ˜¯ç©ºå€¼</span></pre></td></tr><tr><td data-num="36"></td><td><pre>        <span class="token keyword">if</span> <span class="token punctuation">(</span>json <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="37"></td><td><pre>            <span class="token comment">// è¿”å›ä¸€ä¸ªé”™è¯¯ä¿¡æ¯</span></pre></td></tr><tr><td data-num="38"></td><td><pre>            <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="39"></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="40"></td><td><pre></pre></td></tr><tr><td data-num="41"></td><td><pre>        <span class="token comment">// 4. ä¸å­˜åœ¨ï¼Œæ ¹æ® id æŸ¥è¯¢æ•°æ®åº“</span></pre></td></tr><tr><td data-num="42"></td><td><pre>        <span class="token class-name">R</span> r <span class="token operator">=</span> dbFallback<span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="43"></td><td><pre>        <span class="token comment">// 5. ä¸å­˜åœ¨ï¼Œè¿”å›é”™è¯¯</span></pre></td></tr><tr><td data-num="44"></td><td><pre>        <span class="token keyword">if</span> <span class="token punctuation">(</span>r <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="45"></td><td><pre>            <span class="token comment">// å°†ç©ºå€¼å†™å…¥ redis</span></pre></td></tr><tr><td data-num="46"></td><td><pre>            stringRedisTemplate<span class="token punctuation">.</span><span class="token function">opsForValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">,</span> CACHE_NULL_TTL<span class="token punctuation">,</span> <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>MINUTES<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="47"></td><td><pre>            <span class="token comment">// è¿”å›é”™è¯¯ä¿¡æ¯</span></pre></td></tr><tr><td data-num="48"></td><td><pre>            <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="49"></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="50"></td><td><pre>        <span class="token comment">// 6. å­˜åœ¨ï¼Œå†™å…¥ redis</span></pre></td></tr><tr><td data-num="51"></td><td><pre>        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> r<span class="token punctuation">,</span> time<span class="token punctuation">,</span> unit<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="52"></td><td><pre>        <span class="token keyword">return</span> r<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="53"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="54"></td><td><pre></pre></td></tr><tr><td data-num="55"></td><td><pre>    <span class="token keyword">public</span> <span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">R</span><span class="token punctuation">,</span> ID<span class="token punctuation">></span></span> <span class="token class-name">R</span> <span class="token function">queryWithLogicalExpire</span><span class="token punctuation">(</span><span class="token class-name">String</span> keyPrefix<span class="token punctuation">,</span> <span class="token class-name">ID</span> id<span class="token punctuation">,</span> <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">R</span><span class="token punctuation">></span></span> type<span class="token punctuation">,</span> <span class="token class-name">Function</span><span class="token generics"><span class="token punctuation">&lt;</span>ID<span class="token punctuation">,</span> <span class="token class-name">R</span><span class="token punctuation">></span></span> dbFallback<span class="token punctuation">,</span> <span class="token class-name">Long</span> time<span class="token punctuation">,</span> <span class="token class-name">TimeUnit</span> unit<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="56"></td><td><pre>        <span class="token class-name">String</span> key <span class="token operator">=</span> keyPrefix <span class="token operator">+</span> id<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="57"></td><td><pre>        <span class="token comment">// 1. ä» redis æŸ¥è¯¢å•†é“ºç¼“å­˜</span></pre></td></tr><tr><td data-num="58"></td><td><pre>        <span class="token class-name">String</span> json <span class="token operator">=</span> stringRedisTemplate<span class="token punctuation">.</span><span class="token function">opsForValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="59"></td><td><pre>        <span class="token comment">// 2. åˆ¤æ–­æ˜¯å¦å­˜åœ¨</span></pre></td></tr><tr><td data-num="60"></td><td><pre>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">StrUtil</span><span class="token punctuation">.</span><span class="token function">isBlank</span><span class="token punctuation">(</span>json<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="61"></td><td><pre>            <span class="token comment">// 3. å­˜åœ¨ï¼Œç›´æ¥è¿”å›</span></pre></td></tr><tr><td data-num="62"></td><td><pre>            <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="63"></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="64"></td><td><pre>        <span class="token comment">// 4. å‘½ä¸­ï¼Œéœ€è¦å…ˆæŠŠ json ååºåˆ—åŒ–ä¸ºå¯¹è±¡</span></pre></td></tr><tr><td data-num="65"></td><td><pre>        <span class="token class-name">RedisData</span> redisData <span class="token operator">=</span> <span class="token class-name">JSONUtil</span><span class="token punctuation">.</span><span class="token function">toBean</span><span class="token punctuation">(</span>json<span class="token punctuation">,</span> <span class="token class-name">RedisData</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="66"></td><td><pre>        <span class="token class-name">R</span> r <span class="token operator">=</span> <span class="token class-name">JSONUtil</span><span class="token punctuation">.</span><span class="token function">toBean</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">JSONObject</span><span class="token punctuation">)</span> redisData<span class="token punctuation">.</span><span class="token function">getData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> type<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="67"></td><td><pre>        <span class="token class-name">LocalDateTime</span> expireTime <span class="token operator">=</span> redisData<span class="token punctuation">.</span><span class="token function">getExpireTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="68"></td><td><pre>        <span class="token comment">// 5. åˆ¤æ–­æ˜¯å¦è¿‡æœŸ</span></pre></td></tr><tr><td data-num="69"></td><td><pre>        <span class="token keyword">if</span><span class="token punctuation">(</span>expireTime<span class="token punctuation">.</span><span class="token function">isAfter</span><span class="token punctuation">(</span><span class="token class-name">LocalDateTime</span><span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="70"></td><td><pre>            <span class="token comment">// 5.1. æœªè¿‡æœŸï¼Œç›´æ¥è¿”å›åº—é“ºä¿¡æ¯</span></pre></td></tr><tr><td data-num="71"></td><td><pre>            <span class="token keyword">return</span> r<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="72"></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="73"></td><td><pre>        <span class="token comment">// 5.2. å·²è¿‡æœŸï¼Œéœ€è¦ç¼“å­˜é‡å»º</span></pre></td></tr><tr><td data-num="74"></td><td><pre>        <span class="token comment">// 6. ç¼“å­˜é‡å»º</span></pre></td></tr><tr><td data-num="75"></td><td><pre>        <span class="token comment">// 6.1. è·å–äº’æ–¥é”</span></pre></td></tr><tr><td data-num="76"></td><td><pre>        <span class="token class-name">String</span> lockKey <span class="token operator">=</span> LOCK_SHOP_KEY <span class="token operator">+</span> id<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="77"></td><td><pre>        <span class="token keyword">boolean</span> isLock <span class="token operator">=</span> <span class="token function">tryLock</span><span class="token punctuation">(</span>lockKey<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="78"></td><td><pre>        <span class="token comment">// 6.2. åˆ¤æ–­æ˜¯å¦è·å–é”æˆåŠŸ</span></pre></td></tr><tr><td data-num="79"></td><td><pre>        <span class="token keyword">if</span> <span class="token punctuation">(</span>isLock<span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="80"></td><td><pre>            <span class="token comment">// 6.3. æˆåŠŸï¼Œå¼€å¯ç‹¬ç«‹çº¿ç¨‹ï¼Œå®ç°ç¼“å­˜é‡å»º</span></pre></td></tr><tr><td data-num="81"></td><td><pre>            CACHE_REBUILD_EXECUTOR<span class="token punctuation">.</span><span class="token function">submit</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-></span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="82"></td><td><pre>                <span class="token keyword">try</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="83"></td><td><pre>                    <span class="token comment">// æŸ¥è¯¢æ•°æ®åº“</span></pre></td></tr><tr><td data-num="84"></td><td><pre>                    <span class="token class-name">R</span> newR <span class="token operator">=</span> dbFallback<span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="85"></td><td><pre>                    <span class="token comment">// é‡å»ºç¼“å­˜</span></pre></td></tr><tr><td data-num="86"></td><td><pre>                    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setWithLogicalExpire</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> newR<span class="token punctuation">,</span> time<span class="token punctuation">,</span> unit<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="87"></td><td><pre>                <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="88"></td><td><pre>                    <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="89"></td><td><pre>                <span class="token punctuation">&#125;</span> <span class="token keyword">finally</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="90"></td><td><pre>                    <span class="token comment">// é‡Šæ”¾é”</span></pre></td></tr><tr><td data-num="91"></td><td><pre>                    <span class="token function">unlock</span><span class="token punctuation">(</span>lockKey<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="92"></td><td><pre>                <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="93"></td><td><pre>            <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="94"></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="95"></td><td><pre>        <span class="token comment">// 6.4. è¿”å›è¿‡æœŸçš„å•†é“ºä¿¡æ¯</span></pre></td></tr><tr><td data-num="96"></td><td><pre>        <span class="token keyword">return</span> r<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="97"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="98"></td><td><pre></pre></td></tr><tr><td data-num="99"></td><td><pre>    <span class="token keyword">public</span> <span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">R</span><span class="token punctuation">,</span> ID<span class="token punctuation">></span></span> <span class="token class-name">R</span> <span class="token function">queryWithMutex</span><span class="token punctuation">(</span><span class="token class-name">String</span> keyPrefix<span class="token punctuation">,</span> <span class="token class-name">ID</span> id<span class="token punctuation">,</span> <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">R</span><span class="token punctuation">></span></span> type<span class="token punctuation">,</span> <span class="token class-name">Function</span><span class="token generics"><span class="token punctuation">&lt;</span>ID<span class="token punctuation">,</span> <span class="token class-name">R</span><span class="token punctuation">></span></span> dbFallback<span class="token punctuation">,</span> <span class="token class-name">Long</span> time<span class="token punctuation">,</span> <span class="token class-name">TimeUnit</span> unit<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="100"></td><td><pre>        <span class="token class-name">String</span> key <span class="token operator">=</span> keyPrefix <span class="token operator">+</span> id<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="101"></td><td><pre>        <span class="token comment">// 1. ä» redis æŸ¥è¯¢å•†é“ºç¼“å­˜</span></pre></td></tr><tr><td data-num="102"></td><td><pre>        <span class="token class-name">String</span> shopJson <span class="token operator">=</span> stringRedisTemplate<span class="token punctuation">.</span><span class="token function">opsForValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="103"></td><td><pre>        <span class="token comment">// 2. åˆ¤æ–­æ˜¯å¦å­˜åœ¨</span></pre></td></tr><tr><td data-num="104"></td><td><pre>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">StrUtil</span><span class="token punctuation">.</span><span class="token function">isNotBlank</span><span class="token punctuation">(</span>shopJson<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="105"></td><td><pre>            <span class="token comment">// 3. å­˜åœ¨ï¼Œç›´æ¥è¿”å›</span></pre></td></tr><tr><td data-num="106"></td><td><pre>            <span class="token keyword">return</span> <span class="token class-name">JSONUtil</span><span class="token punctuation">.</span><span class="token function">toBean</span><span class="token punctuation">(</span>shopJson<span class="token punctuation">,</span> type<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="107"></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="108"></td><td><pre>        <span class="token comment">// åˆ¤æ–­å‘½ä¸­çš„æ˜¯å¦æ˜¯ç©ºå€¼</span></pre></td></tr><tr><td data-num="109"></td><td><pre>        <span class="token keyword">if</span> <span class="token punctuation">(</span>shopJson <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="110"></td><td><pre>            <span class="token comment">// è¿”å›ä¸€ä¸ªé”™è¯¯ä¿¡æ¯</span></pre></td></tr><tr><td data-num="111"></td><td><pre>            <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="112"></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="113"></td><td><pre></pre></td></tr><tr><td data-num="114"></td><td><pre>        <span class="token comment">// 4. å®ç°ç¼“å­˜é‡å»º</span></pre></td></tr><tr><td data-num="115"></td><td><pre>        <span class="token comment">// 4.1. è·å–äº’æ–¥é”</span></pre></td></tr><tr><td data-num="116"></td><td><pre>        <span class="token class-name">String</span> lockKey <span class="token operator">=</span> LOCK_SHOP_KEY <span class="token operator">+</span> id<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="117"></td><td><pre>        <span class="token class-name">R</span> r <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="118"></td><td><pre>        <span class="token keyword">try</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="119"></td><td><pre>            <span class="token keyword">boolean</span> isLock <span class="token operator">=</span> <span class="token function">tryLock</span><span class="token punctuation">(</span>lockKey<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="120"></td><td><pre>            <span class="token comment">// 4.2. åˆ¤æ–­æ˜¯å¦è·å–æˆåŠŸ</span></pre></td></tr><tr><td data-num="121"></td><td><pre>            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>isLock<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="122"></td><td><pre>                <span class="token comment">// 4.3. è·å–é”å¤±è´¥ï¼Œä¼‘çœ å¹¶é‡è¯•</span></pre></td></tr><tr><td data-num="123"></td><td><pre>                <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="124"></td><td><pre>                <span class="token keyword">return</span> <span class="token function">queryWithMutex</span><span class="token punctuation">(</span>keyPrefix<span class="token punctuation">,</span> id<span class="token punctuation">,</span> type<span class="token punctuation">,</span> dbFallback<span class="token punctuation">,</span> time<span class="token punctuation">,</span> unit<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="125"></td><td><pre>            <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="126"></td><td><pre>            <span class="token comment">// 4.4. è·å–é”æˆåŠŸï¼Œæ ¹æ® id æŸ¥è¯¢æ•°æ®åº“</span></pre></td></tr><tr><td data-num="127"></td><td><pre>            r <span class="token operator">=</span> dbFallback<span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="128"></td><td><pre>            <span class="token comment">// 5. ä¸å­˜åœ¨ï¼Œè¿”å›é”™è¯¯</span></pre></td></tr><tr><td data-num="129"></td><td><pre>            <span class="token keyword">if</span> <span class="token punctuation">(</span>r <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="130"></td><td><pre>                <span class="token comment">// å°†ç©ºå€¼å†™å…¥ redis</span></pre></td></tr><tr><td data-num="131"></td><td><pre>                stringRedisTemplate<span class="token punctuation">.</span><span class="token function">opsForValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">,</span> CACHE_NULL_TTL<span class="token punctuation">,</span> <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>MINUTES<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="132"></td><td><pre>                <span class="token comment">// è¿”å›é”™è¯¯ä¿¡æ¯</span></pre></td></tr><tr><td data-num="133"></td><td><pre>                <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="134"></td><td><pre>            <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="135"></td><td><pre>            <span class="token comment">// 6. å­˜åœ¨ï¼Œå†™å…¥ redis</span></pre></td></tr><tr><td data-num="136"></td><td><pre>            <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> r<span class="token punctuation">,</span> time<span class="token punctuation">,</span> unit<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="137"></td><td><pre>        <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="138"></td><td><pre>            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="139"></td><td><pre>        <span class="token punctuation">&#125;</span> <span class="token keyword">finally</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="140"></td><td><pre>            <span class="token comment">// 7. é‡Šæ”¾é”</span></pre></td></tr><tr><td data-num="141"></td><td><pre>            <span class="token function">unlock</span><span class="token punctuation">(</span>lockKey<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="142"></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="143"></td><td><pre>        <span class="token comment">// 8. è¿”å›</span></pre></td></tr><tr><td data-num="144"></td><td><pre>        <span class="token keyword">return</span> r<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="145"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="146"></td><td><pre></pre></td></tr><tr><td data-num="147"></td><td><pre>    <span class="token keyword">private</span> <span class="token keyword">boolean</span> <span class="token function">tryLock</span><span class="token punctuation">(</span><span class="token class-name">String</span> key<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="148"></td><td><pre>        <span class="token class-name">Boolean</span> flag <span class="token operator">=</span> stringRedisTemplate<span class="token punctuation">.</span><span class="token function">opsForValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setIfAbsent</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> <span class="token string">"1"</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>SECONDS<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="149"></td><td><pre>        <span class="token keyword">return</span> <span class="token class-name">BooleanUtil</span><span class="token punctuation">.</span><span class="token function">isTrue</span><span class="token punctuation">(</span>flag<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="150"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="151"></td><td><pre></pre></td></tr><tr><td data-num="152"></td><td><pre>    <span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">unlock</span><span class="token punctuation">(</span><span class="token class-name">String</span> key<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="153"></td><td><pre>        stringRedisTemplate<span class="token punctuation">.</span><span class="token function">delete</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="154"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="155"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><h3 id="redis-åˆ†å¸ƒå¼é”"><a class="anchor" href="#redis-åˆ†å¸ƒå¼é”">#</a> Redis åˆ†å¸ƒå¼é”</h3><p>æ‰€è°“åˆ†å¸ƒå¼é”ï¼Œå°±æ˜¯æ»¡è¶³åˆ†å¸ƒå¼ç³»ç»Ÿæˆ–é›†ç¾¤æ¨¡å¼ä¸‹å¤šè¿›ç¨‹å¯è§å¹¶äº’æ–¥çš„é”ã€‚</p><p>åˆ†å¸ƒå¼é”çš„æ ¸å¿ƒæ˜¯å®ç°å¤šçº¿ç¨‹ä¹‹é—´çš„äº’æ–¥ï¼Œå…¶å®ç°æ–¹å¼å¸¸è§æœ‰å¦‚ä¸‹ä¸‰ç§ï¼š</p><table><thead><tr><th></th><th>MySQL</th><th>Redis</th><th>Zookeeper</th></tr></thead><tbody><tr><td>äº’æ–¥</td><td>åˆ©ç”¨ mysql æœ¬èº«çš„äº’æ–¥é”æœºåˆ¶</td><td>åˆ©ç”¨ setnx è¿™æ ·çš„äº’æ–¥å‘½ä»¤</td><td>åˆ©ç”¨èŠ‚ç‚¹å”¯ä¸€æ€§å’Œæœ‰åºæ€§å®ç°äº’æ–¥</td></tr><tr><td>é«˜å¯ç”¨</td><td>å¥½</td><td>å¥½</td><td>å¥½</td></tr><tr><td>é«˜æ€§èƒ½</td><td>ä¸€èˆ¬</td><td>å¥½</td><td>ä¸€èˆ¬</td></tr><tr><td>å®‰å…¨æ€§</td><td>æ–­å¼€è¿æ¥ï¼Œè‡ªåŠ¨é‡Šæ”¾é”</td><td>åˆ©ç”¨è¶…æ—¶æœºåˆ¶ï¼Œåˆ°æœŸé‡Šæ”¾</td><td>ä¸´æ—¶èŠ‚ç‚¹ï¼Œæ–­å¼€è¿æ¥è‡ªåŠ¨é‡Šæ”¾</td></tr></tbody></table><h4 id="åŸºäº-redis-å®ç°åˆ†å¸ƒå¼é”"><a class="anchor" href="#åŸºäº-redis-å®ç°åˆ†å¸ƒå¼é”">#</a> åŸºäº Redis å®ç°åˆ†å¸ƒå¼é”</h4><p>åŸºæœ¬å®ç°æ€è·¯ï¼š</p><ol><li><p>ç‰ˆæœ¬ä¸€ï¼š</p><figure class="highlight shell"><figcaption data-lang="Bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment"># æ·»åŠ é”ï¼Œåˆ©ç”¨ SETNX çš„äº’æ–¥æ€§</span></pre></td></tr><tr><td data-num="2"></td><td><pre>SETNX lock thread-1</pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token comment"># æ·»åŠ é”è¿‡æœŸæ—¶é—´ï¼Œé¿å…æœåŠ¡å®•æœºå¯¼è‡´æ­»é”</span></pre></td></tr><tr><td data-num="4"></td><td><pre>EXPIRE lock <span class="token number">10</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token comment"># é‡Šæ”¾é”</span></pre></td></tr><tr><td data-num="6"></td><td><pre>DEL lock</pre></td></tr></table></figure></li><li><p>ç‰ˆæœ¬äºŒï¼š</p><p>åœ¨ç‰ˆæœ¬ä¸€ä¸­ï¼Œç”±äºå‘½ä»¤é€æ¡æ‰§è¡Œï¼Œè€ƒè™‘åˆ°åœ¨æ·»åŠ é”å’Œè®¾ç½®é”è¿‡æœŸæ—¶é—´ä¹‹é—´ä»æœ‰å¯èƒ½å‡ºç°æœåŠ¡å®•æœºçš„æƒ…å†µï¼Œå› æ­¤æˆ‘ä»¬è¿˜éœ€è¦ä¿è¯æ·»åŠ é”å’Œè®¾ç½®é”è¿‡æœŸæ—¶é—´è¿™ä¸¤ä¸ªæ“ä½œåŒæ—¶æ‰§è¡Œï¼Œå…·æœ‰åŸå­æ€§ï¼Œå› æ­¤éœ€è¦å¯¹è¯¥æ–¹æ¡ˆè¿›è¡Œå‡çº§ï¼š</p><figure class="highlight shell"><figcaption data-lang="Bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment"># æ·»åŠ äº’æ–¥é”å¹¶è®¾ç½®è¿‡æœŸæ—¶é—´ï¼ˆåŸå­æ€§ï¼‰</span></pre></td></tr><tr><td data-num="2"></td><td><pre>SET lock thread-1 EX <span class="token number">10</span> NX</pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token comment"># é‡Šæ”¾é”</span></pre></td></tr><tr><td data-num="4"></td><td><pre>DEL lock</pre></td></tr></table></figure></li><li><p>ç‰ˆæœ¬ä¸‰ï¼š</p><p>åŸºäºç‰ˆæœ¬äºŒï¼ŒåŸºæœ¬ä¸Šèƒ½å¤Ÿè§£å†³å¤§éƒ¨åˆ†å¹¶å‘æƒ…å†µï¼Œä½†åœ¨éƒ¨åˆ†æç«¯æƒ…å†µä¸‹ï¼Œä»æ—§å­˜åœ¨çº¿ç¨‹å®‰å…¨é—®é¢˜ã€‚ä¸»è¦è¡¨ç°åœ¨å½“è·å–åˆ°äº’æ–¥é”çš„çº¿ç¨‹ï¼ˆThread-Aï¼‰æ‰§è¡Œæ—¶é—´è¶…è¿‡ Redis TTL è¿‡æœŸæ—¶é—´ï¼Œå°±ä¼šå¯¼è‡´é”æå‰å¤±æ•ˆï¼Œåœ¨å½“å‰çº¿ç¨‹ï¼ˆThread-Aï¼‰æœªé‡Šæ”¾é”çš„æƒ…å†µä¸‹ï¼Œæ­¤æ—¶è¿›å…¥æ–°çš„çº¿ç¨‹ï¼ˆThread-Bï¼‰ä»æ—§å¯ä»¥è·å–é”å¹¶æ‰§è¡Œä¸šåŠ¡é€»è¾‘ï¼Œå¹¶ä¸”ï¼Œåœ¨æ–°çš„çº¿ç¨‹ï¼ˆThread-Bï¼‰æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œå…ˆå‰è·å–åˆ°é”çš„çº¿ç¨‹ï¼ˆThread-Aï¼‰æ‰§è¡Œå®Œä¸šåŠ¡é€»è¾‘åï¼Œå°±ä¼šé‡Šæ”¾çº¿ç¨‹ï¼ˆThread-Bï¼‰æŒæœ‰çš„é”ã€‚è¿™æ ·å°±ä¼šå¯¼è‡´å¤§é‡é”æŒæœ‰å¼‚å¸¸ï¼Œä»è€Œå¼•å‘ä¸šåŠ¡ç¾éš¾ã€‚</p><p>å‡ºç°è¿™æ ·çš„é—®é¢˜ï¼Œæ ¹æœ¬ä¸Šæ˜¯ç”±äºé‡Šæ”¾äº†éå½“å‰çº¿ç¨‹æŒæœ‰çš„é”å¯¼è‡´çš„ï¼Œå› æ­¤ï¼Œè¦è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œåªéœ€è¦åœ¨çº¿ç¨‹é‡Šæ”¾é”æ—¶ï¼Œåˆ¤æ–­å…¶é‡Šæ”¾çš„é”æ˜¯å¦æ˜¯å½“å‰çº¿ç¨‹æŒæœ‰å³å¯ã€‚</p><figure class="highlight java"><figcaption data-lang="java"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">/**</span></pre></td></tr><tr><td data-num="2"></td><td><pre> * æ³¨ï¼šæ­¤æ®µä»£ç åªç”¨äºæ–¹æ¡ˆè¯´æ˜ï¼Œæ— æ³•ç›´æ¥ä½¿ç”¨ã€‚</pre></td></tr><tr><td data-num="3"></td><td><pre> */</pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token class-name">String</span> lockKeyName <span class="token operator">=</span> <span class="token string">"lock:user:192838"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token class-name">String</span> threadId <span class="token operator">=</span> UUID<span class="token punctuation">.</span><span class="token function">randomUUID</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"-"</span> <span class="token operator">+</span> <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token comment">// è·å–é”</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token class-name">Boolean</span> success <span class="token operator">=</span> stringRedisTemplate<span class="token punctuation">.</span><span class="token function">opsForValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setIfAbsent</span><span class="token punctuation">(</span>lockKeyName<span class="token punctuation">,</span> threadId<span class="token punctuation">,</span> <span class="token number">200</span><span class="token punctuation">,</span> <span class="token class-name">TimeUtil</span><span class="token punctuation">.</span>SECONDS<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="8"></td><td><pre></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token comment">// é‡Šæ”¾é”</span></pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token class-name">String</span> id <span class="token operator">=</span> stringRedisTemplate<span class="token punctuation">.</span><span class="token function">opsForValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>lockKeyName<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token comment">// æ ¡éªŒé”æ‹¥æœ‰è€…</span></pre></td></tr><tr><td data-num="12"></td><td><pre><span class="token keyword">if</span> <span class="token punctuation">(</span>threadId<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="13"></td><td><pre>    <span class="token comment">// é‡Šæ”¾é”</span></pre></td></tr><tr><td data-num="14"></td><td><pre>    stringRedisTemplate<span class="token punctuation">.</span><span class="token function">delete</span><span class="token punctuation">(</span>lockKeyName<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="15"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure></li><li><p>æœ€ç»ˆç‰ˆï¼š</p><p>å¯ä»¥è¯´å³ä¾¿æ˜¯åŸºäºç‰ˆæœ¬ä¸‰ï¼Œä»æ—§æœ‰å‡ºç°çº¿ç¨‹å®‰å…¨é—®é¢˜çš„å¯èƒ½ã€‚è€ƒè™‘è¿™æ ·ä¸€ç§æƒ…å†µï¼šå½“ç¨‹åºåœ¨é‡Šæ”¾é”æ—¶ï¼Œå…ˆé€šè¿‡æ ¡éªŒé”æ˜¯å¦ä¸ºå½“å‰çº¿ç¨‹æŒæœ‰ï¼Œæ ¡éªŒé€šè¿‡åï¼Œå¦‚æœæ­¤æ—¶çº¿ç¨‹ï¼ˆThread-Aï¼‰çªç„¶å‘ç”Ÿé˜»å¡ï¼ˆå¯èƒ½æ˜¯ç”± JVM åƒåœ¾å›æ”¶å¯¼è‡´ï¼‰ï¼Œå¹¶ä¸”å¯¼è‡´é”è¶…æ—¶è‡ªåŠ¨é‡Šæ”¾ï¼Œæ­¤æ—¶åœ¨è¯¥çº¿ç¨‹é˜»å¡çš„çŠ¶æ€ä¸‹ï¼Œå…¶ä»–çº¿ç¨‹ï¼ˆThread-Bï¼‰å°±ä»å¯ä»¥è·å–åˆ°é”ï¼Œè€Œå½“çº¿ç¨‹ï¼ˆThread-Aï¼‰é˜»å¡é€šè¿‡åï¼Œç”±äºå®ƒå·²ç»é€šè¿‡é”æŒæœ‰è€…æ ¡éªŒï¼Œå› æ­¤å®ƒå°†ä¼šè¿›è¡Œé‡Šæ”¾é”ï¼Œä½†æ­¤æ—¶å®ƒé”é‡Šæ”¾çš„é”ï¼Œå…¶å®é™…ä¸Šå¹¶éè¿™ä¸ªçº¿ç¨‹ï¼ˆThread-Aï¼‰æ‰€æŒæœ‰ï¼Œä»è€Œå†æ¬¡å¼•èµ·ç‰ˆæœ¬ä¸‰ç§æåˆ°çš„é—®é¢˜ã€‚</p><p>å‡ºç°è¿™æ ·çš„é—®é¢˜ï¼Œæ ¹æœ¬ä¸Šæ˜¯å› ä¸ºæ ¡éªŒé”æŒæœ‰è€…çš„æ“ä½œä¸é‡Šæ”¾é”æ“ä½œä¹‹é—´å­˜åœ¨æ—¶é—´ç©ºéš™ï¼Œå¯¼è‡´é”è¢«æå‰é‡Šæ”¾ï¼Œå› æ­¤ï¼Œè¦è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œå°±éœ€è¦ä¿è¯æ ¡éªŒé”æŒæœ‰è€…æ“ä½œå’Œé‡Šæ”¾é”æ“ä½œåŒæ—¶æ‰§è¡Œï¼Œå…·æœ‰åŸå­æ€§ã€‚</p><p>è¿™é‡Œæ¨èä½¿ç”¨ <code>Lua è„šæœ¬</code> ï¼Œæ¥ä¿è¯ä¸€ä¸ªåŸå­æ€§çš„æ“ä½œï¼ŒLua è„šæœ¬åŸºæœ¬è¯­æ³•ï¼Œå¯å‚è€ƒ <span class="exturl" data-url="aHR0cHM6Ly93d3cucnVub29iLmNvbS9sdWEvbHVhLXR1dG9yaWFsLmh0bWw=">Lua æ•™ç¨‹ | èœé¸Ÿæ•™ç¨‹</span>ã€‚</p><p>Lua è„šæœ¬ç¤ºä¾‹ï¼š</p><figure class="highlight shell"><figcaption data-lang="Bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment"># æ— å‚è„šæœ¬</span></pre></td></tr><tr><td data-num="2"></td><td><pre>EVAL <span class="token string">"return redis.call('set', 'name', 'chinmoku')"</span> <span class="token number">0</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token comment"># å¸¦å‚è„šæœ¬</span></pre></td></tr><tr><td data-num="4"></td><td><pre>EVAL <span class="token string">"return redis.call('set', KEYS[1], ARGV[1])"</span> <span class="token number">2</span> name chinmoku</pre></td></tr></table></figure><p>åŸºäº Lua è„šæœ¬ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡å¦‚ä¸‹æ–¹å¼æ¥è§£å†³ç‰ˆæœ¬ä¸‰ä¸­é—ç•™çš„é—®é¢˜ï¼š</p><ul><li><p>ç¼–å†™é‡Šæ”¾é”çš„ Lua è„šæœ¬ï¼š</p><figure class="highlight lua"><figcaption data-lang="lua"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">-- FileName: unlock.lua</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token comment">-- æ ¡éªŒé”æ‹¥æœ‰è€…</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">if</span> <span class="token punctuation">(</span>redis<span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token string">'get'</span><span class="token punctuation">,</span> KEYS<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">==</span> ARGV<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token keyword">then</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token comment">-- é‡Šæ”¾é” del key</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token keyword">return</span> redis<span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token string">'del'</span><span class="token punctuation">,</span> KEYS<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token keyword">end</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token keyword">return</span> <span class="token number">0</span></pre></td></tr></table></figure></li><li><p>åœ¨ä¸šåŠ¡ä¸­æ‰§è¡Œ Lua è„šæœ¬ï¼š</p><figure class="highlight java"><figcaption data-lang="java"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token class-name">String</span> lockKeyName <span class="token operator">=</span> <span class="token string">"lock:user:192838"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token class-name">String</span> threadId <span class="token operator">=</span> UUID<span class="token punctuation">.</span><span class="token function">randomUUID</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"-"</span> <span class="token operator">+</span> <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">DefaultRedisScript</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Long</span><span class="token punctuation">></span></span> UNLOCK_SCRIPT<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token keyword">static</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    UNLOCK_SCRIPT <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DefaultRedisScript</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="7"></td><td><pre>    UNLOCK_SCRIPT<span class="token punctuation">.</span><span class="token function">setLocation</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ClassPathResource</span><span class="token punctuation">(</span><span class="token string">"unlock.lua"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="8"></td><td><pre>    UNLOCK_SCRIPT<span class="token punctuation">.</span><span class="token function">setResultType</span><span class="token punctuation">(</span><span class="token class-name">Long</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="10"></td><td><pre></pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="12"></td><td><pre>    stringRedisTemplate<span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span>UNLOCK_SCRIPT<span class="token punctuation">,</span> <span class="token class-name">Collections</span><span class="token punctuation">.</span><span class="token function">singletonList</span><span class="token punctuation">(</span>lockKeyName<span class="token punctuation">)</span><span class="token punctuation">,</span> threadId<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="13"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure></li></ul></li></ol><h4 id="redisson"><a class="anchor" href="#redisson">#</a> Redisson</h4><p>ä¸Šè¿°å¯¹ Redis åˆ†å¸ƒå¼é”è¿›è¡Œäº†ä¸€ç³»åˆ—æ–¹æ¡ˆæ¢ç´¢ï¼Œå·²ç»èƒ½å¤Ÿè§£å†³å¤§éƒ¨åˆ†å¹¶å‘åœºæ™¯ä¸‹ Redis åˆ†å¸ƒå¼é”é—®é¢˜ï¼Œä½†è¿™ç§åŸºäº SETNX å‘½ä»¤å®ç°çš„åˆ†å¸ƒå¼é”ä»æ—§å­˜åœ¨ä¸€äº›ä¸è¶³ï¼Œä¾‹å¦‚ï¼š</p><ul><li>ä¸å¯é‡å…¥ï¼šåŒä¸€ä¸ªçº¿ç¨‹æ— æ³•å¤šæ¬¡è·å–åŒä¸€æŠŠé”ã€‚</li><li>ä¸å¯é‡è¯•ï¼šçº¿ç¨‹è·å–é”åªå°è¯•äº†ä¸€æ¬¡ï¼Œæ²¡æœ‰é‡è¯•æœºåˆ¶ã€‚</li><li>è¶…æ—¶é‡Šæ”¾ï¼šé”è¶…æ—¶é‡Šæ”¾è™½ç„¶å¯ä»¥é¿å…æ­»é”ï¼Œä½†å¦‚æœä¸šåŠ¡æ‰§è¡Œè€—æ—¶è¾ƒé•¿ï¼Œä»æ—§ä¼šå¯¼è‡´é”é‡Šæ”¾ï¼Œå› è€Œå­˜åœ¨å®‰å…¨éšæ‚£ã€‚</li><li>ä¸»ä»ä¸€è‡´æ€§ï¼šå¦‚æœ Redis æä¾›ä¸»ä»é›†ç¾¤ï¼Œä¸»ä»èŠ‚ç‚¹åŒæ­¥å­˜åœ¨å»¶è¿Ÿæ—¶ï¼Œå¦‚æœä¸»èŠ‚ç‚¹çªç„¶å®•æœºï¼Œæœªèƒ½å®ŒæˆåŒæ­¥ï¼Œåˆ™ä¼šå¯¼è‡´æ•°æ®ä¸ä¸€è‡´ã€‚</li></ul><p>é‰´äºå¦‚ä¸Šé—®é¢˜ï¼Œå¯ä»¥æ¨èä¸€ä¸ªæ›´åŠ ä½¿ç”¨çš„ Redis è§£å†³æ–¹æ¡ˆï¼Œå³ Redissonã€‚</p><p>Redisson æ˜¯ä¸€ä¸ªåœ¨ Redis åŸºç¡€ä¸Šå®ç°æ‰©å±•åº“ï¼Œå®ƒä¸ä»…æä¾›ä¸€ç³»åˆ—åˆ†å¸ƒå¼çš„ Java å¸¸ç”¨å¯¹è±¡ï¼Œè¿˜æä¾›äº†è®¸å¤šåˆ†å¸ƒå¼æœåŠ¡ï¼ŒåŒ…æ‹¬å„ç§åˆ†å¸ƒå¼é”çš„å®ç°ã€‚</p><p>å®˜ç½‘åœ°å€ï¼š<span class="exturl" data-url="aHR0cHM6Ly9yZWRpc3Nvbi5vcmc=">https://redisson.org</span></p><p>Github é¦–é¡µï¼š<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL3JlZGlzc29uL3JlZGlzc29u">https://github.com/redisson/redisson</span></p><p><strong>åŸºæœ¬ä½¿ç”¨ï¼š</strong></p><ol><li><p>å¼•å…¥ä¾èµ–ï¼š <code>org.redisson.redisson:3.13.6</code> ã€‚</p></li><li><p>å®¢æˆ·ç«¯é…ç½®ï¼š</p><figure class="highlight java"><figcaption data-lang="java"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token annotation punctuation">@Configuration</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">RedisConfig</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token annotation punctuation">@Bean</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token keyword">public</span> <span class="token class-name">RedissonClient</span> <span class="token function">redissonClient</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>        <span class="token class-name">Config</span> config <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Config</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>        config<span class="token punctuation">.</span><span class="token function">useSingleServer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setAddress</span><span class="token punctuation">(</span><span class="token string">"redis://127.0.0.1:6379"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setPassword</span><span class="token punctuation">(</span><span class="token string">"123456"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="7"></td><td><pre>      <span class="token keyword">return</span> <span class="token class-name">Redisson</span><span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>config<span class="token punctuation">)</span><span class="token punctuation">;</span>  </pre></td></tr><tr><td data-num="8"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure></li><li><p>æµ‹è¯•ä½¿ç”¨ï¼š</p><figure class="highlight java"><figcaption data-lang="java"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token annotation punctuation">@Resource</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">private</span> <span class="token class-name">RedissonClient</span> redissonClient<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token annotation punctuation">@Test</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token keyword">void</span> <span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    <span class="token class-name">RLock</span> lock <span class="token operator">=</span> redissonClient<span class="token punctuation">.</span><span class="token function">getLock</span><span class="token punctuation">(</span><span class="token string">"lock:order:123764"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="7"></td><td><pre>    <span class="token keyword">boolean</span> isLock <span class="token operator">=</span> lock<span class="token punctuation">.</span><span class="token function">tryLock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="8"></td><td><pre>    <span class="token keyword">if</span> <span class="token punctuation">(</span>isLock<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="9"></td><td><pre>        <span class="token keyword">try</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="10"></td><td><pre>            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"---> TODO æ‰§è¡Œä¸šåŠ¡é€»è¾‘"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="11"></td><td><pre>        <span class="token punctuation">&#125;</span> <span class="token keyword">finally</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="12"></td><td><pre>            lock<span class="token punctuation">.</span><span class="token function">unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="13"></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="14"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="15"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure></li></ol><p><strong>Redisson åˆ†å¸ƒå¼é”åŸç†</strong></p><p><img data-src="https://img.xfc-exclave.com/2022/03/3a5c08426d7714bd67041598cc8457561647263198.png" alt="redisson-lock"></p><p>Redisson å¦‚ä½•å¤„ç†åˆ†å¸ƒå¼é”é—®é¢˜ï¼š</p><ol><li><p>å¯é‡å…¥é—®é¢˜ï¼šåˆ©ç”¨ Hash ç»“æ„è®°å½•çº¿ç¨‹ ID å’Œé‡å…¥æ¬¡æ•°ã€‚</p></li><li><p>å¯é‡è¯•é—®é¢˜ï¼šåˆ©ç”¨ä¿¡å·é‡å’Œ PubSub åŠŸèƒ½å®ç°ç­‰å¾…ã€å”¤é†’ã€è·å–é”å¤±è´¥çš„é‡è¯•æœºåˆ¶ã€‚</p></li><li><p>è¶…æ—¶ç»­çº¦ï¼šåˆ©ç”¨ watchDogï¼Œæ¯éš”ä¸€æ®µæ—¶é—´ï¼ˆreleaseTime / 3ï¼‰é‡ç½®é”çš„è¶…æ—¶æ—¶é—´ã€‚</p></li><li><p>ä¸»ä»ä¸€è‡´æ€§é—®é¢˜ï¼š</p><p>Redisson ä½¿ç”¨è”é”ï¼ˆmultiLockï¼‰æœºåˆ¶ï¼ŒåŒæ—¶å­˜åœ¨å¤šä¸ª Redis ä¸»èŠ‚ç‚¹ï¼Œå¹¶ä¸”è·å–é”æ—¶ï¼Œéœ€è¦ä¿è¯æ‰€æœ‰ä¸»èŠ‚ç‚¹å†…è¯¥é”éƒ½å·²è¢«é‡Šæ”¾ã€‚</p><figure class="highlight java"><figcaption data-lang="java"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token annotation punctuation">@Resource</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">private</span> <span class="token class-name">RedissonClient</span> redissonClient1<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token annotation punctuation">@Resource</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token keyword">private</span> <span class="token class-name">RedissonClient</span> redissonClient2<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token annotation punctuation">@Resource</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token keyword">private</span> <span class="token class-name">RedissonClient</span> redissonClient3<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="7"></td><td><pre></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token keyword">private</span> <span class="token class-name">RLock</span> lock<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="9"></td><td><pre></pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token annotation punctuation">@BeforeEach</span></pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token keyword">void</span> <span class="token function">setUp</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="12"></td><td><pre>    <span class="token class-name">RLock</span> lock1 <span class="token operator">=</span> redissonClient1<span class="token punctuation">.</span><span class="token function">getLock</span><span class="token punctuation">(</span><span class="token string">"order"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="13"></td><td><pre>    <span class="token class-name">RLock</span> lock2 <span class="token operator">=</span> redissonClient2<span class="token punctuation">.</span><span class="token function">getLock</span><span class="token punctuation">(</span><span class="token string">"order"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="14"></td><td><pre>    <span class="token class-name">RLock</span> lock3 <span class="token operator">=</span> redissonClient3<span class="token punctuation">.</span><span class="token function">getLock</span><span class="token punctuation">(</span><span class="token string">"order"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="15"></td><td><pre>    lock <span class="token operator">=</span> redissonClient1<span class="token punctuation">.</span><span class="token function">getMultiLock</span><span class="token punctuation">(</span>lock1<span class="token punctuation">,</span> lock2<span class="token punctuation">,</span> lock3<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="16"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p>å…¶æœ¬è´¨ä¸Šæ˜¯å¯¹ MultiLock å†…æ‰€æœ‰çš„é”è¿›è¡Œéå†ã€‚</p></li></ol><h3 id="redis-æ¶ˆæ¯é˜Ÿåˆ—"><a class="anchor" href="#redis-æ¶ˆæ¯é˜Ÿåˆ—">#</a> Redis æ¶ˆæ¯é˜Ÿåˆ—</h3><p>é€šå¸¸ï¼Œå¯¹äºå¹¶å‘å’Œæ€§èƒ½è¦æ±‚éƒ½è¾ƒé«˜çš„ç³»ç»Ÿæˆ–ä¸šåŠ¡ï¼Œå¾€å¾€éœ€è¦å°†æµç¨‹åˆ†ç‰‡åŒ–ã€‚ä¾‹å¦‚å…¸å‹çš„ç§’æ€é¡¹ç›®ï¼Œå‡ºäºæ€§èƒ½è€ƒè™‘ï¼Œæˆ‘ä»¬é€šå¸¸ä¼šå°†è¾ƒä¸ºå¤æ‚çš„ã€è€—æ—¶è¾ƒé•¿ä½†æ— éœ€å³æ—¶è¿”å›ç»“æœçš„è¯·æ±‚å­˜å‚¨åˆ°æ¶ˆæ¯é˜Ÿåˆ—ä¸­ï¼Œå¼€å¯å¼‚æ­¥çº¿ç¨‹è¿›è¡Œå¤„ç†ï¼Œè¿™æ ·æ—¢ä¸ä¼šåˆ°å½±å“ä¸šåŠ¡ï¼ŒåŒæ—¶ä¹Ÿæé«˜äº†ç³»ç»Ÿçš„æ€§èƒ½ã€‚</p><p>ç›®å‰æ¯”è¾ƒæµè¡Œçš„æ¶ˆæ¯é˜Ÿåˆ—äº§å“åŒ…æ‹¬ï¼šRabbitMQã€ActiveMQã€RocketMQã€kafka ç­‰ã€‚</p><p>æ­¤å¤–ï¼ŒRedis ä¹Ÿæä¾›äº†ä¸‰ç§ä¸åŒçš„æ–¹å¼æ¥å®ç°æ¶ˆæ¯é˜Ÿåˆ—ï¼š</p><ol><li>List ç»“æ„ï¼šåŸºäº List ç»“æ„æ¨¡æ‹Ÿæ¶ˆæ¯é˜Ÿåˆ—ã€‚</li><li>PubSubï¼šåŸºæœ¬çš„ç‚¹å¯¹ç‚¹æ¶ˆæ¯æ¨¡å‹ã€‚</li><li>Streamï¼šæ¯”è¾ƒå®Œå–„çš„æ¶ˆæ¯é˜Ÿåˆ—æ¨¡å‹ï¼ˆæ¨èï¼‰ã€‚</li></ol><h4 id="åŸºäº-list-æ¨¡æ‹Ÿæ¶ˆæ¯é˜Ÿåˆ—"><a class="anchor" href="#åŸºäº-list-æ¨¡æ‹Ÿæ¶ˆæ¯é˜Ÿåˆ—">#</a> åŸºäº List æ¨¡æ‹Ÿæ¶ˆæ¯é˜Ÿåˆ—</h4><p>æ¶ˆæ¯é˜Ÿåˆ—ï¼Œç®€å•ç†è§£å³æ—¶å­˜æ”¾æ¶ˆæ¯çš„é˜Ÿåˆ—ï¼Œè€Œ Redis çš„ List æ•°æ®ç»“æ„æ˜¯ä¸€ä¸ªåŒå‘é“¾è¡¨ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥å¾ˆå®¹æ˜“åœ°é€šè¿‡ LPUSH ç»“åˆ RPOP æˆ– RPUSH ç»“åˆ LPOP æ¥æ¨¡æ‹Ÿå‡ºé˜Ÿåˆ—çš„æ•ˆæœã€‚</p><p>ä½†å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œå½“ Redis List ä¸­æ²¡æœ‰æ¶ˆæ¯æ—¶ï¼ŒRPOP æˆ– LPOP ä¼šè¿”å› nilï¼Œè€Œä¸æ˜¯åƒ JVM çš„é˜»å¡é˜Ÿåˆ—é‚£æ ·é˜»å¡å¹¶ç­‰å¾…æ¶ˆæ¯ï¼Œå› æ­¤ï¼Œåœ¨å–å‡ºæ¶ˆæ¯æ—¶åº”å½“ä½¿ç”¨ BRPOP æˆ– BLPOP æ¥å®ç°é˜»å¡æ•ˆæœã€‚</p><p>ç›¸æ¯” JVM é˜»å¡é˜Ÿåˆ—æ¥è¯´ï¼ŒRedis å®ç°çš„é˜»å¡é˜Ÿåˆ—å…·æœ‰å¦‚ä¸‹ä¼˜ç‚¹ï¼š</p><ol><li>ä¸å— JVM å†…å­˜å¤§å°é™åˆ¶ã€‚</li><li>åŸºäº Redis æŒä¹…åŒ–ï¼Œå¯ä»¥ä¿è¯æ•°æ®å®‰å…¨ã€‚</li><li>å¯ä»¥æ»¡è¶³æ¶ˆæ¯çš„æœ‰åºæ€§ã€‚</li></ol><p>ç¼ºç‚¹ï¼š</p><ol><li>æ— æ³•é¿å…æ¶ˆæ¯ä¸¢å¤±ï¼ˆå½“å–å‡ºæ¶ˆæ¯ä½†æœªåŠæ—¶å¤„ç†æ—¶ï¼ŒæœåŠ¡å‡ºç°å¼‚å¸¸ï¼Œä¼šå¯¼è‡´æ¶ˆæ¯ä¸¢å¤±ï¼‰ã€‚</li><li>åªæ”¯æŒå•æ¶ˆè´¹è€…ï¼Œæ— æ³•å®ç°å¤šæ¶ˆè´¹è€…åŒæ—¶æ¶ˆè´¹ã€‚</li></ol><h4 id="åŸºäº-pubsub-çš„æ¶ˆæ¯é˜Ÿåˆ—"><a class="anchor" href="#åŸºäº-pubsub-çš„æ¶ˆæ¯é˜Ÿåˆ—">#</a> åŸºäº PubSub çš„æ¶ˆæ¯é˜Ÿåˆ—</h4><p>PubSub æ˜¯ Redis 2.0 ç‰ˆæœ¬å¼•å…¥çš„æ¶ˆæ¯ä¼ é€’æ¨¡å‹ï¼Œæ¶ˆè´¹è€…å¯ä»¥è®¢é˜…ä¸€ä¸ªæˆ–å¤šä¸ª channelï¼Œç”Ÿäº§è€…æƒ³å¯¹åº”çš„ channel å‘é€æ¶ˆæ¯åï¼Œæ‰€æœ‰è®¢é˜…è€…éƒ½èƒ½æ”¶åˆ°ç›¸å…³æ¶ˆæ¯ã€‚</p><ul><li>SUBSCRIBE channel [channel] è®¢é˜…ä¸€ä¸ªæˆ–å¤šä¸ªé¢‘é“ã€‚</li><li>PUBLISH channel msg å‘ä¸€ä¸ªé¢‘é“å‘é€æ¶ˆæ¯ã€‚</li><li>PSUBSCRIBE pattern [pattern] è®¢é˜…ä¸ pattern æ ¼å¼åŒ¹é…çš„æ‰€æœ‰é¢‘é“ã€‚</li></ul><p>PubSub æœ‰ç‚¹ï¼š</p><ol><li>é‡‡ç”¨å‘å¸ƒè®¢é˜…æ¨¡å‹ï¼Œæ”¯æŒå¤šç”Ÿäº§ã€å¤šæ¶ˆè´¹ã€‚</li></ol><p>ç¼ºç‚¹ï¼š</p><ol><li>ä¸æ”¯æŒæ•°æ®æŒä¹…åŒ–ã€‚</li><li>æ— æ³•é¿å…æ¶ˆæ¯ä¸¢å¤±ã€‚</li><li>æ¶ˆæ¯å †ç§¯æœ‰ä¸Šé™ï¼Œè¶…å‡ºæ—¶æ¶ˆæ¯ä¼šä¸¢å¤±ã€‚</li></ol><h4 id="åŸºäº-stream-çš„æ¶ˆæ¯é˜Ÿåˆ—"><a class="anchor" href="#åŸºäº-stream-çš„æ¶ˆæ¯é˜Ÿåˆ—">#</a> åŸºäº Stream çš„æ¶ˆæ¯é˜Ÿåˆ—</h4><p>Stream æ˜¯ Redis 5.0 å¼•å…¥çš„ä¸€ç§æ–°çš„æ•°æ®ç±»å‹ï¼Œå¯ä»¥å®ç°ä¸€ä¸ªåŠŸèƒ½éå¸¸å®Œå–„çš„æ¶ˆæ¯é˜Ÿåˆ—ã€‚</p><p>Stream æ¶ˆæ¯é˜Ÿåˆ—ç›¸å…³å‘½ä»¤ï¼š</p><ol><li><p>XADD key *|ID field value [field value ...] å‘é€æ¶ˆæ¯ã€‚</p><figure class="highlight shell"><figcaption data-lang="Bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment"># æ·»åŠ æ¶ˆæ¯</span></pre></td></tr><tr><td data-num="2"></td><td><pre>XADD user:1001 * name chinmoku</pre></td></tr></table></figure></li><li><p>XREAD STREAMS key [key ...] ID [ID ...]</p><figure class="highlight shell"><figcaption data-lang="Bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment"># ä» 0 å¼€å§‹è¯»å–æ¶ˆæ¯</span></pre></td></tr><tr><td data-num="2"></td><td><pre>XREAD COUNT <span class="token number">1</span> STREAMS user:1001 <span class="token number">0</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token comment"># è¯»å–æœ€æ–°æ¶ˆæ¯</span></pre></td></tr><tr><td data-num="4"></td><td><pre>XREAD COUNT <span class="token number">1</span> STREAMS user:1001 $</pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token comment"># é˜»å¡è¯»å–æ¶ˆæ¯</span></pre></td></tr><tr><td data-num="6"></td><td><pre>XREAD COUNT <span class="token number">1</span> BLOCK <span class="token number">1000</span> STREAMS user:1001 $</pre></td></tr></table></figure></li></ol><p>å®ç°æ¶ˆæ¯é˜Ÿåˆ—ç¤ºä¾‹ï¼š</p><figure class="highlight java"><figcaption data-lang="java"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">while</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token comment">// å°è¯•è¯»å–é˜Ÿåˆ—ä¸­çš„æ¶ˆæ¯ï¼Œæœ€å¤šé˜»å¡ 2s</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token class-name">Object</span> msg <span class="token operator">=</span> redis<span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token string">"XREAD COUNT 1 BLOCK 2000 STREAMS user:1001 $"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token keyword">if</span> <span class="token punctuation">(</span>msg <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>        <span class="token keyword">continue</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="7"></td><td><pre>    <span class="token comment">// å¤„ç†æ¶ˆæ¯</span></pre></td></tr><tr><td data-num="8"></td><td><pre>    <span class="token function">handleMessage</span><span class="token punctuation">(</span>msg<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p>STREAM ç±»å‹æ¶ˆæ¯é˜Ÿåˆ—çš„ XREAD å‘½ä»¤ç‰¹ç‚¹ï¼š</p><ul><li>æ¶ˆæ¯å¯å›æº¯ã€‚</li><li>ä¸€ä¸ªæ¶ˆæ¯å¯ä»¥è¢«å¤šä¸ªæ¶ˆè´¹è€…è¯»å–ã€‚</li><li>å¯ä»¥é˜»å¡è¯»å–ã€‚</li><li>æœ‰æ¶ˆæ¯æ¼è¯»çš„é£é™©ã€‚</li></ul><p><strong>æ¶ˆè´¹è€…ç»„ï¼ˆConsumer Groupï¼‰</strong></p><p>ç”±äºå•æ¶ˆè´¹è€…å…·æœ‰æ¶ˆæ¯æ¼è¯»çš„é£é™©ï¼Œå› æ­¤å¼•å…¥äº†æ¶ˆè´¹è€…ç»„æ¦‚å¿µï¼Œæ‰€è°“æ¶ˆè´¹è€…ç»„ï¼Œå°±æ˜¯å°†å¤šä¸ªæ¶ˆè´¹è€…åˆ’åˆ†åˆ°ä¸€ä¸ªç»„ä¸­ï¼Œç›‘å¬åŒä¸€ä¸ªé˜Ÿåˆ—ï¼Œå®ƒå…·å¤‡å¦‚ä¸‹ç‰¹ç‚¹ï¼š</p><ol><li><p>æ¶ˆæ¯åˆ†æµï¼š</p><p>é˜Ÿåˆ—ä¸­çš„æ¶ˆæ¯ä¼šåˆ†æµç»™ç»„å†…çš„ä¸åŒæ¶ˆè´¹è€…ï¼Œè€Œä¸æ˜¯é‡å¤æ¶ˆè´¹ï¼Œä»è€ŒåŠ å¿«æ¶ˆæ¯å¤„ç†çš„é€Ÿåº¦ã€‚</p></li><li><p>æ¶ˆæ¯æ ‡ç¤ºï¼š</p><p>æ¶ˆè´¹è€…ç»„ä¼šç»´æŠ¤ä¸€ä¸ªæ ‡ç¤ºï¼Œè®°å½•æœ€åä¸€ä¸ªè¢«å¤„ç†çš„æ¶ˆæ¯ï¼Œå“ªæ€•æ¶ˆè´¹è€…å®•æœºé‡å¯ï¼Œä»æ—§ä¼šä»æ ‡ç¤ºä¹‹åè¯»å–æ¶ˆæ¯ï¼Œä¿è¯æ¯ä¸€æ¡æ¶ˆæ¯éƒ½ä¼šè¢«æ¶ˆè´¹ã€‚</p></li><li><p>æ¶ˆæ¯ç¡®è®¤ï¼š</p><p>æ¶ˆè´¹è€…è·å–æ¶ˆæ¯åï¼Œæ¶ˆæ¯å¤„äº pending çŠ¶æ€ï¼Œå¹¶å­˜å…¥ä¸€ä¸ª pending-list ä¸­ï¼Œå½“å¤„ç†å®Œæˆåéœ€è¦é€šè¿‡ XACK æ¥ç¡®è®¤æ¶ˆæ¯ï¼Œæ ‡è®°æ¶ˆæ¯ä¸ºå·²å¤„ç†ï¼Œè¿™æ—¶æ‰ä¼šä» pending-list ä¸­ç§»é™¤ã€‚</p></li></ol><p>Stream Consumer Group ç›¸å…³æ“ä½œå‘½ä»¤ï¼š</p><ol><li>XGROUP CREATE key groupName ID [MKSTREAM] åˆ›å»ºæ¶ˆè´¹è€…ç»„ã€‚</li><li>XGROUP DESTORY key groupName åˆ é™¤æ¶ˆè´¹è€…ç»„ã€‚</li><li>XGROUP CREATECONSUMER key groupName consumername ç»™æŒ‡å®šæ¶ˆè´¹è€…ç»„æ·»åŠ æ¶ˆè´¹è€…ã€‚</li><li>XGROUP DELCONSUMER key groupName consumername åˆ é™¤æ¶ˆè´¹è€…ç»„ä¸­æŒ‡å®šæ¶ˆè´¹è€…ã€‚</li><li>XREADGROUP GROUP group consumer STREAMS key [key ...] ID [ID ...] ä»æ¶ˆè´¹è€…ç»„è¯»å–æ¶ˆæ¯ã€‚</li><li>XACK key group ID [ID ...] ç¡®è®¤æ¶ˆæ¯ï¼ˆè¯»å–æ¶ˆæ¯åéœ€è¦è¿›è¡Œç¡®è®¤ï¼‰ã€‚</li><li>XPENDING key group [start end count] è·å–æœªç¡®è®¤çš„æ¶ˆæ¯ã€‚</li></ol><p>ä¼ªä»£ç å®ç°æ¶ˆè´¹è€…ç»„ç›‘å¬é€»è¾‘ï¼š</p><figure class="highlight java"><figcaption data-lang="java"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token function">white</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token comment">// å°è¯•ç›‘å¬é˜Ÿåˆ—ï¼Œä½¿ç”¨é˜»å¡æ¨¡å¼ï¼Œæœ€é•¿ç­‰å¾… 2000ms</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token class-name">Object</span> msg <span class="token operator">=</span> redis<span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token string">"XREADGROUP GROUP g1 c1 COUNT 1 BLOCK 200 STREAMS S1 >"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token keyword">if</span> <span class="token punctuation">(</span>msg <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token comment">// æ²¡æœ‰æ¶ˆæ¯ï¼Œåˆ™ç»§ç»­ä¸‹ä¸€æ¬¡</span></pre></td></tr><tr><td data-num="5"></td><td><pre>        <span class="token keyword">continue</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="7"></td><td><pre>    <span class="token keyword">try</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="8"></td><td><pre>        <span class="token comment">// å¤„ç†æ¶ˆæ¯ï¼Œå®Œæˆåå¹¶åš ACK</span></pre></td></tr><tr><td data-num="9"></td><td><pre>        <span class="token function">handleMessage</span><span class="token punctuation">(</span>msg<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="10"></td><td><pre>    <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span><span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="11"></td><td><pre>        <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="12"></td><td><pre>            <span class="token comment">// ä» pending-list ä¸­è¯»å–æ¶ˆæ¯</span></pre></td></tr><tr><td data-num="13"></td><td><pre>            <span class="token class-name">Object</span> msg <span class="token operator">=</span> redis<span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token string">"XREADGROUP GROUP g1 s1 COUNT 1 STREAMS s1 0"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="14"></td><td><pre>            <span class="token keyword">if</span> <span class="token punctuation">(</span>msg <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="15"></td><td><pre>                <span class="token keyword">break</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="16"></td><td><pre>            <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="17"></td><td><pre>            <span class="token keyword">try</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="18"></td><td><pre>                <span class="token comment">// å­˜åœ¨å¼‚å¸¸æ¶ˆæ¯ï¼Œå†æ¬¡å¤„ç†</span></pre></td></tr><tr><td data-num="19"></td><td><pre>                <span class="token function">handleMessage</span><span class="token punctuation">(</span>msg<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="20"></td><td><pre>            <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span><span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="21"></td><td><pre>                <span class="token comment">// å†æ¬¡å‡ºç°å¼‚å¸¸ï¼Œç»§ç»­å¾ªç¯</span></pre></td></tr><tr><td data-num="22"></td><td><pre>                <span class="token keyword">continue</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="23"></td><td><pre>            <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="24"></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="25"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="26"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p>STREAM ç±»å‹æ¶ˆæ¯é˜Ÿåˆ—çš„ XREADGROUP å‘½ä»¤ç‰¹ç‚¹ï¼š</p><ul><li>æ¶ˆæ¯å¯å›æº¯ã€‚</li><li>å¯ä»¥å¤šæ¶ˆè´¹è€…äº‰æŠ¢æ¶ˆæ¯ï¼ŒåŠ å¿«æ¶ˆè´¹é€Ÿåº¦ã€‚</li><li>å¯ä»¥é˜»å¡è¯»å–ã€‚</li><li>æ²¡æœ‰æ¶ˆæ¯æ¼è¯»é£é™©ã€‚</li><li>æœ‰æ¶ˆæ¯ç¡®è®¤æœºåˆ¶ï¼Œä¿è¯æ¶ˆæ¯è‡³å°‘è¢«æ¶ˆè´¹ä¸€æ¬¡ã€‚</li></ul><p><strong>Redis æ¶ˆæ¯é˜Ÿåˆ—å¯¹æ¯”ï¼š</strong></p><table><thead><tr><th></th><th>List</th><th>PubSub</th><th>Stream</th></tr></thead><tbody><tr><td>æ¶ˆæ¯æŒä¹…åŒ–</td><td>æ”¯æŒ</td><td>ä¸æ”¯æŒ</td><td>æ”¯æŒ</td></tr><tr><td>é˜»å¡è¯»å–</td><td>æ”¯æŒ</td><td>æ”¯æŒ</td><td>æ”¯æŒ</td></tr><tr><td>æ¶ˆæ¯å †ç§¯å¤„ç†</td><td>å—å†…å­˜ç©ºé—´é™åˆ¶ï¼Œå¯ä»¥åˆ©ç”¨å¤šæ¶ˆè´¹è€…åŠ å¿«å¤„ç†</td><td>å—é™äºæ¶ˆè´¹è€…ç¼“å†²åŒº</td><td>å—é™äºé˜Ÿåˆ—é•¿åº¦ï¼Œå¯ä»¥åˆ©ç”¨æ¶ˆè´¹è€…ç»„æé«˜æ¶ˆè´¹é€Ÿåº¦ï¼Œå‡å°‘å †ç§¯</td></tr><tr><td>æ¶ˆæ¯ç¡®è®¤æœºåˆ¶</td><td>ä¸æ”¯æŒ</td><td>ä¸æ”¯æŒ</td><td>æ”¯æŒ</td></tr><tr><td>æ¶ˆæ¯å›æº¯</td><td>ä¸æ”¯æŒ</td><td>ä¸æ”¯æŒ</td><td>æ”¯æŒ</td></tr></tbody></table><blockquote><p>ä½¿ç”¨ Redis ä½œä¸ºæ¶ˆæ¯é˜Ÿåˆ—ï¼Œæ¨èä½¿ç”¨ Streamï¼Œä½† Redis æ¯•ç«Ÿå¹¶éä¸»è¦ç”¨äºæ¶ˆæ¯é˜Ÿåˆ—ï¼Œå› æ­¤åœ¨å¯¹æ¶ˆæ¯é˜Ÿåˆ—æ€§èƒ½è¦æ±‚è¾ƒé«˜çš„é¡¹ç›®ä¸­ï¼Œè¿˜æ˜¯æ¨èä½¿ç”¨ä¸“é—¨çš„æ¶ˆæ¯é˜Ÿåˆ—äº§å“ã€‚</p></blockquote><h3 id="å‚è€ƒ"><a class="anchor" href="#å‚è€ƒ">#</a> å‚è€ƒ</h3><blockquote><p>å‚è€ƒå†…å®¹æ¥æºäºç½‘ç»œï¼Œæœ¬æ–‡ä¸ä¿è¯å‚è€ƒé“¾æ¥çš„é•¿æœŸæœ‰æ•ˆæ€§ï¼Œä»¥åŠå‚è€ƒå†…å®¹çš„åŸåˆ›æ€§ã€‚</p></blockquote><ul><li><p><span class="exturl" data-url="aHR0cHM6Ly9yZWRpcy5pby9jb21tYW5kcw==">https://redis.io/commands</span></p></li><li><p><span class="exturl" data-url="aHR0cHM6Ly93d3cuYmlsaWJpbGkuY29tL3ZpZGVvL0JWMWNyNHkxNjcxdA==">https://www.bilibili.com/video/BV1cr4y1671t</span></p><p><span class="label primary">â™¥ï¸ æ¨è</span> è¿™ä¸ªæ•™ç¨‹å¤§è‡´æ¶‰åŠäº† Redis åŸºç¡€åŠåŸç†ã€åˆ†å¸ƒå¼é”å’Œ Redis æ¶ˆæ¯é˜Ÿåˆ—è¿™å‡ å¤§å†…å®¹ï¼Œé‡ç‚¹å€¾å‘äº Redis åŸºç¡€åŠå¹¶å‘è§£å†³æ–¹æ¡ˆï¼Œç›®å‰ä¼¼ä¹ä»åœ¨æŒç»­æ›´æ–°ï¼Œç®¡é“ã€é›†ç¾¤ç­‰çŸ¥è¯†å¤§æ¦‚æ˜¯è¦ç­‰åç»­æ›´æ–°å§ã€‚æ€»ä½“æ„Ÿè§‰ç›¸å½“è‰¯å¥½ï¼Œç‰¹åˆ«æ˜¯ PPT åšå¾—çœŸçš„æ˜¯çœ¼å‰ä¸€äº®ã€‚ï¼ˆå°±äº‹è®ºäº‹ï¼‰</p></li><li><p><span class="exturl" data-url="aHR0cHM6Ly93d3cuY25ibG9ncy5jb20vaXRwbGF5L3AvMTEwOTg5OTAuaHRtbA==">https://www.cnblogs.com/itplay/p/11098990.html</span></p></li></ul><div class="tags"><a href="/tags/java/" rel="tag"><i class="ic i-tag"></i> java</a> <a href="/tags/Spring-Cloud-Alibaba/" rel="tag"><i class="ic i-tag"></i> Spring Cloud Alibaba</a></div></div><footer><div class="meta"><span id="computer-science/java-learning-path/3-advanced/redis-tutorial/" class="item leancloud_visitors" data-flag-title="Redis å¦‚ä½•ä¿è¯é«˜æ€§èƒ½" title="é–²è¦§æ•°"><span class="icon"><i class="ic i-eye"></i> </span><span class="text">é–²è¦§æ•°</span> <span class="leancloud-visitors-count"></span> <span class="text">å›</span></span></div><div class="reward"><button><i class="ic i-heartbeat"></i> å¯„ä»˜</button><p>*~(ï¿£â–½ï¿£)~[ãŠèŒ¶]ã‚’ä¸€æ¯ãã ã•ã„</p><div id="qr"><div><img data-src="/images/wechatpay.png" alt="ãƒãƒ³ãƒ¢ã‚¯ WeChat æ”¯æ‰•ã†"><p>WeChat æ”¯æ‰•ã†</p></div><div><img data-src="/images/alipay.png" alt="ãƒãƒ³ãƒ¢ã‚¯ Alipay"><p>Alipay</p></div><div><img data-src="/images/paypal.png" alt="ãƒãƒ³ãƒ¢ã‚¯ PayPal"><p>PayPal</p></div></div></div><div id="copyright"><ul><li class="author"><strong>è‘—è€…ï¼š </strong>ãƒãƒ³ãƒ¢ã‚¯ <i class="ic i-at"><em>@</em></i>ãƒãƒ³ãƒ¢ã‚¯ã®ãƒ–ãƒ­ã‚°</li><li class="link"><strong>è¨˜äº‹ã¸ã®ãƒªãƒ³ã‚¯ï¼š</strong> <a href="https://www.chinmoku.cc/computer-science/java-learning-path/3-advanced/redis-tutorial/" title="Redis å¦‚ä½•ä¿è¯é«˜æ€§èƒ½">https://www.chinmoku.cc/computer-science/java-learning-path/3-advanced/redis-tutorial/</a></li><li class="license"><strong>è‘—ä½œæ¨©è¡¨ç¤ºï¼š </strong>ã“ã®ãƒ–ãƒ­ã‚°å†…ã®ã™ã¹ã¦ã®è¨˜äº‹ã¯ã€ç‰¹åˆ¥ãªè¨˜è¼‰ãŒãªã„é™ã‚Š <span class="exturl" data-url="aHR0cHM6Ly9jcmVhdGl2ZWNvbW1vbnMub3JnL2xpY2Vuc2VzL2J5LW5jLXNhLzQuMC9kZWVkLnpo"><i class="ic i-creative-commons"><em>(CC)</em></i>BY-NC-SA</span> ã®ä¸‹ã®ãƒ©ã‚¤ã‚»ãƒ³ã‚¹ã§ä¿è­·ã•ã‚Œã¦ã„ã¾ã™ã€‚</li></ul></div></footer></article></div><div class="post-nav"><div class="item left"><a href="/blog-log/" itemprop="url" rel="prev" data-background-image="https:&#x2F;&#x2F;reference-1301046789.cos.ap-nanjing.myqcloud.com&#x2F;blog-img&#x2F;35500212880a11ebb6edd017c2d2eca2.png" title="ã€é•¿æœŸç½®é¡¶ã€‘åšå®¢æ–‡ç« æ›´æ–°æ—¥å¿—"><span class="type">å‰ã®è¨˜äº‹</span> <span class="category"><i class="ic i-flag"></i></span><h3>ã€é•¿æœŸç½®é¡¶ã€‘åšå®¢æ–‡ç« æ›´æ–°æ—¥å¿—</h3></a></div><div class="item right"><a href="/computer-science/web/react-tutorial/" itemprop="url" rel="next" data-background-image="https:&#x2F;&#x2F;reference-1301046789.cos.ap-nanjing.myqcloud.com&#x2F;blog-img&#x2F;82c137a7170d4b2cad69db1263f73469.jpg" title="React é€šå…³æŒ‡å—"><span class="type">æ¬¡ã®è¨˜äº‹</span> <span class="category"><i class="ic i-flag"></i> React æ•™ç¨‹</span><h3>React é€šå…³æŒ‡å—</h3></a></div></div><div class="wrap" id="comments"></div></div><div id="sidebar"><div class="inner"><div class="panels"><div class="inner"><div class="contents panel pjax" data-title="è¦‹å‡ºã—"><ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#redis-%E7%AE%80%E4%BB%8B"><span class="toc-number">1.</span> <span class="toc-text">Redis ç®€ä»‹</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8D%B8%E8%BD%BD%E5%AE%89%E8%A3%85"><span class="toc-number">2.</span> <span class="toc-text">å¸è½½å®‰è£…</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#redis-%E5%8D%B8%E8%BD%BD"><span class="toc-number">2.1.</span> <span class="toc-text">Redis å¸è½½</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#redis-%E5%AE%89%E8%A3%85"><span class="toc-number">2.2.</span> <span class="toc-text">Redis å®‰è£…</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#redis-%E8%BF%9E%E6%8E%A5"><span class="toc-number">2.3.</span> <span class="toc-text">Redis è¿æ¥</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#redis-%E5%91%BD%E4%BB%A4"><span class="toc-number">3.</span> <span class="toc-text">Redis å‘½ä»¤</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84"><span class="toc-number">3.1.</span> <span class="toc-text">æ•°æ®ç»“æ„</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%80%9A%E7%94%A8%E5%91%BD%E4%BB%A4"><span class="toc-number">3.2.</span> <span class="toc-text">é€šç”¨å‘½ä»¤</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#string-%E7%B1%BB%E5%9E%8B"><span class="toc-number">3.3.</span> <span class="toc-text">String ç±»å‹</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#hash-%E7%B1%BB%E5%9E%8B"><span class="toc-number">3.4.</span> <span class="toc-text">Hash ç±»å‹</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#list-%E7%B1%BB%E5%9E%8B"><span class="toc-number">3.5.</span> <span class="toc-text">List ç±»å‹</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#set-%E7%B1%BB%E5%9E%8B"><span class="toc-number">3.6.</span> <span class="toc-text">Set ç±»å‹</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#sortedset-%E7%B1%BB%E5%9E%8B"><span class="toc-number">3.7.</span> <span class="toc-text">SortedSet ç±»å‹</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#java-%E5%AE%A2%E6%88%B7%E7%AB%AF"><span class="toc-number">4.</span> <span class="toc-text">Java å®¢æˆ·ç«¯</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#jedis"><span class="toc-number">4.1.</span> <span class="toc-text">Jedis</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#springdataredis"><span class="toc-number">4.2.</span> <span class="toc-text">SpringDataRedis</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BC%93%E5%AD%98%E9%97%AE%E9%A2%98%E5%8F%8A%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88"><span class="toc-number">5.</span> <span class="toc-text">ç¼“å­˜é—®é¢˜åŠè§£å†³æ–¹æ¡ˆ</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%BC%93%E5%AD%98%E6%9B%B4%E6%96%B0%E7%AD%96%E7%95%A5"><span class="toc-number">5.1.</span> <span class="toc-text">ç¼“å­˜æ›´æ–°ç­–ç•¥</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%BC%93%E5%AD%98%E7%A9%BF%E9%80%8F"><span class="toc-number">5.2.</span> <span class="toc-text">ç¼“å­˜ç©¿é€</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%BC%93%E5%AD%98%E9%9B%AA%E5%B4%A9"><span class="toc-number">5.3.</span> <span class="toc-text">ç¼“å­˜é›ªå´©</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%BC%93%E5%AD%98%E5%87%BB%E7%A9%BF"><span class="toc-number">5.4.</span> <span class="toc-text">ç¼“å­˜å‡»ç©¿</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BB%A3%E7%A0%81%E5%AE%9E%E7%8E%B0"><span class="toc-number">5.5.</span> <span class="toc-text">ä»£ç å®ç°</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#redis-%E5%88%86%E5%B8%83%E5%BC%8F%E9%94%81"><span class="toc-number">6.</span> <span class="toc-text">Redis åˆ†å¸ƒå¼é”</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%9F%BA%E4%BA%8E-redis-%E5%AE%9E%E7%8E%B0%E5%88%86%E5%B8%83%E5%BC%8F%E9%94%81"><span class="toc-number">6.1.</span> <span class="toc-text">åŸºäº Redis å®ç°åˆ†å¸ƒå¼é”</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#redisson"><span class="toc-number">6.2.</span> <span class="toc-text">Redisson</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#redis-%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97"><span class="toc-number">7.</span> <span class="toc-text">Redis æ¶ˆæ¯é˜Ÿåˆ—</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%9F%BA%E4%BA%8E-list-%E6%A8%A1%E6%8B%9F%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97"><span class="toc-number">7.1.</span> <span class="toc-text">åŸºäº List æ¨¡æ‹Ÿæ¶ˆæ¯é˜Ÿåˆ—</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%9F%BA%E4%BA%8E-pubsub-%E7%9A%84%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97"><span class="toc-number">7.2.</span> <span class="toc-text">åŸºäº PubSub çš„æ¶ˆæ¯é˜Ÿåˆ—</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%9F%BA%E4%BA%8E-stream-%E7%9A%84%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97"><span class="toc-number">7.3.</span> <span class="toc-text">åŸºäº Stream çš„æ¶ˆæ¯é˜Ÿåˆ—</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8F%82%E8%80%83"><span class="toc-number">8.</span> <span class="toc-text">å‚è€ƒ</span></a></li></ol></div><div class="related panel pjax" data-title="é–¢é€£è¨˜äº‹"><ul><li><a href="/computer-science/java-learning-path/2-intermediate/spring-tutorial/" rel="bookmark" title="Spring æ•™ç¨‹">Spring æ•™ç¨‹</a></li><li><a href="/computer-science/java-learning-path/2-intermediate/mybatis-tutorial/" rel="bookmark" title="MyBatis æ•™ç¨‹">MyBatis æ•™ç¨‹</a></li><li><a href="/computer-science/java-learning-path/2-intermediate/springcloud-tutorial/" rel="bookmark" title="SpringCloud æ•™ç¨‹ï¼ˆFinchley.RELEASEï¼‰">SpringCloud æ•™ç¨‹ï¼ˆFinchley.RELEASEï¼‰</a></li><li><a href="/computer-science/java-learning-path/2-intermediate/webservice-tutorial/" rel="bookmark" title="WebServiceï¼Œå¦‚æ­¤è€Œå·²">WebServiceï¼Œå¦‚æ­¤è€Œå·²</a></li><li><a href="/computer-science/java-learning-path/2-intermediate/dubbo-tutorial/" rel="bookmark" title="Dubbo çŸ¥è¯†æ•´ç†">Dubbo çŸ¥è¯†æ•´ç†</a></li><li class="active"><a href="/computer-science/java-learning-path/3-advanced/redis-tutorial/" rel="bookmark" title="Redis å¦‚ä½•ä¿è¯é«˜æ€§èƒ½">Redis å¦‚ä½•ä¿è¯é«˜æ€§èƒ½</a></li></ul></div><div class="overview panel" data-title="æ¦‚è¦"><div class="author" itemprop="author" itemscope itemtype="http://schema.org/Person"><img class="image" itemprop="image" alt="ãƒãƒ³ãƒ¢ã‚¯" data-src="/images/avatar.jpg"><p class="name" itemprop="name">ãƒãƒ³ãƒ¢ã‚¯</p><div class="description" itemprop="description">æœ¬ç«™ä¸»è¦ä»¥ Java å¼€å‘æ€»ç»“æ–‡ç« ä¸ºä¸»ï¼Œä¹Ÿä¼šå‘æŠ€æœ¯å‘¨è¾¹è¿›è¡Œé€‚å½“çš„æ‰©å±•ã€‚æ­¤å¤–ï¼Œå¶å°”ä¼šæ›´æ–°éƒ¨åˆ†å…¶ä»–å­¦ä¹ æˆ–æ„Ÿå…´è¶£çš„å†…å®¹ï¼Œå¦‚è¯­è¨€å­¦ä¹ ã€æ–‡æœ¬ç¿»è¯‘ã€æ–‡è‰ºåˆ›ä½œç­‰ã€‚</div></div><nav class="state"><div class="item posts"><a href="/archives/"><span class="count">23</span> <span class="name">ãƒã‚¹ãƒˆ</span></a></div><div class="item categories"><a href="/categories/"><span class="count">15</span> <span class="name">ã‚«ãƒ†ã‚´ãƒª</span></a></div><div class="item tags"><a href="/tags/"><span class="count">20</span> <span class="name">ã‚¿ã‚°</span></a></div></nav><div class="social"><span class="exturl item github" data-url="aHR0cHM6Ly9naXRodWIuY29tL3hmYy1leGNsYXZl" title="https:&#x2F;&#x2F;github.com&#x2F;xfc-exclave"><i class="ic i-github"></i></span> <span class="exturl item twitter" data-url="aHR0cHM6Ly90d2l0dGVyLmNvbS95b3VybmFtZQ==" title="https:&#x2F;&#x2F;twitter.com&#x2F;yourname"><i class="ic i-twitter"></i></span> <span class="exturl item zhihu" data-url="aHR0cHM6Ly93d3cuemhpaHUuY29tL3Blb3BsZS95b3VybmFtZQ==" title="https:&#x2F;&#x2F;www.zhihu.com&#x2F;people&#x2F;yourname"><i class="ic i-zhihu"></i></span> <span class="exturl item music" data-url="aHR0cHM6Ly9tdXNpYy4xNjMuY29tLyMvdXNlci9ob21lP2lkPTExMjg2ODg2Mw==" title="https:&#x2F;&#x2F;music.163.com&#x2F;#&#x2F;user&#x2F;home?id&#x3D;112868863"><i class="ic i-cloud-music"></i></span> <span class="exturl item weibo" data-url="aHR0cHM6Ly93ZWliby5jb20vYW1laGltZQ==" title="https:&#x2F;&#x2F;weibo.com&#x2F;amehime"><i class="ic i-weibo"></i></span> <span class="exturl item about" data-url="aHR0cHM6Ly9hYm91dC5tZS95b3VybmFtZQ==" title="https:&#x2F;&#x2F;about.me&#x2F;yourname"><i class="ic i-address-card"></i></span> <span class="exturl item email" data-url="bWFpbHRvOnhmY19leGNsYXZlQDE2My5jb20=" title="mailto:xfc_exclave@163.com"><i class="ic i-envelope"></i></span></div><ul class="menu"><li class="item"><a href="/" rel="section"><i class="ic i-home"></i>ãƒ›ãƒ¼ãƒ </a></li><li class="item dropdown"><a href="javascript:void(0);"><i class="ic i-feather"></i>æŠ•ç¨¿</a><ul class="submenu"><li class="item"><a href="/archives/" rel="section"><i class="ic i-list-alt"></i>ã‚¢ãƒ¼ã‚«ã‚¤ãƒ–</a></li><li class="item"><a href="/categories/" rel="section"><i class="ic i-th"></i>ã‚«ãƒ†ã‚´ãƒª</a></li><li class="item"><a href="/tags/" rel="section"><i class="ic i-tags"></i>ã‚¿ã‚°</a></li></ul></li><li class="item dropdown"><a href="javascript:void(0);"><i class="ic i-link-circle"></i>ãƒªãƒ³ã‚¯</a><ul class="submenu"><li class="item"><a href="/friends/" rel="section"><i class="ic i-heart"></i>å‹äººå¸³</a></li><li class="item"><a href="/websites/" rel="section"><i class="ic i-sun"></i>ã‚µã‚¤ãƒˆ</a></li></ul></li><li class="item"><a href="/plan/" rel="section"><i class="ic i-stars"></i>å­¦ç¿’è¨ˆç”»</a></li></ul></div></div></div><ul id="quick"><li class="prev pjax"><a href="/blog-log/" rel="prev" title="å‰ã®è¨˜äº‹"><i class="ic i-chevron-left"></i></a></li><li class="up"><i class="ic i-arrow-up"></i></li><li class="down"><i class="ic i-arrow-down"></i></li><li class="next pjax"><a href="/computer-science/web/react-tutorial/" rel="next" title="æ¬¡ã®è¨˜äº‹"><i class="ic i-chevron-right"></i></a></li><li class="percent"></li></ul></div></div><div class="dimmer"></div></div></main><footer id="footer"><div class="inner"><div class="widgets"><div class="rpost pjax"><h2>ãƒ©ãƒ³ãƒ€ãƒ ãªè¨˜äº‹</h2><ul><li class="item"><div class="breadcrumb"><a href="/categories/computer-science/" title="ã‚«ãƒ†ã‚´ãƒª è®¡ç®—æœºç§‘å­¦">è®¡ç®—æœºç§‘å­¦</a> <i class="ic i-angle-right"></i> <a href="/categories/computer-science/java-learning-path/" title="ã‚«ãƒ†ã‚´ãƒª JAVA å­¦ä¹ è·¯çº¿">JAVA å­¦ä¹ è·¯çº¿</a> <i class="ic i-angle-right"></i> <a href="/categories/computer-science/java-learning-path/%E8%BF%9B%E9%98%B6%E7%AF%87/" title="ã‚«ãƒ†ã‚´ãƒª è¿›é˜¶ç¯‡">è¿›é˜¶ç¯‡</a></div><span><a href="/computer-science/java-learning-path/2-intermediate/springcloud-tutorial/" title="SpringCloud æ•™ç¨‹ï¼ˆFinchley.RELEASEï¼‰">SpringCloud æ•™ç¨‹ï¼ˆFinchley.RELEASEï¼‰</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/computer-science/" title="ã‚«ãƒ†ã‚´ãƒª è®¡ç®—æœºç§‘å­¦">è®¡ç®—æœºç§‘å­¦</a> <i class="ic i-angle-right"></i> <a href="/categories/computer-science/java-learning-path/" title="ã‚«ãƒ†ã‚´ãƒª JAVA å­¦ä¹ è·¯çº¿">JAVA å­¦ä¹ è·¯çº¿</a> <i class="ic i-angle-right"></i> <a href="/categories/computer-science/java-learning-path/%E5%9F%BA%E7%A1%80%E7%AF%87/" title="ã‚«ãƒ†ã‚´ãƒª åŸºç¡€ç¯‡">åŸºç¡€ç¯‡</a></div><span><a href="/computer-science/java-learning-path/1-basic/02-java-concurrency/" title="Java å¹¶å‘ç¼–ç¨‹çŸ¥è¯†æ•´ç†">Java å¹¶å‘ç¼–ç¨‹çŸ¥è¯†æ•´ç†</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/computer-science/" title="ã‚«ãƒ†ã‚´ãƒª è®¡ç®—æœºç§‘å­¦">è®¡ç®—æœºç§‘å­¦</a> <i class="ic i-angle-right"></i> <a href="/categories/computer-science/Python%E5%85%A5%E9%97%A8%E6%95%99%E7%A8%8B/" title="ã‚«ãƒ†ã‚´ãƒª Python å…¥é—¨æ•™ç¨‹">Python å…¥é—¨æ•™ç¨‹</a></div><span><a href="/computer-science/python/python-all-base/" title="Python åŸºç¡€çŸ¥è¯†å…¨é€šå…³">Python åŸºç¡€çŸ¥è¯†å…¨é€šå…³</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/computer-science/" title="ã‚«ãƒ†ã‚´ãƒª è®¡ç®—æœºç§‘å­¦">è®¡ç®—æœºç§‘å­¦</a> <i class="ic i-angle-right"></i> <a href="/categories/computer-science/java-learning-path/" title="ã‚«ãƒ†ã‚´ãƒª JAVA å­¦ä¹ è·¯çº¿">JAVA å­¦ä¹ è·¯çº¿</a> <i class="ic i-angle-right"></i> <a href="/categories/computer-science/java-learning-path/%E8%BF%9B%E9%98%B6%E7%AF%87/" title="ã‚«ãƒ†ã‚´ãƒª è¿›é˜¶ç¯‡">è¿›é˜¶ç¯‡</a></div><span><a href="/computer-science/java-learning-path/2-intermediate/spring-tutorial/" title="Spring æ•™ç¨‹">Spring æ•™ç¨‹</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/computer-science/" title="ã‚«ãƒ†ã‚´ãƒª è®¡ç®—æœºç§‘å­¦">è®¡ç®—æœºç§‘å­¦</a> <i class="ic i-angle-right"></i> <a href="/categories/computer-science/java-learning-path/" title="ã‚«ãƒ†ã‚´ãƒª JAVA å­¦ä¹ è·¯çº¿">JAVA å­¦ä¹ è·¯çº¿</a> <i class="ic i-angle-right"></i> <a href="/categories/computer-science/java-learning-path/%E6%89%A9%E5%B1%95%E7%AF%87/" title="ã‚«ãƒ†ã‚´ãƒª æ‰©å±•ç¯‡">æ‰©å±•ç¯‡</a></div><span><a href="/computer-science/java-learning-path/3-advanced/elasticsearch-tutorial/" title="Elasticsearch æ•™ç¨‹">Elasticsearch æ•™ç¨‹</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/computer-science/" title="ã‚«ãƒ†ã‚´ãƒª è®¡ç®—æœºç§‘å­¦">è®¡ç®—æœºç§‘å­¦</a> <i class="ic i-angle-right"></i> <a href="/categories/computer-science/WEB%E5%89%8D%E7%AB%AF/" title="ã‚«ãƒ†ã‚´ãƒª WEB å‰ç«¯">WEB å‰ç«¯</a> <i class="ic i-angle-right"></i> <a href="/categories/computer-science/WEB%E5%89%8D%E7%AB%AF/React-%E6%95%99%E7%A8%8B/" title="ã‚«ãƒ†ã‚´ãƒª React æ•™ç¨‹">React æ•™ç¨‹</a></div><span><a href="/computer-science/web/react-tutorial/" title="React é€šå…³æŒ‡å—">React é€šå…³æŒ‡å—</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/computer-science/" title="ã‚«ãƒ†ã‚´ãƒª è®¡ç®—æœºç§‘å­¦">è®¡ç®—æœºç§‘å­¦</a> <i class="ic i-angle-right"></i> <a href="/categories/computer-science/java-learning-path/" title="ã‚«ãƒ†ã‚´ãƒª JAVA å­¦ä¹ è·¯çº¿">JAVA å­¦ä¹ è·¯çº¿</a> <i class="ic i-angle-right"></i> <a href="/categories/computer-science/java-learning-path/%E8%BF%9B%E9%98%B6%E7%AF%87/" title="ã‚«ãƒ†ã‚´ãƒª è¿›é˜¶ç¯‡">è¿›é˜¶ç¯‡</a></div><span><a href="/computer-science/java-learning-path/2-intermediate/mybatis-tutorial/" title="MyBatis æ•™ç¨‹">MyBatis æ•™ç¨‹</a></span></li><li class="item"><div class="breadcrumb"></div><span><a href="/blog-log/" title="ã€é•¿æœŸç½®é¡¶ã€‘åšå®¢æ–‡ç« æ›´æ–°æ—¥å¿—">ã€é•¿æœŸç½®é¡¶ã€‘åšå®¢æ–‡ç« æ›´æ–°æ—¥å¿—</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/computer-science/" title="ã‚«ãƒ†ã‚´ãƒª è®¡ç®—æœºç§‘å­¦">è®¡ç®—æœºç§‘å­¦</a> <i class="ic i-angle-right"></i> <a href="/categories/computer-science/Python%E5%85%A5%E9%97%A8%E6%95%99%E7%A8%8B/" title="ã‚«ãƒ†ã‚´ãƒª Python å…¥é—¨æ•™ç¨‹">Python å…¥é—¨æ•™ç¨‹</a></div><span><a href="/computer-science/python/django-tutorial/" title="Django ç½‘ç«™å…¨æ ˆå¼€å‘æ•™ç¨‹">Django ç½‘ç«™å…¨æ ˆå¼€å‘æ•™ç¨‹</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/computer-science/" title="ã‚«ãƒ†ã‚´ãƒª è®¡ç®—æœºç§‘å­¦">è®¡ç®—æœºç§‘å­¦</a> <i class="ic i-angle-right"></i> <a href="/categories/computer-science/JAVA-%E5%AD%A6%E4%B9%A0%E8%B7%AF%E7%BA%BF/" title="ã‚«ãƒ†ã‚´ãƒª JAVA å­¦ä¹ è·¯çº¿">JAVA å­¦ä¹ è·¯çº¿</a> <i class="ic i-angle-right"></i> <a href="/categories/computer-science/java-learning-path/%E6%89%A9%E5%B1%95%E7%AF%87/" title="ã‚«ãƒ†ã‚´ãƒª æ‰©å±•ç¯‡">æ‰©å±•ç¯‡</a></div><span><a href="/computer-science/java-learning-path/6-extension/quartz-tutorial/" title="Quartz å¿«é€Ÿå…¥é—¨åŠå¸¸è§„ä½¿ç”¨">Quartz å¿«é€Ÿå…¥é—¨åŠå¸¸è§„ä½¿ç”¨</a></span></li></ul></div><div><h2>æœ€è¿‘ã®ã‚³ãƒ¡ãƒ³ãƒˆ</h2><ul class="leancloud-recent-comment"></ul></div></div><div class="status"><div class="copyright">&copy; 2020 â€“ <span itemprop="copyrightYear">2022</span> <span class="with-love"><i class="ic i-sakura rotate"></i> </span><span class="author" itemprop="copyrightHolder">ãƒãƒ³ãƒ¢ã‚¯ @ Chinmoku</span></div><div class="count"><span class="post-meta-item-icon"><i class="ic i-chart-area"></i> </span><span title="å˜èªã®ç·æ•°">593k å˜èª</span> <span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="ic i-coffee"></i> </span><span title="èª­æ›¸ã®åˆè¨ˆæ™‚é–“">8:59</span></div><div class="powered-by">Powered by <span class="exturl" data-url="aHR0cHM6Ly9oZXhvLmlv">Hexo</span> & Theme.<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2FtZWhpbWUvaGV4by10aGVtZS1zaG9rYQ==">Shoka</span></div></div></div></footer></div><script data-config type="text/javascript">var LOCAL={path:"computer-science/java-learning-path/3-advanced/redis-tutorial/",favicon:{show:"ï¼ˆâ—Â´3ï½€â—ï¼‰ã‚„ã‚Œã‚„ã‚Œã ãœ",hide:"(Â´Ğ”ï½€)å¤§å¤‰ã ï¼"},search:{placeholder:"æ¤œç´¢â€¦",empty:"ã€Œ ${query} ã€ã«ã¤ã„ã¦ã¯ä½•ã‚‚è¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸ",stats:"${time} msä»¥å†…ã« ${hits} ä»¶ã®çµæœãŒè¦‹ã¤ã‹ã‚Šã¾ã—ãŸ"},valine:!0,fancybox:!0,copyright:"ã‚³ãƒ”ãƒ¼ã¯æˆåŠŸã—ã¾ã—ãŸã€‚ <br> å†å°åˆ·ã«ã¤ã„ã¦ã¯ã€ ï¼…s å¥‘ç´„ã«å¾“ã£ã¦ãã ã•ã„ã€‚",ignores:[function(e){return e.includes("#")},function(e){return new RegExp(LOCAL.path+"$").test(e)}]}</script><script src="https://cdn.polyfill.io/v2/polyfill.js"></script><script src="//cdn.jsdelivr.net/combine/npm/pace-js@1.0.2/pace.min.js,npm/pjax@0.2.8/pjax.min.js,npm/whatwg-fetch@3.4.0/dist/fetch.umd.min.js,npm/animejs@3.2.0/lib/anime.min.js,npm/algoliasearch@4/dist/algoliasearch-lite.umd.js,npm/instantsearch.js@4/dist/instantsearch.production.min.js,npm/lozad@1/dist/lozad.min.js,npm/quicklink@2/dist/quicklink.umd.js"></script><script src="/js/app.js?v=0.2.5"></script></body></html>